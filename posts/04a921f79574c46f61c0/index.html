<!DOCTYPE html><html lang="en"><head><meta name="generator" content="React Static"/><meta charSet="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, shrink-to-fit=no"/><link rel="preload" as="script" href="/templates/styles.f7428a48.js"/><link rel="preload" as="script" href="/templates/vendors~main.3a8adc8b.js"/><link rel="preload" as="script" href="/main.53c1473c.js"/><link rel="preload" as="style" href="/styles.1048b661.css"/><link rel="stylesheet" href="/styles.1048b661.css"/><link rel="shortcut icon" href="/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="48x48" href="/favicon-48x48.png"/><link rel="manifest" href="/manifest.json"/><meta name="mobile-web-app-capable" content="yes"/><meta name="theme-color" content="#fff"/><meta name="application-name"/><link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png"/><link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png"/><link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png"/><link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png"/><link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png"/><link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png"/><link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png"/><link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png"/><link rel="apple-touch-icon" sizes="167x167" href="/apple-touch-icon-167x167.png"/><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png"/><link rel="apple-touch-icon" sizes="1024x1024" href="/apple-touch-icon-1024x1024.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/><meta name="apple-mobile-web-app-title"/><link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-640x1136.png"/><link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-750x1334.png"/><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-828x1792.png"/><link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/apple-touch-startup-image-1125x2436.png"/><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/apple-touch-startup-image-1242x2208.png"/><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/apple-touch-startup-image-1242x2688.png"/><link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-1536x2048.png"/><link rel="apple-touch-startup-image" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-1668x2224.png"/><link rel="apple-touch-startup-image" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-1668x2388.png"/><link rel="apple-touch-startup-image" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-2048x2732.png"/><link rel="apple-touch-startup-image" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-1620x2160.png"/><link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-1136x640.png"/><link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-1334x750.png"/><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-1792x828.png"/><link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="/apple-touch-startup-image-2436x1125.png"/><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="/apple-touch-startup-image-2208x1242.png"/><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="/apple-touch-startup-image-2688x1242.png"/><link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-2048x1536.png"/><link rel="apple-touch-startup-image" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-2224x1668.png"/><link rel="apple-touch-startup-image" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-2388x1668.png"/><link rel="apple-touch-startup-image" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-2732x2048.png"/><link rel="apple-touch-startup-image" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-2160x1620.png"/><link rel="icon" type="image/png" sizes="228x228" href="/coast-228x228.png"/><meta name="msapplication-TileColor" content="#fff"/><meta name="msapplication-TileImage" content="/mstile-144x144.png"/><meta name="msapplication-config" content="/browserconfig.xml"/><link rel="yandex-tableau-widget" href="/yandex-browser-manifest.json"/></head><body><div id="root"><div style="outline:none" tabindex="-1"><nav class="navbar is-dark is-fixed-top" role="navigation" aria-label="main navigation"><div class="container"><div class="navbar-brand"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/posts">Posts</a><a class="navbar-item" href="/events">Events</a><a class="navbar-item" href="/github">GitHub</a></div></div></nav><div class="container"><div class="is-primary" style="padding:4.5rem 0.5rem"><div style="outline:none" tabindex="-1"><div><a href="/posts">&lt;<!-- --> Back</a><br/><h3>[ AWS ] 初めてLambda-PythonとDynamoDBに触る人に参考になるかもな話</h3><article class="md-body">
<h1>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>

<p>　最近サーバレスアーキテクチャに興味を持っています。以下2エントリーはGoogle Apps ScriptでJava Scriptを使った時の記事ですが、今回はAWS上のLambdaを使って、サーバーレスでPythonコードを実行させることをやっていきたいと思います。記事の内容は、Pythonほぼ初めまして&amp;&amp;AWSほぼ初めましての人が、LambdaとDynamoDBでいろいろできるようになるまでの記録を書いていきます。<br>
　また最初AWS分かんなさすぎて最初は絶望していたし、Lambdaはエラー出まくって初見殺しだし、Python興味はあるけど使ったこと少なめと、かなり初心者目線で記事を書いていきたいと思ってます。写真多め、初心者がわかる程度の内容を、ひとつずつ書いていく感じですので、PythonistとAWS上級者の方は新しいことはないかと思いますが、どうぞよろしくお願いします。</p>

<p>この前書いた記事<br>
- <a href="http://qiita.com/ykhirao/items/782e20ab0465533c48f6" id="reference-15eb3319b9855f190901">月末営業日にタスクをリマインドする</a><br>
- <a href="http://qiita.com/ykhirao/items/09ebaedd0f6f0438f422" id="reference-29cb99f0d0f1d9c020a7">Googleカレンダー 自社版</a></p>

<h2>
<span id="前提" class="fragment"></span><a href="#%E5%89%8D%E6%8F%90"><i class="fa fa-link"></i></a>前提</h2>

<p>AWS初めまして<br>
Python歴2週間くらい<br>
AWSサービス登録済、無料枠中</p>

<h1>
<span id="aws" class="fragment"></span><a href="#aws"><i class="fa fa-link"></i></a>AWS</h1>

<p>自分の場合は、AWSのサービスの多さに混乱したので、どのサービスがどのサービスとつながってるのか、まず概要を勉強しました。下記あたりが参考になるかと思います。またKindleで無料の書籍とか探しました。「ってますが、自分で使いながら、この記事を見直しながらいろいろやってみました。</p>

<p><a href="http://qiita.com/kohashi/items/1bb952313fb695f12577" id="reference-a810c093d7c16de23cbb">「AWS is 何」を3行でまとめてみるよ</a><br>
<a href="http://qiita.com/chroju/items/c7ad918d79b0288bc490" id="reference-4de5e496aa23f9a6e691">AWS1年目無料期間でやったこととハマったこと</a></p>

<h2>
<span id="登録" class="fragment"></span><a href="#%E7%99%BB%E9%8C%B2"><i class="fa fa-link"></i></a>登録</h2>

<p>登録済みと仮定しているのでAWS登録は別の記事を参照ください。</p>

<h2>
<span id="ロール作成" class="fragment"></span><a href="#%E3%83%AD%E3%83%BC%E3%83%AB%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>ロール作成</h2>

<p>AWSロールがないといろいろ面倒なので、<br>
S3,DynamoDB,Lambdaにフルアクセスできるロールを今回作ります。</p>

<p><a href="https://us-west-2.console.aws.amazon.com/console/home" rel="nofollow noopener" target="_blank">AWSサービス一覧</a>からIAM</p>

<p><a href="https://camo.qiitausercontent.com/d478dc689f9049446a3fd1a8af11c93c025f5f75/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131323932392f35623661336631392d313266332d633436392d393166362d3339653063646231313637662e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2F5b6a3f19-12f3-c469-91f6-39e0cdb1167f.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=e4b961b64587c0810a86846df96f11d0" alt="スクリーンショット 2017-03-15 14.22.30.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/112929/5b6a3f19-12f3-c469-91f6-39e0cdb1167f.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2F5b6a3f19-12f3-c469-91f6-39e0cdb1167f.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=074871da599987ed70c01bd0bc104bda 1x" loading="lazy"></a></p>

<p>ロール &gt;&gt; 新しいロールの作成</p>

<p><a href="https://camo.qiitausercontent.com/7d0f5639983c61e54bfb45e8e03497e817790046/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131323932392f39383039346133642d313166372d306563392d346362662d3837313966323536383836642e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2F98094a3d-11f7-0ec9-4cbf-8719f256886d.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=35b619cd185f27cea0645be7fcb72091" alt="スクリーンショット 2017-03-15 14.22.43.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/112929/98094a3d-11f7-0ec9-4cbf-8719f256886d.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2F98094a3d-11f7-0ec9-4cbf-8719f256886d.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=67bbcfca4a563c596b65fb677b7327de 1x" loading="lazy"></a></p>

<p>ロールの名前<br>
今回は[lambda_dynamo]</p>

<p><a href="https://camo.qiitausercontent.com/f786709322318d70a43d2e84b16903fa683883d6/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131323932392f39396331613762612d336663312d643266342d346362302d6632306532363565303965642e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2F99c1a7ba-3fc1-d2f4-4cb0-f20e265e09ed.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=ee17c95f1db732281b3d80e25334d1de" alt="スクリーンショット 2017-03-15 14.22.48.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/112929/99c1a7ba-3fc1-d2f4-4cb0-f20e265e09ed.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2F99c1a7ba-3fc1-d2f4-4cb0-f20e265e09ed.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=e086ab5296990dcc8bab6573e8763df0 1x" loading="lazy"></a></p>

<p>Amazon Lambda &gt;&gt; 選択</p>

<p><a href="https://camo.qiitausercontent.com/a0951796d2028065ce022f8ea5ab4812c50c30d3/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131323932392f61306165633261632d376165312d383130392d653039662d6463366361653661316631392e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2Fa0aec2ac-7ae1-8109-e09f-dc6cae6a1f19.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=5a33f7a56ed4d320d7254e086c50bd9c" alt="スクリーンショット 2017-03-15 14.27.00.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/112929/a0aec2ac-7ae1-8109-e09f-dc6cae6a1f19.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2Fa0aec2ac-7ae1-8109-e09f-dc6cae6a1f19.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=99f96b6d1f4eb79fec81eb22c6a5b1e0 1x" loading="lazy"></a></p>

<p>とりあえず今回はFullAccessを3つ付けます。<br>
AWSLambdaFullAccess<br>
AmazonS3FullAccess<br>
AmazonDynamoDBFullAccess</p>

<p>次のステップ</p>

<p><a href="https://camo.qiitausercontent.com/e44dca66ebdef7f5d59e2445e91e40a3598df78a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131323932392f63343631616263652d633964382d343265302d363066342d3062393663623932313035322e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2Fc461abce-c9d8-42e0-60f4-0b96cb921052.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=70d9c7a2a7da6bc586f5a295e2045c4d" alt="スクリーンショット 2017-03-15 14.27.27.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/112929/c461abce-c9d8-42e0-60f4-0b96cb921052.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2Fc461abce-c9d8-42e0-60f4-0b96cb921052.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=5c849347cde5bb68f001126ec9a0ef10 1x" loading="lazy"></a></p>

<p>ロール &gt;&gt; lambda_dynamo<br>
といいう項目が追加されてたらOkay。</p>

<p><a href="https://camo.qiitausercontent.com/aedc22f12385f6a63d9e7ea54c9bb480596d41c5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131323932392f31626631346238332d633463622d346661612d346531382d3538373130646366616436642e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2F1bf14b83-c4cb-4faa-4e18-58710dcfad6d.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=882f30b01fef07648b7197cd74f501c0" alt="スクリーンショット 2017-03-15 14.33.21.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/112929/1bf14b83-c4cb-4faa-4e18-58710dcfad6d.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2F1bf14b83-c4cb-4faa-4e18-58710dcfad6d.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=7910a61b731e3e145d21f8541947e6ac 1x" loading="lazy"></a></p>

<h1>
<span id="lambda" class="fragment"></span><a href="#lambda"><i class="fa fa-link"></i></a>Lambda</h1>

<p>サーバーレスでスクリプト実行できるサービスです。便利。</p>

<h2>
<span id="料金体系" class="fragment"></span><a href="#%E6%96%99%E9%87%91%E4%BD%93%E7%B3%BB"><i class="fa fa-link"></i></a>料金体系</h2>

<p>基本的にいくらテストに使っても大丈夫！<a href="https://aws.amazon.com/jp/lambda/pricing/" rel="nofollow noopener" target="_blank">公式</a></p>

<p>ラムダ無料枠</p>

<table>
<thead>
<tr>
<th style="text-align: center">1ヶ月</th>
<th style="text-align: center">リクエスト</th>
<th style="text-align: center">コンピューティング時間 [GB*秒]</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center"></td>
<td style="text-align: center">1,000,000</td>
<td style="text-align: center">400,000</td>
</tr>
</tbody>
</table>

<p>リクエスト:関数全体に対する合計リクエスト数<br>
コンピューティング時間: メモリ数と時間をかけたもの</p>

<p>Lambdaの最小メモリが128MBなので1ヶ月3,200,000秒()使えば、400,000[GB*sec]に到達します。<br>
<code>(128.0[MB] / 1024[MB/GB]) * 3200000[sec] = 400,000[GB*sec]</code><br>
なので、888時間くらいスクリプト動いても大丈夫。どんどん使おう。<br>
(時間の計算は一応自分でやってみてくださいね！)</p>

<h2>
<span id="テストコードを使ってみるpythonエラー" class="fragment"></span><a href="#%E3%83%86%E3%82%B9%E3%83%88%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8Bpython%E3%82%A8%E3%83%A9%E3%83%BC"><i class="fa fa-link"></i></a>テストコードを使ってみる(Pythonエラー)</h2>

<p><a href="https://us-west-2.console.aws.amazon.com/console/home" rel="nofollow noopener" target="_blank">AWSサービス一覧</a>からLambda</p>

<h3>
<span id="最初の関数作成" class="fragment"></span><a href="#%E6%9C%80%E5%88%9D%E3%81%AE%E9%96%A2%E6%95%B0%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>最初の関数作成</h3>

<p>Lambda 関数の作成 &gt;&gt; lambda-canary</p>

<p><a href="https://camo.qiitausercontent.com/3ae46df63f007c68787e34b6ec0f494f18b567fe/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131323932392f63346538353566362d383161322d336564382d653039392d3163366533346364343364652e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2Fc4e855f6-81a2-3ed8-e099-1c6e34cd43de.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=74e03bf67beaf82c9a81db87766cd1b2" alt="スクリーンショット 2017-03-15 14.52.52.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/112929/c4e855f6-81a2-3ed8-e099-1c6e34cd43de.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2Fc4e855f6-81a2-3ed8-e099-1c6e34cd43de.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=2199b1f4443d0208c0eeb52986eb54ff 1x" loading="lazy"></a></p>

<p>[ トリガーの設定 ] &gt;&gt; 削除 &gt;&gt; 次へ<br>
ここで何分ごとに一度スクリプトを実行とかいじれます。<br>
が後でも設定できるので今回は削除します。</p>

<p>[ 関数の設定 ]<br>
名前をとりあえず[ sample ]にしました。</p>

<p><a href="https://camo.qiitausercontent.com/a5f2a2336886a48ce83490a936c29f7ea332f0bc/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131323932392f30613338636234652d326537312d366264622d363233302d6165626161646630643336392e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2F0a38cb4e-2e71-6bdb-6230-aebaadf0d369.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=d5ffcfe2281a5b9d67e9cada65ab27a6" alt="スクリーンショット 2017-03-15 14.57.34.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/112929/0a38cb4e-2e71-6bdb-6230-aebaadf0d369.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2F0a38cb4e-2e71-6bdb-6230-aebaadf0d369.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=5d761e82c3f7423281919089a50b1d91 1x" loading="lazy"></a></p>

<p>ロールを先程つくったロールにして関数作成します。<br>
lambda_dynamo</p>

<h3>
<span id="最初のテスト" class="fragment"></span><a href="#%E6%9C%80%E5%88%9D%E3%81%AE%E3%83%86%E3%82%B9%E3%83%88"><i class="fa fa-link"></i></a>最初のテスト</h3>

<div class="code-frame" data-lang="python"><div class="highlight"><pre><code><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">urllib2</span> <span class="kn">import</span> <span class="n">urlopen</span>

<span class="n">SITE</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">[</span><span class="s">'site'</span><span class="p">]</span>  <span class="c1"># URL of the site to check, stored in the site environment variable
</span><span class="n">EXPECTED</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">[</span><span class="s">'expected'</span><span class="p">]</span>  <span class="c1"># String expected to be on the page, stored in the expected environment variable
</span>

<span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="n">res</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">EXPECTED</span> <span class="ow">in</span> <span class="n">res</span>


<span class="k">def</span> <span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Checking {} at {}...'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">SITE</span><span class="p">,</span> <span class="n">event</span><span class="p">[</span><span class="s">'time'</span><span class="p">]))</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">validate</span><span class="p">(</span><span class="n">urlopen</span><span class="p">(</span><span class="n">SITE</span><span class="p">).</span><span class="n">read</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="nb">Exception</span><span class="p">(</span><span class="s">'Validation failed'</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'Check failed!'</span><span class="p">)</span>
        <span class="k">raise</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'Check passed!'</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">event</span><span class="p">[</span><span class="s">'time'</span><span class="p">]</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'Check complete at {}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="p">.</span><span class="n">now</span><span class="p">())))</span>

</code></pre></div></div>

<p><a href="https://camo.qiitausercontent.com/798384903299ef1fa7b4068224a31607e18a57f4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131323932392f35336335633537302d626434392d666239372d323838382d6162333461366437346632322e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2F53c5c570-bd49-fb97-2888-ab34a6d74f22.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=23c0527125220d9e19b41c95bf39c660" alt="スクリーンショット 2017-03-15 15.06.42.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/112929/53c5c570-bd49-fb97-2888-ab34a6d74f22.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2F53c5c570-bd49-fb97-2888-ab34a6d74f22.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=3d24836f995c008a193006df6bd1c2e5 1x" loading="lazy"></a></p>

<p>はい出ましたエラー。</p>

<div class="code-frame" data-lang="shell-session"><div class="highlight"><pre><code><span class="go">    print('Checking {} at {}...'.format(SITE, event['time']))
KeyError: 'time'
</span></code></pre></div></div>

<p>このエラーを解決する前にデフォルトで使用される変数を見ていきます。</p>

<h3>
<span id="デフォルトで使用される変数" class="fragment"></span><a href="#%E3%83%87%E3%83%95%E3%82%A9%E3%83%AB%E3%83%88%E3%81%A7%E4%BD%BF%E7%94%A8%E3%81%95%E3%82%8C%E3%82%8B%E5%A4%89%E6%95%B0"><i class="fa fa-link"></i></a>デフォルトで使用される変数</h3>

<ul>
<li>event - testで設定したところとか、トリガー発生元のイベントデータ</li>
<li>Context - <a href="https://docs.aws.amazon.com/ja_jp/lambda/latest/dg/python-context-object.html#python-context-object-methods" rel="nofollow noopener" target="_blank">Context オブジェクト (Python)</a>
</li>
<li>os.environ - コード自体を変更せずに、AWS上で環境変数を設定できる</li>
</ul>

<blockquote>
<p>event &gt;&gt; AWS Lambda はこのパラメーターを使用してイベントデータをハンドラーに渡します。このパラメータは通常、Python の dict タイプです。また、list、str、int、float、または NoneType タイプを使用できます。</p>

<p>context &gt;&gt; AWS Lambda はこのパラメーターを使用してランタイム情報をハンドラーに提供します。このパラメータは LambdaContext タイプになります。</p>
</blockquote>

<p>となってます。</p>

<blockquote>
<p>os.environで取れるところはこの環境変数</p>
</blockquote>

<p><a href="https://camo.qiitausercontent.com/95689abe5dd1748c5adb9e53fa14b92136de4c5f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131323932392f61333062643464372d383837622d613333392d313565352d3337346638306463383837382e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2Fa30bd4d7-887b-a339-15e5-374f80dc8878.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=2a913808b89626d055416e86855a946b" alt="スクリーンショット 2017-03-15 15.15.28.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/112929/a30bd4d7-887b-a339-15e5-374f80dc8878.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2Fa30bd4d7-887b-a339-15e5-374f80dc8878.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=5868118c70f538db974c09311d0794df 1x" loading="lazy"></a></p>

<h3>
<span id="time-" class="fragment"></span><a href="#time-"><i class="fa fa-link"></i></a>time ?</h3>

<p>さて先程のエラーを処理していきます。</p>

<p><a href="https://camo.qiitausercontent.com/f856a31a1ae93d9051c6d39a92ac9344eab0b908/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131323932392f64663438383730362d643331612d336132312d303832652d3966373934373962313064332e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2Fdf488706-d31a-3a21-082e-9f79479b10d3.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=5618d54eef5fe276e1e767bedfef934d" alt="スクリーンショット 2017-03-15 15.11.53.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/112929/df488706-d31a-3a21-082e-9f79479b10d3.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2Fdf488706-d31a-3a21-082e-9f79479b10d3.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=f138d31554a85a88551bc2b8eef4425a 1x" loading="lazy"></a></p>

<p>テストイベントの設定のtimeを追加します。</p>

<div class="code-frame" data-lang="json"><div class="highlight"><pre><code><span class="p">{</span><span class="w">
  </span><span class="nl">"key3"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value3"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"key2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value2"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"key1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value1"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"now...!"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>これでTimeの部分でエラーはでないと思います。</p>

<div class="code-frame" data-lang="shell-session"><div class="highlight"><pre><code><span class="gp">START RequestId: a8708105-0948-11e7-b83e-b71ae2e4dbbe Version: $</span>LATEST
<span class="go">Checking https://www.amazon.com/ at now...!...
Check failed!
Check complete at 2017-03-15 06:28:53.016209
HTTP Error 503: Service Unavailable: HTTPError
Traceback (most recent call last):
  (省略)
  File "/usr/lib64/python2.7/urllib2.py", line 556, in http_error_default
    raise HTTPError(req.get_full_url(), code, msg, hdrs, fp)
HTTPError: HTTP Error 503: Service Unavailable

END RequestId: a8708105-0948-11e7-b83e-b71ae2e4dbbe
REPORT RequestId: a8708105-0948-11e7-b83e-b71ae2e4dbbe  Duration: 348.59 ms Billed Duration: 400 ms     Memory Size: 128 MB Max Memory Used: 17 MB
</span></code></pre></div></div>

<p>まだエラーでるのでいろいろやっていきます。</p>

<h3>
<span id="except例外処理してるのになんでエラーでるねん" class="fragment"></span><a href="#except%E4%BE%8B%E5%A4%96%E5%87%A6%E7%90%86%E3%81%97%E3%81%A6%E3%82%8B%E3%81%AE%E3%81%AB%E3%81%AA%E3%82%93%E3%81%A7%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%A7%E3%82%8B%E3%81%AD%E3%82%93"><i class="fa fa-link"></i></a>except例外処理してるのになんでエラーでるねん！</h3>

<p>まずは赤い画面でるの嫌なので、urlのリクエスト失敗してもエラーをでなくします。</p>

<div class="code-frame" data-lang="py"><div class="highlight"><pre><code>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">validate</span><span class="p">(</span><span class="n">urlopen</span><span class="p">(</span><span class="n">SITE</span><span class="p">).</span><span class="n">read</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="nb">Exception</span><span class="p">(</span><span class="s">'Validation failed'</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'Check failed!'</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div></div>

<p>Pythonの場合、最後にraiseをいれると、エラーをexceptでキャッチしたのをそのまま素のpython文にエラーを戻しちゃいます。これを書き換えます。</p>

<div class="code-frame" data-lang="python"><div class="highlight"><pre><code>
<span class="k">def</span> <span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Checking {} at {}...'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">SITE</span><span class="p">,</span> <span class="n">event</span><span class="p">[</span><span class="s">'time'</span><span class="p">]))</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">validate</span><span class="p">(</span><span class="n">urlopen</span><span class="p">(</span><span class="n">SITE</span><span class="p">).</span><span class="n">read</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="nb">Exception</span><span class="p">(</span><span class="s">'Validation failed'</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'Check failed!'</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'Check passed!'</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">event</span><span class="p">[</span><span class="s">'time'</span><span class="p">]</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'Check complete at {}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="p">.</span><span class="n">now</span><span class="p">())))</span>

</code></pre></div></div>

<p>やっと緑チェックの成功がでました…！！！！</p>

<p><a href="https://camo.qiitausercontent.com/af18459ba5152d3e053b98285397b08abcf0fc7f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131323932392f30666239663033302d616638612d333264392d653734662d3236306364613761666534652e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2F0fb9f030-af8a-32d9-e74f-260cda7afe4e.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=f73a361299b5a88efacea511723b9c6d" alt="スクリーンショット 2017-03-15 15.44.10.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/112929/0fb9f030-af8a-32d9-e74f-260cda7afe4e.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2F0fb9f030-af8a-32d9-e74f-260cda7afe4e.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=8b6679debb1306f8e7d978d77ebfabb9 1x" loading="lazy"></a></p>

<p><code>except Exception as e:</code>でエラーをキャッチして<br>
<code>print(e)</code>でエラー出力して<br>
<code>raise</code>削除して、とりあえずはエラーでなくしました。</p>

<p>このあたりのpythonのエラーハンドリングかなり調べました。raise。。</p>

<h3>
<span id="http-error-503" class="fragment"></span><a href="#http-error-503"><i class="fa fa-link"></i></a>HTTP Error 503</h3>

<p>エラーがまだ続いてるので<code>HTTP Error 503: Service Unavailable: HTTPError</code>の部分を見ていきます。<br>
また、Validation failedという文字がないので<code>validate(urlopen(SITE).read())</code>この部分で返ってきたエラーが上記のエラーだと判断していきます。</p>

<div class="code-frame" data-lang="python"><div class="highlight"><pre><code><span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="n">res</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">EXPECTED</span> <span class="ow">in</span> <span class="n">res</span>
</code></pre></div></div>

<p>こちらは <a href="https://www.amazon.com/" class="autolink" rel="nofollow noopener" target="_blank">https://www.amazon.com/</a> にアクセスして、返ってきたｈｔｍｌファイルの中に「Online Shopping」という文字があるかどうかの診断になります。</p>

<p>とりあえずAmazonからGoogleへのアクセスへ、環境変数の変更をする<br>
* <a href="https://www.google.co.jp/" class="autolink" rel="nofollow noopener" target="_blank">https://www.google.co.jp/</a><br>
* Gmail</p>

<p>そうすると</p>

<div class="code-frame" data-lang="shell-session"><div class="highlight"><pre><code><span class="go">
Checking https://www.google.co.jp/ at now...!...
Check passed!
Check complete at 2017-03-15 07:00:05.723916

</span></code></pre></div></div>

<p>やっとCheck passed!が出ました。</p>

<blockquote>
<p>503 Service Unavailable<br>
サービス利用不可。サービスが一時的に過負荷やメンテナンスで使用不可能である。<br>
例として、アクセスが殺到して処理不能に陥った場合に返される。</p>
</blockquote>

<p><a href="https://www.amazon.com/" class="autolink" rel="nofollow noopener" target="_blank">https://www.amazon.com/</a> <br>
が落ちるわけないじゃーん。って心のそこから思って環境変数を返してチェックしてみることを失念してました。ただのGoogleサービスに変えたらうまくいきました。<br>
Lambdaからのアクセス拒否してるの？</p>

<p>ハマったところです。</p>

<h3>
<span id="indent" class="fragment"></span><a href="#indent"><i class="fa fa-link"></i></a>indent</h3>

<p>Pythonのエラーですがインデックスの数とかでも何回かエラー出しました。</p>

<div class="code-frame" data-lang="shell-session"><div class="highlight"><pre><code><span class="go">Syntax error in module 'lambda_function': 
unexpected indent (lambda_function.py, line 30)
</span></code></pre></div></div>

<p>このあたり勉強したのですが、タブとスペース(4つ)の戦争ですね。<br>
<a href="http://www.gizmodo.jp/2016/09/tab-vs-space.html" rel="nofollow noopener" target="_blank">プログラミングのコードを書く時のタブvsスペース戦争がついに決着</a><br>
pythonはスペースで書くのが一般的だということが書かれてます。</p>

<p>自分がローカルで編集してたファイルがtabで入っていて<br>
AWS上で編集したコードはスペース4つで入ります。<br>
このindentエラーを見たくないのでスペース派に乗り換えました。</p>

<h3>
<span id="requests" class="fragment"></span><a href="#requests"><i class="fa fa-link"></i></a>Requests</h3>

<p>urlopenをそのまま使ってもいいのですがrequestsを導入したいと思います。</p>

<p><a href="http://d.hatena.ne.jp/yumimue/20071231/1199129495" rel="nofollow noopener" target="_blank">python urllib2モジュール</a><br>
<a href="http://requests-docs-ja.readthedocs.io/en/latest/" rel="nofollow noopener" target="_blank">Requests: 人間のためのHTTP</a><br>
<a href="https://gist.github.com/kennethreitz/973705" rel="nofollow noopener" target="_blank">Requestsを使わずに同じ事をするためのコード</a></p>

<p>slackとかにメッセージ送るのが簡単になります。</p>

<div class="code-frame" data-lang="python">
<div class="code-lang"><span class="bold">今のコード.py</span></div>
<div class="highlight"><pre><code><span class="c1"># coding: utf-8
</span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">urllib2</span> <span class="kn">import</span> <span class="n">urlopen</span>

<span class="n">SITE</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">[</span><span class="s">'site'</span><span class="p">]</span>
<span class="n">EXPECTED</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">[</span><span class="s">'expected'</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="n">res</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">EXPECTED</span> <span class="ow">in</span> <span class="n">res</span>

<span class="k">def</span> <span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Checking {} at {}...'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">SITE</span><span class="p">,</span> <span class="n">event</span><span class="p">[</span><span class="s">'time'</span><span class="p">]))</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">validate</span><span class="p">(</span><span class="n">urlopen</span><span class="p">(</span><span class="n">SITE</span><span class="p">).</span><span class="n">read</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="nb">Exception</span><span class="p">(</span><span class="s">'Validation failed'</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'Check failed!'</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'Check passed!'</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'Check complete at {}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="p">.</span><span class="n">now</span><span class="p">())))</span>
        <span class="k">return</span> <span class="s">"Finish"</span>

</code></pre></div>
</div>

<div class="code-frame" data-lang="shell-session"><div class="highlight"><pre><code><span class="go">Unable to import module 'lambda_function': No module named requests
</span></code></pre></div></div>

<p>requestsは外部モジュールなのでこんなエラーおきます。</p>

<h2>
<span id="外部モジュールの使用" class="fragment"></span><a href="#%E5%A4%96%E9%83%A8%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%AE%E4%BD%BF%E7%94%A8"><i class="fa fa-link"></i></a>外部モジュールの使用</h2>

<p>requestsみたいなPython標準外のモジュールを入れるのにも一癖あったので書いていきます。</p>

<ul>
<li>lambda-uploaderを使ってリモート</li>
<li>ローカルで自分でzipにかためてUP</li>
</ul>

<h3>
<span id="lambda-uploader" class="fragment"></span><a href="#lambda-uploader"><i class="fa fa-link"></i></a>lambda-uploader</h3>

<p>このあたりが参考になります。</p>

<p><a href="http://qiita.com/Esfahan/items/08fa6af8811dada4cb2a" id="reference-3d9aa0b1c65c395d42a4">lambda-uploaderを使ってAWS Lambdaをリモートで開発、実行、デプロイする</a><br>
<a href="http://dev.classmethod.jp/cloud/deploy-aws-lambda-python-with-lambda-uploader/" rel="nofollow noopener" target="_blank">AWS Lambda Pythonをlambda-uploaderでデプロイ</a></p>

<h3>
<span id="自分のコードをzipアップロード" class="fragment"></span><a href="#%E8%87%AA%E5%88%86%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92zip%E3%82%A2%E3%83%83%E3%83%97%E3%83%AD%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>自分のコードをZIPアップロード</h3>

<p>自分はこれで行いました。単発だとすぐできる。<br>
<a href="http://qiita.com/Hironsan/items/0eb5578f3321c72637b4" id="reference-4dd871d93361b26b3044">【AWS】Lambdaでpipしたいと思ったときにすべきこと</a></p>

<p>作業フォルダに<code>pip install requests -t .</code>して、それをzipで固めてアップする感じです。</p>

<p>無事アップロードできたら、先程の<code>今のコード.py</code>からスタートします。</p>

<h2>
<span id="slack" class="fragment"></span><a href="#slack"><i class="fa fa-link"></i></a>Slack</h2>

<p>import <br>
* urllib2<br>
* requests<br>
* どっちでも可</p>

<p>api<br>
* Slack api(token取得してごにょごにょ xoxp-12131212こんなやつ)<br>
* Webhook(urlだけ取ってくる)<br>
* どっちでも可</p>

<p>どの組み合わせを使っても良いのですが、今回は簡単なrequests * Webhookを使います。</p>

<p>こちらWebhookのURL取得はこちらを参考に！<br>
<a href="http://qiita.com/vmmhypervisor/items/18c99624a84df8b31008" id="reference-a01b885ea53ea7354206">SlackのWebhook URL取得手順</a></p>

<div class="code-frame" data-lang="python"><div class="highlight"><pre><code><span class="k">def</span> <span class="nf">send_slack</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s">"先程げっとしたURL"</span>
    <span class="n">payload_dic</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"text"</span><span class="p">:</span><span class="n">text</span><span class="p">,</span>
        <span class="s">"icon_emoji"</span><span class="p">:</span><span class="s">':grin:'</span><span class="p">,</span>
        <span class="s">"channel"</span><span class="p">:</span><span class="s">'bot-test2'</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">payload_dic</span><span class="p">))</span>
</code></pre></div></div>

<p>たったこれだけでSlack送れます！</p>

<div class="code-frame" data-lang="python"><div class="highlight"><pre><code><span class="c1"># coding: utf-8
</span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">urllib2</span> <span class="kn">import</span> <span class="n">urlopen</span>

<span class="n">SITE</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">[</span><span class="s">'site'</span><span class="p">]</span>
<span class="n">EXPECTED</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">[</span><span class="s">'expected'</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="n">res</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">EXPECTED</span> <span class="ow">in</span> <span class="n">res</span>

<span class="k">def</span> <span class="nf">web_check</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">validate</span><span class="p">(</span><span class="n">urlopen</span><span class="p">(</span><span class="n">SITE</span><span class="p">).</span><span class="n">read</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="nb">Exception</span><span class="p">(</span><span class="s">'Validation failed'</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'Check failed!'</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'Check passed!'</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'Check complete at {}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="p">.</span><span class="n">now</span><span class="p">())))</span>

<span class="k">def</span> <span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Checking {} at {}...'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">SITE</span><span class="p">,</span> <span class="n">event</span><span class="p">[</span><span class="s">'time'</span><span class="p">]))</span>
    <span class="c1"># web_check()
</span>    <span class="n">send_slack</span><span class="p">(</span><span class="s">"test"</span><span class="p">)</span>
    <span class="k">return</span> <span class="s">"success!"</span>

<span class="k">def</span> <span class="nf">send_slack</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s">"こちら自分のURL"</span>
    <span class="n">payload_dic</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"text"</span><span class="p">:</span><span class="n">text</span><span class="p">,</span>
        <span class="s">"icon_emoji"</span><span class="p">:</span><span class="s">':grin:'</span><span class="p">,</span>
        <span class="s">"channel"</span><span class="p">:</span><span class="s">'bot-test2'</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">payload_dic</span><span class="p">))</span>


</code></pre></div></div>

<p><code>def web_check():</code>に処理を移して置きました。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code>def lambda_handler(event, context):
    print('Checking {} at {}...'.format(SITE, event['time']))
    # web_check()
    send_slack("test")
    return "success!"
</code></pre></div></div>

<p>これで</p>

<p><a href="https://camo.qiitausercontent.com/23e831030b9e580f8597ad709ffcc8a2fbc4ccdc/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131323932392f62336364323839302d303066332d356337642d306666322d3430313664393461613431372e706e67" target="_blank" rel="nofollow noopener"><img width="760" alt="スクリーンショット 2017-03-15 16.55.31.png" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2Fb3cd2890-00f3-5c7d-0ff2-4016d94aa417.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=90e87855869ce070705fd203e3dc65fa" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/112929/b3cd2890-00f3-5c7d-0ff2-4016d94aa417.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2Fb3cd2890-00f3-5c7d-0ff2-4016d94aa417.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=b3ba890f1bfb02bae52cdce7568a3339 1x" loading="lazy"></a><br>
Slack到着しました。</p>

<p>Okay。<br>
次はDynamoDBからデータを取ってきます。</p>

<h1>
<span id="dynamodb" class="fragment"></span><a href="#dynamodb"><i class="fa fa-link"></i></a>DynamoDB</h1>

<h2>
<span id="料金体系-1" class="fragment"></span><a href="#%E6%96%99%E9%87%91%E4%BD%93%E7%B3%BB-1"><i class="fa fa-link"></i></a>料金体系</h2>

<p>AWS の無料利用枠の一部としてのDynamoDB無料枠</p>

<table>
<thead>
<tr>
<th style="text-align: center">ストレージ</th>
<th style="text-align: center">書き込み容量</th>
<th style="text-align: center">書き込み容量</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center">25GB</td>
<td style="text-align: center">25</td>
<td style="text-align: center">25</td>
</tr>
</tbody>
</table>

<blockquote>
<p>1 つの容量のユニットで 1 秒あたりに 1 つのリクエストを処理します<br>
1ユニットの書き込み容量: 最大1KBデータを1秒に1書き込み<br>
1ユニットの読み込み容量: 最大4KBデータを1秒に1読み込み<br>
DynamoDB ストリームからの 250 万回の読み込みリクエストを無料で利用できます。</p>
</blockquote>

<p>とりあえずデータベースを作る時に書き込み容量と読み込み容量を1にセットして使えば、無料枠だとお金かからないと思います。<br>
今回は1分に1度くらいでもいいので、最小単位の1(1秒に1度アクセスできるレベル)を選びます。</p>

<h2>
<span id="作ってみる" class="fragment"></span><a href="#%E4%BD%9C%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>作ってみる</h2>

<p>とりあえず設定はこんな感じ。</p>

<p><a href="https://camo.qiitausercontent.com/e8b3da60bed5d16323f30e1a45ce118e562363f5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131323932392f39383434363062372d386463352d633264352d333166342d6162356238303736373963302e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2F984460b7-8dc5-c2d5-31f4-ab5b807679c0.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=e09245884c341858e798a2bf449ae35e" alt="スクリーンショット 2017-03-15 17.10.25.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/112929/984460b7-8dc5-c2d5-31f4-ab5b807679c0.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2F984460b7-8dc5-c2d5-31f4-ab5b807679c0.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=14ef6909a249447d1075862b99e22fe5 1x" loading="lazy"></a></p>

<p>DynamoDBはハッシュ(言語によっては辞書型、連想配列など)のKeyでしかアクセスできません。今回はidをkeyとしてアクセスします。</p>

<p><a href="https://camo.qiitausercontent.com/456ad6b5288496ab9ee9734b092f406a2a88f9aa/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131323932392f30613836313233372d646230662d333731652d343539362d3461643662633438386539342e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2F0a861237-db0f-371e-4596-4ad6bc488e94.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=7148e5adb30fb0ae0ec2c07be4fbe5ec" alt="スクリーンショット 2017-03-15 17.15.28.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/112929/0a861237-db0f-371e-4596-4ad6bc488e94.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2F0a861237-db0f-371e-4596-4ad6bc488e94.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=9f21c61c847813fb1b3454885520e7be 1x" loading="lazy"></a></p>

<div class="code-frame" data-lang="json"><div class="highlight"><pre><code><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="nl">"target"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Online Shopping"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://www.amazon.com/"</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="p">{</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
  </span><span class="nl">"target"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Gmail"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://www.google.co.jp/"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>urlからtargetを探すためのTableとして使います。</p>

<h2>
<span id="pythonコードから先程のデータを取ってみる" class="fragment"></span><a href="#python%E3%82%B3%E3%83%BC%E3%83%89%E3%81%8B%E3%82%89%E5%85%88%E7%A8%8B%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E5%8F%96%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>pythonコードから先程のデータを取ってみる</h2>

<div class="code-frame" data-lang="python"><div class="highlight"><pre><code><span class="c1"># ２つ追加
</span><span class="kn">import</span> <span class="nn">boto3</span>
<span class="kn">from</span> <span class="nn">boto3.dynamodb.conditions</span> <span class="kn">import</span> <span class="n">Key</span><span class="p">,</span> <span class="n">Attr</span>

<span class="k">def</span> <span class="nf">get_urls</span><span class="p">():</span>
    <span class="n">table</span>    <span class="o">=</span> <span class="n">dynamodb</span><span class="p">.</span><span class="n">Table</span><span class="p">(</span><span class="s">'sites'</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">table</span><span class="p">.</span><span class="n">scan</span><span class="p">()</span>
    <span class="n">sites</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s">"Items"</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">sites</span>
</code></pre></div></div>

<p>機能を追加して、get_urls()でDynamoDBから取ってきたurlからtargetの文章があるかサーチしています。</p>

<div class="code-frame" data-lang="python">
<div class="code-lang"><span class="bold">現在の.py</span></div>
<div class="highlight"><pre><code><span class="c1"># coding: utf-8
</span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">urllib2</span> <span class="kn">import</span> <span class="n">urlopen</span>
<span class="kn">import</span> <span class="nn">boto3</span>
<span class="kn">from</span> <span class="nn">boto3.dynamodb.conditions</span> <span class="kn">import</span> <span class="n">Key</span><span class="p">,</span> <span class="n">Attr</span>

<span class="n">dynamodb</span> <span class="o">=</span> <span class="n">boto3</span><span class="p">.</span><span class="n">resource</span><span class="p">(</span><span class="s">'dynamodb'</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">res</span>

<span class="k">def</span> <span class="nf">web_check</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Serching ... "</span> <span class="o">+</span> <span class="n">target</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">validate</span><span class="p">(</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">).</span><span class="n">read</span><span class="p">(),</span> <span class="n">target</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"Find!"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"Not Find!"</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'Error'</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_urls</span><span class="p">():</span>
    <span class="n">table</span>    <span class="o">=</span> <span class="n">dynamodb</span><span class="p">.</span><span class="n">Table</span><span class="p">(</span><span class="s">'sites'</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">table</span><span class="p">.</span><span class="n">scan</span><span class="p">()</span>
    <span class="n">sites</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s">"Items"</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">sites</span>

<span class="k">def</span> <span class="nf">send_slack</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s">"https://hooks.slack.com/services/"</span>
    <span class="n">payload_dic</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"text"</span><span class="p">:</span><span class="n">text</span><span class="p">,</span>
        <span class="s">"icon_emoji"</span><span class="p">:</span><span class="s">':grin:'</span><span class="p">,</span>
        <span class="s">"channel"</span><span class="p">:</span><span class="s">'bot-test2'</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">payload_dic</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Check start'</span><span class="p">)</span>

    <span class="n">sites</span> <span class="o">=</span> <span class="n">get_urls</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">sites</span><span class="p">:</span>
        <span class="n">web_check</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">site</span><span class="p">[</span><span class="s">"url"</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">site</span><span class="p">[</span><span class="s">"target"</span><span class="p">]))</span>

    <span class="k">return</span> <span class="s">"success!"</span>


</code></pre></div>
</div>

<p>出力結果</p>

<div class="code-frame" data-lang="shell-session"><div class="highlight"><pre><code><span class="go">
Check start
Serching ... 技術情報共有サービスです at https://qiita.com/
Find!
Serching ... Gmail at https://www.google.co.jp/
Find!
Serching ... Gmailですか？ at https://www.google.co.jp/
Not Find!
Serching ... Online Shopping at https://www.amazon.com/
Error
HTTP Error 503: Service Unavailable
END RequestId: 3992d81e-095e-11e7-b30a-1ddc7da9e992
</span></code></pre></div></div>

<p>ここでもエラーおきました。Pythonつまづく！</p>

<div class="code-frame" data-lang="shell-session"><div class="highlight"><pre><code><span class="go">
'utf8' codec can't decode byte 0x90 in position 102: invalid start byte
</span></code></pre></div></div>

<p><a href="http://lab.hde.co.jp/2008/08/pythonunicodeencodeerror.html" rel="nofollow noopener" target="_blank">PythonのUnicodeEncodeErrorを知る</a><br>
ここを参考にエラー解決しました。<br>
<code>type(site["url"])</code>したら<code>&lt;type 'unicode'&gt;</code>だったので、<br>
<code>str(site["url"])</code>をして<code>&lt;type 'str'&gt;</code>に変えました。</p>

<h2>
<span id="lambdaからdynamodb書き込み" class="fragment"></span><a href="#lambda%E3%81%8B%E3%82%89dynamodb%E6%9B%B8%E3%81%8D%E8%BE%BC%E3%81%BF"><i class="fa fa-link"></i></a>LambdaからDynamoDB書き込み</h2>

<p>sites_check1テーブルの追加</p>

<p><a href="https://camo.qiitausercontent.com/6b816960ceb961b453da976b4c20284f5e863ffc/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131323932392f65383039613561642d363565632d346639342d643262392d6136393933383065303439372e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2Fe809a5ad-65ec-4f94-d2b9-a699380e0497.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=8cccb26f61719c7e881c7bb82bbe8891" alt="スクリーンショット 2017-03-15 18.19.12.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/112929/e809a5ad-65ec-4f94-d2b9-a699380e0497.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2Fe809a5ad-65ec-4f94-d2b9-a699380e0497.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=6f962ba1e6c3ea97b4634855f0627e1f 1x" loading="lazy"></a></p>

<p>追加</p>

<div class="code-frame" data-lang="python"><div class="highlight"><pre><code><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

<span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="n">results</span><span class="p">):</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">dynamodb</span><span class="p">.</span><span class="n">Table</span><span class="p">(</span><span class="s">'sites_check'</span><span class="p">)</span>
    <span class="n">table</span><span class="p">.</span><span class="n">put_item</span><span class="p">(</span>
        <span class="n">Item</span><span class="o">=</span><span class="p">{</span>
            <span class="s">"id"</span><span class="p">:</span> <span class="nb">id</span><span class="p">,</span>
            <span class="s">"date"</span><span class="p">:</span> <span class="n">date</span><span class="p">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">"%Y/%m/%d %H:%M"</span><span class="p">),</span>
            <span class="s">"result"</span><span class="p">:</span> <span class="n">results</span>
       <span class="p">}</span>
    <span class="p">)</span>
</code></pre></div></div>

<p>時間の増減を行うtimedeltaとかを追加しました。<br>
DynamoDBのsitesテーブルにタイトル追加しました。<br>
現在のコード</p>

<div class="code-frame" data-lang="python"><div class="highlight"><pre><code>
<span class="c1"># coding: utf-8
</span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">from</span> <span class="nn">urllib2</span> <span class="kn">import</span> <span class="n">urlopen</span>
<span class="kn">import</span> <span class="nn">boto3</span>
<span class="kn">from</span> <span class="nn">boto3.dynamodb.conditions</span> <span class="kn">import</span> <span class="n">Key</span><span class="p">,</span> <span class="n">Attr</span>

<span class="n">dynamodb</span> <span class="o">=</span> <span class="n">boto3</span><span class="p">.</span><span class="n">resource</span><span class="p">(</span><span class="s">'dynamodb'</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">res</span>

<span class="k">def</span> <span class="nf">web_check</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Serching ... "</span> <span class="o">+</span> <span class="n">target</span> <span class="o">+</span> <span class="s">" at "</span> <span class="o">+</span> <span class="n">url</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">validate</span><span class="p">(</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">).</span><span class="n">read</span><span class="p">(),</span> <span class="n">target</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">"Find!"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">"Not Find!"</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_urls</span><span class="p">():</span>
    <span class="n">table</span>    <span class="o">=</span> <span class="n">dynamodb</span><span class="p">.</span><span class="n">Table</span><span class="p">(</span><span class="s">'sites'</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">table</span><span class="p">.</span><span class="n">scan</span><span class="p">()</span>
    <span class="n">sites</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s">"Items"</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">sites</span>

<span class="k">def</span> <span class="nf">send_slack</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s">"https://hooks.slack.com/"</span>
    <span class="n">payload_dic</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"text"</span><span class="p">:</span><span class="n">text</span><span class="p">,</span>
        <span class="s">"icon_emoji"</span><span class="p">:</span><span class="s">':grin:'</span><span class="p">,</span>
        <span class="s">"channel"</span><span class="p">:</span><span class="s">'bot-test2'</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">payload_dic</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="n">results</span><span class="p">):</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">dynamodb</span><span class="p">.</span><span class="n">Table</span><span class="p">(</span><span class="s">'sites_check'</span><span class="p">)</span>
    <span class="n">table</span><span class="p">.</span><span class="n">put_item</span><span class="p">(</span>
        <span class="n">Item</span><span class="o">=</span><span class="p">{</span>
            <span class="s">"id"</span><span class="p">:</span> <span class="nb">id</span><span class="p">,</span>
            <span class="s">"date"</span><span class="p">:</span> <span class="n">date</span><span class="p">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">"%Y/%m/%d %H:%M"</span><span class="p">),</span>
            <span class="s">"result"</span><span class="p">:</span> <span class="n">results</span>
       <span class="p">}</span>
    <span class="p">)</span>

<span class="k">def</span> <span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Check start'</span><span class="p">)</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">sites</span> <span class="o">=</span> <span class="n">get_urls</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">sites</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">web_check</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">site</span><span class="p">[</span><span class="s">"url"</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">site</span><span class="p">[</span><span class="s">"target"</span><span class="p">]))</span>
        <span class="n">results</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">site</span><span class="p">[</span><span class="s">"title"</span><span class="p">])]</span> <span class="o">=</span> <span class="n">msg</span>

    <span class="n">insert</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
    <span class="k">return</span> <span class="s">"success!"</span>



</code></pre></div></div>

<p>データを挿入した結果がこちら。</p>

<div class="code-frame" data-lang="json"><div class="highlight"><pre><code><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017/03/15 18:37"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="nl">"result"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"Amazon"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Find!"</span><span class="p">,</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="err">なぜかFindとなってエラー起きず</span><span class="w"> 
    </span><span class="nl">"Google"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Find!"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Google-2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Not Find!"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Qiita"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Find!"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="p">{</span><span class="w">
  </span><span class="nl">"date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017/03/15 18:48"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="nl">"result"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"Amazon"</span><span class="p">:</span><span class="w"> </span><span class="s2">"HTTP Error 503: Service Unavailable"</span><span class="p">,</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="err">こちらでエラー起きたときにstr(e)にしました</span><span class="w">
    </span><span class="nl">"Google"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Find!"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Google-2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Not Find!"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Qiita"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Find!"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p><code>str(e)</code>ってしないとeがstr型じゃないのでエラーが起きました。<br>
Pythonに慣れてきたので10分くらいで解決。<br>
jsonってコメントつけられないんですね。</p>

<div class="code-frame" data-lang="python"><div class="highlight"><pre><code><span class="k">def</span> <span class="nf">get_recent_codes</span><span class="p">():</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">date</span><span class="p">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">"%Y/%m/%d %H:%M"</span><span class="p">)</span>
    <span class="n">last</span> <span class="o">=</span> <span class="p">(</span><span class="n">date</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=-</span><span class="mi">9</span><span class="p">)).</span><span class="n">strftime</span><span class="p">(</span><span class="s">"%Y/%m/%d %H:%M"</span><span class="p">)</span>

    <span class="c1"># idが0かつ、１０分以内のデータを取ってくる感じのクエリ
</span>    <span class="n">response</span> <span class="o">=</span> <span class="n">table</span><span class="p">.</span><span class="n">query</span><span class="p">(</span>
        <span class="n">KeyConditionExpression</span><span class="o">=</span><span class="n">Key</span><span class="p">(</span><span class="s">'id'</span><span class="p">).</span><span class="n">eq</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">Key</span><span class="p">(</span><span class="s">'date'</span><span class="p">).</span><span class="n">between</span><span class="p">(</span><span class="n">last</span><span class="p">,</span> <span class="n">now</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">response</span>
</code></pre></div></div>

<p><code>response['Count']</code>に取ってこれたクエリの数が入ります。<br>
<code>response['Items']</code>に取ってこれたTableのデータがはいってます。<br>
それ以外のデータ必要な場合は適宜、Printしつつデータの取り出しをしてください。</p>

<p>結果こんな感じ</p>

<div class="code-frame" data-lang="python"><div class="highlight"><pre><code><span class="c1"># coding: utf-8
</span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">from</span> <span class="nn">urllib2</span> <span class="kn">import</span> <span class="n">urlopen</span>
<span class="kn">import</span> <span class="nn">boto3</span>
<span class="kn">from</span> <span class="nn">boto3.dynamodb.conditions</span> <span class="kn">import</span> <span class="n">Key</span><span class="p">,</span> <span class="n">Attr</span>

<span class="n">dynamodb</span> <span class="o">=</span> <span class="n">boto3</span><span class="p">.</span><span class="n">resource</span><span class="p">(</span><span class="s">'dynamodb'</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">res</span>

<span class="k">def</span> <span class="nf">web_check</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Serching ... "</span> <span class="o">+</span> <span class="n">target</span> <span class="o">+</span> <span class="s">" at "</span> <span class="o">+</span> <span class="n">url</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">validate</span><span class="p">(</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">).</span><span class="n">read</span><span class="p">(),</span> <span class="n">target</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">"Find!"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">"Not Find!"</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_urls</span><span class="p">():</span>
    <span class="n">table</span>    <span class="o">=</span> <span class="n">dynamodb</span><span class="p">.</span><span class="n">Table</span><span class="p">(</span><span class="s">'sites'</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">table</span><span class="p">.</span><span class="n">scan</span><span class="p">()</span>
    <span class="n">sites</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s">"Items"</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">sites</span>

<span class="k">def</span> <span class="nf">send_slack</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s">"https://hooks.slack.com/"</span>
    <span class="n">payload_dic</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"text"</span><span class="p">:</span><span class="n">text</span><span class="p">,</span>
        <span class="s">"icon_emoji"</span><span class="p">:</span><span class="s">':grin:'</span><span class="p">,</span>
        <span class="s">"channel"</span><span class="p">:</span><span class="s">'bot-test2'</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">payload_dic</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="n">results</span><span class="p">):</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">dynamodb</span><span class="p">.</span><span class="n">Table</span><span class="p">(</span><span class="s">'sites_check'</span><span class="p">)</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">table</span><span class="p">.</span><span class="n">put_item</span><span class="p">(</span>
        <span class="n">Item</span><span class="o">=</span><span class="p">{</span>
            <span class="s">"id"</span><span class="p">:</span> <span class="nb">id</span><span class="p">,</span>
            <span class="s">"date"</span><span class="p">:</span> <span class="n">date</span><span class="p">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">"%Y/%m/%d %H:%M"</span><span class="p">),</span>
            <span class="s">"result"</span><span class="p">:</span> <span class="n">results</span>
       <span class="p">}</span>
    <span class="p">)</span>

<span class="k">def</span> <span class="nf">get_recent_codes</span><span class="p">():</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">dynamodb</span><span class="p">.</span><span class="n">Table</span><span class="p">(</span><span class="s">'sites_check'</span><span class="p">)</span>

    <span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">date</span><span class="p">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">"%Y/%m/%d %H:%M"</span><span class="p">)</span>
    <span class="n">last</span> <span class="o">=</span> <span class="p">(</span><span class="n">date</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=-</span><span class="mi">9</span><span class="p">)).</span><span class="n">strftime</span><span class="p">(</span><span class="s">"%Y/%m/%d %H:%M"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">last</span> <span class="o">+</span> <span class="s">" から "</span> <span class="o">+</span> <span class="n">now</span> <span class="o">+</span> <span class="s">" までのチェック"</span><span class="p">)</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">table</span><span class="p">.</span><span class="n">query</span><span class="p">(</span>
        <span class="n">KeyConditionExpression</span><span class="o">=</span><span class="n">Key</span><span class="p">(</span><span class="s">'id'</span><span class="p">).</span><span class="n">eq</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">Key</span><span class="p">(</span><span class="s">'date'</span><span class="p">).</span><span class="n">between</span><span class="p">(</span><span class="n">last</span><span class="p">,</span> <span class="n">now</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">response</span>

<span class="k">def</span> <span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Check start'</span><span class="p">)</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">sites</span> <span class="o">=</span> <span class="n">get_urls</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">sites</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">web_check</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">site</span><span class="p">[</span><span class="s">"url"</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">site</span><span class="p">[</span><span class="s">"target"</span><span class="p">]))</span>
        <span class="n">results</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">site</span><span class="p">[</span><span class="s">"title"</span><span class="p">])]</span> <span class="o">=</span> <span class="n">msg</span>

    <span class="n">insert</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">get_recent_codes</span><span class="p">())</span>
    <span class="k">return</span> <span class="s">"success!"</span>



</code></pre></div></div>

<p>定期実行させたりいろいろできると思われます。</p>

<h1>
<span id="さいごに" class="fragment"></span><a href="#%E3%81%95%E3%81%84%E3%81%94%E3%81%AB"><i class="fa fa-link"></i></a>さいごに</h1>

<p>PythonとLambdaの素人なのでかなりエラーだしました。が、PythonとLambdaによるアーキテクトはかなり便利になると思うのでこれからも使っていきたいと思っています。</p>
</article></div></div></div></div><footer class="footer"><div class="content has-text-centered"><p>This web site was created by ykhirao using react-static. <a href="https://github.com/ykhirao/ykhirao.github.io">Here</a> is the link to the GitHub repository.</p><p>© 2021 ykhirao</p></div></footer></div></div><script type="text/javascript">window.__routeInfo = JSON.parse("{\"template\":\"__react_static_root__/src/components/QiitaPost\",\"sharedHashesByProp\":{},\"data\":{\"post\":{\"rendered_body\":\"\\n<h1>\\n<span id=\\\"\u306F\u3058\u3081\u306B\\\" class=\\\"fragment\\\"></span><a href=\\\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\\\"><i class=\\\"fa fa-link\\\"></i></a>\u306F\u3058\u3081\u306B</h1>\\n\\n<p>\u3000\u6700\u8FD1\u30B5\u30FC\u30D0\u30EC\u30B9\u30A2\u30FC\u30AD\u30C6\u30AF\u30C1\u30E3\u306B\u8208\u5473\u3092\u6301\u3063\u3066\u3044\u307E\u3059\u3002\u4EE5\u4E0B2\u30A8\u30F3\u30C8\u30EA\u30FC\u306FGoogle Apps Script\u3067Java Script\u3092\u4F7F\u3063\u305F\u6642\u306E\u8A18\u4E8B\u3067\u3059\u304C\u3001\u4ECA\u56DE\u306FAWS\u4E0A\u306ELambda\u3092\u4F7F\u3063\u3066\u3001\u30B5\u30FC\u30D0\u30FC\u30EC\u30B9\u3067Python\u30B3\u30FC\u30C9\u3092\u5B9F\u884C\u3055\u305B\u308B\u3053\u3068\u3092\u3084\u3063\u3066\u3044\u304D\u305F\u3044\u3068\u601D\u3044\u307E\u3059\u3002\u8A18\u4E8B\u306E\u5185\u5BB9\u306F\u3001Python\u307B\u307C\u521D\u3081\u307E\u3057\u3066&amp;&amp;AWS\u307B\u307C\u521D\u3081\u307E\u3057\u3066\u306E\u4EBA\u304C\u3001Lambda\u3068DynamoDB\u3067\u3044\u308D\u3044\u308D\u3067\u304D\u308B\u3088\u3046\u306B\u306A\u308B\u307E\u3067\u306E\u8A18\u9332\u3092\u66F8\u3044\u3066\u3044\u304D\u307E\u3059\u3002<br>\\n\u3000\u307E\u305F\u6700\u521DAWS\u5206\u304B\u3093\u306A\u3055\u3059\u304E\u3066\u6700\u521D\u306F\u7D76\u671B\u3057\u3066\u3044\u305F\u3057\u3001Lambda\u306F\u30A8\u30E9\u30FC\u51FA\u307E\u304F\u3063\u3066\u521D\u898B\u6BBA\u3057\u3060\u3057\u3001Python\u8208\u5473\u306F\u3042\u308B\u3051\u3069\u4F7F\u3063\u305F\u3053\u3068\u5C11\u306A\u3081\u3068\u3001\u304B\u306A\u308A\u521D\u5FC3\u8005\u76EE\u7DDA\u3067\u8A18\u4E8B\u3092\u66F8\u3044\u3066\u3044\u304D\u305F\u3044\u3068\u601D\u3063\u3066\u307E\u3059\u3002\u5199\u771F\u591A\u3081\u3001\u521D\u5FC3\u8005\u304C\u308F\u304B\u308B\u7A0B\u5EA6\u306E\u5185\u5BB9\u3092\u3001\u3072\u3068\u3064\u305A\u3064\u66F8\u3044\u3066\u3044\u304F\u611F\u3058\u3067\u3059\u306E\u3067\u3001Pythonist\u3068AWS\u4E0A\u7D1A\u8005\u306E\u65B9\u306F\u65B0\u3057\u3044\u3053\u3068\u306F\u306A\u3044\u304B\u3068\u601D\u3044\u307E\u3059\u304C\u3001\u3069\u3046\u305E\u3088\u308D\u3057\u304F\u304A\u9858\u3044\u3057\u307E\u3059\u3002</p>\\n\\n<p>\u3053\u306E\u524D\u66F8\u3044\u305F\u8A18\u4E8B<br>\\n- <a href=\\\"http://qiita.com/ykhirao/items/782e20ab0465533c48f6\\\" id=\\\"reference-15eb3319b9855f190901\\\">\u6708\u672B\u55B6\u696D\u65E5\u306B\u30BF\u30B9\u30AF\u3092\u30EA\u30DE\u30A4\u30F3\u30C9\u3059\u308B</a><br>\\n- <a href=\\\"http://qiita.com/ykhirao/items/09ebaedd0f6f0438f422\\\" id=\\\"reference-29cb99f0d0f1d9c020a7\\\">Google\u30AB\u30EC\u30F3\u30C0\u30FC \u81EA\u793E\u7248</a></p>\\n\\n<h2>\\n<span id=\\\"\u524D\u63D0\\\" class=\\\"fragment\\\"></span><a href=\\\"#%E5%89%8D%E6%8F%90\\\"><i class=\\\"fa fa-link\\\"></i></a>\u524D\u63D0</h2>\\n\\n<p>AWS\u521D\u3081\u307E\u3057\u3066<br>\\nPython\u6B742\u9031\u9593\u304F\u3089\u3044<br>\\nAWS\u30B5\u30FC\u30D3\u30B9\u767B\u9332\u6E08\u3001\u7121\u6599\u67A0\u4E2D</p>\\n\\n<h1>\\n<span id=\\\"aws\\\" class=\\\"fragment\\\"></span><a href=\\\"#aws\\\"><i class=\\\"fa fa-link\\\"></i></a>AWS</h1>\\n\\n<p>\u81EA\u5206\u306E\u5834\u5408\u306F\u3001AWS\u306E\u30B5\u30FC\u30D3\u30B9\u306E\u591A\u3055\u306B\u6DF7\u4E71\u3057\u305F\u306E\u3067\u3001\u3069\u306E\u30B5\u30FC\u30D3\u30B9\u304C\u3069\u306E\u30B5\u30FC\u30D3\u30B9\u3068\u3064\u306A\u304C\u3063\u3066\u308B\u306E\u304B\u3001\u307E\u305A\u6982\u8981\u3092\u52C9\u5F37\u3057\u307E\u3057\u305F\u3002\u4E0B\u8A18\u3042\u305F\u308A\u304C\u53C2\u8003\u306B\u306A\u308B\u304B\u3068\u601D\u3044\u307E\u3059\u3002\u307E\u305FKindle\u3067\u7121\u6599\u306E\u66F8\u7C4D\u3068\u304B\u63A2\u3057\u307E\u3057\u305F\u3002\u300C\u3063\u3066\u307E\u3059\u304C\u3001\u81EA\u5206\u3067\u4F7F\u3044\u306A\u304C\u3089\u3001\u3053\u306E\u8A18\u4E8B\u3092\u898B\u76F4\u3057\u306A\u304C\u3089\u3044\u308D\u3044\u308D\u3084\u3063\u3066\u307F\u307E\u3057\u305F\u3002</p>\\n\\n<p><a href=\\\"http://qiita.com/kohashi/items/1bb952313fb695f12577\\\" id=\\\"reference-a810c093d7c16de23cbb\\\">\u300CAWS is \u4F55\u300D\u30923\u884C\u3067\u307E\u3068\u3081\u3066\u307F\u308B\u3088</a><br>\\n<a href=\\\"http://qiita.com/chroju/items/c7ad918d79b0288bc490\\\" id=\\\"reference-4de5e496aa23f9a6e691\\\">AWS1\u5E74\u76EE\u7121\u6599\u671F\u9593\u3067\u3084\u3063\u305F\u3053\u3068\u3068\u30CF\u30DE\u3063\u305F\u3053\u3068</a></p>\\n\\n<h2>\\n<span id=\\\"\u767B\u9332\\\" class=\\\"fragment\\\"></span><a href=\\\"#%E7%99%BB%E9%8C%B2\\\"><i class=\\\"fa fa-link\\\"></i></a>\u767B\u9332</h2>\\n\\n<p>\u767B\u9332\u6E08\u307F\u3068\u4EEE\u5B9A\u3057\u3066\u3044\u308B\u306E\u3067AWS\u767B\u9332\u306F\u5225\u306E\u8A18\u4E8B\u3092\u53C2\u7167\u304F\u3060\u3055\u3044\u3002</p>\\n\\n<h2>\\n<span id=\\\"\u30ED\u30FC\u30EB\u4F5C\u6210\\\" class=\\\"fragment\\\"></span><a href=\\\"#%E3%83%AD%E3%83%BC%E3%83%AB%E4%BD%9C%E6%88%90\\\"><i class=\\\"fa fa-link\\\"></i></a>\u30ED\u30FC\u30EB\u4F5C\u6210</h2>\\n\\n<p>AWS\u30ED\u30FC\u30EB\u304C\u306A\u3044\u3068\u3044\u308D\u3044\u308D\u9762\u5012\u306A\u306E\u3067\u3001<br>\\nS3,DynamoDB,Lambda\u306B\u30D5\u30EB\u30A2\u30AF\u30BB\u30B9\u3067\u304D\u308B\u30ED\u30FC\u30EB\u3092\u4ECA\u56DE\u4F5C\u308A\u307E\u3059\u3002</p>\\n\\n<p><a href=\\\"https://us-west-2.console.aws.amazon.com/console/home\\\" rel=\\\"nofollow noopener\\\" target=\\\"_blank\\\">AWS\u30B5\u30FC\u30D3\u30B9\u4E00\u89A7</a>\u304B\u3089IAM</p>\\n\\n<p><a href=\\\"https://camo.qiitausercontent.com/d478dc689f9049446a3fd1a8af11c93c025f5f75/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131323932392f35623661336631392d313266332d633436392d393166362d3339653063646231313637662e706e67\\\" target=\\\"_blank\\\" rel=\\\"nofollow noopener\\\"><img src=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2F5b6a3f19-12f3-c469-91f6-39e0cdb1167f.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=e4b961b64587c0810a86846df96f11d0\\\" alt=\\\"\u30B9\u30AF\u30EA\u30FC\u30F3\u30B7\u30E7\u30C3\u30C8 2017-03-15 14.22.30.png\\\" data-canonical-src=\\\"https://qiita-image-store.s3.amazonaws.com/0/112929/5b6a3f19-12f3-c469-91f6-39e0cdb1167f.png\\\" srcset=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2F5b6a3f19-12f3-c469-91f6-39e0cdb1167f.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=074871da599987ed70c01bd0bc104bda 1x\\\" loading=\\\"lazy\\\"></a></p>\\n\\n<p>\u30ED\u30FC\u30EB &gt;&gt; \u65B0\u3057\u3044\u30ED\u30FC\u30EB\u306E\u4F5C\u6210</p>\\n\\n<p><a href=\\\"https://camo.qiitausercontent.com/7d0f5639983c61e54bfb45e8e03497e817790046/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131323932392f39383039346133642d313166372d306563392d346362662d3837313966323536383836642e706e67\\\" target=\\\"_blank\\\" rel=\\\"nofollow noopener\\\"><img src=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2F98094a3d-11f7-0ec9-4cbf-8719f256886d.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=35b619cd185f27cea0645be7fcb72091\\\" alt=\\\"\u30B9\u30AF\u30EA\u30FC\u30F3\u30B7\u30E7\u30C3\u30C8 2017-03-15 14.22.43.png\\\" data-canonical-src=\\\"https://qiita-image-store.s3.amazonaws.com/0/112929/98094a3d-11f7-0ec9-4cbf-8719f256886d.png\\\" srcset=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2F98094a3d-11f7-0ec9-4cbf-8719f256886d.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=67bbcfca4a563c596b65fb677b7327de 1x\\\" loading=\\\"lazy\\\"></a></p>\\n\\n<p>\u30ED\u30FC\u30EB\u306E\u540D\u524D<br>\\n\u4ECA\u56DE\u306F[lambda_dynamo]</p>\\n\\n<p><a href=\\\"https://camo.qiitausercontent.com/f786709322318d70a43d2e84b16903fa683883d6/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131323932392f39396331613762612d336663312d643266342d346362302d6632306532363565303965642e706e67\\\" target=\\\"_blank\\\" rel=\\\"nofollow noopener\\\"><img src=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2F99c1a7ba-3fc1-d2f4-4cb0-f20e265e09ed.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=ee17c95f1db732281b3d80e25334d1de\\\" alt=\\\"\u30B9\u30AF\u30EA\u30FC\u30F3\u30B7\u30E7\u30C3\u30C8 2017-03-15 14.22.48.png\\\" data-canonical-src=\\\"https://qiita-image-store.s3.amazonaws.com/0/112929/99c1a7ba-3fc1-d2f4-4cb0-f20e265e09ed.png\\\" srcset=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2F99c1a7ba-3fc1-d2f4-4cb0-f20e265e09ed.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=e086ab5296990dcc8bab6573e8763df0 1x\\\" loading=\\\"lazy\\\"></a></p>\\n\\n<p>Amazon Lambda &gt;&gt; \u9078\u629E</p>\\n\\n<p><a href=\\\"https://camo.qiitausercontent.com/a0951796d2028065ce022f8ea5ab4812c50c30d3/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131323932392f61306165633261632d376165312d383130392d653039662d6463366361653661316631392e706e67\\\" target=\\\"_blank\\\" rel=\\\"nofollow noopener\\\"><img src=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2Fa0aec2ac-7ae1-8109-e09f-dc6cae6a1f19.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=5a33f7a56ed4d320d7254e086c50bd9c\\\" alt=\\\"\u30B9\u30AF\u30EA\u30FC\u30F3\u30B7\u30E7\u30C3\u30C8 2017-03-15 14.27.00.png\\\" data-canonical-src=\\\"https://qiita-image-store.s3.amazonaws.com/0/112929/a0aec2ac-7ae1-8109-e09f-dc6cae6a1f19.png\\\" srcset=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2Fa0aec2ac-7ae1-8109-e09f-dc6cae6a1f19.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=99f96b6d1f4eb79fec81eb22c6a5b1e0 1x\\\" loading=\\\"lazy\\\"></a></p>\\n\\n<p>\u3068\u308A\u3042\u3048\u305A\u4ECA\u56DE\u306FFullAccess\u30923\u3064\u4ED8\u3051\u307E\u3059\u3002<br>\\nAWSLambdaFullAccess<br>\\nAmazonS3FullAccess<br>\\nAmazonDynamoDBFullAccess</p>\\n\\n<p>\u6B21\u306E\u30B9\u30C6\u30C3\u30D7</p>\\n\\n<p><a href=\\\"https://camo.qiitausercontent.com/e44dca66ebdef7f5d59e2445e91e40a3598df78a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131323932392f63343631616263652d633964382d343265302d363066342d3062393663623932313035322e706e67\\\" target=\\\"_blank\\\" rel=\\\"nofollow noopener\\\"><img src=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2Fc461abce-c9d8-42e0-60f4-0b96cb921052.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=70d9c7a2a7da6bc586f5a295e2045c4d\\\" alt=\\\"\u30B9\u30AF\u30EA\u30FC\u30F3\u30B7\u30E7\u30C3\u30C8 2017-03-15 14.27.27.png\\\" data-canonical-src=\\\"https://qiita-image-store.s3.amazonaws.com/0/112929/c461abce-c9d8-42e0-60f4-0b96cb921052.png\\\" srcset=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2Fc461abce-c9d8-42e0-60f4-0b96cb921052.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=5c849347cde5bb68f001126ec9a0ef10 1x\\\" loading=\\\"lazy\\\"></a></p>\\n\\n<p>\u30ED\u30FC\u30EB &gt;&gt; lambda_dynamo<br>\\n\u3068\u3044\u3044\u3046\u9805\u76EE\u304C\u8FFD\u52A0\u3055\u308C\u3066\u305F\u3089Okay\u3002</p>\\n\\n<p><a href=\\\"https://camo.qiitausercontent.com/aedc22f12385f6a63d9e7ea54c9bb480596d41c5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131323932392f31626631346238332d633463622d346661612d346531382d3538373130646366616436642e706e67\\\" target=\\\"_blank\\\" rel=\\\"nofollow noopener\\\"><img src=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2F1bf14b83-c4cb-4faa-4e18-58710dcfad6d.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=882f30b01fef07648b7197cd74f501c0\\\" alt=\\\"\u30B9\u30AF\u30EA\u30FC\u30F3\u30B7\u30E7\u30C3\u30C8 2017-03-15 14.33.21.png\\\" data-canonical-src=\\\"https://qiita-image-store.s3.amazonaws.com/0/112929/1bf14b83-c4cb-4faa-4e18-58710dcfad6d.png\\\" srcset=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2F1bf14b83-c4cb-4faa-4e18-58710dcfad6d.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=7910a61b731e3e145d21f8541947e6ac 1x\\\" loading=\\\"lazy\\\"></a></p>\\n\\n<h1>\\n<span id=\\\"lambda\\\" class=\\\"fragment\\\"></span><a href=\\\"#lambda\\\"><i class=\\\"fa fa-link\\\"></i></a>Lambda</h1>\\n\\n<p>\u30B5\u30FC\u30D0\u30FC\u30EC\u30B9\u3067\u30B9\u30AF\u30EA\u30D7\u30C8\u5B9F\u884C\u3067\u304D\u308B\u30B5\u30FC\u30D3\u30B9\u3067\u3059\u3002\u4FBF\u5229\u3002</p>\\n\\n<h2>\\n<span id=\\\"\u6599\u91D1\u4F53\u7CFB\\\" class=\\\"fragment\\\"></span><a href=\\\"#%E6%96%99%E9%87%91%E4%BD%93%E7%B3%BB\\\"><i class=\\\"fa fa-link\\\"></i></a>\u6599\u91D1\u4F53\u7CFB</h2>\\n\\n<p>\u57FA\u672C\u7684\u306B\u3044\u304F\u3089\u30C6\u30B9\u30C8\u306B\u4F7F\u3063\u3066\u3082\u5927\u4E08\u592B\uFF01<a href=\\\"https://aws.amazon.com/jp/lambda/pricing/\\\" rel=\\\"nofollow noopener\\\" target=\\\"_blank\\\">\u516C\u5F0F</a></p>\\n\\n<p>\u30E9\u30E0\u30C0\u7121\u6599\u67A0</p>\\n\\n<table>\\n<thead>\\n<tr>\\n<th style=\\\"text-align: center\\\">1\u30F6\u6708</th>\\n<th style=\\\"text-align: center\\\">\u30EA\u30AF\u30A8\u30B9\u30C8</th>\\n<th style=\\\"text-align: center\\\">\u30B3\u30F3\u30D4\u30E5\u30FC\u30C6\u30A3\u30F3\u30B0\u6642\u9593 [GB*\u79D2]</th>\\n</tr>\\n</thead>\\n<tbody>\\n<tr>\\n<td style=\\\"text-align: center\\\"></td>\\n<td style=\\\"text-align: center\\\">1,000,000</td>\\n<td style=\\\"text-align: center\\\">400,000</td>\\n</tr>\\n</tbody>\\n</table>\\n\\n<p>\u30EA\u30AF\u30A8\u30B9\u30C8:\u95A2\u6570\u5168\u4F53\u306B\u5BFE\u3059\u308B\u5408\u8A08\u30EA\u30AF\u30A8\u30B9\u30C8\u6570<br>\\n\u30B3\u30F3\u30D4\u30E5\u30FC\u30C6\u30A3\u30F3\u30B0\u6642\u9593: \u30E1\u30E2\u30EA\u6570\u3068\u6642\u9593\u3092\u304B\u3051\u305F\u3082\u306E</p>\\n\\n<p>Lambda\u306E\u6700\u5C0F\u30E1\u30E2\u30EA\u304C128MB\u306A\u306E\u30671\u30F6\u67083,200,000\u79D2()\u4F7F\u3048\u3070\u3001400,000[GB*sec]\u306B\u5230\u9054\u3057\u307E\u3059\u3002<br>\\n<code>(128.0[MB] / 1024[MB/GB]) * 3200000[sec] = 400,000[GB*sec]</code><br>\\n\u306A\u306E\u3067\u3001888\u6642\u9593\u304F\u3089\u3044\u30B9\u30AF\u30EA\u30D7\u30C8\u52D5\u3044\u3066\u3082\u5927\u4E08\u592B\u3002\u3069\u3093\u3069\u3093\u4F7F\u304A\u3046\u3002<br>\\n(\u6642\u9593\u306E\u8A08\u7B97\u306F\u4E00\u5FDC\u81EA\u5206\u3067\u3084\u3063\u3066\u307F\u3066\u304F\u3060\u3055\u3044\u306D\uFF01)</p>\\n\\n<h2>\\n<span id=\\\"\u30C6\u30B9\u30C8\u30B3\u30FC\u30C9\u3092\u4F7F\u3063\u3066\u307F\u308Bpython\u30A8\u30E9\u30FC\\\" class=\\\"fragment\\\"></span><a href=\\\"#%E3%83%86%E3%82%B9%E3%83%88%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8Bpython%E3%82%A8%E3%83%A9%E3%83%BC\\\"><i class=\\\"fa fa-link\\\"></i></a>\u30C6\u30B9\u30C8\u30B3\u30FC\u30C9\u3092\u4F7F\u3063\u3066\u307F\u308B(Python\u30A8\u30E9\u30FC)</h2>\\n\\n<p><a href=\\\"https://us-west-2.console.aws.amazon.com/console/home\\\" rel=\\\"nofollow noopener\\\" target=\\\"_blank\\\">AWS\u30B5\u30FC\u30D3\u30B9\u4E00\u89A7</a>\u304B\u3089Lambda</p>\\n\\n<h3>\\n<span id=\\\"\u6700\u521D\u306E\u95A2\u6570\u4F5C\u6210\\\" class=\\\"fragment\\\"></span><a href=\\\"#%E6%9C%80%E5%88%9D%E3%81%AE%E9%96%A2%E6%95%B0%E4%BD%9C%E6%88%90\\\"><i class=\\\"fa fa-link\\\"></i></a>\u6700\u521D\u306E\u95A2\u6570\u4F5C\u6210</h3>\\n\\n<p>Lambda \u95A2\u6570\u306E\u4F5C\u6210 &gt;&gt; lambda-canary</p>\\n\\n<p><a href=\\\"https://camo.qiitausercontent.com/3ae46df63f007c68787e34b6ec0f494f18b567fe/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131323932392f63346538353566362d383161322d336564382d653039392d3163366533346364343364652e706e67\\\" target=\\\"_blank\\\" rel=\\\"nofollow noopener\\\"><img src=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2Fc4e855f6-81a2-3ed8-e099-1c6e34cd43de.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=74e03bf67beaf82c9a81db87766cd1b2\\\" alt=\\\"\u30B9\u30AF\u30EA\u30FC\u30F3\u30B7\u30E7\u30C3\u30C8 2017-03-15 14.52.52.png\\\" data-canonical-src=\\\"https://qiita-image-store.s3.amazonaws.com/0/112929/c4e855f6-81a2-3ed8-e099-1c6e34cd43de.png\\\" srcset=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2Fc4e855f6-81a2-3ed8-e099-1c6e34cd43de.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=2199b1f4443d0208c0eeb52986eb54ff 1x\\\" loading=\\\"lazy\\\"></a></p>\\n\\n<p>[ \u30C8\u30EA\u30AC\u30FC\u306E\u8A2D\u5B9A ] &gt;&gt; \u524A\u9664 &gt;&gt; \u6B21\u3078<br>\\n\u3053\u3053\u3067\u4F55\u5206\u3054\u3068\u306B\u4E00\u5EA6\u30B9\u30AF\u30EA\u30D7\u30C8\u3092\u5B9F\u884C\u3068\u304B\u3044\u3058\u308C\u307E\u3059\u3002<br>\\n\u304C\u5F8C\u3067\u3082\u8A2D\u5B9A\u3067\u304D\u308B\u306E\u3067\u4ECA\u56DE\u306F\u524A\u9664\u3057\u307E\u3059\u3002</p>\\n\\n<p>[ \u95A2\u6570\u306E\u8A2D\u5B9A ]<br>\\n\u540D\u524D\u3092\u3068\u308A\u3042\u3048\u305A[ sample ]\u306B\u3057\u307E\u3057\u305F\u3002</p>\\n\\n<p><a href=\\\"https://camo.qiitausercontent.com/a5f2a2336886a48ce83490a936c29f7ea332f0bc/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131323932392f30613338636234652d326537312d366264622d363233302d6165626161646630643336392e706e67\\\" target=\\\"_blank\\\" rel=\\\"nofollow noopener\\\"><img src=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2F0a38cb4e-2e71-6bdb-6230-aebaadf0d369.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=d5ffcfe2281a5b9d67e9cada65ab27a6\\\" alt=\\\"\u30B9\u30AF\u30EA\u30FC\u30F3\u30B7\u30E7\u30C3\u30C8 2017-03-15 14.57.34.png\\\" data-canonical-src=\\\"https://qiita-image-store.s3.amazonaws.com/0/112929/0a38cb4e-2e71-6bdb-6230-aebaadf0d369.png\\\" srcset=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2F0a38cb4e-2e71-6bdb-6230-aebaadf0d369.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=5d761e82c3f7423281919089a50b1d91 1x\\\" loading=\\\"lazy\\\"></a></p>\\n\\n<p>\u30ED\u30FC\u30EB\u3092\u5148\u7A0B\u3064\u304F\u3063\u305F\u30ED\u30FC\u30EB\u306B\u3057\u3066\u95A2\u6570\u4F5C\u6210\u3057\u307E\u3059\u3002<br>\\nlambda_dynamo</p>\\n\\n<h3>\\n<span id=\\\"\u6700\u521D\u306E\u30C6\u30B9\u30C8\\\" class=\\\"fragment\\\"></span><a href=\\\"#%E6%9C%80%E5%88%9D%E3%81%AE%E3%83%86%E3%82%B9%E3%83%88\\\"><i class=\\\"fa fa-link\\\"></i></a>\u6700\u521D\u306E\u30C6\u30B9\u30C8</h3>\\n\\n<div class=\\\"code-frame\\\" data-lang=\\\"python\\\"><div class=\\\"highlight\\\"><pre><code><span class=\\\"kn\\\">from</span> <span class=\\\"nn\\\">__future__</span> <span class=\\\"kn\\\">import</span> <span class=\\\"n\\\">print_function</span>\\n\\n<span class=\\\"kn\\\">import</span> <span class=\\\"nn\\\">os</span>\\n<span class=\\\"kn\\\">from</span> <span class=\\\"nn\\\">datetime</span> <span class=\\\"kn\\\">import</span> <span class=\\\"n\\\">datetime</span>\\n<span class=\\\"kn\\\">from</span> <span class=\\\"nn\\\">urllib2</span> <span class=\\\"kn\\\">import</span> <span class=\\\"n\\\">urlopen</span>\\n\\n<span class=\\\"n\\\">SITE</span> <span class=\\\"o\\\">=</span> <span class=\\\"n\\\">os</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">environ</span><span class=\\\"p\\\">[</span><span class=\\\"s\\\">'site'</span><span class=\\\"p\\\">]</span>  <span class=\\\"c1\\\"># URL of the site to check, stored in the site environment variable\\n</span><span class=\\\"n\\\">EXPECTED</span> <span class=\\\"o\\\">=</span> <span class=\\\"n\\\">os</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">environ</span><span class=\\\"p\\\">[</span><span class=\\\"s\\\">'expected'</span><span class=\\\"p\\\">]</span>  <span class=\\\"c1\\\"># String expected to be on the page, stored in the expected environment variable\\n</span>\\n\\n<span class=\\\"k\\\">def</span> <span class=\\\"nf\\\">validate</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">res</span><span class=\\\"p\\\">):</span>\\n    <span class=\\\"k\\\">return</span> <span class=\\\"n\\\">EXPECTED</span> <span class=\\\"ow\\\">in</span> <span class=\\\"n\\\">res</span>\\n\\n\\n<span class=\\\"k\\\">def</span> <span class=\\\"nf\\\">lambda_handler</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">event</span><span class=\\\"p\\\">,</span> <span class=\\\"n\\\">context</span><span class=\\\"p\\\">):</span>\\n    <span class=\\\"k\\\">print</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">'Checking {} at {}...'</span><span class=\\\"p\\\">.</span><span class=\\\"nb\\\">format</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">SITE</span><span class=\\\"p\\\">,</span> <span class=\\\"n\\\">event</span><span class=\\\"p\\\">[</span><span class=\\\"s\\\">'time'</span><span class=\\\"p\\\">]))</span>\\n    <span class=\\\"k\\\">try</span><span class=\\\"p\\\">:</span>\\n        <span class=\\\"k\\\">if</span> <span class=\\\"ow\\\">not</span> <span class=\\\"n\\\">validate</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">urlopen</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">SITE</span><span class=\\\"p\\\">).</span><span class=\\\"n\\\">read</span><span class=\\\"p\\\">()):</span>\\n            <span class=\\\"k\\\">raise</span> <span class=\\\"nb\\\">Exception</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">'Validation failed'</span><span class=\\\"p\\\">)</span>\\n    <span class=\\\"k\\\">except</span><span class=\\\"p\\\">:</span>\\n        <span class=\\\"k\\\">print</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">'Check failed!'</span><span class=\\\"p\\\">)</span>\\n        <span class=\\\"k\\\">raise</span>\\n    <span class=\\\"k\\\">else</span><span class=\\\"p\\\">:</span>\\n        <span class=\\\"k\\\">print</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">'Check passed!'</span><span class=\\\"p\\\">)</span>\\n        <span class=\\\"k\\\">return</span> <span class=\\\"n\\\">event</span><span class=\\\"p\\\">[</span><span class=\\\"s\\\">'time'</span><span class=\\\"p\\\">]</span>\\n    <span class=\\\"k\\\">finally</span><span class=\\\"p\\\">:</span>\\n        <span class=\\\"k\\\">print</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">'Check complete at {}'</span><span class=\\\"p\\\">.</span><span class=\\\"nb\\\">format</span><span class=\\\"p\\\">(</span><span class=\\\"nb\\\">str</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">datetime</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">now</span><span class=\\\"p\\\">())))</span>\\n\\n</code></pre></div></div>\\n\\n<p><a href=\\\"https://camo.qiitausercontent.com/798384903299ef1fa7b4068224a31607e18a57f4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131323932392f35336335633537302d626434392d666239372d323838382d6162333461366437346632322e706e67\\\" target=\\\"_blank\\\" rel=\\\"nofollow noopener\\\"><img src=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2F53c5c570-bd49-fb97-2888-ab34a6d74f22.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=23c0527125220d9e19b41c95bf39c660\\\" alt=\\\"\u30B9\u30AF\u30EA\u30FC\u30F3\u30B7\u30E7\u30C3\u30C8 2017-03-15 15.06.42.png\\\" data-canonical-src=\\\"https://qiita-image-store.s3.amazonaws.com/0/112929/53c5c570-bd49-fb97-2888-ab34a6d74f22.png\\\" srcset=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2F53c5c570-bd49-fb97-2888-ab34a6d74f22.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=3d24836f995c008a193006df6bd1c2e5 1x\\\" loading=\\\"lazy\\\"></a></p>\\n\\n<p>\u306F\u3044\u51FA\u307E\u3057\u305F\u30A8\u30E9\u30FC\u3002</p>\\n\\n<div class=\\\"code-frame\\\" data-lang=\\\"shell-session\\\"><div class=\\\"highlight\\\"><pre><code><span class=\\\"go\\\">    print('Checking {} at {}...'.format(SITE, event['time']))\\nKeyError: 'time'\\n</span></code></pre></div></div>\\n\\n<p>\u3053\u306E\u30A8\u30E9\u30FC\u3092\u89E3\u6C7A\u3059\u308B\u524D\u306B\u30C7\u30D5\u30A9\u30EB\u30C8\u3067\u4F7F\u7528\u3055\u308C\u308B\u5909\u6570\u3092\u898B\u3066\u3044\u304D\u307E\u3059\u3002</p>\\n\\n<h3>\\n<span id=\\\"\u30C7\u30D5\u30A9\u30EB\u30C8\u3067\u4F7F\u7528\u3055\u308C\u308B\u5909\u6570\\\" class=\\\"fragment\\\"></span><a href=\\\"#%E3%83%87%E3%83%95%E3%82%A9%E3%83%AB%E3%83%88%E3%81%A7%E4%BD%BF%E7%94%A8%E3%81%95%E3%82%8C%E3%82%8B%E5%A4%89%E6%95%B0\\\"><i class=\\\"fa fa-link\\\"></i></a>\u30C7\u30D5\u30A9\u30EB\u30C8\u3067\u4F7F\u7528\u3055\u308C\u308B\u5909\u6570</h3>\\n\\n<ul>\\n<li>event - test\u3067\u8A2D\u5B9A\u3057\u305F\u3068\u3053\u308D\u3068\u304B\u3001\u30C8\u30EA\u30AC\u30FC\u767A\u751F\u5143\u306E\u30A4\u30D9\u30F3\u30C8\u30C7\u30FC\u30BF</li>\\n<li>Context - <a href=\\\"https://docs.aws.amazon.com/ja_jp/lambda/latest/dg/python-context-object.html#python-context-object-methods\\\" rel=\\\"nofollow noopener\\\" target=\\\"_blank\\\">Context \u30AA\u30D6\u30B8\u30A7\u30AF\u30C8 (Python)</a>\\n</li>\\n<li>os.environ - \u30B3\u30FC\u30C9\u81EA\u4F53\u3092\u5909\u66F4\u305B\u305A\u306B\u3001AWS\u4E0A\u3067\u74B0\u5883\u5909\u6570\u3092\u8A2D\u5B9A\u3067\u304D\u308B</li>\\n</ul>\\n\\n<blockquote>\\n<p>event &gt;&gt; AWS Lambda \u306F\u3053\u306E\u30D1\u30E9\u30E1\u30FC\u30BF\u30FC\u3092\u4F7F\u7528\u3057\u3066\u30A4\u30D9\u30F3\u30C8\u30C7\u30FC\u30BF\u3092\u30CF\u30F3\u30C9\u30E9\u30FC\u306B\u6E21\u3057\u307E\u3059\u3002\u3053\u306E\u30D1\u30E9\u30E1\u30FC\u30BF\u306F\u901A\u5E38\u3001Python \u306E dict \u30BF\u30A4\u30D7\u3067\u3059\u3002\u307E\u305F\u3001list\u3001str\u3001int\u3001float\u3001\u307E\u305F\u306F NoneType \u30BF\u30A4\u30D7\u3092\u4F7F\u7528\u3067\u304D\u307E\u3059\u3002</p>\\n\\n<p>context &gt;&gt; AWS Lambda \u306F\u3053\u306E\u30D1\u30E9\u30E1\u30FC\u30BF\u30FC\u3092\u4F7F\u7528\u3057\u3066\u30E9\u30F3\u30BF\u30A4\u30E0\u60C5\u5831\u3092\u30CF\u30F3\u30C9\u30E9\u30FC\u306B\u63D0\u4F9B\u3057\u307E\u3059\u3002\u3053\u306E\u30D1\u30E9\u30E1\u30FC\u30BF\u306F LambdaContext \u30BF\u30A4\u30D7\u306B\u306A\u308A\u307E\u3059\u3002</p>\\n</blockquote>\\n\\n<p>\u3068\u306A\u3063\u3066\u307E\u3059\u3002</p>\\n\\n<blockquote>\\n<p>os.environ\u3067\u53D6\u308C\u308B\u3068\u3053\u308D\u306F\u3053\u306E\u74B0\u5883\u5909\u6570</p>\\n</blockquote>\\n\\n<p><a href=\\\"https://camo.qiitausercontent.com/95689abe5dd1748c5adb9e53fa14b92136de4c5f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131323932392f61333062643464372d383837622d613333392d313565352d3337346638306463383837382e706e67\\\" target=\\\"_blank\\\" rel=\\\"nofollow noopener\\\"><img src=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2Fa30bd4d7-887b-a339-15e5-374f80dc8878.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=2a913808b89626d055416e86855a946b\\\" alt=\\\"\u30B9\u30AF\u30EA\u30FC\u30F3\u30B7\u30E7\u30C3\u30C8 2017-03-15 15.15.28.png\\\" data-canonical-src=\\\"https://qiita-image-store.s3.amazonaws.com/0/112929/a30bd4d7-887b-a339-15e5-374f80dc8878.png\\\" srcset=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2Fa30bd4d7-887b-a339-15e5-374f80dc8878.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=5868118c70f538db974c09311d0794df 1x\\\" loading=\\\"lazy\\\"></a></p>\\n\\n<h3>\\n<span id=\\\"time-\\\" class=\\\"fragment\\\"></span><a href=\\\"#time-\\\"><i class=\\\"fa fa-link\\\"></i></a>time ?</h3>\\n\\n<p>\u3055\u3066\u5148\u7A0B\u306E\u30A8\u30E9\u30FC\u3092\u51E6\u7406\u3057\u3066\u3044\u304D\u307E\u3059\u3002</p>\\n\\n<p><a href=\\\"https://camo.qiitausercontent.com/f856a31a1ae93d9051c6d39a92ac9344eab0b908/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131323932392f64663438383730362d643331612d336132312d303832652d3966373934373962313064332e706e67\\\" target=\\\"_blank\\\" rel=\\\"nofollow noopener\\\"><img src=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2Fdf488706-d31a-3a21-082e-9f79479b10d3.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=5618d54eef5fe276e1e767bedfef934d\\\" alt=\\\"\u30B9\u30AF\u30EA\u30FC\u30F3\u30B7\u30E7\u30C3\u30C8 2017-03-15 15.11.53.png\\\" data-canonical-src=\\\"https://qiita-image-store.s3.amazonaws.com/0/112929/df488706-d31a-3a21-082e-9f79479b10d3.png\\\" srcset=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2Fdf488706-d31a-3a21-082e-9f79479b10d3.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=f138d31554a85a88551bc2b8eef4425a 1x\\\" loading=\\\"lazy\\\"></a></p>\\n\\n<p>\u30C6\u30B9\u30C8\u30A4\u30D9\u30F3\u30C8\u306E\u8A2D\u5B9A\u306Etime\u3092\u8FFD\u52A0\u3057\u307E\u3059\u3002</p>\\n\\n<div class=\\\"code-frame\\\" data-lang=\\\"json\\\"><div class=\\\"highlight\\\"><pre><code><span class=\\\"p\\\">{</span><span class=\\\"w\\\">\\n  </span><span class=\\\"nl\\\">\\\"key3\\\"</span><span class=\\\"p\\\">:</span><span class=\\\"w\\\"> </span><span class=\\\"s2\\\">\\\"value3\\\"</span><span class=\\\"p\\\">,</span><span class=\\\"w\\\">\\n  </span><span class=\\\"nl\\\">\\\"key2\\\"</span><span class=\\\"p\\\">:</span><span class=\\\"w\\\"> </span><span class=\\\"s2\\\">\\\"value2\\\"</span><span class=\\\"p\\\">,</span><span class=\\\"w\\\">\\n  </span><span class=\\\"nl\\\">\\\"key1\\\"</span><span class=\\\"p\\\">:</span><span class=\\\"w\\\"> </span><span class=\\\"s2\\\">\\\"value1\\\"</span><span class=\\\"p\\\">,</span><span class=\\\"w\\\">\\n  </span><span class=\\\"nl\\\">\\\"time\\\"</span><span class=\\\"p\\\">:</span><span class=\\\"w\\\"> </span><span class=\\\"s2\\\">\\\"now...!\\\"</span><span class=\\\"w\\\">\\n</span><span class=\\\"p\\\">}</span><span class=\\\"w\\\">\\n</span></code></pre></div></div>\\n\\n<p>\u3053\u308C\u3067Time\u306E\u90E8\u5206\u3067\u30A8\u30E9\u30FC\u306F\u3067\u306A\u3044\u3068\u601D\u3044\u307E\u3059\u3002</p>\\n\\n<div class=\\\"code-frame\\\" data-lang=\\\"shell-session\\\"><div class=\\\"highlight\\\"><pre><code><span class=\\\"gp\\\">START RequestId: a8708105-0948-11e7-b83e-b71ae2e4dbbe Version: $</span>LATEST\\n<span class=\\\"go\\\">Checking https://www.amazon.com/ at now...!...\\nCheck failed!\\nCheck complete at 2017-03-15 06:28:53.016209\\nHTTP Error 503: Service Unavailable: HTTPError\\nTraceback (most recent call last):\\n  (\u7701\u7565)\\n  File \\\"/usr/lib64/python2.7/urllib2.py\\\", line 556, in http_error_default\\n    raise HTTPError(req.get_full_url(), code, msg, hdrs, fp)\\nHTTPError: HTTP Error 503: Service Unavailable\\n\\nEND RequestId: a8708105-0948-11e7-b83e-b71ae2e4dbbe\\nREPORT RequestId: a8708105-0948-11e7-b83e-b71ae2e4dbbe  Duration: 348.59 ms Billed Duration: 400 ms     Memory Size: 128 MB Max Memory Used: 17 MB\\n</span></code></pre></div></div>\\n\\n<p>\u307E\u3060\u30A8\u30E9\u30FC\u3067\u308B\u306E\u3067\u3044\u308D\u3044\u308D\u3084\u3063\u3066\u3044\u304D\u307E\u3059\u3002</p>\\n\\n<h3>\\n<span id=\\\"except\u4F8B\u5916\u51E6\u7406\u3057\u3066\u308B\u306E\u306B\u306A\u3093\u3067\u30A8\u30E9\u30FC\u3067\u308B\u306D\u3093\\\" class=\\\"fragment\\\"></span><a href=\\\"#except%E4%BE%8B%E5%A4%96%E5%87%A6%E7%90%86%E3%81%97%E3%81%A6%E3%82%8B%E3%81%AE%E3%81%AB%E3%81%AA%E3%82%93%E3%81%A7%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%A7%E3%82%8B%E3%81%AD%E3%82%93\\\"><i class=\\\"fa fa-link\\\"></i></a>except\u4F8B\u5916\u51E6\u7406\u3057\u3066\u308B\u306E\u306B\u306A\u3093\u3067\u30A8\u30E9\u30FC\u3067\u308B\u306D\u3093\uFF01</h3>\\n\\n<p>\u307E\u305A\u306F\u8D64\u3044\u753B\u9762\u3067\u308B\u306E\u5ACC\u306A\u306E\u3067\u3001url\u306E\u30EA\u30AF\u30A8\u30B9\u30C8\u5931\u6557\u3057\u3066\u3082\u30A8\u30E9\u30FC\u3092\u3067\u306A\u304F\u3057\u307E\u3059\u3002</p>\\n\\n<div class=\\\"code-frame\\\" data-lang=\\\"py\\\"><div class=\\\"highlight\\\"><pre><code>\\n    <span class=\\\"k\\\">try</span><span class=\\\"p\\\">:</span>\\n        <span class=\\\"k\\\">if</span> <span class=\\\"ow\\\">not</span> <span class=\\\"n\\\">validate</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">urlopen</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">SITE</span><span class=\\\"p\\\">).</span><span class=\\\"n\\\">read</span><span class=\\\"p\\\">()):</span>\\n            <span class=\\\"k\\\">raise</span> <span class=\\\"nb\\\">Exception</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">'Validation failed'</span><span class=\\\"p\\\">)</span>\\n    <span class=\\\"k\\\">except</span><span class=\\\"p\\\">:</span>\\n        <span class=\\\"k\\\">print</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">'Check failed!'</span><span class=\\\"p\\\">)</span>\\n        <span class=\\\"k\\\">raise</span>\\n</code></pre></div></div>\\n\\n<p>Python\u306E\u5834\u5408\u3001\u6700\u5F8C\u306Braise\u3092\u3044\u308C\u308B\u3068\u3001\u30A8\u30E9\u30FC\u3092except\u3067\u30AD\u30E3\u30C3\u30C1\u3057\u305F\u306E\u3092\u305D\u306E\u307E\u307E\u7D20\u306Epython\u6587\u306B\u30A8\u30E9\u30FC\u3092\u623B\u3057\u3061\u3083\u3044\u307E\u3059\u3002\u3053\u308C\u3092\u66F8\u304D\u63DB\u3048\u307E\u3059\u3002</p>\\n\\n<div class=\\\"code-frame\\\" data-lang=\\\"python\\\"><div class=\\\"highlight\\\"><pre><code>\\n<span class=\\\"k\\\">def</span> <span class=\\\"nf\\\">lambda_handler</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">event</span><span class=\\\"p\\\">,</span> <span class=\\\"n\\\">context</span><span class=\\\"p\\\">):</span>\\n    <span class=\\\"k\\\">print</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">'Checking {} at {}...'</span><span class=\\\"p\\\">.</span><span class=\\\"nb\\\">format</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">SITE</span><span class=\\\"p\\\">,</span> <span class=\\\"n\\\">event</span><span class=\\\"p\\\">[</span><span class=\\\"s\\\">'time'</span><span class=\\\"p\\\">]))</span>\\n    <span class=\\\"k\\\">try</span><span class=\\\"p\\\">:</span>\\n        <span class=\\\"k\\\">if</span> <span class=\\\"ow\\\">not</span> <span class=\\\"n\\\">validate</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">urlopen</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">SITE</span><span class=\\\"p\\\">).</span><span class=\\\"n\\\">read</span><span class=\\\"p\\\">()):</span>\\n            <span class=\\\"k\\\">raise</span> <span class=\\\"nb\\\">Exception</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">'Validation failed'</span><span class=\\\"p\\\">)</span>\\n    <span class=\\\"k\\\">except</span> <span class=\\\"nb\\\">Exception</span> <span class=\\\"k\\\">as</span> <span class=\\\"n\\\">e</span><span class=\\\"p\\\">:</span>\\n        <span class=\\\"k\\\">print</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">'Check failed!'</span><span class=\\\"p\\\">)</span>\\n        <span class=\\\"k\\\">print</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">e</span><span class=\\\"p\\\">)</span>\\n    <span class=\\\"k\\\">else</span><span class=\\\"p\\\">:</span>\\n        <span class=\\\"k\\\">print</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">'Check passed!'</span><span class=\\\"p\\\">)</span>\\n        <span class=\\\"k\\\">return</span> <span class=\\\"n\\\">event</span><span class=\\\"p\\\">[</span><span class=\\\"s\\\">'time'</span><span class=\\\"p\\\">]</span>\\n    <span class=\\\"k\\\">finally</span><span class=\\\"p\\\">:</span>\\n        <span class=\\\"k\\\">print</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">'Check complete at {}'</span><span class=\\\"p\\\">.</span><span class=\\\"nb\\\">format</span><span class=\\\"p\\\">(</span><span class=\\\"nb\\\">str</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">datetime</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">now</span><span class=\\\"p\\\">())))</span>\\n\\n</code></pre></div></div>\\n\\n<p>\u3084\u3063\u3068\u7DD1\u30C1\u30A7\u30C3\u30AF\u306E\u6210\u529F\u304C\u3067\u307E\u3057\u305F\u2026\uFF01\uFF01\uFF01\uFF01</p>\\n\\n<p><a href=\\\"https://camo.qiitausercontent.com/af18459ba5152d3e053b98285397b08abcf0fc7f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131323932392f30666239663033302d616638612d333264392d653734662d3236306364613761666534652e706e67\\\" target=\\\"_blank\\\" rel=\\\"nofollow noopener\\\"><img src=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2F0fb9f030-af8a-32d9-e74f-260cda7afe4e.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=f73a361299b5a88efacea511723b9c6d\\\" alt=\\\"\u30B9\u30AF\u30EA\u30FC\u30F3\u30B7\u30E7\u30C3\u30C8 2017-03-15 15.44.10.png\\\" data-canonical-src=\\\"https://qiita-image-store.s3.amazonaws.com/0/112929/0fb9f030-af8a-32d9-e74f-260cda7afe4e.png\\\" srcset=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2F0fb9f030-af8a-32d9-e74f-260cda7afe4e.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=8b6679debb1306f8e7d978d77ebfabb9 1x\\\" loading=\\\"lazy\\\"></a></p>\\n\\n<p><code>except Exception as e:</code>\u3067\u30A8\u30E9\u30FC\u3092\u30AD\u30E3\u30C3\u30C1\u3057\u3066<br>\\n<code>print(e)</code>\u3067\u30A8\u30E9\u30FC\u51FA\u529B\u3057\u3066<br>\\n<code>raise</code>\u524A\u9664\u3057\u3066\u3001\u3068\u308A\u3042\u3048\u305A\u306F\u30A8\u30E9\u30FC\u3067\u306A\u304F\u3057\u307E\u3057\u305F\u3002</p>\\n\\n<p>\u3053\u306E\u3042\u305F\u308A\u306Epython\u306E\u30A8\u30E9\u30FC\u30CF\u30F3\u30C9\u30EA\u30F3\u30B0\u304B\u306A\u308A\u8ABF\u3079\u307E\u3057\u305F\u3002raise\u3002\u3002</p>\\n\\n<h3>\\n<span id=\\\"http-error-503\\\" class=\\\"fragment\\\"></span><a href=\\\"#http-error-503\\\"><i class=\\\"fa fa-link\\\"></i></a>HTTP Error 503</h3>\\n\\n<p>\u30A8\u30E9\u30FC\u304C\u307E\u3060\u7D9A\u3044\u3066\u308B\u306E\u3067<code>HTTP Error 503: Service Unavailable: HTTPError</code>\u306E\u90E8\u5206\u3092\u898B\u3066\u3044\u304D\u307E\u3059\u3002<br>\\n\u307E\u305F\u3001Validation failed\u3068\u3044\u3046\u6587\u5B57\u304C\u306A\u3044\u306E\u3067<code>validate(urlopen(SITE).read())</code>\u3053\u306E\u90E8\u5206\u3067\u8FD4\u3063\u3066\u304D\u305F\u30A8\u30E9\u30FC\u304C\u4E0A\u8A18\u306E\u30A8\u30E9\u30FC\u3060\u3068\u5224\u65AD\u3057\u3066\u3044\u304D\u307E\u3059\u3002</p>\\n\\n<div class=\\\"code-frame\\\" data-lang=\\\"python\\\"><div class=\\\"highlight\\\"><pre><code><span class=\\\"k\\\">def</span> <span class=\\\"nf\\\">validate</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">res</span><span class=\\\"p\\\">):</span>\\n    <span class=\\\"k\\\">return</span> <span class=\\\"n\\\">EXPECTED</span> <span class=\\\"ow\\\">in</span> <span class=\\\"n\\\">res</span>\\n</code></pre></div></div>\\n\\n<p>\u3053\u3061\u3089\u306F <a href=\\\"https://www.amazon.com/\\\" class=\\\"autolink\\\" rel=\\\"nofollow noopener\\\" target=\\\"_blank\\\">https://www.amazon.com/</a> \u306B\u30A2\u30AF\u30BB\u30B9\u3057\u3066\u3001\u8FD4\u3063\u3066\u304D\u305F\uFF48\uFF54\uFF4D\uFF4C\u30D5\u30A1\u30A4\u30EB\u306E\u4E2D\u306B\u300COnline Shopping\u300D\u3068\u3044\u3046\u6587\u5B57\u304C\u3042\u308B\u304B\u3069\u3046\u304B\u306E\u8A3A\u65AD\u306B\u306A\u308A\u307E\u3059\u3002</p>\\n\\n<p>\u3068\u308A\u3042\u3048\u305AAmazon\u304B\u3089Google\u3078\u306E\u30A2\u30AF\u30BB\u30B9\u3078\u3001\u74B0\u5883\u5909\u6570\u306E\u5909\u66F4\u3092\u3059\u308B<br>\\n* <a href=\\\"https://www.google.co.jp/\\\" class=\\\"autolink\\\" rel=\\\"nofollow noopener\\\" target=\\\"_blank\\\">https://www.google.co.jp/</a><br>\\n* Gmail</p>\\n\\n<p>\u305D\u3046\u3059\u308B\u3068</p>\\n\\n<div class=\\\"code-frame\\\" data-lang=\\\"shell-session\\\"><div class=\\\"highlight\\\"><pre><code><span class=\\\"go\\\">\\nChecking https://www.google.co.jp/ at now...!...\\nCheck passed!\\nCheck complete at 2017-03-15 07:00:05.723916\\n\\n</span></code></pre></div></div>\\n\\n<p>\u3084\u3063\u3068Check passed!\u304C\u51FA\u307E\u3057\u305F\u3002</p>\\n\\n<blockquote>\\n<p>503 Service Unavailable<br>\\n\u30B5\u30FC\u30D3\u30B9\u5229\u7528\u4E0D\u53EF\u3002\u30B5\u30FC\u30D3\u30B9\u304C\u4E00\u6642\u7684\u306B\u904E\u8CA0\u8377\u3084\u30E1\u30F3\u30C6\u30CA\u30F3\u30B9\u3067\u4F7F\u7528\u4E0D\u53EF\u80FD\u3067\u3042\u308B\u3002<br>\\n\u4F8B\u3068\u3057\u3066\u3001\u30A2\u30AF\u30BB\u30B9\u304C\u6BBA\u5230\u3057\u3066\u51E6\u7406\u4E0D\u80FD\u306B\u9665\u3063\u305F\u5834\u5408\u306B\u8FD4\u3055\u308C\u308B\u3002</p>\\n</blockquote>\\n\\n<p><a href=\\\"https://www.amazon.com/\\\" class=\\\"autolink\\\" rel=\\\"nofollow noopener\\\" target=\\\"_blank\\\">https://www.amazon.com/</a> <br>\\n\u304C\u843D\u3061\u308B\u308F\u3051\u306A\u3044\u3058\u3083\u30FC\u3093\u3002\u3063\u3066\u5FC3\u306E\u305D\u3053\u304B\u3089\u601D\u3063\u3066\u74B0\u5883\u5909\u6570\u3092\u8FD4\u3057\u3066\u30C1\u30A7\u30C3\u30AF\u3057\u3066\u307F\u308B\u3053\u3068\u3092\u5931\u5FF5\u3057\u3066\u307E\u3057\u305F\u3002\u305F\u3060\u306EGoogle\u30B5\u30FC\u30D3\u30B9\u306B\u5909\u3048\u305F\u3089\u3046\u307E\u304F\u3044\u304D\u307E\u3057\u305F\u3002<br>\\nLambda\u304B\u3089\u306E\u30A2\u30AF\u30BB\u30B9\u62D2\u5426\u3057\u3066\u308B\u306E\uFF1F</p>\\n\\n<p>\u30CF\u30DE\u3063\u305F\u3068\u3053\u308D\u3067\u3059\u3002</p>\\n\\n<h3>\\n<span id=\\\"indent\\\" class=\\\"fragment\\\"></span><a href=\\\"#indent\\\"><i class=\\\"fa fa-link\\\"></i></a>indent</h3>\\n\\n<p>Python\u306E\u30A8\u30E9\u30FC\u3067\u3059\u304C\u30A4\u30F3\u30C7\u30C3\u30AF\u30B9\u306E\u6570\u3068\u304B\u3067\u3082\u4F55\u56DE\u304B\u30A8\u30E9\u30FC\u51FA\u3057\u307E\u3057\u305F\u3002</p>\\n\\n<div class=\\\"code-frame\\\" data-lang=\\\"shell-session\\\"><div class=\\\"highlight\\\"><pre><code><span class=\\\"go\\\">Syntax error in module 'lambda_function': \\nunexpected indent (lambda_function.py, line 30)\\n</span></code></pre></div></div>\\n\\n<p>\u3053\u306E\u3042\u305F\u308A\u52C9\u5F37\u3057\u305F\u306E\u3067\u3059\u304C\u3001\u30BF\u30D6\u3068\u30B9\u30DA\u30FC\u30B9(4\u3064)\u306E\u6226\u4E89\u3067\u3059\u306D\u3002<br>\\n<a href=\\\"http://www.gizmodo.jp/2016/09/tab-vs-space.html\\\" rel=\\\"nofollow noopener\\\" target=\\\"_blank\\\">\u30D7\u30ED\u30B0\u30E9\u30DF\u30F3\u30B0\u306E\u30B3\u30FC\u30C9\u3092\u66F8\u304F\u6642\u306E\u30BF\u30D6vs\u30B9\u30DA\u30FC\u30B9\u6226\u4E89\u304C\u3064\u3044\u306B\u6C7A\u7740</a><br>\\npython\u306F\u30B9\u30DA\u30FC\u30B9\u3067\u66F8\u304F\u306E\u304C\u4E00\u822C\u7684\u3060\u3068\u3044\u3046\u3053\u3068\u304C\u66F8\u304B\u308C\u3066\u307E\u3059\u3002</p>\\n\\n<p>\u81EA\u5206\u304C\u30ED\u30FC\u30AB\u30EB\u3067\u7DE8\u96C6\u3057\u3066\u305F\u30D5\u30A1\u30A4\u30EB\u304Ctab\u3067\u5165\u3063\u3066\u3044\u3066<br>\\nAWS\u4E0A\u3067\u7DE8\u96C6\u3057\u305F\u30B3\u30FC\u30C9\u306F\u30B9\u30DA\u30FC\u30B94\u3064\u3067\u5165\u308A\u307E\u3059\u3002<br>\\n\u3053\u306Eindent\u30A8\u30E9\u30FC\u3092\u898B\u305F\u304F\u306A\u3044\u306E\u3067\u30B9\u30DA\u30FC\u30B9\u6D3E\u306B\u4E57\u308A\u63DB\u3048\u307E\u3057\u305F\u3002</p>\\n\\n<h3>\\n<span id=\\\"requests\\\" class=\\\"fragment\\\"></span><a href=\\\"#requests\\\"><i class=\\\"fa fa-link\\\"></i></a>Requests</h3>\\n\\n<p>urlopen\u3092\u305D\u306E\u307E\u307E\u4F7F\u3063\u3066\u3082\u3044\u3044\u306E\u3067\u3059\u304Crequests\u3092\u5C0E\u5165\u3057\u305F\u3044\u3068\u601D\u3044\u307E\u3059\u3002</p>\\n\\n<p><a href=\\\"http://d.hatena.ne.jp/yumimue/20071231/1199129495\\\" rel=\\\"nofollow noopener\\\" target=\\\"_blank\\\">python urllib2\u30E2\u30B8\u30E5\u30FC\u30EB</a><br>\\n<a href=\\\"http://requests-docs-ja.readthedocs.io/en/latest/\\\" rel=\\\"nofollow noopener\\\" target=\\\"_blank\\\">Requests: \u4EBA\u9593\u306E\u305F\u3081\u306EHTTP</a><br>\\n<a href=\\\"https://gist.github.com/kennethreitz/973705\\\" rel=\\\"nofollow noopener\\\" target=\\\"_blank\\\">Requests\u3092\u4F7F\u308F\u305A\u306B\u540C\u3058\u4E8B\u3092\u3059\u308B\u305F\u3081\u306E\u30B3\u30FC\u30C9</a></p>\\n\\n<p>slack\u3068\u304B\u306B\u30E1\u30C3\u30BB\u30FC\u30B8\u9001\u308B\u306E\u304C\u7C21\u5358\u306B\u306A\u308A\u307E\u3059\u3002</p>\\n\\n<div class=\\\"code-frame\\\" data-lang=\\\"python\\\">\\n<div class=\\\"code-lang\\\"><span class=\\\"bold\\\">\u4ECA\u306E\u30B3\u30FC\u30C9.py</span></div>\\n<div class=\\\"highlight\\\"><pre><code><span class=\\\"c1\\\"># coding: utf-8\\n</span><span class=\\\"kn\\\">from</span> <span class=\\\"nn\\\">__future__</span> <span class=\\\"kn\\\">import</span> <span class=\\\"n\\\">print_function</span>\\n\\n<span class=\\\"kn\\\">import</span> <span class=\\\"nn\\\">os</span>\\n<span class=\\\"kn\\\">import</span> <span class=\\\"nn\\\">json</span>\\n<span class=\\\"kn\\\">import</span> <span class=\\\"nn\\\">requests</span>\\n<span class=\\\"kn\\\">from</span> <span class=\\\"nn\\\">datetime</span> <span class=\\\"kn\\\">import</span> <span class=\\\"n\\\">datetime</span>\\n<span class=\\\"kn\\\">from</span> <span class=\\\"nn\\\">urllib2</span> <span class=\\\"kn\\\">import</span> <span class=\\\"n\\\">urlopen</span>\\n\\n<span class=\\\"n\\\">SITE</span> <span class=\\\"o\\\">=</span> <span class=\\\"n\\\">os</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">environ</span><span class=\\\"p\\\">[</span><span class=\\\"s\\\">'site'</span><span class=\\\"p\\\">]</span>\\n<span class=\\\"n\\\">EXPECTED</span> <span class=\\\"o\\\">=</span> <span class=\\\"n\\\">os</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">environ</span><span class=\\\"p\\\">[</span><span class=\\\"s\\\">'expected'</span><span class=\\\"p\\\">]</span>\\n\\n<span class=\\\"k\\\">def</span> <span class=\\\"nf\\\">validate</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">res</span><span class=\\\"p\\\">):</span>\\n    <span class=\\\"k\\\">return</span> <span class=\\\"n\\\">EXPECTED</span> <span class=\\\"ow\\\">in</span> <span class=\\\"n\\\">res</span>\\n\\n<span class=\\\"k\\\">def</span> <span class=\\\"nf\\\">lambda_handler</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">event</span><span class=\\\"p\\\">,</span> <span class=\\\"n\\\">context</span><span class=\\\"p\\\">):</span>\\n    <span class=\\\"k\\\">print</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">'Checking {} at {}...'</span><span class=\\\"p\\\">.</span><span class=\\\"nb\\\">format</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">SITE</span><span class=\\\"p\\\">,</span> <span class=\\\"n\\\">event</span><span class=\\\"p\\\">[</span><span class=\\\"s\\\">'time'</span><span class=\\\"p\\\">]))</span>\\n    <span class=\\\"k\\\">try</span><span class=\\\"p\\\">:</span>\\n        <span class=\\\"k\\\">if</span> <span class=\\\"ow\\\">not</span> <span class=\\\"n\\\">validate</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">urlopen</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">SITE</span><span class=\\\"p\\\">).</span><span class=\\\"n\\\">read</span><span class=\\\"p\\\">()):</span>\\n            <span class=\\\"k\\\">raise</span> <span class=\\\"nb\\\">Exception</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">'Validation failed'</span><span class=\\\"p\\\">)</span>\\n    <span class=\\\"k\\\">except</span> <span class=\\\"nb\\\">Exception</span> <span class=\\\"k\\\">as</span> <span class=\\\"n\\\">e</span><span class=\\\"p\\\">:</span>\\n        <span class=\\\"k\\\">print</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">'Check failed!'</span><span class=\\\"p\\\">)</span>\\n        <span class=\\\"k\\\">print</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">e</span><span class=\\\"p\\\">)</span>\\n    <span class=\\\"k\\\">else</span><span class=\\\"p\\\">:</span>\\n        <span class=\\\"k\\\">print</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">'Check passed!'</span><span class=\\\"p\\\">)</span>\\n    <span class=\\\"k\\\">finally</span><span class=\\\"p\\\">:</span>\\n        <span class=\\\"k\\\">print</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">'Check complete at {}'</span><span class=\\\"p\\\">.</span><span class=\\\"nb\\\">format</span><span class=\\\"p\\\">(</span><span class=\\\"nb\\\">str</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">datetime</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">now</span><span class=\\\"p\\\">())))</span>\\n        <span class=\\\"k\\\">return</span> <span class=\\\"s\\\">\\\"Finish\\\"</span>\\n\\n</code></pre></div>\\n</div>\\n\\n<div class=\\\"code-frame\\\" data-lang=\\\"shell-session\\\"><div class=\\\"highlight\\\"><pre><code><span class=\\\"go\\\">Unable to import module 'lambda_function': No module named requests\\n</span></code></pre></div></div>\\n\\n<p>requests\u306F\u5916\u90E8\u30E2\u30B8\u30E5\u30FC\u30EB\u306A\u306E\u3067\u3053\u3093\u306A\u30A8\u30E9\u30FC\u304A\u304D\u307E\u3059\u3002</p>\\n\\n<h2>\\n<span id=\\\"\u5916\u90E8\u30E2\u30B8\u30E5\u30FC\u30EB\u306E\u4F7F\u7528\\\" class=\\\"fragment\\\"></span><a href=\\\"#%E5%A4%96%E9%83%A8%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%AE%E4%BD%BF%E7%94%A8\\\"><i class=\\\"fa fa-link\\\"></i></a>\u5916\u90E8\u30E2\u30B8\u30E5\u30FC\u30EB\u306E\u4F7F\u7528</h2>\\n\\n<p>requests\u307F\u305F\u3044\u306APython\u6A19\u6E96\u5916\u306E\u30E2\u30B8\u30E5\u30FC\u30EB\u3092\u5165\u308C\u308B\u306E\u306B\u3082\u4E00\u7656\u3042\u3063\u305F\u306E\u3067\u66F8\u3044\u3066\u3044\u304D\u307E\u3059\u3002</p>\\n\\n<ul>\\n<li>lambda-uploader\u3092\u4F7F\u3063\u3066\u30EA\u30E2\u30FC\u30C8</li>\\n<li>\u30ED\u30FC\u30AB\u30EB\u3067\u81EA\u5206\u3067zip\u306B\u304B\u305F\u3081\u3066UP</li>\\n</ul>\\n\\n<h3>\\n<span id=\\\"lambda-uploader\\\" class=\\\"fragment\\\"></span><a href=\\\"#lambda-uploader\\\"><i class=\\\"fa fa-link\\\"></i></a>lambda-uploader</h3>\\n\\n<p>\u3053\u306E\u3042\u305F\u308A\u304C\u53C2\u8003\u306B\u306A\u308A\u307E\u3059\u3002</p>\\n\\n<p><a href=\\\"http://qiita.com/Esfahan/items/08fa6af8811dada4cb2a\\\" id=\\\"reference-3d9aa0b1c65c395d42a4\\\">lambda-uploader\u3092\u4F7F\u3063\u3066AWS Lambda\u3092\u30EA\u30E2\u30FC\u30C8\u3067\u958B\u767A\u3001\u5B9F\u884C\u3001\u30C7\u30D7\u30ED\u30A4\u3059\u308B</a><br>\\n<a href=\\\"http://dev.classmethod.jp/cloud/deploy-aws-lambda-python-with-lambda-uploader/\\\" rel=\\\"nofollow noopener\\\" target=\\\"_blank\\\">AWS Lambda Python\u3092lambda-uploader\u3067\u30C7\u30D7\u30ED\u30A4</a></p>\\n\\n<h3>\\n<span id=\\\"\u81EA\u5206\u306E\u30B3\u30FC\u30C9\u3092zip\u30A2\u30C3\u30D7\u30ED\u30FC\u30C9\\\" class=\\\"fragment\\\"></span><a href=\\\"#%E8%87%AA%E5%88%86%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92zip%E3%82%A2%E3%83%83%E3%83%97%E3%83%AD%E3%83%BC%E3%83%89\\\"><i class=\\\"fa fa-link\\\"></i></a>\u81EA\u5206\u306E\u30B3\u30FC\u30C9\u3092ZIP\u30A2\u30C3\u30D7\u30ED\u30FC\u30C9</h3>\\n\\n<p>\u81EA\u5206\u306F\u3053\u308C\u3067\u884C\u3044\u307E\u3057\u305F\u3002\u5358\u767A\u3060\u3068\u3059\u3050\u3067\u304D\u308B\u3002<br>\\n<a href=\\\"http://qiita.com/Hironsan/items/0eb5578f3321c72637b4\\\" id=\\\"reference-4dd871d93361b26b3044\\\">\u3010AWS\u3011Lambda\u3067pip\u3057\u305F\u3044\u3068\u601D\u3063\u305F\u3068\u304D\u306B\u3059\u3079\u304D\u3053\u3068</a></p>\\n\\n<p>\u4F5C\u696D\u30D5\u30A9\u30EB\u30C0\u306B<code>pip install requests -t .</code>\u3057\u3066\u3001\u305D\u308C\u3092zip\u3067\u56FA\u3081\u3066\u30A2\u30C3\u30D7\u3059\u308B\u611F\u3058\u3067\u3059\u3002</p>\\n\\n<p>\u7121\u4E8B\u30A2\u30C3\u30D7\u30ED\u30FC\u30C9\u3067\u304D\u305F\u3089\u3001\u5148\u7A0B\u306E<code>\u4ECA\u306E\u30B3\u30FC\u30C9.py</code>\u304B\u3089\u30B9\u30BF\u30FC\u30C8\u3057\u307E\u3059\u3002</p>\\n\\n<h2>\\n<span id=\\\"slack\\\" class=\\\"fragment\\\"></span><a href=\\\"#slack\\\"><i class=\\\"fa fa-link\\\"></i></a>Slack</h2>\\n\\n<p>import <br>\\n* urllib2<br>\\n* requests<br>\\n* \u3069\u3063\u3061\u3067\u3082\u53EF</p>\\n\\n<p>api<br>\\n* Slack api(token\u53D6\u5F97\u3057\u3066\u3054\u306B\u3087\u3054\u306B\u3087 xoxp-12131212\u3053\u3093\u306A\u3084\u3064)<br>\\n* Webhook(url\u3060\u3051\u53D6\u3063\u3066\u304F\u308B)<br>\\n* \u3069\u3063\u3061\u3067\u3082\u53EF</p>\\n\\n<p>\u3069\u306E\u7D44\u307F\u5408\u308F\u305B\u3092\u4F7F\u3063\u3066\u3082\u826F\u3044\u306E\u3067\u3059\u304C\u3001\u4ECA\u56DE\u306F\u7C21\u5358\u306Arequests * Webhook\u3092\u4F7F\u3044\u307E\u3059\u3002</p>\\n\\n<p>\u3053\u3061\u3089Webhook\u306EURL\u53D6\u5F97\u306F\u3053\u3061\u3089\u3092\u53C2\u8003\u306B\uFF01<br>\\n<a href=\\\"http://qiita.com/vmmhypervisor/items/18c99624a84df8b31008\\\" id=\\\"reference-a01b885ea53ea7354206\\\">Slack\u306EWebhook URL\u53D6\u5F97\u624B\u9806</a></p>\\n\\n<div class=\\\"code-frame\\\" data-lang=\\\"python\\\"><div class=\\\"highlight\\\"><pre><code><span class=\\\"k\\\">def</span> <span class=\\\"nf\\\">send_slack</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">text</span><span class=\\\"p\\\">):</span>\\n    <span class=\\\"n\\\">url</span> <span class=\\\"o\\\">=</span> <span class=\\\"s\\\">\\\"\u5148\u7A0B\u3052\u3063\u3068\u3057\u305FURL\\\"</span>\\n    <span class=\\\"n\\\">payload_dic</span> <span class=\\\"o\\\">=</span> <span class=\\\"p\\\">{</span>\\n        <span class=\\\"s\\\">\\\"text\\\"</span><span class=\\\"p\\\">:</span><span class=\\\"n\\\">text</span><span class=\\\"p\\\">,</span>\\n        <span class=\\\"s\\\">\\\"icon_emoji\\\"</span><span class=\\\"p\\\">:</span><span class=\\\"s\\\">':grin:'</span><span class=\\\"p\\\">,</span>\\n        <span class=\\\"s\\\">\\\"channel\\\"</span><span class=\\\"p\\\">:</span><span class=\\\"s\\\">'bot-test2'</span><span class=\\\"p\\\">,</span>\\n    <span class=\\\"p\\\">}</span>\\n\\n    <span class=\\\"n\\\">r</span> <span class=\\\"o\\\">=</span> <span class=\\\"n\\\">requests</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">post</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">url</span><span class=\\\"p\\\">,</span> <span class=\\\"n\\\">data</span><span class=\\\"o\\\">=</span><span class=\\\"n\\\">json</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">dumps</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">payload_dic</span><span class=\\\"p\\\">))</span>\\n</code></pre></div></div>\\n\\n<p>\u305F\u3063\u305F\u3053\u308C\u3060\u3051\u3067Slack\u9001\u308C\u307E\u3059\uFF01</p>\\n\\n<div class=\\\"code-frame\\\" data-lang=\\\"python\\\"><div class=\\\"highlight\\\"><pre><code><span class=\\\"c1\\\"># coding: utf-8\\n</span><span class=\\\"kn\\\">from</span> <span class=\\\"nn\\\">__future__</span> <span class=\\\"kn\\\">import</span> <span class=\\\"n\\\">print_function</span>\\n\\n<span class=\\\"kn\\\">import</span> <span class=\\\"nn\\\">os</span>\\n<span class=\\\"kn\\\">import</span> <span class=\\\"nn\\\">json</span>\\n<span class=\\\"kn\\\">import</span> <span class=\\\"nn\\\">requests</span>\\n<span class=\\\"kn\\\">from</span> <span class=\\\"nn\\\">datetime</span> <span class=\\\"kn\\\">import</span> <span class=\\\"n\\\">datetime</span>\\n<span class=\\\"kn\\\">from</span> <span class=\\\"nn\\\">urllib2</span> <span class=\\\"kn\\\">import</span> <span class=\\\"n\\\">urlopen</span>\\n\\n<span class=\\\"n\\\">SITE</span> <span class=\\\"o\\\">=</span> <span class=\\\"n\\\">os</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">environ</span><span class=\\\"p\\\">[</span><span class=\\\"s\\\">'site'</span><span class=\\\"p\\\">]</span>\\n<span class=\\\"n\\\">EXPECTED</span> <span class=\\\"o\\\">=</span> <span class=\\\"n\\\">os</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">environ</span><span class=\\\"p\\\">[</span><span class=\\\"s\\\">'expected'</span><span class=\\\"p\\\">]</span>\\n\\n<span class=\\\"k\\\">def</span> <span class=\\\"nf\\\">validate</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">res</span><span class=\\\"p\\\">):</span>\\n    <span class=\\\"k\\\">return</span> <span class=\\\"n\\\">EXPECTED</span> <span class=\\\"ow\\\">in</span> <span class=\\\"n\\\">res</span>\\n\\n<span class=\\\"k\\\">def</span> <span class=\\\"nf\\\">web_check</span><span class=\\\"p\\\">():</span>\\n    <span class=\\\"k\\\">try</span><span class=\\\"p\\\">:</span>\\n        <span class=\\\"k\\\">if</span> <span class=\\\"ow\\\">not</span> <span class=\\\"n\\\">validate</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">urlopen</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">SITE</span><span class=\\\"p\\\">).</span><span class=\\\"n\\\">read</span><span class=\\\"p\\\">()):</span>\\n            <span class=\\\"k\\\">raise</span> <span class=\\\"nb\\\">Exception</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">'Validation failed'</span><span class=\\\"p\\\">)</span>\\n    <span class=\\\"k\\\">except</span> <span class=\\\"nb\\\">Exception</span> <span class=\\\"k\\\">as</span> <span class=\\\"n\\\">e</span><span class=\\\"p\\\">:</span>\\n        <span class=\\\"k\\\">print</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">'Check failed!'</span><span class=\\\"p\\\">)</span>\\n        <span class=\\\"k\\\">print</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">e</span><span class=\\\"p\\\">)</span>\\n    <span class=\\\"k\\\">else</span><span class=\\\"p\\\">:</span>\\n        <span class=\\\"k\\\">print</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">'Check passed!'</span><span class=\\\"p\\\">)</span>\\n    <span class=\\\"k\\\">finally</span><span class=\\\"p\\\">:</span>\\n        <span class=\\\"k\\\">print</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">'Check complete at {}'</span><span class=\\\"p\\\">.</span><span class=\\\"nb\\\">format</span><span class=\\\"p\\\">(</span><span class=\\\"nb\\\">str</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">datetime</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">now</span><span class=\\\"p\\\">())))</span>\\n\\n<span class=\\\"k\\\">def</span> <span class=\\\"nf\\\">lambda_handler</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">event</span><span class=\\\"p\\\">,</span> <span class=\\\"n\\\">context</span><span class=\\\"p\\\">):</span>\\n    <span class=\\\"k\\\">print</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">'Checking {} at {}...'</span><span class=\\\"p\\\">.</span><span class=\\\"nb\\\">format</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">SITE</span><span class=\\\"p\\\">,</span> <span class=\\\"n\\\">event</span><span class=\\\"p\\\">[</span><span class=\\\"s\\\">'time'</span><span class=\\\"p\\\">]))</span>\\n    <span class=\\\"c1\\\"># web_check()\\n</span>    <span class=\\\"n\\\">send_slack</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">\\\"test\\\"</span><span class=\\\"p\\\">)</span>\\n    <span class=\\\"k\\\">return</span> <span class=\\\"s\\\">\\\"success!\\\"</span>\\n\\n<span class=\\\"k\\\">def</span> <span class=\\\"nf\\\">send_slack</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">text</span><span class=\\\"p\\\">):</span>\\n    <span class=\\\"n\\\">url</span> <span class=\\\"o\\\">=</span> <span class=\\\"s\\\">\\\"\u3053\u3061\u3089\u81EA\u5206\u306EURL\\\"</span>\\n    <span class=\\\"n\\\">payload_dic</span> <span class=\\\"o\\\">=</span> <span class=\\\"p\\\">{</span>\\n        <span class=\\\"s\\\">\\\"text\\\"</span><span class=\\\"p\\\">:</span><span class=\\\"n\\\">text</span><span class=\\\"p\\\">,</span>\\n        <span class=\\\"s\\\">\\\"icon_emoji\\\"</span><span class=\\\"p\\\">:</span><span class=\\\"s\\\">':grin:'</span><span class=\\\"p\\\">,</span>\\n        <span class=\\\"s\\\">\\\"channel\\\"</span><span class=\\\"p\\\">:</span><span class=\\\"s\\\">'bot-test2'</span><span class=\\\"p\\\">,</span>\\n    <span class=\\\"p\\\">}</span>\\n\\n    <span class=\\\"n\\\">r</span> <span class=\\\"o\\\">=</span> <span class=\\\"n\\\">requests</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">post</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">url</span><span class=\\\"p\\\">,</span> <span class=\\\"n\\\">data</span><span class=\\\"o\\\">=</span><span class=\\\"n\\\">json</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">dumps</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">payload_dic</span><span class=\\\"p\\\">))</span>\\n\\n\\n</code></pre></div></div>\\n\\n<p><code>def web_check():</code>\u306B\u51E6\u7406\u3092\u79FB\u3057\u3066\u7F6E\u304D\u307E\u3057\u305F\u3002</p>\\n\\n<div class=\\\"code-frame\\\" data-lang=\\\"text\\\"><div class=\\\"highlight\\\"><pre><code>def lambda_handler(event, context):\\n    print('Checking {} at {}...'.format(SITE, event['time']))\\n    # web_check()\\n    send_slack(\\\"test\\\")\\n    return \\\"success!\\\"\\n</code></pre></div></div>\\n\\n<p>\u3053\u308C\u3067</p>\\n\\n<p><a href=\\\"https://camo.qiitausercontent.com/23e831030b9e580f8597ad709ffcc8a2fbc4ccdc/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131323932392f62336364323839302d303066332d356337642d306666322d3430313664393461613431372e706e67\\\" target=\\\"_blank\\\" rel=\\\"nofollow noopener\\\"><img width=\\\"760\\\" alt=\\\"\u30B9\u30AF\u30EA\u30FC\u30F3\u30B7\u30E7\u30C3\u30C8 2017-03-15 16.55.31.png\\\" src=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2Fb3cd2890-00f3-5c7d-0ff2-4016d94aa417.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=90e87855869ce070705fd203e3dc65fa\\\" data-canonical-src=\\\"https://qiita-image-store.s3.amazonaws.com/0/112929/b3cd2890-00f3-5c7d-0ff2-4016d94aa417.png\\\" srcset=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2Fb3cd2890-00f3-5c7d-0ff2-4016d94aa417.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=b3ba890f1bfb02bae52cdce7568a3339 1x\\\" loading=\\\"lazy\\\"></a><br>\\nSlack\u5230\u7740\u3057\u307E\u3057\u305F\u3002</p>\\n\\n<p>Okay\u3002<br>\\n\u6B21\u306FDynamoDB\u304B\u3089\u30C7\u30FC\u30BF\u3092\u53D6\u3063\u3066\u304D\u307E\u3059\u3002</p>\\n\\n<h1>\\n<span id=\\\"dynamodb\\\" class=\\\"fragment\\\"></span><a href=\\\"#dynamodb\\\"><i class=\\\"fa fa-link\\\"></i></a>DynamoDB</h1>\\n\\n<h2>\\n<span id=\\\"\u6599\u91D1\u4F53\u7CFB-1\\\" class=\\\"fragment\\\"></span><a href=\\\"#%E6%96%99%E9%87%91%E4%BD%93%E7%B3%BB-1\\\"><i class=\\\"fa fa-link\\\"></i></a>\u6599\u91D1\u4F53\u7CFB</h2>\\n\\n<p>AWS \u306E\u7121\u6599\u5229\u7528\u67A0\u306E\u4E00\u90E8\u3068\u3057\u3066\u306EDynamoDB\u7121\u6599\u67A0</p>\\n\\n<table>\\n<thead>\\n<tr>\\n<th style=\\\"text-align: center\\\">\u30B9\u30C8\u30EC\u30FC\u30B8</th>\\n<th style=\\\"text-align: center\\\">\u66F8\u304D\u8FBC\u307F\u5BB9\u91CF</th>\\n<th style=\\\"text-align: center\\\">\u66F8\u304D\u8FBC\u307F\u5BB9\u91CF</th>\\n</tr>\\n</thead>\\n<tbody>\\n<tr>\\n<td style=\\\"text-align: center\\\">25GB</td>\\n<td style=\\\"text-align: center\\\">25</td>\\n<td style=\\\"text-align: center\\\">25</td>\\n</tr>\\n</tbody>\\n</table>\\n\\n<blockquote>\\n<p>1 \u3064\u306E\u5BB9\u91CF\u306E\u30E6\u30CB\u30C3\u30C8\u3067 1 \u79D2\u3042\u305F\u308A\u306B 1 \u3064\u306E\u30EA\u30AF\u30A8\u30B9\u30C8\u3092\u51E6\u7406\u3057\u307E\u3059<br>\\n1\u30E6\u30CB\u30C3\u30C8\u306E\u66F8\u304D\u8FBC\u307F\u5BB9\u91CF: \u6700\u59271KB\u30C7\u30FC\u30BF\u30921\u79D2\u306B1\u66F8\u304D\u8FBC\u307F<br>\\n1\u30E6\u30CB\u30C3\u30C8\u306E\u8AAD\u307F\u8FBC\u307F\u5BB9\u91CF: \u6700\u59274KB\u30C7\u30FC\u30BF\u30921\u79D2\u306B1\u8AAD\u307F\u8FBC\u307F<br>\\nDynamoDB \u30B9\u30C8\u30EA\u30FC\u30E0\u304B\u3089\u306E 250 \u4E07\u56DE\u306E\u8AAD\u307F\u8FBC\u307F\u30EA\u30AF\u30A8\u30B9\u30C8\u3092\u7121\u6599\u3067\u5229\u7528\u3067\u304D\u307E\u3059\u3002</p>\\n</blockquote>\\n\\n<p>\u3068\u308A\u3042\u3048\u305A\u30C7\u30FC\u30BF\u30D9\u30FC\u30B9\u3092\u4F5C\u308B\u6642\u306B\u66F8\u304D\u8FBC\u307F\u5BB9\u91CF\u3068\u8AAD\u307F\u8FBC\u307F\u5BB9\u91CF\u30921\u306B\u30BB\u30C3\u30C8\u3057\u3066\u4F7F\u3048\u3070\u3001\u7121\u6599\u67A0\u3060\u3068\u304A\u91D1\u304B\u304B\u3089\u306A\u3044\u3068\u601D\u3044\u307E\u3059\u3002<br>\\n\u4ECA\u56DE\u306F1\u5206\u306B1\u5EA6\u304F\u3089\u3044\u3067\u3082\u3044\u3044\u306E\u3067\u3001\u6700\u5C0F\u5358\u4F4D\u306E1(1\u79D2\u306B1\u5EA6\u30A2\u30AF\u30BB\u30B9\u3067\u304D\u308B\u30EC\u30D9\u30EB)\u3092\u9078\u3073\u307E\u3059\u3002</p>\\n\\n<h2>\\n<span id=\\\"\u4F5C\u3063\u3066\u307F\u308B\\\" class=\\\"fragment\\\"></span><a href=\\\"#%E4%BD%9C%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B\\\"><i class=\\\"fa fa-link\\\"></i></a>\u4F5C\u3063\u3066\u307F\u308B</h2>\\n\\n<p>\u3068\u308A\u3042\u3048\u305A\u8A2D\u5B9A\u306F\u3053\u3093\u306A\u611F\u3058\u3002</p>\\n\\n<p><a href=\\\"https://camo.qiitausercontent.com/e8b3da60bed5d16323f30e1a45ce118e562363f5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131323932392f39383434363062372d386463352d633264352d333166342d6162356238303736373963302e706e67\\\" target=\\\"_blank\\\" rel=\\\"nofollow noopener\\\"><img src=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2F984460b7-8dc5-c2d5-31f4-ab5b807679c0.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=e09245884c341858e798a2bf449ae35e\\\" alt=\\\"\u30B9\u30AF\u30EA\u30FC\u30F3\u30B7\u30E7\u30C3\u30C8 2017-03-15 17.10.25.png\\\" data-canonical-src=\\\"https://qiita-image-store.s3.amazonaws.com/0/112929/984460b7-8dc5-c2d5-31f4-ab5b807679c0.png\\\" srcset=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2F984460b7-8dc5-c2d5-31f4-ab5b807679c0.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=14ef6909a249447d1075862b99e22fe5 1x\\\" loading=\\\"lazy\\\"></a></p>\\n\\n<p>DynamoDB\u306F\u30CF\u30C3\u30B7\u30E5(\u8A00\u8A9E\u306B\u3088\u3063\u3066\u306F\u8F9E\u66F8\u578B\u3001\u9023\u60F3\u914D\u5217\u306A\u3069)\u306EKey\u3067\u3057\u304B\u30A2\u30AF\u30BB\u30B9\u3067\u304D\u307E\u305B\u3093\u3002\u4ECA\u56DE\u306Fid\u3092key\u3068\u3057\u3066\u30A2\u30AF\u30BB\u30B9\u3057\u307E\u3059\u3002</p>\\n\\n<p><a href=\\\"https://camo.qiitausercontent.com/456ad6b5288496ab9ee9734b092f406a2a88f9aa/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131323932392f30613836313233372d646230662d333731652d343539362d3461643662633438386539342e706e67\\\" target=\\\"_blank\\\" rel=\\\"nofollow noopener\\\"><img src=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2F0a861237-db0f-371e-4596-4ad6bc488e94.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=7148e5adb30fb0ae0ec2c07be4fbe5ec\\\" alt=\\\"\u30B9\u30AF\u30EA\u30FC\u30F3\u30B7\u30E7\u30C3\u30C8 2017-03-15 17.15.28.png\\\" data-canonical-src=\\\"https://qiita-image-store.s3.amazonaws.com/0/112929/0a861237-db0f-371e-4596-4ad6bc488e94.png\\\" srcset=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2F0a861237-db0f-371e-4596-4ad6bc488e94.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=9f21c61c847813fb1b3454885520e7be 1x\\\" loading=\\\"lazy\\\"></a></p>\\n\\n<div class=\\\"code-frame\\\" data-lang=\\\"json\\\"><div class=\\\"highlight\\\"><pre><code><span class=\\\"w\\\">\\n</span><span class=\\\"p\\\">{</span><span class=\\\"w\\\">\\n  </span><span class=\\\"nl\\\">\\\"id\\\"</span><span class=\\\"p\\\">:</span><span class=\\\"w\\\"> </span><span class=\\\"mi\\\">1</span><span class=\\\"p\\\">,</span><span class=\\\"w\\\">\\n  </span><span class=\\\"nl\\\">\\\"target\\\"</span><span class=\\\"p\\\">:</span><span class=\\\"w\\\"> </span><span class=\\\"s2\\\">\\\"Online Shopping\\\"</span><span class=\\\"p\\\">,</span><span class=\\\"w\\\">\\n  </span><span class=\\\"nl\\\">\\\"url\\\"</span><span class=\\\"p\\\">:</span><span class=\\\"w\\\"> </span><span class=\\\"s2\\\">\\\"https://www.amazon.com/\\\"</span><span class=\\\"w\\\">\\n</span><span class=\\\"p\\\">}</span><span class=\\\"w\\\">\\n\\n</span><span class=\\\"p\\\">{</span><span class=\\\"w\\\">\\n  </span><span class=\\\"nl\\\">\\\"id\\\"</span><span class=\\\"p\\\">:</span><span class=\\\"w\\\"> </span><span class=\\\"mi\\\">2</span><span class=\\\"p\\\">,</span><span class=\\\"w\\\">\\n  </span><span class=\\\"nl\\\">\\\"target\\\"</span><span class=\\\"p\\\">:</span><span class=\\\"w\\\"> </span><span class=\\\"s2\\\">\\\"Gmail\\\"</span><span class=\\\"p\\\">,</span><span class=\\\"w\\\">\\n  </span><span class=\\\"nl\\\">\\\"url\\\"</span><span class=\\\"p\\\">:</span><span class=\\\"w\\\"> </span><span class=\\\"s2\\\">\\\"https://www.google.co.jp/\\\"</span><span class=\\\"w\\\">\\n</span><span class=\\\"p\\\">}</span><span class=\\\"w\\\">\\n</span></code></pre></div></div>\\n\\n<p>url\u304B\u3089target\u3092\u63A2\u3059\u305F\u3081\u306ETable\u3068\u3057\u3066\u4F7F\u3044\u307E\u3059\u3002</p>\\n\\n<h2>\\n<span id=\\\"python\u30B3\u30FC\u30C9\u304B\u3089\u5148\u7A0B\u306E\u30C7\u30FC\u30BF\u3092\u53D6\u3063\u3066\u307F\u308B\\\" class=\\\"fragment\\\"></span><a href=\\\"#python%E3%82%B3%E3%83%BC%E3%83%89%E3%81%8B%E3%82%89%E5%85%88%E7%A8%8B%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E5%8F%96%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B\\\"><i class=\\\"fa fa-link\\\"></i></a>python\u30B3\u30FC\u30C9\u304B\u3089\u5148\u7A0B\u306E\u30C7\u30FC\u30BF\u3092\u53D6\u3063\u3066\u307F\u308B</h2>\\n\\n<div class=\\\"code-frame\\\" data-lang=\\\"python\\\"><div class=\\\"highlight\\\"><pre><code><span class=\\\"c1\\\"># \uFF12\u3064\u8FFD\u52A0\\n</span><span class=\\\"kn\\\">import</span> <span class=\\\"nn\\\">boto3</span>\\n<span class=\\\"kn\\\">from</span> <span class=\\\"nn\\\">boto3.dynamodb.conditions</span> <span class=\\\"kn\\\">import</span> <span class=\\\"n\\\">Key</span><span class=\\\"p\\\">,</span> <span class=\\\"n\\\">Attr</span>\\n\\n<span class=\\\"k\\\">def</span> <span class=\\\"nf\\\">get_urls</span><span class=\\\"p\\\">():</span>\\n    <span class=\\\"n\\\">table</span>    <span class=\\\"o\\\">=</span> <span class=\\\"n\\\">dynamodb</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">Table</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">'sites'</span><span class=\\\"p\\\">)</span>\\n    <span class=\\\"n\\\">response</span> <span class=\\\"o\\\">=</span> <span class=\\\"n\\\">table</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">scan</span><span class=\\\"p\\\">()</span>\\n    <span class=\\\"n\\\">sites</span> <span class=\\\"o\\\">=</span> <span class=\\\"n\\\">response</span><span class=\\\"p\\\">[</span><span class=\\\"s\\\">\\\"Items\\\"</span><span class=\\\"p\\\">]</span>\\n    <span class=\\\"k\\\">return</span> <span class=\\\"n\\\">sites</span>\\n</code></pre></div></div>\\n\\n<p>\u6A5F\u80FD\u3092\u8FFD\u52A0\u3057\u3066\u3001get_urls()\u3067DynamoDB\u304B\u3089\u53D6\u3063\u3066\u304D\u305Furl\u304B\u3089target\u306E\u6587\u7AE0\u304C\u3042\u308B\u304B\u30B5\u30FC\u30C1\u3057\u3066\u3044\u307E\u3059\u3002</p>\\n\\n<div class=\\\"code-frame\\\" data-lang=\\\"python\\\">\\n<div class=\\\"code-lang\\\"><span class=\\\"bold\\\">\u73FE\u5728\u306E.py</span></div>\\n<div class=\\\"highlight\\\"><pre><code><span class=\\\"c1\\\"># coding: utf-8\\n</span><span class=\\\"kn\\\">from</span> <span class=\\\"nn\\\">__future__</span> <span class=\\\"kn\\\">import</span> <span class=\\\"n\\\">print_function</span>\\n\\n<span class=\\\"kn\\\">import</span> <span class=\\\"nn\\\">os</span>\\n<span class=\\\"kn\\\">import</span> <span class=\\\"nn\\\">json</span>\\n<span class=\\\"kn\\\">import</span> <span class=\\\"nn\\\">requests</span>\\n<span class=\\\"kn\\\">from</span> <span class=\\\"nn\\\">datetime</span> <span class=\\\"kn\\\">import</span> <span class=\\\"n\\\">datetime</span>\\n<span class=\\\"kn\\\">from</span> <span class=\\\"nn\\\">urllib2</span> <span class=\\\"kn\\\">import</span> <span class=\\\"n\\\">urlopen</span>\\n<span class=\\\"kn\\\">import</span> <span class=\\\"nn\\\">boto3</span>\\n<span class=\\\"kn\\\">from</span> <span class=\\\"nn\\\">boto3.dynamodb.conditions</span> <span class=\\\"kn\\\">import</span> <span class=\\\"n\\\">Key</span><span class=\\\"p\\\">,</span> <span class=\\\"n\\\">Attr</span>\\n\\n<span class=\\\"n\\\">dynamodb</span> <span class=\\\"o\\\">=</span> <span class=\\\"n\\\">boto3</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">resource</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">'dynamodb'</span><span class=\\\"p\\\">)</span>\\n\\n<span class=\\\"k\\\">def</span> <span class=\\\"nf\\\">validate</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">res</span><span class=\\\"p\\\">,</span> <span class=\\\"n\\\">target</span><span class=\\\"p\\\">):</span>\\n    <span class=\\\"k\\\">return</span> <span class=\\\"n\\\">target</span> <span class=\\\"ow\\\">in</span> <span class=\\\"n\\\">res</span>\\n\\n<span class=\\\"k\\\">def</span> <span class=\\\"nf\\\">web_check</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">url</span><span class=\\\"p\\\">,</span> <span class=\\\"n\\\">target</span><span class=\\\"p\\\">):</span>\\n    <span class=\\\"k\\\">print</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">\\\"Serching ... \\\"</span> <span class=\\\"o\\\">+</span> <span class=\\\"n\\\">target</span><span class=\\\"p\\\">)</span>\\n    <span class=\\\"k\\\">try</span><span class=\\\"p\\\">:</span>\\n        <span class=\\\"k\\\">if</span> <span class=\\\"n\\\">validate</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">urlopen</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">url</span><span class=\\\"p\\\">).</span><span class=\\\"n\\\">read</span><span class=\\\"p\\\">(),</span> <span class=\\\"n\\\">target</span><span class=\\\"p\\\">):</span>\\n            <span class=\\\"k\\\">print</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">\\\"Find!\\\"</span><span class=\\\"p\\\">)</span>\\n        <span class=\\\"k\\\">else</span><span class=\\\"p\\\">:</span>\\n            <span class=\\\"k\\\">print</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">\\\"Not Find!\\\"</span><span class=\\\"p\\\">)</span>\\n    <span class=\\\"k\\\">except</span> <span class=\\\"nb\\\">Exception</span> <span class=\\\"k\\\">as</span> <span class=\\\"n\\\">e</span><span class=\\\"p\\\">:</span>\\n        <span class=\\\"k\\\">print</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">'Error'</span><span class=\\\"p\\\">)</span>\\n        <span class=\\\"k\\\">print</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">e</span><span class=\\\"p\\\">)</span>\\n\\n<span class=\\\"k\\\">def</span> <span class=\\\"nf\\\">get_urls</span><span class=\\\"p\\\">():</span>\\n    <span class=\\\"n\\\">table</span>    <span class=\\\"o\\\">=</span> <span class=\\\"n\\\">dynamodb</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">Table</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">'sites'</span><span class=\\\"p\\\">)</span>\\n    <span class=\\\"n\\\">response</span> <span class=\\\"o\\\">=</span> <span class=\\\"n\\\">table</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">scan</span><span class=\\\"p\\\">()</span>\\n    <span class=\\\"n\\\">sites</span> <span class=\\\"o\\\">=</span> <span class=\\\"n\\\">response</span><span class=\\\"p\\\">[</span><span class=\\\"s\\\">\\\"Items\\\"</span><span class=\\\"p\\\">]</span>\\n    <span class=\\\"k\\\">return</span> <span class=\\\"n\\\">sites</span>\\n\\n<span class=\\\"k\\\">def</span> <span class=\\\"nf\\\">send_slack</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">text</span><span class=\\\"p\\\">):</span>\\n    <span class=\\\"n\\\">url</span> <span class=\\\"o\\\">=</span> <span class=\\\"s\\\">\\\"https://hooks.slack.com/services/\\\"</span>\\n    <span class=\\\"n\\\">payload_dic</span> <span class=\\\"o\\\">=</span> <span class=\\\"p\\\">{</span>\\n        <span class=\\\"s\\\">\\\"text\\\"</span><span class=\\\"p\\\">:</span><span class=\\\"n\\\">text</span><span class=\\\"p\\\">,</span>\\n        <span class=\\\"s\\\">\\\"icon_emoji\\\"</span><span class=\\\"p\\\">:</span><span class=\\\"s\\\">':grin:'</span><span class=\\\"p\\\">,</span>\\n        <span class=\\\"s\\\">\\\"channel\\\"</span><span class=\\\"p\\\">:</span><span class=\\\"s\\\">'bot-test2'</span><span class=\\\"p\\\">,</span>\\n    <span class=\\\"p\\\">}</span>\\n    <span class=\\\"n\\\">r</span> <span class=\\\"o\\\">=</span> <span class=\\\"n\\\">requests</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">post</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">url</span><span class=\\\"p\\\">,</span> <span class=\\\"n\\\">data</span><span class=\\\"o\\\">=</span><span class=\\\"n\\\">json</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">dumps</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">payload_dic</span><span class=\\\"p\\\">))</span>\\n\\n<span class=\\\"k\\\">def</span> <span class=\\\"nf\\\">lambda_handler</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">event</span><span class=\\\"p\\\">,</span> <span class=\\\"n\\\">context</span><span class=\\\"p\\\">):</span>\\n    <span class=\\\"k\\\">print</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">'Check start'</span><span class=\\\"p\\\">)</span>\\n\\n    <span class=\\\"n\\\">sites</span> <span class=\\\"o\\\">=</span> <span class=\\\"n\\\">get_urls</span><span class=\\\"p\\\">()</span>\\n    <span class=\\\"k\\\">for</span> <span class=\\\"n\\\">site</span> <span class=\\\"ow\\\">in</span> <span class=\\\"n\\\">sites</span><span class=\\\"p\\\">:</span>\\n        <span class=\\\"n\\\">web_check</span><span class=\\\"p\\\">(</span><span class=\\\"nb\\\">str</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">site</span><span class=\\\"p\\\">[</span><span class=\\\"s\\\">\\\"url\\\"</span><span class=\\\"p\\\">]),</span> <span class=\\\"nb\\\">str</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">site</span><span class=\\\"p\\\">[</span><span class=\\\"s\\\">\\\"target\\\"</span><span class=\\\"p\\\">]))</span>\\n\\n    <span class=\\\"k\\\">return</span> <span class=\\\"s\\\">\\\"success!\\\"</span>\\n\\n\\n</code></pre></div>\\n</div>\\n\\n<p>\u51FA\u529B\u7D50\u679C</p>\\n\\n<div class=\\\"code-frame\\\" data-lang=\\\"shell-session\\\"><div class=\\\"highlight\\\"><pre><code><span class=\\\"go\\\">\\nCheck start\\nSerching ... \u6280\u8853\u60C5\u5831\u5171\u6709\u30B5\u30FC\u30D3\u30B9\u3067\u3059 at https://qiita.com/\\nFind!\\nSerching ... Gmail at https://www.google.co.jp/\\nFind!\\nSerching ... Gmail\u3067\u3059\u304B\uFF1F at https://www.google.co.jp/\\nNot Find!\\nSerching ... Online Shopping at https://www.amazon.com/\\nError\\nHTTP Error 503: Service Unavailable\\nEND RequestId: 3992d81e-095e-11e7-b30a-1ddc7da9e992\\n</span></code></pre></div></div>\\n\\n<p>\u3053\u3053\u3067\u3082\u30A8\u30E9\u30FC\u304A\u304D\u307E\u3057\u305F\u3002Python\u3064\u307E\u3065\u304F\uFF01</p>\\n\\n<div class=\\\"code-frame\\\" data-lang=\\\"shell-session\\\"><div class=\\\"highlight\\\"><pre><code><span class=\\\"go\\\">\\n'utf8' codec can't decode byte 0x90 in position 102: invalid start byte\\n</span></code></pre></div></div>\\n\\n<p><a href=\\\"http://lab.hde.co.jp/2008/08/pythonunicodeencodeerror.html\\\" rel=\\\"nofollow noopener\\\" target=\\\"_blank\\\">Python\u306EUnicodeEncodeError\u3092\u77E5\u308B</a><br>\\n\u3053\u3053\u3092\u53C2\u8003\u306B\u30A8\u30E9\u30FC\u89E3\u6C7A\u3057\u307E\u3057\u305F\u3002<br>\\n<code>type(site[\\\"url\\\"])</code>\u3057\u305F\u3089<code>&lt;type 'unicode'&gt;</code>\u3060\u3063\u305F\u306E\u3067\u3001<br>\\n<code>str(site[\\\"url\\\"])</code>\u3092\u3057\u3066<code>&lt;type 'str'&gt;</code>\u306B\u5909\u3048\u307E\u3057\u305F\u3002</p>\\n\\n<h2>\\n<span id=\\\"lambda\u304B\u3089dynamodb\u66F8\u304D\u8FBC\u307F\\\" class=\\\"fragment\\\"></span><a href=\\\"#lambda%E3%81%8B%E3%82%89dynamodb%E6%9B%B8%E3%81%8D%E8%BE%BC%E3%81%BF\\\"><i class=\\\"fa fa-link\\\"></i></a>Lambda\u304B\u3089DynamoDB\u66F8\u304D\u8FBC\u307F</h2>\\n\\n<p>sites_check1\u30C6\u30FC\u30D6\u30EB\u306E\u8FFD\u52A0</p>\\n\\n<p><a href=\\\"https://camo.qiitausercontent.com/6b816960ceb961b453da976b4c20284f5e863ffc/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131323932392f65383039613561642d363565632d346639342d643262392d6136393933383065303439372e706e67\\\" target=\\\"_blank\\\" rel=\\\"nofollow noopener\\\"><img src=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2Fe809a5ad-65ec-4f94-d2b9-a699380e0497.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=8cccb26f61719c7e881c7bb82bbe8891\\\" alt=\\\"\u30B9\u30AF\u30EA\u30FC\u30F3\u30B7\u30E7\u30C3\u30C8 2017-03-15 18.19.12.png\\\" data-canonical-src=\\\"https://qiita-image-store.s3.amazonaws.com/0/112929/e809a5ad-65ec-4f94-d2b9-a699380e0497.png\\\" srcset=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2Fe809a5ad-65ec-4f94-d2b9-a699380e0497.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=6f962ba1e6c3ea97b4634855f0627e1f 1x\\\" loading=\\\"lazy\\\"></a></p>\\n\\n<p>\u8FFD\u52A0</p>\\n\\n<div class=\\\"code-frame\\\" data-lang=\\\"python\\\"><div class=\\\"highlight\\\"><pre><code><span class=\\\"kn\\\">from</span> <span class=\\\"nn\\\">datetime</span> <span class=\\\"kn\\\">import</span> <span class=\\\"n\\\">datetime</span><span class=\\\"p\\\">,</span> <span class=\\\"n\\\">timedelta</span>\\n\\n<span class=\\\"k\\\">def</span> <span class=\\\"nf\\\">insert</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">results</span><span class=\\\"p\\\">):</span>\\n    <span class=\\\"n\\\">date</span> <span class=\\\"o\\\">=</span> <span class=\\\"n\\\">datetime</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">now</span><span class=\\\"p\\\">()</span> <span class=\\\"o\\\">+</span> <span class=\\\"n\\\">timedelta</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">hours</span><span class=\\\"o\\\">=</span><span class=\\\"mi\\\">9</span><span class=\\\"p\\\">)</span>\\n\\n    <span class=\\\"nb\\\">id</span> <span class=\\\"o\\\">=</span> <span class=\\\"mi\\\">0</span>\\n    <span class=\\\"n\\\">table</span> <span class=\\\"o\\\">=</span> <span class=\\\"n\\\">dynamodb</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">Table</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">'sites_check'</span><span class=\\\"p\\\">)</span>\\n    <span class=\\\"n\\\">table</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">put_item</span><span class=\\\"p\\\">(</span>\\n        <span class=\\\"n\\\">Item</span><span class=\\\"o\\\">=</span><span class=\\\"p\\\">{</span>\\n            <span class=\\\"s\\\">\\\"id\\\"</span><span class=\\\"p\\\">:</span> <span class=\\\"nb\\\">id</span><span class=\\\"p\\\">,</span>\\n            <span class=\\\"s\\\">\\\"date\\\"</span><span class=\\\"p\\\">:</span> <span class=\\\"n\\\">date</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">strftime</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">\\\"%Y/%m/%d %H:%M\\\"</span><span class=\\\"p\\\">),</span>\\n            <span class=\\\"s\\\">\\\"result\\\"</span><span class=\\\"p\\\">:</span> <span class=\\\"n\\\">results</span>\\n       <span class=\\\"p\\\">}</span>\\n    <span class=\\\"p\\\">)</span>\\n</code></pre></div></div>\\n\\n<p>\u6642\u9593\u306E\u5897\u6E1B\u3092\u884C\u3046timedelta\u3068\u304B\u3092\u8FFD\u52A0\u3057\u307E\u3057\u305F\u3002<br>\\nDynamoDB\u306Esites\u30C6\u30FC\u30D6\u30EB\u306B\u30BF\u30A4\u30C8\u30EB\u8FFD\u52A0\u3057\u307E\u3057\u305F\u3002<br>\\n\u73FE\u5728\u306E\u30B3\u30FC\u30C9</p>\\n\\n<div class=\\\"code-frame\\\" data-lang=\\\"python\\\"><div class=\\\"highlight\\\"><pre><code>\\n<span class=\\\"c1\\\"># coding: utf-8\\n</span><span class=\\\"kn\\\">from</span> <span class=\\\"nn\\\">__future__</span> <span class=\\\"kn\\\">import</span> <span class=\\\"n\\\">print_function</span>\\n\\n<span class=\\\"kn\\\">import</span> <span class=\\\"nn\\\">os</span>\\n<span class=\\\"kn\\\">import</span> <span class=\\\"nn\\\">json</span>\\n<span class=\\\"kn\\\">import</span> <span class=\\\"nn\\\">requests</span>\\n<span class=\\\"kn\\\">from</span> <span class=\\\"nn\\\">datetime</span> <span class=\\\"kn\\\">import</span> <span class=\\\"n\\\">datetime</span><span class=\\\"p\\\">,</span> <span class=\\\"n\\\">timedelta</span>\\n<span class=\\\"kn\\\">from</span> <span class=\\\"nn\\\">urllib2</span> <span class=\\\"kn\\\">import</span> <span class=\\\"n\\\">urlopen</span>\\n<span class=\\\"kn\\\">import</span> <span class=\\\"nn\\\">boto3</span>\\n<span class=\\\"kn\\\">from</span> <span class=\\\"nn\\\">boto3.dynamodb.conditions</span> <span class=\\\"kn\\\">import</span> <span class=\\\"n\\\">Key</span><span class=\\\"p\\\">,</span> <span class=\\\"n\\\">Attr</span>\\n\\n<span class=\\\"n\\\">dynamodb</span> <span class=\\\"o\\\">=</span> <span class=\\\"n\\\">boto3</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">resource</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">'dynamodb'</span><span class=\\\"p\\\">)</span>\\n\\n<span class=\\\"k\\\">def</span> <span class=\\\"nf\\\">validate</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">res</span><span class=\\\"p\\\">,</span> <span class=\\\"n\\\">target</span><span class=\\\"p\\\">):</span>\\n    <span class=\\\"k\\\">return</span> <span class=\\\"n\\\">target</span> <span class=\\\"ow\\\">in</span> <span class=\\\"n\\\">res</span>\\n\\n<span class=\\\"k\\\">def</span> <span class=\\\"nf\\\">web_check</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">url</span><span class=\\\"p\\\">,</span> <span class=\\\"n\\\">target</span><span class=\\\"p\\\">):</span>\\n    <span class=\\\"k\\\">print</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">\\\"Serching ... \\\"</span> <span class=\\\"o\\\">+</span> <span class=\\\"n\\\">target</span> <span class=\\\"o\\\">+</span> <span class=\\\"s\\\">\\\" at \\\"</span> <span class=\\\"o\\\">+</span> <span class=\\\"n\\\">url</span><span class=\\\"p\\\">)</span>\\n    <span class=\\\"k\\\">try</span><span class=\\\"p\\\">:</span>\\n        <span class=\\\"k\\\">if</span> <span class=\\\"n\\\">validate</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">urlopen</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">url</span><span class=\\\"p\\\">).</span><span class=\\\"n\\\">read</span><span class=\\\"p\\\">(),</span> <span class=\\\"n\\\">target</span><span class=\\\"p\\\">):</span>\\n            <span class=\\\"k\\\">return</span> <span class=\\\"s\\\">\\\"Find!\\\"</span>\\n        <span class=\\\"k\\\">else</span><span class=\\\"p\\\">:</span>\\n            <span class=\\\"k\\\">return</span> <span class=\\\"s\\\">\\\"Not Find!\\\"</span>\\n    <span class=\\\"k\\\">except</span> <span class=\\\"nb\\\">Exception</span> <span class=\\\"k\\\">as</span> <span class=\\\"n\\\">e</span><span class=\\\"p\\\">:</span>\\n        <span class=\\\"k\\\">return</span> <span class=\\\"nb\\\">str</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">e</span><span class=\\\"p\\\">)</span>\\n\\n<span class=\\\"k\\\">def</span> <span class=\\\"nf\\\">get_urls</span><span class=\\\"p\\\">():</span>\\n    <span class=\\\"n\\\">table</span>    <span class=\\\"o\\\">=</span> <span class=\\\"n\\\">dynamodb</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">Table</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">'sites'</span><span class=\\\"p\\\">)</span>\\n    <span class=\\\"n\\\">response</span> <span class=\\\"o\\\">=</span> <span class=\\\"n\\\">table</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">scan</span><span class=\\\"p\\\">()</span>\\n    <span class=\\\"n\\\">sites</span> <span class=\\\"o\\\">=</span> <span class=\\\"n\\\">response</span><span class=\\\"p\\\">[</span><span class=\\\"s\\\">\\\"Items\\\"</span><span class=\\\"p\\\">]</span>\\n    <span class=\\\"k\\\">return</span> <span class=\\\"n\\\">sites</span>\\n\\n<span class=\\\"k\\\">def</span> <span class=\\\"nf\\\">send_slack</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">text</span><span class=\\\"p\\\">):</span>\\n    <span class=\\\"n\\\">url</span> <span class=\\\"o\\\">=</span> <span class=\\\"s\\\">\\\"https://hooks.slack.com/\\\"</span>\\n    <span class=\\\"n\\\">payload_dic</span> <span class=\\\"o\\\">=</span> <span class=\\\"p\\\">{</span>\\n        <span class=\\\"s\\\">\\\"text\\\"</span><span class=\\\"p\\\">:</span><span class=\\\"n\\\">text</span><span class=\\\"p\\\">,</span>\\n        <span class=\\\"s\\\">\\\"icon_emoji\\\"</span><span class=\\\"p\\\">:</span><span class=\\\"s\\\">':grin:'</span><span class=\\\"p\\\">,</span>\\n        <span class=\\\"s\\\">\\\"channel\\\"</span><span class=\\\"p\\\">:</span><span class=\\\"s\\\">'bot-test2'</span><span class=\\\"p\\\">,</span>\\n    <span class=\\\"p\\\">}</span>\\n    <span class=\\\"n\\\">r</span> <span class=\\\"o\\\">=</span> <span class=\\\"n\\\">requests</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">post</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">url</span><span class=\\\"p\\\">,</span> <span class=\\\"n\\\">data</span><span class=\\\"o\\\">=</span><span class=\\\"n\\\">json</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">dumps</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">payload_dic</span><span class=\\\"p\\\">))</span>\\n\\n<span class=\\\"k\\\">def</span> <span class=\\\"nf\\\">insert</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">results</span><span class=\\\"p\\\">):</span>\\n    <span class=\\\"n\\\">date</span> <span class=\\\"o\\\">=</span> <span class=\\\"n\\\">datetime</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">now</span><span class=\\\"p\\\">()</span> <span class=\\\"o\\\">+</span> <span class=\\\"n\\\">timedelta</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">hours</span><span class=\\\"o\\\">=</span><span class=\\\"mi\\\">9</span><span class=\\\"p\\\">)</span>\\n\\n    <span class=\\\"nb\\\">id</span> <span class=\\\"o\\\">=</span> <span class=\\\"mi\\\">0</span>\\n    <span class=\\\"n\\\">table</span> <span class=\\\"o\\\">=</span> <span class=\\\"n\\\">dynamodb</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">Table</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">'sites_check'</span><span class=\\\"p\\\">)</span>\\n    <span class=\\\"n\\\">table</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">put_item</span><span class=\\\"p\\\">(</span>\\n        <span class=\\\"n\\\">Item</span><span class=\\\"o\\\">=</span><span class=\\\"p\\\">{</span>\\n            <span class=\\\"s\\\">\\\"id\\\"</span><span class=\\\"p\\\">:</span> <span class=\\\"nb\\\">id</span><span class=\\\"p\\\">,</span>\\n            <span class=\\\"s\\\">\\\"date\\\"</span><span class=\\\"p\\\">:</span> <span class=\\\"n\\\">date</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">strftime</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">\\\"%Y/%m/%d %H:%M\\\"</span><span class=\\\"p\\\">),</span>\\n            <span class=\\\"s\\\">\\\"result\\\"</span><span class=\\\"p\\\">:</span> <span class=\\\"n\\\">results</span>\\n       <span class=\\\"p\\\">}</span>\\n    <span class=\\\"p\\\">)</span>\\n\\n<span class=\\\"k\\\">def</span> <span class=\\\"nf\\\">lambda_handler</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">event</span><span class=\\\"p\\\">,</span> <span class=\\\"n\\\">context</span><span class=\\\"p\\\">):</span>\\n    <span class=\\\"k\\\">print</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">'Check start'</span><span class=\\\"p\\\">)</span>\\n\\n    <span class=\\\"n\\\">results</span> <span class=\\\"o\\\">=</span> <span class=\\\"p\\\">{}</span>\\n    <span class=\\\"n\\\">sites</span> <span class=\\\"o\\\">=</span> <span class=\\\"n\\\">get_urls</span><span class=\\\"p\\\">()</span>\\n    <span class=\\\"k\\\">for</span> <span class=\\\"n\\\">site</span> <span class=\\\"ow\\\">in</span> <span class=\\\"n\\\">sites</span><span class=\\\"p\\\">:</span>\\n        <span class=\\\"n\\\">msg</span> <span class=\\\"o\\\">=</span> <span class=\\\"n\\\">web_check</span><span class=\\\"p\\\">(</span><span class=\\\"nb\\\">str</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">site</span><span class=\\\"p\\\">[</span><span class=\\\"s\\\">\\\"url\\\"</span><span class=\\\"p\\\">]),</span> <span class=\\\"nb\\\">str</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">site</span><span class=\\\"p\\\">[</span><span class=\\\"s\\\">\\\"target\\\"</span><span class=\\\"p\\\">]))</span>\\n        <span class=\\\"n\\\">results</span><span class=\\\"p\\\">[</span><span class=\\\"nb\\\">str</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">site</span><span class=\\\"p\\\">[</span><span class=\\\"s\\\">\\\"title\\\"</span><span class=\\\"p\\\">])]</span> <span class=\\\"o\\\">=</span> <span class=\\\"n\\\">msg</span>\\n\\n    <span class=\\\"n\\\">insert</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">results</span><span class=\\\"p\\\">)</span>\\n    <span class=\\\"k\\\">return</span> <span class=\\\"s\\\">\\\"success!\\\"</span>\\n\\n\\n\\n</code></pre></div></div>\\n\\n<p>\u30C7\u30FC\u30BF\u3092\u633F\u5165\u3057\u305F\u7D50\u679C\u304C\u3053\u3061\u3089\u3002</p>\\n\\n<div class=\\\"code-frame\\\" data-lang=\\\"json\\\"><div class=\\\"highlight\\\"><pre><code><span class=\\\"w\\\">\\n</span><span class=\\\"p\\\">{</span><span class=\\\"w\\\">\\n  </span><span class=\\\"nl\\\">\\\"date\\\"</span><span class=\\\"p\\\">:</span><span class=\\\"w\\\"> </span><span class=\\\"s2\\\">\\\"2017/03/15 18:37\\\"</span><span class=\\\"p\\\">,</span><span class=\\\"w\\\">\\n  </span><span class=\\\"nl\\\">\\\"id\\\"</span><span class=\\\"p\\\">:</span><span class=\\\"w\\\"> </span><span class=\\\"mi\\\">0</span><span class=\\\"p\\\">,</span><span class=\\\"w\\\">\\n  </span><span class=\\\"nl\\\">\\\"result\\\"</span><span class=\\\"p\\\">:</span><span class=\\\"w\\\"> </span><span class=\\\"p\\\">{</span><span class=\\\"w\\\">\\n    </span><span class=\\\"nl\\\">\\\"Amazon\\\"</span><span class=\\\"p\\\">:</span><span class=\\\"w\\\"> </span><span class=\\\"s2\\\">\\\"Find!\\\"</span><span class=\\\"p\\\">,</span><span class=\\\"w\\\"> </span><span class=\\\"err\\\">#</span><span class=\\\"w\\\"> </span><span class=\\\"err\\\">\u306A\u305C\u304BFind\u3068\u306A\u3063\u3066\u30A8\u30E9\u30FC\u8D77\u304D\u305A</span><span class=\\\"w\\\"> \\n    </span><span class=\\\"nl\\\">\\\"Google\\\"</span><span class=\\\"p\\\">:</span><span class=\\\"w\\\"> </span><span class=\\\"s2\\\">\\\"Find!\\\"</span><span class=\\\"p\\\">,</span><span class=\\\"w\\\">\\n    </span><span class=\\\"nl\\\">\\\"Google-2\\\"</span><span class=\\\"p\\\">:</span><span class=\\\"w\\\"> </span><span class=\\\"s2\\\">\\\"Not Find!\\\"</span><span class=\\\"p\\\">,</span><span class=\\\"w\\\">\\n    </span><span class=\\\"nl\\\">\\\"Qiita\\\"</span><span class=\\\"p\\\">:</span><span class=\\\"w\\\"> </span><span class=\\\"s2\\\">\\\"Find!\\\"</span><span class=\\\"w\\\">\\n  </span><span class=\\\"p\\\">}</span><span class=\\\"w\\\">\\n</span><span class=\\\"p\\\">}</span><span class=\\\"w\\\">\\n\\n</span><span class=\\\"p\\\">{</span><span class=\\\"w\\\">\\n  </span><span class=\\\"nl\\\">\\\"date\\\"</span><span class=\\\"p\\\">:</span><span class=\\\"w\\\"> </span><span class=\\\"s2\\\">\\\"2017/03/15 18:48\\\"</span><span class=\\\"p\\\">,</span><span class=\\\"w\\\">\\n  </span><span class=\\\"nl\\\">\\\"id\\\"</span><span class=\\\"p\\\">:</span><span class=\\\"w\\\"> </span><span class=\\\"mi\\\">0</span><span class=\\\"p\\\">,</span><span class=\\\"w\\\">\\n  </span><span class=\\\"nl\\\">\\\"result\\\"</span><span class=\\\"p\\\">:</span><span class=\\\"w\\\"> </span><span class=\\\"p\\\">{</span><span class=\\\"w\\\">\\n    </span><span class=\\\"nl\\\">\\\"Amazon\\\"</span><span class=\\\"p\\\">:</span><span class=\\\"w\\\"> </span><span class=\\\"s2\\\">\\\"HTTP Error 503: Service Unavailable\\\"</span><span class=\\\"p\\\">,</span><span class=\\\"w\\\"> </span><span class=\\\"err\\\">#</span><span class=\\\"w\\\"> </span><span class=\\\"err\\\">\u3053\u3061\u3089\u3067\u30A8\u30E9\u30FC\u8D77\u304D\u305F\u3068\u304D\u306Bstr(e)\u306B\u3057\u307E\u3057\u305F</span><span class=\\\"w\\\">\\n    </span><span class=\\\"nl\\\">\\\"Google\\\"</span><span class=\\\"p\\\">:</span><span class=\\\"w\\\"> </span><span class=\\\"s2\\\">\\\"Find!\\\"</span><span class=\\\"p\\\">,</span><span class=\\\"w\\\">\\n    </span><span class=\\\"nl\\\">\\\"Google-2\\\"</span><span class=\\\"p\\\">:</span><span class=\\\"w\\\"> </span><span class=\\\"s2\\\">\\\"Not Find!\\\"</span><span class=\\\"p\\\">,</span><span class=\\\"w\\\">\\n    </span><span class=\\\"nl\\\">\\\"Qiita\\\"</span><span class=\\\"p\\\">:</span><span class=\\\"w\\\"> </span><span class=\\\"s2\\\">\\\"Find!\\\"</span><span class=\\\"w\\\">\\n  </span><span class=\\\"p\\\">}</span><span class=\\\"w\\\">\\n</span><span class=\\\"p\\\">}</span><span class=\\\"w\\\">\\n</span></code></pre></div></div>\\n\\n<p><code>str(e)</code>\u3063\u3066\u3057\u306A\u3044\u3068e\u304Cstr\u578B\u3058\u3083\u306A\u3044\u306E\u3067\u30A8\u30E9\u30FC\u304C\u8D77\u304D\u307E\u3057\u305F\u3002<br>\\nPython\u306B\u6163\u308C\u3066\u304D\u305F\u306E\u306710\u5206\u304F\u3089\u3044\u3067\u89E3\u6C7A\u3002<br>\\njson\u3063\u3066\u30B3\u30E1\u30F3\u30C8\u3064\u3051\u3089\u308C\u306A\u3044\u3093\u3067\u3059\u306D\u3002</p>\\n\\n<div class=\\\"code-frame\\\" data-lang=\\\"python\\\"><div class=\\\"highlight\\\"><pre><code><span class=\\\"k\\\">def</span> <span class=\\\"nf\\\">get_recent_codes</span><span class=\\\"p\\\">():</span>\\n    <span class=\\\"n\\\">date</span> <span class=\\\"o\\\">=</span> <span class=\\\"n\\\">datetime</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">now</span><span class=\\\"p\\\">()</span> <span class=\\\"o\\\">+</span> <span class=\\\"n\\\">timedelta</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">hours</span><span class=\\\"o\\\">=</span><span class=\\\"mi\\\">9</span><span class=\\\"p\\\">)</span>\\n    <span class=\\\"n\\\">now</span> <span class=\\\"o\\\">=</span> <span class=\\\"n\\\">date</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">strftime</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">\\\"%Y/%m/%d %H:%M\\\"</span><span class=\\\"p\\\">)</span>\\n    <span class=\\\"n\\\">last</span> <span class=\\\"o\\\">=</span> <span class=\\\"p\\\">(</span><span class=\\\"n\\\">date</span> <span class=\\\"o\\\">+</span> <span class=\\\"n\\\">timedelta</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">minutes</span><span class=\\\"o\\\">=-</span><span class=\\\"mi\\\">9</span><span class=\\\"p\\\">)).</span><span class=\\\"n\\\">strftime</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">\\\"%Y/%m/%d %H:%M\\\"</span><span class=\\\"p\\\">)</span>\\n\\n    <span class=\\\"c1\\\"># id\u304C0\u304B\u3064\u3001\uFF11\uFF10\u5206\u4EE5\u5185\u306E\u30C7\u30FC\u30BF\u3092\u53D6\u3063\u3066\u304F\u308B\u611F\u3058\u306E\u30AF\u30A8\u30EA\\n</span>    <span class=\\\"n\\\">response</span> <span class=\\\"o\\\">=</span> <span class=\\\"n\\\">table</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">query</span><span class=\\\"p\\\">(</span>\\n        <span class=\\\"n\\\">KeyConditionExpression</span><span class=\\\"o\\\">=</span><span class=\\\"n\\\">Key</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">'id'</span><span class=\\\"p\\\">).</span><span class=\\\"n\\\">eq</span><span class=\\\"p\\\">(</span><span class=\\\"mi\\\">0</span><span class=\\\"p\\\">)</span> <span class=\\\"o\\\">&amp;</span> <span class=\\\"n\\\">Key</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">'date'</span><span class=\\\"p\\\">).</span><span class=\\\"n\\\">between</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">last</span><span class=\\\"p\\\">,</span> <span class=\\\"n\\\">now</span><span class=\\\"p\\\">)</span>\\n    <span class=\\\"p\\\">)</span>\\n\\n    <span class=\\\"k\\\">return</span> <span class=\\\"n\\\">response</span>\\n</code></pre></div></div>\\n\\n<p><code>response['Count']</code>\u306B\u53D6\u3063\u3066\u3053\u308C\u305F\u30AF\u30A8\u30EA\u306E\u6570\u304C\u5165\u308A\u307E\u3059\u3002<br>\\n<code>response['Items']</code>\u306B\u53D6\u3063\u3066\u3053\u308C\u305FTable\u306E\u30C7\u30FC\u30BF\u304C\u306F\u3044\u3063\u3066\u307E\u3059\u3002<br>\\n\u305D\u308C\u4EE5\u5916\u306E\u30C7\u30FC\u30BF\u5FC5\u8981\u306A\u5834\u5408\u306F\u9069\u5B9C\u3001Print\u3057\u3064\u3064\u30C7\u30FC\u30BF\u306E\u53D6\u308A\u51FA\u3057\u3092\u3057\u3066\u304F\u3060\u3055\u3044\u3002</p>\\n\\n<p>\u7D50\u679C\u3053\u3093\u306A\u611F\u3058</p>\\n\\n<div class=\\\"code-frame\\\" data-lang=\\\"python\\\"><div class=\\\"highlight\\\"><pre><code><span class=\\\"c1\\\"># coding: utf-8\\n</span><span class=\\\"kn\\\">from</span> <span class=\\\"nn\\\">__future__</span> <span class=\\\"kn\\\">import</span> <span class=\\\"n\\\">print_function</span>\\n\\n<span class=\\\"kn\\\">import</span> <span class=\\\"nn\\\">os</span>\\n<span class=\\\"kn\\\">import</span> <span class=\\\"nn\\\">json</span>\\n<span class=\\\"kn\\\">import</span> <span class=\\\"nn\\\">requests</span>\\n<span class=\\\"kn\\\">from</span> <span class=\\\"nn\\\">datetime</span> <span class=\\\"kn\\\">import</span> <span class=\\\"n\\\">datetime</span><span class=\\\"p\\\">,</span> <span class=\\\"n\\\">timedelta</span>\\n<span class=\\\"kn\\\">from</span> <span class=\\\"nn\\\">urllib2</span> <span class=\\\"kn\\\">import</span> <span class=\\\"n\\\">urlopen</span>\\n<span class=\\\"kn\\\">import</span> <span class=\\\"nn\\\">boto3</span>\\n<span class=\\\"kn\\\">from</span> <span class=\\\"nn\\\">boto3.dynamodb.conditions</span> <span class=\\\"kn\\\">import</span> <span class=\\\"n\\\">Key</span><span class=\\\"p\\\">,</span> <span class=\\\"n\\\">Attr</span>\\n\\n<span class=\\\"n\\\">dynamodb</span> <span class=\\\"o\\\">=</span> <span class=\\\"n\\\">boto3</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">resource</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">'dynamodb'</span><span class=\\\"p\\\">)</span>\\n\\n<span class=\\\"k\\\">def</span> <span class=\\\"nf\\\">validate</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">res</span><span class=\\\"p\\\">,</span> <span class=\\\"n\\\">target</span><span class=\\\"p\\\">):</span>\\n    <span class=\\\"k\\\">return</span> <span class=\\\"n\\\">target</span> <span class=\\\"ow\\\">in</span> <span class=\\\"n\\\">res</span>\\n\\n<span class=\\\"k\\\">def</span> <span class=\\\"nf\\\">web_check</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">url</span><span class=\\\"p\\\">,</span> <span class=\\\"n\\\">target</span><span class=\\\"p\\\">):</span>\\n    <span class=\\\"k\\\">print</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">\\\"Serching ... \\\"</span> <span class=\\\"o\\\">+</span> <span class=\\\"n\\\">target</span> <span class=\\\"o\\\">+</span> <span class=\\\"s\\\">\\\" at \\\"</span> <span class=\\\"o\\\">+</span> <span class=\\\"n\\\">url</span><span class=\\\"p\\\">)</span>\\n    <span class=\\\"k\\\">try</span><span class=\\\"p\\\">:</span>\\n        <span class=\\\"k\\\">if</span> <span class=\\\"n\\\">validate</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">urlopen</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">url</span><span class=\\\"p\\\">).</span><span class=\\\"n\\\">read</span><span class=\\\"p\\\">(),</span> <span class=\\\"n\\\">target</span><span class=\\\"p\\\">):</span>\\n            <span class=\\\"k\\\">return</span> <span class=\\\"s\\\">\\\"Find!\\\"</span>\\n        <span class=\\\"k\\\">else</span><span class=\\\"p\\\">:</span>\\n            <span class=\\\"k\\\">return</span> <span class=\\\"s\\\">\\\"Not Find!\\\"</span>\\n    <span class=\\\"k\\\">except</span> <span class=\\\"nb\\\">Exception</span> <span class=\\\"k\\\">as</span> <span class=\\\"n\\\">e</span><span class=\\\"p\\\">:</span>\\n        <span class=\\\"k\\\">return</span> <span class=\\\"nb\\\">str</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">e</span><span class=\\\"p\\\">)</span>\\n\\n<span class=\\\"k\\\">def</span> <span class=\\\"nf\\\">get_urls</span><span class=\\\"p\\\">():</span>\\n    <span class=\\\"n\\\">table</span>    <span class=\\\"o\\\">=</span> <span class=\\\"n\\\">dynamodb</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">Table</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">'sites'</span><span class=\\\"p\\\">)</span>\\n    <span class=\\\"n\\\">response</span> <span class=\\\"o\\\">=</span> <span class=\\\"n\\\">table</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">scan</span><span class=\\\"p\\\">()</span>\\n    <span class=\\\"n\\\">sites</span> <span class=\\\"o\\\">=</span> <span class=\\\"n\\\">response</span><span class=\\\"p\\\">[</span><span class=\\\"s\\\">\\\"Items\\\"</span><span class=\\\"p\\\">]</span>\\n    <span class=\\\"k\\\">return</span> <span class=\\\"n\\\">sites</span>\\n\\n<span class=\\\"k\\\">def</span> <span class=\\\"nf\\\">send_slack</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">text</span><span class=\\\"p\\\">):</span>\\n    <span class=\\\"n\\\">url</span> <span class=\\\"o\\\">=</span> <span class=\\\"s\\\">\\\"https://hooks.slack.com/\\\"</span>\\n    <span class=\\\"n\\\">payload_dic</span> <span class=\\\"o\\\">=</span> <span class=\\\"p\\\">{</span>\\n        <span class=\\\"s\\\">\\\"text\\\"</span><span class=\\\"p\\\">:</span><span class=\\\"n\\\">text</span><span class=\\\"p\\\">,</span>\\n        <span class=\\\"s\\\">\\\"icon_emoji\\\"</span><span class=\\\"p\\\">:</span><span class=\\\"s\\\">':grin:'</span><span class=\\\"p\\\">,</span>\\n        <span class=\\\"s\\\">\\\"channel\\\"</span><span class=\\\"p\\\">:</span><span class=\\\"s\\\">'bot-test2'</span><span class=\\\"p\\\">,</span>\\n    <span class=\\\"p\\\">}</span>\\n    <span class=\\\"n\\\">r</span> <span class=\\\"o\\\">=</span> <span class=\\\"n\\\">requests</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">post</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">url</span><span class=\\\"p\\\">,</span> <span class=\\\"n\\\">data</span><span class=\\\"o\\\">=</span><span class=\\\"n\\\">json</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">dumps</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">payload_dic</span><span class=\\\"p\\\">))</span>\\n\\n<span class=\\\"k\\\">def</span> <span class=\\\"nf\\\">insert</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">results</span><span class=\\\"p\\\">):</span>\\n    <span class=\\\"n\\\">table</span> <span class=\\\"o\\\">=</span> <span class=\\\"n\\\">dynamodb</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">Table</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">'sites_check'</span><span class=\\\"p\\\">)</span>\\n    <span class=\\\"n\\\">date</span> <span class=\\\"o\\\">=</span> <span class=\\\"n\\\">datetime</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">now</span><span class=\\\"p\\\">()</span> <span class=\\\"o\\\">+</span> <span class=\\\"n\\\">timedelta</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">hours</span><span class=\\\"o\\\">=</span><span class=\\\"mi\\\">9</span><span class=\\\"p\\\">)</span>\\n    <span class=\\\"nb\\\">id</span> <span class=\\\"o\\\">=</span> <span class=\\\"mi\\\">0</span>\\n    <span class=\\\"n\\\">table</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">put_item</span><span class=\\\"p\\\">(</span>\\n        <span class=\\\"n\\\">Item</span><span class=\\\"o\\\">=</span><span class=\\\"p\\\">{</span>\\n            <span class=\\\"s\\\">\\\"id\\\"</span><span class=\\\"p\\\">:</span> <span class=\\\"nb\\\">id</span><span class=\\\"p\\\">,</span>\\n            <span class=\\\"s\\\">\\\"date\\\"</span><span class=\\\"p\\\">:</span> <span class=\\\"n\\\">date</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">strftime</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">\\\"%Y/%m/%d %H:%M\\\"</span><span class=\\\"p\\\">),</span>\\n            <span class=\\\"s\\\">\\\"result\\\"</span><span class=\\\"p\\\">:</span> <span class=\\\"n\\\">results</span>\\n       <span class=\\\"p\\\">}</span>\\n    <span class=\\\"p\\\">)</span>\\n\\n<span class=\\\"k\\\">def</span> <span class=\\\"nf\\\">get_recent_codes</span><span class=\\\"p\\\">():</span>\\n    <span class=\\\"n\\\">table</span> <span class=\\\"o\\\">=</span> <span class=\\\"n\\\">dynamodb</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">Table</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">'sites_check'</span><span class=\\\"p\\\">)</span>\\n\\n    <span class=\\\"n\\\">date</span> <span class=\\\"o\\\">=</span> <span class=\\\"n\\\">datetime</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">now</span><span class=\\\"p\\\">()</span> <span class=\\\"o\\\">+</span> <span class=\\\"n\\\">timedelta</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">hours</span><span class=\\\"o\\\">=</span><span class=\\\"mi\\\">9</span><span class=\\\"p\\\">)</span>\\n    <span class=\\\"n\\\">now</span> <span class=\\\"o\\\">=</span> <span class=\\\"n\\\">date</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">strftime</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">\\\"%Y/%m/%d %H:%M\\\"</span><span class=\\\"p\\\">)</span>\\n    <span class=\\\"n\\\">last</span> <span class=\\\"o\\\">=</span> <span class=\\\"p\\\">(</span><span class=\\\"n\\\">date</span> <span class=\\\"o\\\">+</span> <span class=\\\"n\\\">timedelta</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">minutes</span><span class=\\\"o\\\">=-</span><span class=\\\"mi\\\">9</span><span class=\\\"p\\\">)).</span><span class=\\\"n\\\">strftime</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">\\\"%Y/%m/%d %H:%M\\\"</span><span class=\\\"p\\\">)</span>\\n    <span class=\\\"k\\\">print</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">last</span> <span class=\\\"o\\\">+</span> <span class=\\\"s\\\">\\\" \u304B\u3089 \\\"</span> <span class=\\\"o\\\">+</span> <span class=\\\"n\\\">now</span> <span class=\\\"o\\\">+</span> <span class=\\\"s\\\">\\\" \u307E\u3067\u306E\u30C1\u30A7\u30C3\u30AF\\\"</span><span class=\\\"p\\\">)</span>\\n\\n    <span class=\\\"n\\\">response</span> <span class=\\\"o\\\">=</span> <span class=\\\"n\\\">table</span><span class=\\\"p\\\">.</span><span class=\\\"n\\\">query</span><span class=\\\"p\\\">(</span>\\n        <span class=\\\"n\\\">KeyConditionExpression</span><span class=\\\"o\\\">=</span><span class=\\\"n\\\">Key</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">'id'</span><span class=\\\"p\\\">).</span><span class=\\\"n\\\">eq</span><span class=\\\"p\\\">(</span><span class=\\\"mi\\\">0</span><span class=\\\"p\\\">)</span> <span class=\\\"o\\\">&amp;</span> <span class=\\\"n\\\">Key</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">'date'</span><span class=\\\"p\\\">).</span><span class=\\\"n\\\">between</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">last</span><span class=\\\"p\\\">,</span> <span class=\\\"n\\\">now</span><span class=\\\"p\\\">)</span>\\n    <span class=\\\"p\\\">)</span>\\n\\n    <span class=\\\"k\\\">return</span> <span class=\\\"n\\\">response</span>\\n\\n<span class=\\\"k\\\">def</span> <span class=\\\"nf\\\">lambda_handler</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">event</span><span class=\\\"p\\\">,</span> <span class=\\\"n\\\">context</span><span class=\\\"p\\\">):</span>\\n    <span class=\\\"k\\\">print</span><span class=\\\"p\\\">(</span><span class=\\\"s\\\">'Check start'</span><span class=\\\"p\\\">)</span>\\n\\n    <span class=\\\"n\\\">results</span> <span class=\\\"o\\\">=</span> <span class=\\\"p\\\">{}</span>\\n    <span class=\\\"n\\\">sites</span> <span class=\\\"o\\\">=</span> <span class=\\\"n\\\">get_urls</span><span class=\\\"p\\\">()</span>\\n    <span class=\\\"k\\\">for</span> <span class=\\\"n\\\">site</span> <span class=\\\"ow\\\">in</span> <span class=\\\"n\\\">sites</span><span class=\\\"p\\\">:</span>\\n        <span class=\\\"n\\\">msg</span> <span class=\\\"o\\\">=</span> <span class=\\\"n\\\">web_check</span><span class=\\\"p\\\">(</span><span class=\\\"nb\\\">str</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">site</span><span class=\\\"p\\\">[</span><span class=\\\"s\\\">\\\"url\\\"</span><span class=\\\"p\\\">]),</span> <span class=\\\"nb\\\">str</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">site</span><span class=\\\"p\\\">[</span><span class=\\\"s\\\">\\\"target\\\"</span><span class=\\\"p\\\">]))</span>\\n        <span class=\\\"n\\\">results</span><span class=\\\"p\\\">[</span><span class=\\\"nb\\\">str</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">site</span><span class=\\\"p\\\">[</span><span class=\\\"s\\\">\\\"title\\\"</span><span class=\\\"p\\\">])]</span> <span class=\\\"o\\\">=</span> <span class=\\\"n\\\">msg</span>\\n\\n    <span class=\\\"n\\\">insert</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">results</span><span class=\\\"p\\\">)</span>\\n    <span class=\\\"k\\\">print</span><span class=\\\"p\\\">(</span><span class=\\\"n\\\">get_recent_codes</span><span class=\\\"p\\\">())</span>\\n    <span class=\\\"k\\\">return</span> <span class=\\\"s\\\">\\\"success!\\\"</span>\\n\\n\\n\\n</code></pre></div></div>\\n\\n<p>\u5B9A\u671F\u5B9F\u884C\u3055\u305B\u305F\u308A\u3044\u308D\u3044\u308D\u3067\u304D\u308B\u3068\u601D\u308F\u308C\u307E\u3059\u3002</p>\\n\\n<h1>\\n<span id=\\\"\u3055\u3044\u3054\u306B\\\" class=\\\"fragment\\\"></span><a href=\\\"#%E3%81%95%E3%81%84%E3%81%94%E3%81%AB\\\"><i class=\\\"fa fa-link\\\"></i></a>\u3055\u3044\u3054\u306B</h1>\\n\\n<p>Python\u3068Lambda\u306E\u7D20\u4EBA\u306A\u306E\u3067\u304B\u306A\u308A\u30A8\u30E9\u30FC\u3060\u3057\u307E\u3057\u305F\u3002\u304C\u3001Python\u3068Lambda\u306B\u3088\u308B\u30A2\u30FC\u30AD\u30C6\u30AF\u30C8\u306F\u304B\u306A\u308A\u4FBF\u5229\u306B\u306A\u308B\u3068\u601D\u3046\u306E\u3067\u3053\u308C\u304B\u3089\u3082\u4F7F\u3063\u3066\u3044\u304D\u305F\u3044\u3068\u601D\u3063\u3066\u3044\u307E\u3059\u3002</p>\\n\",\"body\":\"# \u306F\u3058\u3081\u306B\\n\\n\u3000\u6700\u8FD1\u30B5\u30FC\u30D0\u30EC\u30B9\u30A2\u30FC\u30AD\u30C6\u30AF\u30C1\u30E3\u306B\u8208\u5473\u3092\u6301\u3063\u3066\u3044\u307E\u3059\u3002\u4EE5\u4E0B2\u30A8\u30F3\u30C8\u30EA\u30FC\u306FGoogle Apps Script\u3067Java Script\u3092\u4F7F\u3063\u305F\u6642\u306E\u8A18\u4E8B\u3067\u3059\u304C\u3001\u4ECA\u56DE\u306FAWS\u4E0A\u306ELambda\u3092\u4F7F\u3063\u3066\u3001\u30B5\u30FC\u30D0\u30FC\u30EC\u30B9\u3067Python\u30B3\u30FC\u30C9\u3092\u5B9F\u884C\u3055\u305B\u308B\u3053\u3068\u3092\u3084\u3063\u3066\u3044\u304D\u305F\u3044\u3068\u601D\u3044\u307E\u3059\u3002\u8A18\u4E8B\u306E\u5185\u5BB9\u306F\u3001Python\u307B\u307C\u521D\u3081\u307E\u3057\u3066&&AWS\u307B\u307C\u521D\u3081\u307E\u3057\u3066\u306E\u4EBA\u304C\u3001Lambda\u3068DynamoDB\u3067\u3044\u308D\u3044\u308D\u3067\u304D\u308B\u3088\u3046\u306B\u306A\u308B\u307E\u3067\u306E\u8A18\u9332\u3092\u66F8\u3044\u3066\u3044\u304D\u307E\u3059\u3002\\n\u3000\u307E\u305F\u6700\u521DAWS\u5206\u304B\u3093\u306A\u3055\u3059\u304E\u3066\u6700\u521D\u306F\u7D76\u671B\u3057\u3066\u3044\u305F\u3057\u3001Lambda\u306F\u30A8\u30E9\u30FC\u51FA\u307E\u304F\u3063\u3066\u521D\u898B\u6BBA\u3057\u3060\u3057\u3001Python\u8208\u5473\u306F\u3042\u308B\u3051\u3069\u4F7F\u3063\u305F\u3053\u3068\u5C11\u306A\u3081\u3068\u3001\u304B\u306A\u308A\u521D\u5FC3\u8005\u76EE\u7DDA\u3067\u8A18\u4E8B\u3092\u66F8\u3044\u3066\u3044\u304D\u305F\u3044\u3068\u601D\u3063\u3066\u307E\u3059\u3002\u5199\u771F\u591A\u3081\u3001\u521D\u5FC3\u8005\u304C\u308F\u304B\u308B\u7A0B\u5EA6\u306E\u5185\u5BB9\u3092\u3001\u3072\u3068\u3064\u305A\u3064\u66F8\u3044\u3066\u3044\u304F\u611F\u3058\u3067\u3059\u306E\u3067\u3001Pythonist\u3068AWS\u4E0A\u7D1A\u8005\u306E\u65B9\u306F\u65B0\u3057\u3044\u3053\u3068\u306F\u306A\u3044\u304B\u3068\u601D\u3044\u307E\u3059\u304C\u3001\u3069\u3046\u305E\u3088\u308D\u3057\u304F\u304A\u9858\u3044\u3057\u307E\u3059\u3002\\n\\n\u3053\u306E\u524D\u66F8\u3044\u305F\u8A18\u4E8B\\n- [\u6708\u672B\u55B6\u696D\u65E5\u306B\u30BF\u30B9\u30AF\u3092\u30EA\u30DE\u30A4\u30F3\u30C9\u3059\u308B](http://qiita.com/ykhirao/items/782e20ab0465533c48f6)\\n- [Google\u30AB\u30EC\u30F3\u30C0\u30FC \u81EA\u793E\u7248](http://qiita.com/ykhirao/items/09ebaedd0f6f0438f422)\\n\\n\\n## \u524D\u63D0\\nAWS\u521D\u3081\u307E\u3057\u3066\\nPython\u6B742\u9031\u9593\u304F\u3089\u3044\\nAWS\u30B5\u30FC\u30D3\u30B9\u767B\u9332\u6E08\u3001\u7121\u6599\u67A0\u4E2D\\n\\n# AWS\\n\u81EA\u5206\u306E\u5834\u5408\u306F\u3001AWS\u306E\u30B5\u30FC\u30D3\u30B9\u306E\u591A\u3055\u306B\u6DF7\u4E71\u3057\u305F\u306E\u3067\u3001\u3069\u306E\u30B5\u30FC\u30D3\u30B9\u304C\u3069\u306E\u30B5\u30FC\u30D3\u30B9\u3068\u3064\u306A\u304C\u3063\u3066\u308B\u306E\u304B\u3001\u307E\u305A\u6982\u8981\u3092\u52C9\u5F37\u3057\u307E\u3057\u305F\u3002\u4E0B\u8A18\u3042\u305F\u308A\u304C\u53C2\u8003\u306B\u306A\u308B\u304B\u3068\u601D\u3044\u307E\u3059\u3002\u307E\u305FKindle\u3067\u7121\u6599\u306E\u66F8\u7C4D\u3068\u304B\u63A2\u3057\u307E\u3057\u305F\u3002\u300C\u3063\u3066\u307E\u3059\u304C\u3001\u81EA\u5206\u3067\u4F7F\u3044\u306A\u304C\u3089\u3001\u3053\u306E\u8A18\u4E8B\u3092\u898B\u76F4\u3057\u306A\u304C\u3089\u3044\u308D\u3044\u308D\u3084\u3063\u3066\u307F\u307E\u3057\u305F\u3002\\n\\n[\u300CAWS is \u4F55\u300D\u30923\u884C\u3067\u307E\u3068\u3081\u3066\u307F\u308B\u3088](http://qiita.com/kohashi/items/1bb952313fb695f12577)\\n[AWS1\u5E74\u76EE\u7121\u6599\u671F\u9593\u3067\u3084\u3063\u305F\u3053\u3068\u3068\u30CF\u30DE\u3063\u305F\u3053\u3068](http://qiita.com/chroju/items/c7ad918d79b0288bc490)\\n\\n## \u767B\u9332\\n\u767B\u9332\u6E08\u307F\u3068\u4EEE\u5B9A\u3057\u3066\u3044\u308B\u306E\u3067AWS\u767B\u9332\u306F\u5225\u306E\u8A18\u4E8B\u3092\u53C2\u7167\u304F\u3060\u3055\u3044\u3002\\n\\n## \u30ED\u30FC\u30EB\u4F5C\u6210\\n\\nAWS\u30ED\u30FC\u30EB\u304C\u306A\u3044\u3068\u3044\u308D\u3044\u308D\u9762\u5012\u306A\u306E\u3067\u3001\\nS3,DynamoDB,Lambda\u306B\u30D5\u30EB\u30A2\u30AF\u30BB\u30B9\u3067\u304D\u308B\u30ED\u30FC\u30EB\u3092\u4ECA\u56DE\u4F5C\u308A\u307E\u3059\u3002\\n\\n[AWS\u30B5\u30FC\u30D3\u30B9\u4E00\u89A7](https://us-west-2.console.aws.amazon.com/console/home)\u304B\u3089IAM\\n\\n![\u30B9\u30AF\u30EA\u30FC\u30F3\u30B7\u30E7\u30C3\u30C8 2017-03-15 14.22.30.png](https://qiita-image-store.s3.amazonaws.com/0/112929/5b6a3f19-12f3-c469-91f6-39e0cdb1167f.png)\\n\\n\u30ED\u30FC\u30EB >> \u65B0\u3057\u3044\u30ED\u30FC\u30EB\u306E\u4F5C\u6210\\n\\n![\u30B9\u30AF\u30EA\u30FC\u30F3\u30B7\u30E7\u30C3\u30C8 2017-03-15 14.22.43.png](https://qiita-image-store.s3.amazonaws.com/0/112929/98094a3d-11f7-0ec9-4cbf-8719f256886d.png)\\n\\n\u30ED\u30FC\u30EB\u306E\u540D\u524D\\n\u4ECA\u56DE\u306F[lambda_dynamo]\\n\\n![\u30B9\u30AF\u30EA\u30FC\u30F3\u30B7\u30E7\u30C3\u30C8 2017-03-15 14.22.48.png](https://qiita-image-store.s3.amazonaws.com/0/112929/99c1a7ba-3fc1-d2f4-4cb0-f20e265e09ed.png)\\n\\nAmazon Lambda >> \u9078\u629E\\n\\n![\u30B9\u30AF\u30EA\u30FC\u30F3\u30B7\u30E7\u30C3\u30C8 2017-03-15 14.27.00.png](https://qiita-image-store.s3.amazonaws.com/0/112929/a0aec2ac-7ae1-8109-e09f-dc6cae6a1f19.png)\\n\\n\u3068\u308A\u3042\u3048\u305A\u4ECA\u56DE\u306FFullAccess\u30923\u3064\u4ED8\u3051\u307E\u3059\u3002\\nAWSLambdaFullAccess\\nAmazonS3FullAccess\\nAmazonDynamoDBFullAccess\\n\\n\u6B21\u306E\u30B9\u30C6\u30C3\u30D7\\n\\n![\u30B9\u30AF\u30EA\u30FC\u30F3\u30B7\u30E7\u30C3\u30C8 2017-03-15 14.27.27.png](https://qiita-image-store.s3.amazonaws.com/0/112929/c461abce-c9d8-42e0-60f4-0b96cb921052.png)\\n\\n\\n\u30ED\u30FC\u30EB >> lambda_dynamo\\n\u3068\u3044\u3044\u3046\u9805\u76EE\u304C\u8FFD\u52A0\u3055\u308C\u3066\u305F\u3089Okay\u3002\\n\\n![\u30B9\u30AF\u30EA\u30FC\u30F3\u30B7\u30E7\u30C3\u30C8 2017-03-15 14.33.21.png](https://qiita-image-store.s3.amazonaws.com/0/112929/1bf14b83-c4cb-4faa-4e18-58710dcfad6d.png)\\n\\n\\n\\n# Lambda\\n\\n\u30B5\u30FC\u30D0\u30FC\u30EC\u30B9\u3067\u30B9\u30AF\u30EA\u30D7\u30C8\u5B9F\u884C\u3067\u304D\u308B\u30B5\u30FC\u30D3\u30B9\u3067\u3059\u3002\u4FBF\u5229\u3002\\n\\n## \u6599\u91D1\u4F53\u7CFB\\n\u57FA\u672C\u7684\u306B\u3044\u304F\u3089\u30C6\u30B9\u30C8\u306B\u4F7F\u3063\u3066\u3082\u5927\u4E08\u592B\uFF01[\u516C\u5F0F](https://aws.amazon.com/jp/lambda/pricing/)\\n\\n\u30E9\u30E0\u30C0\u7121\u6599\u67A0\\n\\n|1\u30F6\u6708| \u30EA\u30AF\u30A8\u30B9\u30C8 | \u30B3\u30F3\u30D4\u30E5\u30FC\u30C6\u30A3\u30F3\u30B0\u6642\u9593 [GB*\u79D2] |\\n|:-:|:-:|:-:|\\n|| 1,000,000  | 400,000  |\\n\\n\u30EA\u30AF\u30A8\u30B9\u30C8:\u95A2\u6570\u5168\u4F53\u306B\u5BFE\u3059\u308B\u5408\u8A08\u30EA\u30AF\u30A8\u30B9\u30C8\u6570\\n\u30B3\u30F3\u30D4\u30E5\u30FC\u30C6\u30A3\u30F3\u30B0\u6642\u9593: \u30E1\u30E2\u30EA\u6570\u3068\u6642\u9593\u3092\u304B\u3051\u305F\u3082\u306E\\n\\nLambda\u306E\u6700\u5C0F\u30E1\u30E2\u30EA\u304C128MB\u306A\u306E\u30671\u30F6\u67083,200,000\u79D2()\u4F7F\u3048\u3070\u3001400,000[GB*sec]\u306B\u5230\u9054\u3057\u307E\u3059\u3002\\n`(128.0[MB] / 1024[MB/GB]) * 3200000[sec] = 400,000[GB*sec]`\\n\u306A\u306E\u3067\u3001888\u6642\u9593\u304F\u3089\u3044\u30B9\u30AF\u30EA\u30D7\u30C8\u52D5\u3044\u3066\u3082\u5927\u4E08\u592B\u3002\u3069\u3093\u3069\u3093\u4F7F\u304A\u3046\u3002\\n(\u6642\u9593\u306E\u8A08\u7B97\u306F\u4E00\u5FDC\u81EA\u5206\u3067\u3084\u3063\u3066\u307F\u3066\u304F\u3060\u3055\u3044\u306D\uFF01)\\n\\n## \u30C6\u30B9\u30C8\u30B3\u30FC\u30C9\u3092\u4F7F\u3063\u3066\u307F\u308B(Python\u30A8\u30E9\u30FC)\\n[AWS\u30B5\u30FC\u30D3\u30B9\u4E00\u89A7](https://us-west-2.console.aws.amazon.com/console/home)\u304B\u3089Lambda\\n\\n### \u6700\u521D\u306E\u95A2\u6570\u4F5C\u6210\\n\\nLambda \u95A2\u6570\u306E\u4F5C\u6210 >> lambda-canary\\n\\n![\u30B9\u30AF\u30EA\u30FC\u30F3\u30B7\u30E7\u30C3\u30C8 2017-03-15 14.52.52.png](https://qiita-image-store.s3.amazonaws.com/0/112929/c4e855f6-81a2-3ed8-e099-1c6e34cd43de.png)\\n\\n[ \u30C8\u30EA\u30AC\u30FC\u306E\u8A2D\u5B9A ] >> \u524A\u9664 >> \u6B21\u3078\\n\u3053\u3053\u3067\u4F55\u5206\u3054\u3068\u306B\u4E00\u5EA6\u30B9\u30AF\u30EA\u30D7\u30C8\u3092\u5B9F\u884C\u3068\u304B\u3044\u3058\u308C\u307E\u3059\u3002\\n\u304C\u5F8C\u3067\u3082\u8A2D\u5B9A\u3067\u304D\u308B\u306E\u3067\u4ECA\u56DE\u306F\u524A\u9664\u3057\u307E\u3059\u3002\\n\\n[ \u95A2\u6570\u306E\u8A2D\u5B9A ]\\n\u540D\u524D\u3092\u3068\u308A\u3042\u3048\u305A[ sample ]\u306B\u3057\u307E\u3057\u305F\u3002\\n\\n![\u30B9\u30AF\u30EA\u30FC\u30F3\u30B7\u30E7\u30C3\u30C8 2017-03-15 14.57.34.png](https://qiita-image-store.s3.amazonaws.com/0/112929/0a38cb4e-2e71-6bdb-6230-aebaadf0d369.png)\\n\\n\u30ED\u30FC\u30EB\u3092\u5148\u7A0B\u3064\u304F\u3063\u305F\u30ED\u30FC\u30EB\u306B\u3057\u3066\u95A2\u6570\u4F5C\u6210\u3057\u307E\u3059\u3002\\nlambda_dynamo\\n\\n### \u6700\u521D\u306E\u30C6\u30B9\u30C8\\n\\n```python\\nfrom __future__ import print_function\\n\\nimport os\\nfrom datetime import datetime\\nfrom urllib2 import urlopen\\n\\nSITE = os.environ['site']  # URL of the site to check, stored in the site environment variable\\nEXPECTED = os.environ['expected']  # String expected to be on the page, stored in the expected environment variable\\n\\n\\ndef validate(res):\\n    return EXPECTED in res\\n\\n\\ndef lambda_handler(event, context):\\n    print('Checking {} at {}...'.format(SITE, event['time']))\\n    try:\\n        if not validate(urlopen(SITE).read()):\\n            raise Exception('Validation failed')\\n    except:\\n        print('Check failed!')\\n        raise\\n    else:\\n        print('Check passed!')\\n        return event['time']\\n    finally:\\n        print('Check complete at {}'.format(str(datetime.now())))\\n\\n```\\n\\n![\u30B9\u30AF\u30EA\u30FC\u30F3\u30B7\u30E7\u30C3\u30C8 2017-03-15 15.06.42.png](https://qiita-image-store.s3.amazonaws.com/0/112929/53c5c570-bd49-fb97-2888-ab34a6d74f22.png)\\n\\n\u306F\u3044\u51FA\u307E\u3057\u305F\u30A8\u30E9\u30FC\u3002\\n\\n```shell-session\\n    print('Checking {} at {}...'.format(SITE, event['time']))\\nKeyError: 'time'\\n```\\n\\n\u3053\u306E\u30A8\u30E9\u30FC\u3092\u89E3\u6C7A\u3059\u308B\u524D\u306B\u30C7\u30D5\u30A9\u30EB\u30C8\u3067\u4F7F\u7528\u3055\u308C\u308B\u5909\u6570\u3092\u898B\u3066\u3044\u304D\u307E\u3059\u3002\\n\\n### \u30C7\u30D5\u30A9\u30EB\u30C8\u3067\u4F7F\u7528\u3055\u308C\u308B\u5909\u6570\\n* event - test\u3067\u8A2D\u5B9A\u3057\u305F\u3068\u3053\u308D\u3068\u304B\u3001\u30C8\u30EA\u30AC\u30FC\u767A\u751F\u5143\u306E\u30A4\u30D9\u30F3\u30C8\u30C7\u30FC\u30BF\\n* Context - [Context \u30AA\u30D6\u30B8\u30A7\u30AF\u30C8 (Python)](https://docs.aws.amazon.com/ja_jp/lambda/latest/dg/python-context-object.html#python-context-object-methods)\\n* os.environ - \u30B3\u30FC\u30C9\u81EA\u4F53\u3092\u5909\u66F4\u305B\u305A\u306B\u3001AWS\u4E0A\u3067\u74B0\u5883\u5909\u6570\u3092\u8A2D\u5B9A\u3067\u304D\u308B\\n\\n>event >> AWS Lambda \u306F\u3053\u306E\u30D1\u30E9\u30E1\u30FC\u30BF\u30FC\u3092\u4F7F\u7528\u3057\u3066\u30A4\u30D9\u30F3\u30C8\u30C7\u30FC\u30BF\u3092\u30CF\u30F3\u30C9\u30E9\u30FC\u306B\u6E21\u3057\u307E\u3059\u3002\u3053\u306E\u30D1\u30E9\u30E1\u30FC\u30BF\u306F\u901A\u5E38\u3001Python \u306E dict \u30BF\u30A4\u30D7\u3067\u3059\u3002\u307E\u305F\u3001list\u3001str\u3001int\u3001float\u3001\u307E\u305F\u306F NoneType \u30BF\u30A4\u30D7\u3092\u4F7F\u7528\u3067\u304D\u307E\u3059\u3002\\n\\n>context >> AWS Lambda \u306F\u3053\u306E\u30D1\u30E9\u30E1\u30FC\u30BF\u30FC\u3092\u4F7F\u7528\u3057\u3066\u30E9\u30F3\u30BF\u30A4\u30E0\u60C5\u5831\u3092\u30CF\u30F3\u30C9\u30E9\u30FC\u306B\u63D0\u4F9B\u3057\u307E\u3059\u3002\u3053\u306E\u30D1\u30E9\u30E1\u30FC\u30BF\u306F LambdaContext \u30BF\u30A4\u30D7\u306B\u306A\u308A\u307E\u3059\u3002\\n\\n\u3068\u306A\u3063\u3066\u307E\u3059\u3002\\n\\n> os.environ\u3067\u53D6\u308C\u308B\u3068\u3053\u308D\u306F\u3053\u306E\u74B0\u5883\u5909\u6570\\n\\n![\u30B9\u30AF\u30EA\u30FC\u30F3\u30B7\u30E7\u30C3\u30C8 2017-03-15 15.15.28.png](https://qiita-image-store.s3.amazonaws.com/0/112929/a30bd4d7-887b-a339-15e5-374f80dc8878.png)\\n\\n### time ?\\n\\n\u3055\u3066\u5148\u7A0B\u306E\u30A8\u30E9\u30FC\u3092\u51E6\u7406\u3057\u3066\u3044\u304D\u307E\u3059\u3002\\n\\n![\u30B9\u30AF\u30EA\u30FC\u30F3\u30B7\u30E7\u30C3\u30C8 2017-03-15 15.11.53.png](https://qiita-image-store.s3.amazonaws.com/0/112929/df488706-d31a-3a21-082e-9f79479b10d3.png)\\n\\n\u30C6\u30B9\u30C8\u30A4\u30D9\u30F3\u30C8\u306E\u8A2D\u5B9A\u306Etime\u3092\u8FFD\u52A0\u3057\u307E\u3059\u3002\\n\\n```json\\n{\\n  \\\"key3\\\": \\\"value3\\\",\\n  \\\"key2\\\": \\\"value2\\\",\\n  \\\"key1\\\": \\\"value1\\\",\\n  \\\"time\\\": \\\"now...!\\\"\\n}\\n```\\n\\n\u3053\u308C\u3067Time\u306E\u90E8\u5206\u3067\u30A8\u30E9\u30FC\u306F\u3067\u306A\u3044\u3068\u601D\u3044\u307E\u3059\u3002\\n\\n```shell-session\\nSTART RequestId: a8708105-0948-11e7-b83e-b71ae2e4dbbe Version: $LATEST\\nChecking https://www.amazon.com/ at now...!...\\nCheck failed!\\nCheck complete at 2017-03-15 06:28:53.016209\\nHTTP Error 503: Service Unavailable: HTTPError\\nTraceback (most recent call last):\\n  (\u7701\u7565)\\n  File \\\"/usr/lib64/python2.7/urllib2.py\\\", line 556, in http_error_default\\n    raise HTTPError(req.get_full_url(), code, msg, hdrs, fp)\\nHTTPError: HTTP Error 503: Service Unavailable\\n\\nEND RequestId: a8708105-0948-11e7-b83e-b71ae2e4dbbe\\nREPORT RequestId: a8708105-0948-11e7-b83e-b71ae2e4dbbe\\tDuration: 348.59 ms\\tBilled Duration: 400 ms \\tMemory Size: 128 MB\\tMax Memory Used: 17 MB\\n```\\n\\n\u307E\u3060\u30A8\u30E9\u30FC\u3067\u308B\u306E\u3067\u3044\u308D\u3044\u308D\u3084\u3063\u3066\u3044\u304D\u307E\u3059\u3002\\n\\n### except\u4F8B\u5916\u51E6\u7406\u3057\u3066\u308B\u306E\u306B\u306A\u3093\u3067\u30A8\u30E9\u30FC\u3067\u308B\u306D\u3093\uFF01\\n\\n\u307E\u305A\u306F\u8D64\u3044\u753B\u9762\u3067\u308B\u306E\u5ACC\u306A\u306E\u3067\u3001url\u306E\u30EA\u30AF\u30A8\u30B9\u30C8\u5931\u6557\u3057\u3066\u3082\u30A8\u30E9\u30FC\u3092\u3067\u306A\u304F\u3057\u307E\u3059\u3002\\n\\n```py\\n\\n    try:\\n        if not validate(urlopen(SITE).read()):\\n            raise Exception('Validation failed')\\n    except:\\n        print('Check failed!')\\n        raise\\n```\\n\\nPython\u306E\u5834\u5408\u3001\u6700\u5F8C\u306Braise\u3092\u3044\u308C\u308B\u3068\u3001\u30A8\u30E9\u30FC\u3092except\u3067\u30AD\u30E3\u30C3\u30C1\u3057\u305F\u306E\u3092\u305D\u306E\u307E\u307E\u7D20\u306Epython\u6587\u306B\u30A8\u30E9\u30FC\u3092\u623B\u3057\u3061\u3083\u3044\u307E\u3059\u3002\u3053\u308C\u3092\u66F8\u304D\u63DB\u3048\u307E\u3059\u3002\\n\\n```python\\n\\ndef lambda_handler(event, context):\\n    print('Checking {} at {}...'.format(SITE, event['time']))\\n    try:\\n        if not validate(urlopen(SITE).read()):\\n            raise Exception('Validation failed')\\n    except Exception as e:\\n        print('Check failed!')\\n        print(e)\\n    else:\\n        print('Check passed!')\\n        return event['time']\\n    finally:\\n        print('Check complete at {}'.format(str(datetime.now())))\\n\\n```\\n\\n\u3084\u3063\u3068\u7DD1\u30C1\u30A7\u30C3\u30AF\u306E\u6210\u529F\u304C\u3067\u307E\u3057\u305F\u2026\uFF01\uFF01\uFF01\uFF01\\n\\n![\u30B9\u30AF\u30EA\u30FC\u30F3\u30B7\u30E7\u30C3\u30C8 2017-03-15 15.44.10.png](https://qiita-image-store.s3.amazonaws.com/0/112929/0fb9f030-af8a-32d9-e74f-260cda7afe4e.png)\\n\\n`except Exception as e:`\u3067\u30A8\u30E9\u30FC\u3092\u30AD\u30E3\u30C3\u30C1\u3057\u3066\\n`print(e)`\u3067\u30A8\u30E9\u30FC\u51FA\u529B\u3057\u3066\\n`raise`\u524A\u9664\u3057\u3066\u3001\u3068\u308A\u3042\u3048\u305A\u306F\u30A8\u30E9\u30FC\u3067\u306A\u304F\u3057\u307E\u3057\u305F\u3002\\n\\n\u3053\u306E\u3042\u305F\u308A\u306Epython\u306E\u30A8\u30E9\u30FC\u30CF\u30F3\u30C9\u30EA\u30F3\u30B0\u304B\u306A\u308A\u8ABF\u3079\u307E\u3057\u305F\u3002raise\u3002\u3002\\n\\n\\n### HTTP Error 503\\n\\n\\n\u30A8\u30E9\u30FC\u304C\u307E\u3060\u7D9A\u3044\u3066\u308B\u306E\u3067`HTTP Error 503: Service Unavailable: HTTPError`\u306E\u90E8\u5206\u3092\u898B\u3066\u3044\u304D\u307E\u3059\u3002\\n\u307E\u305F\u3001Validation failed\u3068\u3044\u3046\u6587\u5B57\u304C\u306A\u3044\u306E\u3067`validate(urlopen(SITE).read())`\u3053\u306E\u90E8\u5206\u3067\u8FD4\u3063\u3066\u304D\u305F\u30A8\u30E9\u30FC\u304C\u4E0A\u8A18\u306E\u30A8\u30E9\u30FC\u3060\u3068\u5224\u65AD\u3057\u3066\u3044\u304D\u307E\u3059\u3002\\n\\n```python\\ndef validate(res):\\n    return EXPECTED in res\\n```\\n\\n\u3053\u3061\u3089\u306F https://www.amazon.com/ \u306B\u30A2\u30AF\u30BB\u30B9\u3057\u3066\u3001\u8FD4\u3063\u3066\u304D\u305F\uFF48\uFF54\uFF4D\uFF4C\u30D5\u30A1\u30A4\u30EB\u306E\u4E2D\u306B\u300COnline Shopping\u300D\u3068\u3044\u3046\u6587\u5B57\u304C\u3042\u308B\u304B\u3069\u3046\u304B\u306E\u8A3A\u65AD\u306B\u306A\u308A\u307E\u3059\u3002\\n\\n\u3068\u308A\u3042\u3048\u305AAmazon\u304B\u3089Google\u3078\u306E\u30A2\u30AF\u30BB\u30B9\u3078\u3001\u74B0\u5883\u5909\u6570\u306E\u5909\u66F4\u3092\u3059\u308B\\n* https://www.google.co.jp/\\n* Gmail\\n\\n\u305D\u3046\u3059\u308B\u3068\\n\\n```shell-session\\n\\nChecking https://www.google.co.jp/ at now...!...\\nCheck passed!\\nCheck complete at 2017-03-15 07:00:05.723916\\n\\n```\\n\\n\u3084\u3063\u3068Check passed!\u304C\u51FA\u307E\u3057\u305F\u3002\\n\\n> 503 Service Unavailable\\n\u30B5\u30FC\u30D3\u30B9\u5229\u7528\u4E0D\u53EF\u3002\u30B5\u30FC\u30D3\u30B9\u304C\u4E00\u6642\u7684\u306B\u904E\u8CA0\u8377\u3084\u30E1\u30F3\u30C6\u30CA\u30F3\u30B9\u3067\u4F7F\u7528\u4E0D\u53EF\u80FD\u3067\u3042\u308B\u3002\\n\u4F8B\u3068\u3057\u3066\u3001\u30A2\u30AF\u30BB\u30B9\u304C\u6BBA\u5230\u3057\u3066\u51E6\u7406\u4E0D\u80FD\u306B\u9665\u3063\u305F\u5834\u5408\u306B\u8FD4\u3055\u308C\u308B\u3002\\n\\n\\nhttps://www.amazon.com/ \\n\u304C\u843D\u3061\u308B\u308F\u3051\u306A\u3044\u3058\u3083\u30FC\u3093\u3002\u3063\u3066\u5FC3\u306E\u305D\u3053\u304B\u3089\u601D\u3063\u3066\u74B0\u5883\u5909\u6570\u3092\u8FD4\u3057\u3066\u30C1\u30A7\u30C3\u30AF\u3057\u3066\u307F\u308B\u3053\u3068\u3092\u5931\u5FF5\u3057\u3066\u307E\u3057\u305F\u3002\u305F\u3060\u306EGoogle\u30B5\u30FC\u30D3\u30B9\u306B\u5909\u3048\u305F\u3089\u3046\u307E\u304F\u3044\u304D\u307E\u3057\u305F\u3002\\nLambda\u304B\u3089\u306E\u30A2\u30AF\u30BB\u30B9\u62D2\u5426\u3057\u3066\u308B\u306E\uFF1F\\n\\n\u30CF\u30DE\u3063\u305F\u3068\u3053\u308D\u3067\u3059\u3002\\n\\n### indent\\n\\nPython\u306E\u30A8\u30E9\u30FC\u3067\u3059\u304C\u30A4\u30F3\u30C7\u30C3\u30AF\u30B9\u306E\u6570\u3068\u304B\u3067\u3082\u4F55\u56DE\u304B\u30A8\u30E9\u30FC\u51FA\u3057\u307E\u3057\u305F\u3002\\n\\n```shell-session\\nSyntax error in module 'lambda_function': \\nunexpected indent (lambda_function.py, line 30)\\n```\\n\\n\u3053\u306E\u3042\u305F\u308A\u52C9\u5F37\u3057\u305F\u306E\u3067\u3059\u304C\u3001\u30BF\u30D6\u3068\u30B9\u30DA\u30FC\u30B9(4\u3064)\u306E\u6226\u4E89\u3067\u3059\u306D\u3002\\n[\u30D7\u30ED\u30B0\u30E9\u30DF\u30F3\u30B0\u306E\u30B3\u30FC\u30C9\u3092\u66F8\u304F\u6642\u306E\u30BF\u30D6vs\u30B9\u30DA\u30FC\u30B9\u6226\u4E89\u304C\u3064\u3044\u306B\u6C7A\u7740](http://www.gizmodo.jp/2016/09/tab-vs-space.html)\\npython\u306F\u30B9\u30DA\u30FC\u30B9\u3067\u66F8\u304F\u306E\u304C\u4E00\u822C\u7684\u3060\u3068\u3044\u3046\u3053\u3068\u304C\u66F8\u304B\u308C\u3066\u307E\u3059\u3002\\n\\n\u81EA\u5206\u304C\u30ED\u30FC\u30AB\u30EB\u3067\u7DE8\u96C6\u3057\u3066\u305F\u30D5\u30A1\u30A4\u30EB\u304Ctab\u3067\u5165\u3063\u3066\u3044\u3066\\nAWS\u4E0A\u3067\u7DE8\u96C6\u3057\u305F\u30B3\u30FC\u30C9\u306F\u30B9\u30DA\u30FC\u30B94\u3064\u3067\u5165\u308A\u307E\u3059\u3002\\n\u3053\u306Eindent\u30A8\u30E9\u30FC\u3092\u898B\u305F\u304F\u306A\u3044\u306E\u3067\u30B9\u30DA\u30FC\u30B9\u6D3E\u306B\u4E57\u308A\u63DB\u3048\u307E\u3057\u305F\u3002\\n\\n### Requests\\n\\nurlopen\u3092\u305D\u306E\u307E\u307E\u4F7F\u3063\u3066\u3082\u3044\u3044\u306E\u3067\u3059\u304Crequests\u3092\u5C0E\u5165\u3057\u305F\u3044\u3068\u601D\u3044\u307E\u3059\u3002\\n\\n[python urllib2\u30E2\u30B8\u30E5\u30FC\u30EB](http://d.hatena.ne.jp/yumimue/20071231/1199129495)\\n[Requests: \u4EBA\u9593\u306E\u305F\u3081\u306EHTTP](http://requests-docs-ja.readthedocs.io/en/latest/)\\n[Requests\u3092\u4F7F\u308F\u305A\u306B\u540C\u3058\u4E8B\u3092\u3059\u308B\u305F\u3081\u306E\u30B3\u30FC\u30C9](https://gist.github.com/kennethreitz/973705)\\n\\nslack\u3068\u304B\u306B\u30E1\u30C3\u30BB\u30FC\u30B8\u9001\u308B\u306E\u304C\u7C21\u5358\u306B\u306A\u308A\u307E\u3059\u3002\\n\\n```\u4ECA\u306E\u30B3\u30FC\u30C9.py\\n# coding: utf-8\\nfrom __future__ import print_function\\n\\nimport os\\nimport json\\nimport requests\\nfrom datetime import datetime\\nfrom urllib2 import urlopen\\n\\nSITE = os.environ['site']\\nEXPECTED = os.environ['expected']\\n\\ndef validate(res):\\n    return EXPECTED in res\\n\\ndef lambda_handler(event, context):\\n    print('Checking {} at {}...'.format(SITE, event['time']))\\n    try:\\n        if not validate(urlopen(SITE).read()):\\n            raise Exception('Validation failed')\\n    except Exception as e:\\n        print('Check failed!')\\n        print(e)\\n    else:\\n        print('Check passed!')\\n    finally:\\n        print('Check complete at {}'.format(str(datetime.now())))\\n        return \\\"Finish\\\"\\n\\n```\\n\\n\\n```shell-session\\nUnable to import module 'lambda_function': No module named requests\\n```\\n\\nrequests\u306F\u5916\u90E8\u30E2\u30B8\u30E5\u30FC\u30EB\u306A\u306E\u3067\u3053\u3093\u306A\u30A8\u30E9\u30FC\u304A\u304D\u307E\u3059\u3002\\n\\n\\n## \u5916\u90E8\u30E2\u30B8\u30E5\u30FC\u30EB\u306E\u4F7F\u7528\\nrequests\u307F\u305F\u3044\u306APython\u6A19\u6E96\u5916\u306E\u30E2\u30B8\u30E5\u30FC\u30EB\u3092\u5165\u308C\u308B\u306E\u306B\u3082\u4E00\u7656\u3042\u3063\u305F\u306E\u3067\u66F8\u3044\u3066\u3044\u304D\u307E\u3059\u3002\\n\\n* lambda-uploader\u3092\u4F7F\u3063\u3066\u30EA\u30E2\u30FC\u30C8\\n* \u30ED\u30FC\u30AB\u30EB\u3067\u81EA\u5206\u3067zip\u306B\u304B\u305F\u3081\u3066UP\\n\\n### lambda-uploader\\n\u3053\u306E\u3042\u305F\u308A\u304C\u53C2\u8003\u306B\u306A\u308A\u307E\u3059\u3002\\n\\n[lambda-uploader\u3092\u4F7F\u3063\u3066AWS Lambda\u3092\u30EA\u30E2\u30FC\u30C8\u3067\u958B\u767A\u3001\u5B9F\u884C\u3001\u30C7\u30D7\u30ED\u30A4\u3059\u308B](http://qiita.com/Esfahan/items/08fa6af8811dada4cb2a)\\n[AWS Lambda Python\u3092lambda-uploader\u3067\u30C7\u30D7\u30ED\u30A4](http://dev.classmethod.jp/cloud/deploy-aws-lambda-python-with-lambda-uploader/)\\n\\n### \u81EA\u5206\u306E\u30B3\u30FC\u30C9\u3092ZIP\u30A2\u30C3\u30D7\u30ED\u30FC\u30C9\\n\u81EA\u5206\u306F\u3053\u308C\u3067\u884C\u3044\u307E\u3057\u305F\u3002\u5358\u767A\u3060\u3068\u3059\u3050\u3067\u304D\u308B\u3002\\n[\u3010AWS\u3011Lambda\u3067pip\u3057\u305F\u3044\u3068\u601D\u3063\u305F\u3068\u304D\u306B\u3059\u3079\u304D\u3053\u3068](http://qiita.com/Hironsan/items/0eb5578f3321c72637b4)\\n\\n\u4F5C\u696D\u30D5\u30A9\u30EB\u30C0\u306B`pip install requests -t .`\u3057\u3066\u3001\u305D\u308C\u3092zip\u3067\u56FA\u3081\u3066\u30A2\u30C3\u30D7\u3059\u308B\u611F\u3058\u3067\u3059\u3002\\n\\n\u7121\u4E8B\u30A2\u30C3\u30D7\u30ED\u30FC\u30C9\u3067\u304D\u305F\u3089\u3001\u5148\u7A0B\u306E`\u4ECA\u306E\u30B3\u30FC\u30C9.py`\u304B\u3089\u30B9\u30BF\u30FC\u30C8\u3057\u307E\u3059\u3002\\n\\n## Slack\\n\\nimport \\n* urllib2\\n* requests\\n* \u3069\u3063\u3061\u3067\u3082\u53EF\\n\\napi\\n* Slack api(token\u53D6\u5F97\u3057\u3066\u3054\u306B\u3087\u3054\u306B\u3087 xoxp-12131212\u3053\u3093\u306A\u3084\u3064)\\n* Webhook(url\u3060\u3051\u53D6\u3063\u3066\u304F\u308B)\\n* \u3069\u3063\u3061\u3067\u3082\u53EF\\n\\n\u3069\u306E\u7D44\u307F\u5408\u308F\u305B\u3092\u4F7F\u3063\u3066\u3082\u826F\u3044\u306E\u3067\u3059\u304C\u3001\u4ECA\u56DE\u306F\u7C21\u5358\u306Arequests * Webhook\u3092\u4F7F\u3044\u307E\u3059\u3002\\n\\n\u3053\u3061\u3089Webhook\u306EURL\u53D6\u5F97\u306F\u3053\u3061\u3089\u3092\u53C2\u8003\u306B\uFF01\\n[Slack\u306EWebhook URL\u53D6\u5F97\u624B\u9806](http://qiita.com/vmmhypervisor/items/18c99624a84df8b31008)\\n\\n\\n```python\\ndef send_slack(text):\\n    url = \\\"\u5148\u7A0B\u3052\u3063\u3068\u3057\u305FURL\\\"\\n    payload_dic = {\\n        \\\"text\\\":text,\\n        \\\"icon_emoji\\\":':grin:',\\n        \\\"channel\\\":'bot-test2',\\n    }\\n\\n    r = requests.post(url, data=json.dumps(payload_dic))\\n```\\n\\n\u305F\u3063\u305F\u3053\u308C\u3060\u3051\u3067Slack\u9001\u308C\u307E\u3059\uFF01\\n\\n```python\\n# coding: utf-8\\nfrom __future__ import print_function\\n\\nimport os\\nimport json\\nimport requests\\nfrom datetime import datetime\\nfrom urllib2 import urlopen\\n\\nSITE = os.environ['site']\\nEXPECTED = os.environ['expected']\\n\\ndef validate(res):\\n    return EXPECTED in res\\n\\ndef web_check():\\n    try:\\n        if not validate(urlopen(SITE).read()):\\n            raise Exception('Validation failed')\\n    except Exception as e:\\n        print('Check failed!')\\n        print(e)\\n    else:\\n        print('Check passed!')\\n    finally:\\n        print('Check complete at {}'.format(str(datetime.now())))\\n\\ndef lambda_handler(event, context):\\n    print('Checking {} at {}...'.format(SITE, event['time']))\\n    # web_check()\\n    send_slack(\\\"test\\\")\\n    return \\\"success!\\\"\\n\\ndef send_slack(text):\\n    url = \\\"\u3053\u3061\u3089\u81EA\u5206\u306EURL\\\"\\n    payload_dic = {\\n        \\\"text\\\":text,\\n        \\\"icon_emoji\\\":':grin:',\\n        \\\"channel\\\":'bot-test2',\\n    }\\n\\n    r = requests.post(url, data=json.dumps(payload_dic))\\n\\n\\n```\\n\\n`def web_check():`\u306B\u51E6\u7406\u3092\u79FB\u3057\u3066\u7F6E\u304D\u307E\u3057\u305F\u3002\\n\\n\\n```\\ndef lambda_handler(event, context):\\n    print('Checking {} at {}...'.format(SITE, event['time']))\\n    # web_check()\\n    send_slack(\\\"test\\\")\\n    return \\\"success!\\\"\\n```\\n\\n\u3053\u308C\u3067\\n\\n<img width=\\\"760\\\" alt=\\\"\u30B9\u30AF\u30EA\u30FC\u30F3\u30B7\u30E7\u30C3\u30C8 2017-03-15 16.55.31.png\\\" src=\\\"https://qiita-image-store.s3.amazonaws.com/0/112929/b3cd2890-00f3-5c7d-0ff2-4016d94aa417.png\\\">\\nSlack\u5230\u7740\u3057\u307E\u3057\u305F\u3002\\n\\nOkay\u3002\\n\u6B21\u306FDynamoDB\u304B\u3089\u30C7\u30FC\u30BF\u3092\u53D6\u3063\u3066\u304D\u307E\u3059\u3002\\n\\n\\n# DynamoDB\\n\\n## \u6599\u91D1\u4F53\u7CFB\\n\\nAWS \u306E\u7121\u6599\u5229\u7528\u67A0\u306E\u4E00\u90E8\u3068\u3057\u3066\u306EDynamoDB\u7121\u6599\u67A0\\n\\n|\u30B9\u30C8\u30EC\u30FC\u30B8| \u66F8\u304D\u8FBC\u307F\u5BB9\u91CF | \u66F8\u304D\u8FBC\u307F\u5BB9\u91CF |\\n|:-:|:-:|:-:|\\n|25GB| 25  | 25  |\\n\\n> 1 \u3064\u306E\u5BB9\u91CF\u306E\u30E6\u30CB\u30C3\u30C8\u3067 1 \u79D2\u3042\u305F\u308A\u306B 1 \u3064\u306E\u30EA\u30AF\u30A8\u30B9\u30C8\u3092\u51E6\u7406\u3057\u307E\u3059\\n1\u30E6\u30CB\u30C3\u30C8\u306E\u66F8\u304D\u8FBC\u307F\u5BB9\u91CF: \u6700\u59271KB\u30C7\u30FC\u30BF\u30921\u79D2\u306B1\u66F8\u304D\u8FBC\u307F\\n1\u30E6\u30CB\u30C3\u30C8\u306E\u8AAD\u307F\u8FBC\u307F\u5BB9\u91CF: \u6700\u59274KB\u30C7\u30FC\u30BF\u30921\u79D2\u306B1\u8AAD\u307F\u8FBC\u307F\\nDynamoDB \u30B9\u30C8\u30EA\u30FC\u30E0\u304B\u3089\u306E 250 \u4E07\u56DE\u306E\u8AAD\u307F\u8FBC\u307F\u30EA\u30AF\u30A8\u30B9\u30C8\u3092\u7121\u6599\u3067\u5229\u7528\u3067\u304D\u307E\u3059\u3002\\n\\n\u3068\u308A\u3042\u3048\u305A\u30C7\u30FC\u30BF\u30D9\u30FC\u30B9\u3092\u4F5C\u308B\u6642\u306B\u66F8\u304D\u8FBC\u307F\u5BB9\u91CF\u3068\u8AAD\u307F\u8FBC\u307F\u5BB9\u91CF\u30921\u306B\u30BB\u30C3\u30C8\u3057\u3066\u4F7F\u3048\u3070\u3001\u7121\u6599\u67A0\u3060\u3068\u304A\u91D1\u304B\u304B\u3089\u306A\u3044\u3068\u601D\u3044\u307E\u3059\u3002\\n\u4ECA\u56DE\u306F1\u5206\u306B1\u5EA6\u304F\u3089\u3044\u3067\u3082\u3044\u3044\u306E\u3067\u3001\u6700\u5C0F\u5358\u4F4D\u306E1(1\u79D2\u306B1\u5EA6\u30A2\u30AF\u30BB\u30B9\u3067\u304D\u308B\u30EC\u30D9\u30EB)\u3092\u9078\u3073\u307E\u3059\u3002\\n\\n## \u4F5C\u3063\u3066\u307F\u308B\\n\\n\u3068\u308A\u3042\u3048\u305A\u8A2D\u5B9A\u306F\u3053\u3093\u306A\u611F\u3058\u3002\\n\\n![\u30B9\u30AF\u30EA\u30FC\u30F3\u30B7\u30E7\u30C3\u30C8 2017-03-15 17.10.25.png](https://qiita-image-store.s3.amazonaws.com/0/112929/984460b7-8dc5-c2d5-31f4-ab5b807679c0.png)\\n\\nDynamoDB\u306F\u30CF\u30C3\u30B7\u30E5(\u8A00\u8A9E\u306B\u3088\u3063\u3066\u306F\u8F9E\u66F8\u578B\u3001\u9023\u60F3\u914D\u5217\u306A\u3069)\u306EKey\u3067\u3057\u304B\u30A2\u30AF\u30BB\u30B9\u3067\u304D\u307E\u305B\u3093\u3002\u4ECA\u56DE\u306Fid\u3092key\u3068\u3057\u3066\u30A2\u30AF\u30BB\u30B9\u3057\u307E\u3059\u3002\\n\\n![\u30B9\u30AF\u30EA\u30FC\u30F3\u30B7\u30E7\u30C3\u30C8 2017-03-15 17.15.28.png](https://qiita-image-store.s3.amazonaws.com/0/112929/0a861237-db0f-371e-4596-4ad6bc488e94.png)\\n\\n```json\\n\\n{\\n  \\\"id\\\": 1,\\n  \\\"target\\\": \\\"Online Shopping\\\",\\n  \\\"url\\\": \\\"https://www.amazon.com/\\\"\\n}\\n\\n{\\n  \\\"id\\\": 2,\\n  \\\"target\\\": \\\"Gmail\\\",\\n  \\\"url\\\": \\\"https://www.google.co.jp/\\\"\\n}\\n```\\n\\nurl\u304B\u3089target\u3092\u63A2\u3059\u305F\u3081\u306ETable\u3068\u3057\u3066\u4F7F\u3044\u307E\u3059\u3002\\n\\n\\n## python\u30B3\u30FC\u30C9\u304B\u3089\u5148\u7A0B\u306E\u30C7\u30FC\u30BF\u3092\u53D6\u3063\u3066\u307F\u308B\\n\\n```python\\n# \uFF12\u3064\u8FFD\u52A0\\nimport boto3\\nfrom boto3.dynamodb.conditions import Key, Attr\\n\\ndef get_urls():\\n    table    = dynamodb.Table('sites')\\n    response = table.scan()\\n    sites = response[\\\"Items\\\"]\\n    return sites\\n```\\n\\n\u6A5F\u80FD\u3092\u8FFD\u52A0\u3057\u3066\u3001get_urls()\u3067DynamoDB\u304B\u3089\u53D6\u3063\u3066\u304D\u305Furl\u304B\u3089target\u306E\u6587\u7AE0\u304C\u3042\u308B\u304B\u30B5\u30FC\u30C1\u3057\u3066\u3044\u307E\u3059\u3002\\n\\n```\u73FE\u5728\u306E.py\\n# coding: utf-8\\nfrom __future__ import print_function\\n\\nimport os\\nimport json\\nimport requests\\nfrom datetime import datetime\\nfrom urllib2 import urlopen\\nimport boto3\\nfrom boto3.dynamodb.conditions import Key, Attr\\n\\ndynamodb = boto3.resource('dynamodb')\\n\\ndef validate(res, target):\\n    return target in res\\n\\ndef web_check(url, target):\\n    print(\\\"Serching ... \\\" + target)\\n    try:\\n        if validate(urlopen(url).read(), target):\\n            print(\\\"Find!\\\")\\n        else:\\n            print(\\\"Not Find!\\\")\\n    except Exception as e:\\n        print('Error')\\n        print(e)\\n\\ndef get_urls():\\n    table    = dynamodb.Table('sites')\\n    response = table.scan()\\n    sites = response[\\\"Items\\\"]\\n    return sites\\n\\ndef send_slack(text):\\n    url = \\\"https://hooks.slack.com/services/\\\"\\n    payload_dic = {\\n        \\\"text\\\":text,\\n        \\\"icon_emoji\\\":':grin:',\\n        \\\"channel\\\":'bot-test2',\\n    }\\n    r = requests.post(url, data=json.dumps(payload_dic))\\n\\ndef lambda_handler(event, context):\\n    print('Check start')\\n\\n    sites = get_urls()\\n    for site in sites:\\n        web_check(str(site[\\\"url\\\"]), str(site[\\\"target\\\"]))\\n    \\n    return \\\"success!\\\"\\n\\n\\n```\\n\\n\u51FA\u529B\u7D50\u679C\\n\\n```shell-session\\n\\nCheck start\\nSerching ... \u6280\u8853\u60C5\u5831\u5171\u6709\u30B5\u30FC\u30D3\u30B9\u3067\u3059 at https://qiita.com/\\nFind!\\nSerching ... Gmail at https://www.google.co.jp/\\nFind!\\nSerching ... Gmail\u3067\u3059\u304B\uFF1F at https://www.google.co.jp/\\nNot Find!\\nSerching ... Online Shopping at https://www.amazon.com/\\nError\\nHTTP Error 503: Service Unavailable\\nEND RequestId: 3992d81e-095e-11e7-b30a-1ddc7da9e992\\n```\\n\\n\u3053\u3053\u3067\u3082\u30A8\u30E9\u30FC\u304A\u304D\u307E\u3057\u305F\u3002Python\u3064\u307E\u3065\u304F\uFF01\\n\\n```shell-session\\n\\n'utf8' codec can't decode byte 0x90 in position 102: invalid start byte\\n```\\n\\n[Python\u306EUnicodeEncodeError\u3092\u77E5\u308B](http://lab.hde.co.jp/2008/08/pythonunicodeencodeerror.html)\\n\u3053\u3053\u3092\u53C2\u8003\u306B\u30A8\u30E9\u30FC\u89E3\u6C7A\u3057\u307E\u3057\u305F\u3002\\n`type(site[\\\"url\\\"])`\u3057\u305F\u3089`<type 'unicode'>`\u3060\u3063\u305F\u306E\u3067\u3001\\n`str(site[\\\"url\\\"])`\u3092\u3057\u3066`<type 'str'>`\u306B\u5909\u3048\u307E\u3057\u305F\u3002\\n\\n\\n## Lambda\u304B\u3089DynamoDB\u66F8\u304D\u8FBC\u307F\\n\\nsites_check1\u30C6\u30FC\u30D6\u30EB\u306E\u8FFD\u52A0\\n\\n![\u30B9\u30AF\u30EA\u30FC\u30F3\u30B7\u30E7\u30C3\u30C8 2017-03-15 18.19.12.png](https://qiita-image-store.s3.amazonaws.com/0/112929/e809a5ad-65ec-4f94-d2b9-a699380e0497.png)\\n\\n\\n\u8FFD\u52A0\\n\\n```python\\nfrom datetime import datetime, timedelta\\n\\ndef insert(results):\\n    date = datetime.now() + timedelta(hours=9)\\n\\n    id = 0\\n    table = dynamodb.Table('sites_check')\\n    table.put_item(\\n        Item={\\n            \\\"id\\\": id,\\n            \\\"date\\\": date.strftime(\\\"%Y/%m/%d %H:%M\\\"),\\n            \\\"result\\\": results\\n       }\\n    )\\n```\\n\\n\u6642\u9593\u306E\u5897\u6E1B\u3092\u884C\u3046timedelta\u3068\u304B\u3092\u8FFD\u52A0\u3057\u307E\u3057\u305F\u3002\\nDynamoDB\u306Esites\u30C6\u30FC\u30D6\u30EB\u306B\u30BF\u30A4\u30C8\u30EB\u8FFD\u52A0\u3057\u307E\u3057\u305F\u3002\\n\u73FE\u5728\u306E\u30B3\u30FC\u30C9\\n\\n```python\\n\\n# coding: utf-8\\nfrom __future__ import print_function\\n\\nimport os\\nimport json\\nimport requests\\nfrom datetime import datetime, timedelta\\nfrom urllib2 import urlopen\\nimport boto3\\nfrom boto3.dynamodb.conditions import Key, Attr\\n\\ndynamodb = boto3.resource('dynamodb')\\n\\ndef validate(res, target):\\n    return target in res\\n\\ndef web_check(url, target):\\n    print(\\\"Serching ... \\\" + target + \\\" at \\\" + url)\\n    try:\\n        if validate(urlopen(url).read(), target):\\n            return \\\"Find!\\\"\\n        else:\\n            return \\\"Not Find!\\\"\\n    except Exception as e:\\n        return str(e)\\n\\ndef get_urls():\\n    table    = dynamodb.Table('sites')\\n    response = table.scan()\\n    sites = response[\\\"Items\\\"]\\n    return sites\\n\\ndef send_slack(text):\\n    url = \\\"https://hooks.slack.com/\\\"\\n    payload_dic = {\\n        \\\"text\\\":text,\\n        \\\"icon_emoji\\\":':grin:',\\n        \\\"channel\\\":'bot-test2',\\n    }\\n    r = requests.post(url, data=json.dumps(payload_dic))\\n\\ndef insert(results):\\n    date = datetime.now() + timedelta(hours=9)\\n\\n    id = 0\\n    table = dynamodb.Table('sites_check')\\n    table.put_item(\\n        Item={\\n            \\\"id\\\": id,\\n            \\\"date\\\": date.strftime(\\\"%Y/%m/%d %H:%M\\\"),\\n            \\\"result\\\": results\\n       }\\n    )\\n\\ndef lambda_handler(event, context):\\n    print('Check start')\\n\\n    results = {}\\n    sites = get_urls()\\n    for site in sites:\\n        msg = web_check(str(site[\\\"url\\\"]), str(site[\\\"target\\\"]))\\n        results[str(site[\\\"title\\\"])] = msg\\n    \\n    insert(results)\\n    return \\\"success!\\\"\\n\\n\\n\\n```\\n\\n\u30C7\u30FC\u30BF\u3092\u633F\u5165\u3057\u305F\u7D50\u679C\u304C\u3053\u3061\u3089\u3002\\n\\n```json\\n\\n{\\n  \\\"date\\\": \\\"2017/03/15 18:37\\\",\\n  \\\"id\\\": 0,\\n  \\\"result\\\": {\\n    \\\"Amazon\\\": \\\"Find!\\\", # \u306A\u305C\u304BFind\u3068\u306A\u3063\u3066\u30A8\u30E9\u30FC\u8D77\u304D\u305A \\n    \\\"Google\\\": \\\"Find!\\\",\\n    \\\"Google-2\\\": \\\"Not Find!\\\",\\n    \\\"Qiita\\\": \\\"Find!\\\"\\n  }\\n}\\n\\n{\\n  \\\"date\\\": \\\"2017/03/15 18:48\\\",\\n  \\\"id\\\": 0,\\n  \\\"result\\\": {\\n    \\\"Amazon\\\": \\\"HTTP Error 503: Service Unavailable\\\", # \u3053\u3061\u3089\u3067\u30A8\u30E9\u30FC\u8D77\u304D\u305F\u3068\u304D\u306Bstr(e)\u306B\u3057\u307E\u3057\u305F\\n    \\\"Google\\\": \\\"Find!\\\",\\n    \\\"Google-2\\\": \\\"Not Find!\\\",\\n    \\\"Qiita\\\": \\\"Find!\\\"\\n  }\\n}\\n```\\n\\n\\n`str(e)`\u3063\u3066\u3057\u306A\u3044\u3068e\u304Cstr\u578B\u3058\u3083\u306A\u3044\u306E\u3067\u30A8\u30E9\u30FC\u304C\u8D77\u304D\u307E\u3057\u305F\u3002\\nPython\u306B\u6163\u308C\u3066\u304D\u305F\u306E\u306710\u5206\u304F\u3089\u3044\u3067\u89E3\u6C7A\u3002\\njson\u3063\u3066\u30B3\u30E1\u30F3\u30C8\u3064\u3051\u3089\u308C\u306A\u3044\u3093\u3067\u3059\u306D\u3002\\n\\n\\n## \\n\\n```python\\ndef get_recent_codes():\\n    date = datetime.now() + timedelta(hours=9)\\n    now = date.strftime(\\\"%Y/%m/%d %H:%M\\\")\\n    last = (date + timedelta(minutes=-9)).strftime(\\\"%Y/%m/%d %H:%M\\\")\\n\\n    # id\u304C0\u304B\u3064\u3001\uFF11\uFF10\u5206\u4EE5\u5185\u306E\u30C7\u30FC\u30BF\u3092\u53D6\u3063\u3066\u304F\u308B\u611F\u3058\u306E\u30AF\u30A8\u30EA\\n    response = table.query(\\n        KeyConditionExpression=Key('id').eq(0) & Key('date').between(last, now)\\n    )\\n\\n    return response\\n```\\n\\n`response['Count']`\u306B\u53D6\u3063\u3066\u3053\u308C\u305F\u30AF\u30A8\u30EA\u306E\u6570\u304C\u5165\u308A\u307E\u3059\u3002\\n`response['Items']`\u306B\u53D6\u3063\u3066\u3053\u308C\u305FTable\u306E\u30C7\u30FC\u30BF\u304C\u306F\u3044\u3063\u3066\u307E\u3059\u3002\\n\u305D\u308C\u4EE5\u5916\u306E\u30C7\u30FC\u30BF\u5FC5\u8981\u306A\u5834\u5408\u306F\u9069\u5B9C\u3001Print\u3057\u3064\u3064\u30C7\u30FC\u30BF\u306E\u53D6\u308A\u51FA\u3057\u3092\u3057\u3066\u304F\u3060\u3055\u3044\u3002\\n\\n\\n\\n\u7D50\u679C\u3053\u3093\u306A\u611F\u3058\\n\\n```python\\n# coding: utf-8\\nfrom __future__ import print_function\\n\\nimport os\\nimport json\\nimport requests\\nfrom datetime import datetime, timedelta\\nfrom urllib2 import urlopen\\nimport boto3\\nfrom boto3.dynamodb.conditions import Key, Attr\\n\\ndynamodb = boto3.resource('dynamodb')\\n\\ndef validate(res, target):\\n    return target in res\\n\\ndef web_check(url, target):\\n    print(\\\"Serching ... \\\" + target + \\\" at \\\" + url)\\n    try:\\n        if validate(urlopen(url).read(), target):\\n            return \\\"Find!\\\"\\n        else:\\n            return \\\"Not Find!\\\"\\n    except Exception as e:\\n        return str(e)\\n\\ndef get_urls():\\n    table    = dynamodb.Table('sites')\\n    response = table.scan()\\n    sites = response[\\\"Items\\\"]\\n    return sites\\n\\ndef send_slack(text):\\n    url = \\\"https://hooks.slack.com/\\\"\\n    payload_dic = {\\n        \\\"text\\\":text,\\n        \\\"icon_emoji\\\":':grin:',\\n        \\\"channel\\\":'bot-test2',\\n    }\\n    r = requests.post(url, data=json.dumps(payload_dic))\\n\\ndef insert(results):\\n    table = dynamodb.Table('sites_check')\\n    date = datetime.now() + timedelta(hours=9)\\n    id = 0\\n    table.put_item(\\n        Item={\\n            \\\"id\\\": id,\\n            \\\"date\\\": date.strftime(\\\"%Y/%m/%d %H:%M\\\"),\\n            \\\"result\\\": results\\n       }\\n    )\\n\\ndef get_recent_codes():\\n    table = dynamodb.Table('sites_check')\\n\\n    date = datetime.now() + timedelta(hours=9)\\n    now = date.strftime(\\\"%Y/%m/%d %H:%M\\\")\\n    last = (date + timedelta(minutes=-9)).strftime(\\\"%Y/%m/%d %H:%M\\\")\\n    print(last + \\\" \u304B\u3089 \\\" + now + \\\" \u307E\u3067\u306E\u30C1\u30A7\u30C3\u30AF\\\")\\n\\n    response = table.query(\\n        KeyConditionExpression=Key('id').eq(0) & Key('date').between(last, now)\\n    )\\n    \\n    return response\\n\\ndef lambda_handler(event, context):\\n    print('Check start')\\n\\n    results = {}\\n    sites = get_urls()\\n    for site in sites:\\n        msg = web_check(str(site[\\\"url\\\"]), str(site[\\\"target\\\"]))\\n        results[str(site[\\\"title\\\"])] = msg\\n    \\n    insert(results)\\n    print(get_recent_codes())\\n    return \\\"success!\\\"\\n\\n\\n\\n```\\n\\n\u5B9A\u671F\u5B9F\u884C\u3055\u305B\u305F\u308A\u3044\u308D\u3044\u308D\u3067\u304D\u308B\u3068\u601D\u308F\u308C\u307E\u3059\u3002\\n\\n\\n# \u3055\u3044\u3054\u306B\\n\\nPython\u3068Lambda\u306E\u7D20\u4EBA\u306A\u306E\u3067\u304B\u306A\u308A\u30A8\u30E9\u30FC\u3060\u3057\u307E\u3057\u305F\u3002\u304C\u3001Python\u3068Lambda\u306B\u3088\u308B\u30A2\u30FC\u30AD\u30C6\u30AF\u30C8\u306F\u304B\u306A\u308A\u4FBF\u5229\u306B\u306A\u308B\u3068\u601D\u3046\u306E\u3067\u3053\u308C\u304B\u3089\u3082\u4F7F\u3063\u3066\u3044\u304D\u305F\u3044\u3068\u601D\u3063\u3066\u3044\u307E\u3059\u3002\\n\\n\",\"coediting\":false,\"comments_count\":0,\"created_at\":\"2017-03-15T19:30:51+09:00\",\"group\":null,\"id\":\"04a921f79574c46f61c0\",\"likes_count\":82,\"private\":false,\"reactions_count\":0,\"tags\":[{\"name\":\"Python\",\"versions\":[]},{\"name\":\"AWS\",\"versions\":[]},{\"name\":\"lambda\",\"versions\":[]}],\"title\":\"[ AWS ] \u521D\u3081\u3066Lambda-Python\u3068DynamoDB\u306B\u89E6\u308B\u4EBA\u306B\u53C2\u8003\u306B\u306A\u308B\u304B\u3082\u306A\u8A71\",\"updated_at\":\"2019-09-12T14:23:37+09:00\",\"url\":\"https://qiita.com/ykhirao/items/04a921f79574c46f61c0\",\"user\":{\"description\":\"Web Developer For 6 years.\\r\\nPHP/Laravel && (React OR Vue.js)\\r\\nTypeScript/node.js\\r\\n\\r\\n\u696D\u52D9\u59D4\u8A17\u306E\u4F9D\u983C\u3068\u304B\u306FWantedly\u3068\u304B\u304B\u3089\u3067\u304A\u9858\u3044\u3057\u307E\u3059\uFF01\",\"facebook_id\":\"\",\"followees_count\":39,\"followers_count\":94,\"github_login_name\":\"ykhirao\",\"id\":\"ykhirao\",\"items_count\":57,\"linkedin_id\":\"\",\"location\":\"Tokyo, Japan\",\"name\":\"yk\",\"organization\":\"\",\"permanent_id\":112929,\"profile_image_url\":\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/112929/profile-images/1639030792\",\"team_only\":false,\"twitter_screen_name\":\"yk_hirao\",\"website_url\":\"https://www.wantedly.com/id/ykhirao\"},\"page_views_count\":null,\"team_membership\":null}},\"path\":\"posts/04a921f79574c46f61c0\",\"sharedData\":{},\"siteData\":{}}");</script><script defer="" type="text/javascript" src="/templates/styles.f7428a48.js"></script><script defer="" type="text/javascript" src="/templates/vendors~main.3a8adc8b.js"></script><script defer="" type="text/javascript" src="/main.53c1473c.js"></script></body></html>