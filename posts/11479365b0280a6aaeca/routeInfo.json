{"template":"__react_static_root__/src/components/QiitaPost","sharedHashesByProp":{},"data":{"post":{"rendered_body":"<p><a href=\"https://camo.qiitausercontent.com/18478755f9544ec862fc94ec1a7b10735aefcc0b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3131323932392f38663930653861382d343534652d386537302d653831372d3363343661363433356630352e706e67\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F112929%2F8f90e8a8-454e-8e70-e817-3c46a6435f05.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=6ecec4d48ae118bd405aa88a860fcdb7\" alt=\"スクリーンショット 2020-12-28 2.10.22.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/112929/8f90e8a8-454e-8e70-e817-3c46a6435f05.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F112929%2F8f90e8a8-454e-8e70-e817-3c46a6435f05.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=8ce4169eb7dc6662c7349314c29adf22 1x\" loading=\"lazy\"></a></p>\n\n<p>以下のようなURLをクリックするだけで、規定の配列から何人か選んでくれる。</p>\n\n<div class=\"code-frame\" data-lang=\"text\"><div class=\"highlight\"><pre><code>https://script.google.com/macros/s/XXXXX-XXXX/exec\nhttps://script.google.com/macros/s/XXXXX-XXXX/exec?num=2\nhttps://script.google.com/macros/s/XXXXX-XXXX/exec?num=3\nhttps://script.google.com/macros/s/XXXXX-XXXX/exec?num=4\n</code></pre></div></div>\n\n<p>以下のようなスクリプトをGASにいれて、Webアプリケーションとして公開したらOK</p>\n\n<div class=\"code-frame\" data-lang=\"js\"><div class=\"highlight\"><pre><code><span class=\"kd\">function</span> <span class=\"nx\">doGet</span><span class=\"p\">(</span><span class=\"nx\">e</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n  <span class=\"k\">if</span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"nx\">isOurGsuiteUser</span><span class=\"p\">())</span> <span class=\"p\">{</span>\n    <span class=\"k\">return</span> <span class=\"nx\">resText</span><span class=\"p\">(</span><span class=\"dl\">\"</span><span class=\"s2\">ログインアドレスが違います</span><span class=\"dl\">\"</span><span class=\"p\">);</span>\n  <span class=\"p\">}</span>\n\n  <span class=\"nx\">postSlackMessage</span><span class=\"p\">(</span><span class=\"nx\">getMessageArray</span><span class=\"p\">(</span><span class=\"nx\">e</span><span class=\"p\">).</span><span class=\"nx\">join</span><span class=\"p\">(</span><span class=\"dl\">\"</span><span class=\"se\">\\n</span><span class=\"dl\">\"</span><span class=\"p\">));</span>\n\n  <span class=\"k\">return</span> <span class=\"nx\">resText</span><span class=\"p\">(</span><span class=\"dl\">\"</span><span class=\"s2\">OK!</span><span class=\"dl\">\"</span><span class=\"p\">);</span>\n<span class=\"p\">}</span>\n\n<span class=\"kd\">function</span> <span class=\"nx\">testSlack</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n  <span class=\"kd\">const</span> <span class=\"nx\">array</span> <span class=\"o\">=</span> <span class=\"nx\">getMessageArray</span><span class=\"p\">();</span>\n\n  <span class=\"nx\">postSlackMessage</span><span class=\"p\">(</span><span class=\"nx\">array</span><span class=\"p\">.</span><span class=\"nx\">join</span><span class=\"p\">(</span><span class=\"dl\">\"</span><span class=\"se\">\\n</span><span class=\"dl\">\"</span><span class=\"p\">))</span>\n<span class=\"p\">}</span>\n\n<span class=\"kd\">function</span> <span class=\"nx\">getMessageArray</span><span class=\"p\">(</span><span class=\"nx\">e</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n  <span class=\"kd\">const</span> <span class=\"nx\">num</span> <span class=\"o\">=</span> <span class=\"nx\">getNum</span><span class=\"p\">(</span><span class=\"nx\">e</span><span class=\"p\">);</span>\n  <span class=\"kd\">const</span> <span class=\"nx\">array</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n    <span class=\"nx\">getLoginUser</span><span class=\"p\">()</span> <span class=\"o\">+</span> <span class=\"s2\">`さんからのリクエストでランダムに </span><span class=\"se\">\\`</span><span class=\"p\">${</span><span class=\"nx\">num</span><span class=\"p\">}</span><span class=\"s2\">人</span><span class=\"se\">\\`</span><span class=\"s2\"> 選ばれました :tada:`</span><span class=\"p\">,</span>\n    <span class=\"dl\">\"\"</span><span class=\"p\">,</span>\n    <span class=\"dl\">\"</span><span class=\"s2\">```</span><span class=\"dl\">\"</span><span class=\"p\">,</span>\n    <span class=\"p\">...(</span><span class=\"nx\">getMember</span><span class=\"p\">(</span><span class=\"nx\">num</span><span class=\"p\">)),</span>\n    <span class=\"dl\">\"</span><span class=\"s2\">```</span><span class=\"dl\">\"</span><span class=\"p\">,</span>\n    <span class=\"dl\">\"\"</span><span class=\"p\">,</span>\n    <span class=\"dl\">\"</span><span class=\"s2\">ランチとか1on1とか楽しんできてください:+1::star:</span><span class=\"dl\">\"</span><span class=\"p\">,</span>\n  <span class=\"p\">];</span>\n\n  <span class=\"k\">return</span> <span class=\"nx\">array</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"kd\">function</span> <span class=\"nx\">postSlackMessage</span><span class=\"p\">(</span><span class=\"nx\">message</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n  <span class=\"kd\">var</span> <span class=\"nx\">postUrl</span> <span class=\"o\">=</span> <span class=\"dl\">'</span><span class=\"s1\">https://hooks.slack.com/services/BBBBB/XXXX/????????</span><span class=\"dl\">'</span><span class=\"p\">;</span> <span class=\"c1\">// webhookurlは自分のチャンネルで取得してください</span>\n  <span class=\"kd\">var</span> <span class=\"nx\">username</span> <span class=\"o\">=</span> <span class=\"dl\">'</span><span class=\"s1\">Choice BOT</span><span class=\"dl\">'</span><span class=\"p\">;</span>\n  <span class=\"kd\">var</span> <span class=\"nx\">icon</span> <span class=\"o\">=</span> <span class=\"dl\">'</span><span class=\"s1\">:slightly_smiling_face:</span><span class=\"dl\">'</span><span class=\"p\">;</span>\n\n  <span class=\"kd\">var</span> <span class=\"nx\">jsonData</span> <span class=\"o\">=</span>\n  <span class=\"p\">{</span>\n     <span class=\"dl\">\"</span><span class=\"s2\">username</span><span class=\"dl\">\"</span> <span class=\"p\">:</span> <span class=\"nx\">username</span><span class=\"p\">,</span>\n     <span class=\"dl\">\"</span><span class=\"s2\">icon_emoji</span><span class=\"dl\">\"</span><span class=\"p\">:</span> <span class=\"nx\">icon</span><span class=\"p\">,</span>\n     <span class=\"dl\">\"</span><span class=\"s2\">text</span><span class=\"dl\">\"</span> <span class=\"p\">:</span> <span class=\"nx\">message</span>\n  <span class=\"p\">};</span>\n  <span class=\"kd\">var</span> <span class=\"nx\">payload</span> <span class=\"o\">=</span> <span class=\"nx\">JSON</span><span class=\"p\">.</span><span class=\"nx\">stringify</span><span class=\"p\">(</span><span class=\"nx\">jsonData</span><span class=\"p\">);</span>\n\n  <span class=\"kd\">var</span> <span class=\"nx\">options</span> <span class=\"o\">=</span>\n  <span class=\"p\">{</span>\n    <span class=\"dl\">\"</span><span class=\"s2\">method</span><span class=\"dl\">\"</span> <span class=\"p\">:</span> <span class=\"dl\">\"</span><span class=\"s2\">post</span><span class=\"dl\">\"</span><span class=\"p\">,</span>\n    <span class=\"dl\">\"</span><span class=\"s2\">contentType</span><span class=\"dl\">\"</span> <span class=\"p\">:</span> <span class=\"dl\">\"</span><span class=\"s2\">application/json</span><span class=\"dl\">\"</span><span class=\"p\">,</span>\n    <span class=\"dl\">\"</span><span class=\"s2\">payload</span><span class=\"dl\">\"</span> <span class=\"p\">:</span> <span class=\"nx\">payload</span>\n  <span class=\"p\">};</span>\n\n  <span class=\"nx\">UrlFetchApp</span><span class=\"p\">.</span><span class=\"nx\">fetch</span><span class=\"p\">(</span><span class=\"nx\">postUrl</span><span class=\"p\">,</span> <span class=\"nx\">options</span><span class=\"p\">);</span>\n<span class=\"p\">}</span>\n\n<span class=\"cm\">/**\n * memberを指定の数だけ返す\n */</span>\n<span class=\"kd\">function</span> <span class=\"nx\">getMember</span><span class=\"p\">(</span><span class=\"nx\">num</span><span class=\"p\">){</span>\n  <span class=\"kd\">const</span> <span class=\"nx\">member</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n    <span class=\"dl\">'</span><span class=\"s1\">Aさん</span><span class=\"dl\">'</span><span class=\"p\">,</span>\n    <span class=\"dl\">'</span><span class=\"s1\">Bさん</span><span class=\"dl\">'</span><span class=\"p\">,</span>\n    <span class=\"dl\">'</span><span class=\"s1\">Cさん</span><span class=\"dl\">'</span>\n  <span class=\"p\">];</span>\n\n  <span class=\"k\">return</span> <span class=\"nx\">shuffle</span><span class=\"p\">(</span><span class=\"nx\">member</span><span class=\"p\">).</span><span class=\"nx\">slice</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"nx\">num</span><span class=\"p\">);</span>\n<span class=\"p\">}</span>\n\n<span class=\"cm\">/**\n * 何人にするか\n * 基本は1人\n * @return number\n */</span>\n<span class=\"kd\">function</span> <span class=\"nx\">getNum</span><span class=\"p\">(</span><span class=\"nx\">e</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n  <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"o\">!</span><span class=\"nx\">e</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">return</span> <span class=\"mi\">1</span><span class=\"p\">;</span>\n  <span class=\"p\">}</span>\n\n  <span class=\"kd\">const</span> <span class=\"nx\">num</span> <span class=\"o\">=</span> <span class=\"nb\">parseInt</span><span class=\"p\">(</span><span class=\"nx\">e</span><span class=\"p\">.</span><span class=\"nx\">parameter</span><span class=\"p\">.</span><span class=\"nx\">num</span><span class=\"p\">);</span>\n\n  <span class=\"k\">return</span> <span class=\"nb\">isNaN</span><span class=\"p\">(</span><span class=\"nx\">num</span><span class=\"p\">)</span> <span class=\"p\">?</span> <span class=\"mi\">1</span> <span class=\"p\">:</span> <span class=\"nx\">num</span><span class=\"p\">;</span> \n<span class=\"p\">}</span>\n\n<span class=\"cm\">/**\n * ログインユーザーのアドレスを確認して弊社社員か確認する\n */</span>\n<span class=\"kd\">function</span> <span class=\"nx\">isOurGsuiteUser</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n  <span class=\"kd\">const</span> <span class=\"nx\">user</span> <span class=\"o\">=</span> <span class=\"nx\">Session</span><span class=\"p\">.</span><span class=\"nx\">getActiveUser</span><span class=\"p\">();</span>\n  <span class=\"kd\">const</span> <span class=\"nx\">email</span> <span class=\"o\">=</span> <span class=\"nx\">user</span><span class=\"p\">.</span><span class=\"nx\">getEmail</span><span class=\"p\">();</span>\n\n  <span class=\"k\">return</span> <span class=\"nx\">email</span> <span class=\"o\">&amp;&amp;</span> <span class=\"nx\">email</span><span class=\"p\">.</span><span class=\"nx\">split</span><span class=\"p\">(</span><span class=\"dl\">\"</span><span class=\"s2\">@</span><span class=\"dl\">\"</span><span class=\"p\">)</span> <span class=\"o\">&amp;&amp;</span> <span class=\"nx\">email</span><span class=\"p\">.</span><span class=\"nx\">split</span><span class=\"p\">(</span><span class=\"dl\">\"</span><span class=\"s2\">@</span><span class=\"dl\">\"</span><span class=\"p\">)[</span><span class=\"mi\">1</span><span class=\"p\">]</span> <span class=\"o\">===</span> <span class=\"dl\">\"</span><span class=\"s2\">gmail.com</span><span class=\"dl\">\"</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"cm\">/**\n * ログインユーザーを取得\n * return Sting\n */</span>\n<span class=\"kd\">function</span> <span class=\"nx\">getLoginUser</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n  <span class=\"kd\">const</span> <span class=\"nx\">user</span> <span class=\"o\">=</span> <span class=\"nx\">Session</span><span class=\"p\">.</span><span class=\"nx\">getActiveUser</span><span class=\"p\">();</span>\n  <span class=\"kd\">const</span> <span class=\"nx\">email</span> <span class=\"o\">=</span> <span class=\"nx\">user</span><span class=\"p\">.</span><span class=\"nx\">getEmail</span><span class=\"p\">();</span>\n\n  <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"nx\">email</span> <span class=\"o\">&amp;&amp;</span> <span class=\"nx\">email</span><span class=\"p\">.</span><span class=\"nx\">split</span><span class=\"p\">(</span><span class=\"dl\">\"</span><span class=\"s2\">@</span><span class=\"dl\">\"</span><span class=\"p\">)</span> <span class=\"o\">&amp;&amp;</span> <span class=\"nx\">email</span><span class=\"p\">.</span><span class=\"nx\">split</span><span class=\"p\">(</span><span class=\"dl\">\"</span><span class=\"s2\">@</span><span class=\"dl\">\"</span><span class=\"p\">)[</span><span class=\"mi\">0</span><span class=\"p\">])</span> <span class=\"p\">{</span>\n    <span class=\"k\">return</span> <span class=\"nx\">email</span><span class=\"p\">.</span><span class=\"nx\">split</span><span class=\"p\">(</span><span class=\"dl\">\"</span><span class=\"s2\">@</span><span class=\"dl\">\"</span><span class=\"p\">)[</span><span class=\"mi\">0</span><span class=\"p\">];</span>\n  <span class=\"p\">}</span>\n\n  <span class=\"k\">return</span> <span class=\"dl\">\"</span><span class=\"s2\">Who??</span><span class=\"dl\">\"</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n\n<span class=\"cm\">/**\n * responceのラッパーにしようとしている\n */</span>\n<span class=\"kd\">function</span> <span class=\"nx\">resText</span><span class=\"p\">(</span><span class=\"nx\">text</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n  <span class=\"k\">return</span> <span class=\"nx\">ContentService</span><span class=\"p\">.</span><span class=\"nx\">createTextOutput</span><span class=\"p\">(</span><span class=\"nx\">text</span><span class=\"p\">)</span>\n<span class=\"p\">}</span>\n\n\n<span class=\"cm\">/**\n * 配列をシャッフルする\n */</span>\n<span class=\"kd\">function</span> <span class=\"nx\">shuffle</span><span class=\"p\">(</span><span class=\"nx\">array</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n  <span class=\"k\">for</span> <span class=\"p\">(</span><span class=\"kd\">let</span> <span class=\"nx\">i</span> <span class=\"o\">=</span> <span class=\"nx\">array</span><span class=\"p\">.</span><span class=\"nx\">length</span> <span class=\"o\">-</span> <span class=\"mi\">1</span><span class=\"p\">;</span> <span class=\"nx\">i</span> <span class=\"o\">&gt;=</span> <span class=\"mi\">0</span><span class=\"p\">;</span> <span class=\"nx\">i</span><span class=\"o\">--</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"kd\">const</span> <span class=\"nx\">j</span> <span class=\"o\">=</span> <span class=\"nb\">Math</span><span class=\"p\">.</span><span class=\"nx\">floor</span><span class=\"p\">(</span><span class=\"nb\">Math</span><span class=\"p\">.</span><span class=\"nx\">random</span><span class=\"p\">()</span> <span class=\"o\">*</span> <span class=\"p\">(</span><span class=\"nx\">i</span> <span class=\"o\">+</span> <span class=\"mi\">1</span><span class=\"p\">));</span>\n    <span class=\"p\">[</span><span class=\"nx\">array</span><span class=\"p\">[</span><span class=\"nx\">i</span><span class=\"p\">],</span> <span class=\"nx\">array</span><span class=\"p\">[</span><span class=\"nx\">j</span><span class=\"p\">]]</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"nx\">array</span><span class=\"p\">[</span><span class=\"nx\">j</span><span class=\"p\">],</span> <span class=\"nx\">array</span><span class=\"p\">[</span><span class=\"nx\">i</span><span class=\"p\">]];</span>\n  <span class=\"p\">}</span>\n\n  <span class=\"k\">return</span> <span class=\"nx\">array</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n</code></pre></div></div>\n","body":"\n\n\n![スクリーンショット 2020-12-28 2.10.22.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/112929/8f90e8a8-454e-8e70-e817-3c46a6435f05.png)\n\n以下のようなURLをクリックするだけで、規定の配列から何人か選んでくれる。\n\n```\nhttps://script.google.com/macros/s/XXXXX-XXXX/exec\nhttps://script.google.com/macros/s/XXXXX-XXXX/exec?num=2\nhttps://script.google.com/macros/s/XXXXX-XXXX/exec?num=3\nhttps://script.google.com/macros/s/XXXXX-XXXX/exec?num=4\n```\n\n以下のようなスクリプトをGASにいれて、Webアプリケーションとして公開したらOK\n\n```js\nfunction doGet(e) {\n  if(!isOurGsuiteUser()) {\n    return resText(\"ログインアドレスが違います\");\n  }\n\n  postSlackMessage(getMessageArray(e).join(\"\\n\"));\n\n  return resText(\"OK!\");\n}\n\nfunction testSlack() {\n  const array = getMessageArray();\n\n  postSlackMessage(array.join(\"\\n\"))\n}\n\nfunction getMessageArray(e) {\n  const num = getNum(e);\n  const array = [\n    getLoginUser() + `さんからのリクエストでランダムに \\`${num}人\\` 選ばれました :tada:`,\n    \"\",\n    \"```\",\n    ...(getMember(num)),\n    \"```\",\n    \"\",\n    \"ランチとか1on1とか楽しんできてください:+1::star:\",\n  ];\n  \n  return array;\n}\n\nfunction postSlackMessage(message) {\n  var postUrl = 'https://hooks.slack.com/services/BBBBB/XXXX/????????'; // webhookurlは自分のチャンネルで取得してください\n  var username = 'Choice BOT';\n  var icon = ':slightly_smiling_face:';\n\n  var jsonData =\n  {\n     \"username\" : username,\n     \"icon_emoji\": icon,\n     \"text\" : message\n  };\n  var payload = JSON.stringify(jsonData);\n\n  var options =\n  {\n    \"method\" : \"post\",\n    \"contentType\" : \"application/json\",\n    \"payload\" : payload\n  };\n\n  UrlFetchApp.fetch(postUrl, options);\n}\n\n/**\n * memberを指定の数だけ返す\n */\nfunction getMember(num){\n  const member = [\n    'Aさん',\n    'Bさん',\n    'Cさん'\n  ];\n\n  return shuffle(member).slice(0,num);\n}\n\n/**\n * 何人にするか\n * 基本は1人\n * @return number\n */\nfunction getNum(e) {\n  if (!e) {\n    return 1;\n  }\n\n  const num = parseInt(e.parameter.num);\n\n  return isNaN(num) ? 1 : num; \n}\n\n/**\n * ログインユーザーのアドレスを確認して弊社社員か確認する\n */\nfunction isOurGsuiteUser() {\n  const user = Session.getActiveUser();\n  const email = user.getEmail();\n\n  return email && email.split(\"@\") && email.split(\"@\")[1] === \"gmail.com\";\n}\n\n/**\n * ログインユーザーを取得\n * return Sting\n */\nfunction getLoginUser() {\n  const user = Session.getActiveUser();\n  const email = user.getEmail();\n\n  if (email && email.split(\"@\") && email.split(\"@\")[0]) {\n    return email.split(\"@\")[0];\n  }\n\n  return \"Who??\";\n}\n\n\n/**\n * responceのラッパーにしようとしている\n */\nfunction resText(text) {\n  return ContentService.createTextOutput(text)\n}\n\n\n/**\n * 配列をシャッフルする\n */\nfunction shuffle(array) {\n  for (let i = array.length - 1; i >= 0; i--) {\n    const j = Math.floor(Math.random() * (i + 1));\n    [array[i], array[j]] = [array[j], array[i]];\n  }\n\n  return array;\n}\n\n```\n","coediting":false,"comments_count":0,"created_at":"2020-12-28T02:13:59+09:00","group":null,"id":"11479365b0280a6aaeca","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"JavaScript","versions":[]},{"name":"gas","versions":[]},{"name":"Slack","versions":[]}],"title":"ランチメンバーをランダムでいい感じに選ぶGASスクリプト","updated_at":"2020-12-28T02:13:59+09:00","url":"https://qiita.com/ykhirao/items/11479365b0280a6aaeca","user":{"description":"Web Developer For 6 years.\r\nPHP/Laravel && (React OR Vue.js)\r\nTypeScript/node.js\r\n\r\n業務委託の依頼とかはWantedlyとかからでお願いします！","facebook_id":"","followees_count":38,"followers_count":95,"github_login_name":"ykhirao","id":"ykhirao","items_count":59,"linkedin_id":"","location":"Tokyo, Japan","name":"yk","organization":"","permanent_id":112929,"profile_image_url":"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/112929/profile-images/1639030792","team_only":false,"twitter_screen_name":"yk_hirao","website_url":"https://www.wantedly.com/id/ykhirao"},"page_views_count":null,"team_membership":null}},"path":"posts/11479365b0280a6aaeca"}
