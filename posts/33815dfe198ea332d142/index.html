<!DOCTYPE html><html lang="en"><head><meta name="generator" content="React Static"/><meta charSet="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, shrink-to-fit=no"/><link rel="preload" as="script" href="/templates/styles.9da399bc.js"/><link rel="preload" as="script" href="/templates/vendors~main.50f3f31b.js"/><link rel="preload" as="script" href="/main.62ec0c15.js"/><link rel="preload" as="style" href="/styles.1048b661.css"/><link rel="stylesheet" href="/styles.1048b661.css"/><link rel="shortcut icon" href="/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="48x48" href="/favicon-48x48.png"/><link rel="manifest" href="/manifest.json"/><meta name="mobile-web-app-capable" content="yes"/><meta name="theme-color" content="#fff"/><meta name="application-name"/><link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png"/><link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png"/><link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png"/><link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png"/><link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png"/><link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png"/><link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png"/><link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png"/><link rel="apple-touch-icon" sizes="167x167" href="/apple-touch-icon-167x167.png"/><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png"/><link rel="apple-touch-icon" sizes="1024x1024" href="/apple-touch-icon-1024x1024.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/><meta name="apple-mobile-web-app-title"/><link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-640x1136.png"/><link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-750x1334.png"/><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-828x1792.png"/><link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/apple-touch-startup-image-1125x2436.png"/><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/apple-touch-startup-image-1242x2208.png"/><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/apple-touch-startup-image-1242x2688.png"/><link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-1536x2048.png"/><link rel="apple-touch-startup-image" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-1668x2224.png"/><link rel="apple-touch-startup-image" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-1668x2388.png"/><link rel="apple-touch-startup-image" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-2048x2732.png"/><link rel="apple-touch-startup-image" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-1620x2160.png"/><link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-1136x640.png"/><link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-1334x750.png"/><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-1792x828.png"/><link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="/apple-touch-startup-image-2436x1125.png"/><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="/apple-touch-startup-image-2208x1242.png"/><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="/apple-touch-startup-image-2688x1242.png"/><link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-2048x1536.png"/><link rel="apple-touch-startup-image" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-2224x1668.png"/><link rel="apple-touch-startup-image" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-2388x1668.png"/><link rel="apple-touch-startup-image" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-2732x2048.png"/><link rel="apple-touch-startup-image" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-2160x1620.png"/><link rel="icon" type="image/png" sizes="228x228" href="/coast-228x228.png"/><meta name="msapplication-TileColor" content="#fff"/><meta name="msapplication-TileImage" content="/mstile-144x144.png"/><meta name="msapplication-config" content="/browserconfig.xml"/><link rel="yandex-tableau-widget" href="/yandex-browser-manifest.json"/></head><body><div id="root"><div style="outline:none" tabindex="-1"><nav class="navbar is-dark is-fixed-top" role="navigation" aria-label="main navigation"><div class="container"><div class="navbar-brand"><a class="navbar-item" href="/">Home</a><a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false"><span aria-hidden="true"></span><span aria-hidden="true"></span><span aria-hidden="true"></span></a></div><div id="navbarBasicExample" class="navbar-menu "><div class="navbar-start"><a class="navbar-item" href="/posts">Posts</a><a class="navbar-item" href="/events">Events</a><a class="navbar-item" href="/github">GitHub</a></div></div></div></nav><div class="container"><div class="is-primary" style="padding:4.5rem 0.5rem"><div style="outline:none" tabindex="-1"><div><a href="/posts">&lt;<!-- --> Back</a><br/><h3>画像をアップロード前に圧縮する流行りの方法【Vue.js x Firebase x 令和】</h3><article class="md-body"><p>こんにちは。年末年始はずっとFirebaseを触っていました <a href="/ykhirao" class="user-mention js-hovercard" title="ykhirao" data-hovercard-target-type="user" data-hovercard-target-name="ykhirao">@ykhirao</a> です。たぶん3年くらい遅れて流行に乗り始めています。Typescriptお正月にはじめました。</p>

<p>今日は、仕事がお休みなのでスマホぽちぽちしていたらすごく参考になる記事を見かけましたのですが、こちらの記事 <a href="https://tech.appbrew.io/entry/2020/01/15/120000" rel="nofollow noopener" target="_blank">Firebaseで作る！リアルタイム画像変換CDN【Firebase Hosting + Cloud Functions】 - AppBrew Tech Blog</a> で書かれている <code>アップロードされた画像をそのまま表示する時代は平成とともに終わりを告げたわけですが[※要出典]</code> という文言を見てくすっと笑ってしまい、少し前に <a href="https://qiita.com/hecateball/items/c55b6811835923fb9574">君はまだ平成のアーキテクチャを使ってるのか？僕はFirebaseと令和の時代に行くぞ。</a> という記事がたくさんの方に読まれていたこととか、Twitterの擬人化された <a href="https://twitter.com/search?q=%23%E4%BB%A4%E5%92%8C%E3%81%A1%E3%82%83%E3%82%93" rel="nofollow noopener" target="_blank">#令和ちゃん</a> を思い出したりして、エンジニアのみなさんは令和ちゃんもFirebaseも大好きっぽいので私も記事を書こうかなーーと思って書き始めました。ネタなんだけど誰かの役にたつ記事を書きたい次第です。</p>

<p>さて前置きが長くなりましたが、本文は、画像をアップロードする前にゴリッと処理する方法を書いて行きます。</p>

<h1>
<span id="画像をアップロード前に圧縮する流行りの方法" class="fragment"></span><a href="#%E7%94%BB%E5%83%8F%E3%82%92%E3%82%A2%E3%83%83%E3%83%97%E3%83%AD%E3%83%BC%E3%83%89%E5%89%8D%E3%81%AB%E5%9C%A7%E7%B8%AE%E3%81%99%E3%82%8B%E6%B5%81%E8%A1%8C%E3%82%8A%E3%81%AE%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>画像をアップロード前に圧縮する流行りの方法</h1>

<h2>
<span id="今回紹介することしないこと" class="fragment"></span><a href="#%E4%BB%8A%E5%9B%9E%E7%B4%B9%E4%BB%8B%E3%81%99%E3%82%8B%E3%81%93%E3%81%A8%E3%81%97%E3%81%AA%E3%81%84%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>今回紹介すること、しないこと</h2>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><code># 画像アップロードについての手法

1. 画像処理をしない(平成)

2. 画像処理をする(令和)
  - 2.1 サーバーで処理する (https://tech.appbrew.io/entry/2020/01/15/120000 で紹介されている)
    - Firebase Extension（まだβっぽいですが公式の拡張があるっぽい！）
    - CloudFunctionsを自分でNode.JSごりごり書く
  - 2.2 クライアント側で処理する( &lt;---- 今日の記事はここ！！！)
</code></pre></div></div>

<h2>
<span id="本文いらないからスクショとかgistみたいひと" class="fragment"></span><a href="#%E6%9C%AC%E6%96%87%E3%81%84%E3%82%89%E3%81%AA%E3%81%84%E3%81%8B%E3%82%89%E3%82%B9%E3%82%AF%E3%82%B7%E3%83%A7%E3%81%A8%E3%81%8Bgist%E3%81%BF%E3%81%9F%E3%81%84%E3%81%B2%E3%81%A8"><i class="fa fa-link"></i></a>本文いらないからスクショとかGistみたいひと</h2>

<p>以下のスクショのようになるGistはこちら<br>
<a href="https://gist.github.com/ykhirao/1d36aeca9abb02709cc9dd3d676040ef" class="autolink" rel="nofollow noopener" target="_blank">https://gist.github.com/ykhirao/1d36aeca9abb02709cc9dd3d676040ef</a></p>

<p><a href="https://camo.qiitausercontent.com/6b6c597a98d947ee94c260fa4d55bd4436205254/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3131323932392f62313533373531372d656334342d663962302d336632342d3066393962376365613434612e706e67" target="_blank" rel="nofollow noopener"><img width="1672" alt="スクリーンショット 2020-01-16 13.32.29.png" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F112929%2Fb1537517-ec44-f9b0-3f24-0f99b7cea44a.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=69b617e8b6520c467cfa27db3dd124bb" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/112929/b1537517-ec44-f9b0-3f24-0f99b7cea44a.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F112929%2Fb1537517-ec44-f9b0-3f24-0f99b7cea44a.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=5ccaf52e4a792a625b9688b420bd8c1b 1x" loading="lazy"></a></p>

<p><a href="https://camo.qiitausercontent.com/affbbab7aafe55e01f7105f920d83748d3a2df4f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3131323932392f64366437663039642d666463362d343739612d336639362d3765396137313236306265322e706e67" target="_blank" rel="nofollow noopener"><img width="1330" alt="スクリーンショット 2020-01-16 14.17.23.png" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F112929%2Fd6d7f09d-fdc6-479a-3f96-7e9a71260be2.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=1570a6f782c256deaa732bd20c2fb778" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/112929/d6d7f09d-fdc6-479a-3f96-7e9a71260be2.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F112929%2Fd6d7f09d-fdc6-479a-3f96-7e9a71260be2.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=e34da2ce6e6f65476da3ca294eaa1aa1 1x" loading="lazy"></a></p>

<p>(最大 100x100 px にしているので2kbくらい)</p>

<h2>
<span id="処理して簡単に解説する" class="fragment"></span><a href="#%E5%87%A6%E7%90%86%E3%81%97%E3%81%A6%E7%B0%A1%E5%8D%98%E3%81%AB%E8%A7%A3%E8%AA%AC%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>処理して簡単に解説する</h2>

<p><a href="https://qiita.com/komakomako/items/8efd4184f6d7cf1363f2" id="reference-70c300a4799183af61fb">Canvasでごりっと処理する</a>とか、ライブラリに頼るとか方法はあると思いますが今回は <a href="https://github.com/fengyuanchen/compressorjs" rel="nofollow noopener" target="_blank">compressorjs</a> を紹介したいっす。</p>

<div class="code-frame" data-lang="javascript">
<div class="code-lang"><span class="bold">component.js</span></div>
<div class="highlight"><pre><code><span class="k">import</span> <span class="nx">Compressor</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">compressorjs</span><span class="dl">'</span>
</code></pre></div>
</div>

<p>OR</p>

<div class="code-frame" data-lang="html">
<div class="code-lang"><span class="bold">index.html</span></div>
<div class="highlight"><pre><code><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://cdn.jsdelivr.net/gh/fengyuanchen/compressorjs/dist/compressor.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
</code></pre></div>
</div>

<p>CDNはなかなか見つからなかったのですがぐぐったら <a href="https://paiza.hatenablog.com/entry/2019/04/03/%E7%94%BB%E5%83%8F%E5%9C%A7%E7%B8%AE%E3%82%84%E3%82%AA%E3%83%BC%E3%83%88%E3%82%B3%E3%83%B3%E3%83%97%E3%83%AA%E3%83%BC%E3%83%88%E3%81%AA%E3%81%A9Web%E9%96%8B%E7%99%BA%E3%82%92%E7%B0%A1%E5%8D%98%E3%81%AB" rel="nofollow noopener" target="_blank">このブログ</a> で見つかった。まさとらんさんありがとうです。</p>

<p>画像は <code>input</code> タグで選択してもらって</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><code><span class="o">&lt;</span><span class="nx">input</span>
  <span class="nx">type</span><span class="o">=</span><span class="dl">"</span><span class="s2">file</span><span class="dl">"</span>
  <span class="nx">id</span><span class="o">=</span><span class="dl">"</span><span class="s2">file</span><span class="dl">"</span>
  <span class="nx">multiple</span>
  <span class="nx">accept</span><span class="o">=</span><span class="dl">"</span><span class="s2">image/*</span><span class="dl">"</span>
  <span class="p">@</span><span class="nd">change</span><span class="o">=</span><span class="dl">"</span><span class="s2">handleFiles</span><span class="dl">"</span>
<span class="o">/&gt;</span>
</code></pre></div></div>

<p><code>multiple</code> で複数選択可にして <code>accept</code> で画像以外を一応弾いています。それで <code>@change</code> イベントのフックで画像を圧縮しています。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><code><span class="nx">handleFiles</span><span class="p">(</span><span class="nx">e</span><span class="p">:</span> <span class="nx">Event</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">images</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">images</span>
  <span class="kd">const</span> <span class="nx">files</span><span class="p">:</span> <span class="nx">FileList</span> <span class="o">|</span> <span class="kc">null</span> <span class="o">=</span> <span class="p">(</span><span class="o">&lt;</span><span class="nx">HTMLInputElement</span><span class="o">&gt;</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">).</span><span class="nx">files</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">files</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="k">return</span>
  <span class="p">;[...</span><span class="nx">files</span><span class="p">].</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">file</span><span class="p">:</span> <span class="nx">File</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// 複数ファイルを受け入れているので、この中で処理している</span>
  <span class="p">})</span>
<span class="p">}</span>
</code></pre></div></div>

<p>複数処理やfileが取得できなかった場合の処理は上のような感じで、Typescript的にエラーが出ていないのでこれでOKかなと思ってます（認識あってますか？）</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><code><span class="kd">const</span> <span class="nx">payload</span><span class="p">:</span> <span class="nx">Compressor</span><span class="p">.</span><span class="nx">Options</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">quality</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">,</span>
  <span class="na">maxWidth</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
  <span class="na">maxHeight</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
  <span class="na">mimeType</span><span class="p">:</span> <span class="dl">'</span><span class="s1">image/jpeg</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">success</span><span class="p">(</span><span class="na">blob</span><span class="p">:</span> <span class="nx">Blob</span><span class="p">):</span> <span class="k">void</span> <span class="p">{</span>
    <span class="c1">// ここに成功時の処理を書く。次。</span>
  <span class="p">},</span>
  <span class="nx">error</span><span class="p">(</span><span class="na">err</span><span class="p">:</span> <span class="nb">Error</span><span class="p">):</span> <span class="k">void</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="k">new</span> <span class="nx">Compressor</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">payload</span><span class="p">)</span>
</code></pre></div></div>

<p>実際の処理はこんな感じで横幅・縦幅の最大とか圧縮率とかたくさんの <a href="https://github.com/fengyuanchen/compressorjs/blob/master/README.md#options" rel="nofollow noopener" target="_blank">オプション</a> があります。また成功時と失敗時は <code>success</code> と <code>error</code> のコールバックに書くみたいです。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><code><span class="nx">success</span><span class="p">(</span><span class="nx">blob</span><span class="p">:</span> <span class="nx">Blob</span><span class="p">):</span> <span class="k">void</span> <span class="p">{</span>
<span class="p">},</span>

</code></pre></div></div>

<p>サクセスのコールバックは <code>Blob</code> を受け取るのでFirebaseではこの段階でファイルのアップロードができます！！！<a href="https://firebase.google.com/docs/storage/web/upload-files?hl=ja#upload_from_a_blob_or_file" rel="nofollow noopener" target="_blank">ドキュメントはこちら。</a>  Blobからアップロードできるとかすごくいいですね。(試してないけどたぶんそちらでUploadできる)</p>

<p>今回はアップロードする前に読み込みを確認したかったので、DataUrlという形式に変換しています。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><code><span class="nx">success</span><span class="p">(</span><span class="nx">blob</span><span class="p">:</span> <span class="nx">Blob</span><span class="p">):</span> <span class="k">void</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">reader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FileReader</span><span class="p">()</span>
  <span class="nx">reader</span><span class="p">.</span><span class="nx">onloadend</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="o">&lt;</span><span class="nx">string</span> <span class="o">|</span> <span class="nb">ArrayBuffer</span> <span class="o">|</span> <span class="kc">null</span><span class="o">&gt;</span><span class="nx">reader</span><span class="p">.</span><span class="nx">result</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">result</span> <span class="k">instanceof</span> <span class="nb">ArrayBuffer</span> <span class="o">||</span> <span class="nx">result</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="k">return</span>
    <span class="nx">images</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="nx">reader</span><span class="p">.</span><span class="nx">readAsDataURL</span><span class="p">(</span><span class="nx">blob</span><span class="p">)</span>
<span class="p">},</span>
</code></pre></div></div>

<p><code>images.push(result)</code> する段階でDataUrlという形式の <code>data:image/jpeg;base64,XXXXXXXX</code>みたいな文字列になっています。<a href="https://firebase.google.com/docs/storage/web/upload-files?hl=ja#upload_from_a_string" rel="nofollow noopener" target="_blank">ドキュメントの文字列からアップロードする</a>を見ると</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><code><span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">data:text/plain;base64,5b6p5Y+344GX44G+44GX44Gf77yB44GK44KB44Gn44Go44GG77yB</span><span class="dl">'</span><span class="p">;</span>
<span class="nx">ref</span><span class="p">.</span><span class="nx">putString</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="dl">'</span><span class="s1">data_url</span><span class="dl">'</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">snapshot</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Uploaded a data_url string!</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div>

<p>これでアップロードできそうですね。</p>

<p>ドキュメントを読むと <code>data:text/plain;base64,</code> という文字列を削除したら ref.putString(message, 'base64url')でアップロードできそうです。たぶん。</p>

<p>サンプルファイルは <code>&lt;script lang="ts"&gt;</code> にしているのでVSCodeでひらいて、 <code>CMD + Click</code> とかで定義元とか飛んで行って自分で触ってみてください！！</p>

<p><a href="https://camo.qiitausercontent.com/1727be86da44b5cc85c2dbae435f1b31f2af6e04/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3131323932392f38643038333739662d323139322d626266312d386238342d6437323764373361623237622e706e67" target="_blank" rel="nofollow noopener"><img width="659" alt="スクリーンショット 2020-01-16 14.09.43.png" src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F112929%2F8d08379f-2192-bbf1-8b84-d727d73ab27b.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=c089a54495a050d153c48ddf100f248e" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/112929/8d08379f-2192-bbf1-8b84-d727d73ab27b.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F112929%2F8d08379f-2192-bbf1-8b84-d727d73ab27b.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=14f8e46852d921d15bfacf5512470bfe 1x" loading="lazy"></a></p>

<h2>
<span id="終わりに" class="fragment"></span><a href="#%E7%B5%82%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>終わりに</h2>

<p>ブラウザのAPIを叩くときにTypeScriptすごく開発体験良かったです。MDNを見に行かなくても何が返ってくるかわかるので、null制御とかそういうのがやりやすかったです。コード書いてて楽しかった。</p>

<p>なにか間違い見つけたら編集リクエストください！！！</p>

<p>最後まで読んでいただきありがとうございます。！！</p>
</article></div></div></div></div><footer class="footer"><div class="content has-text-centered"><p>This web site was created by ykhirao using react-static. <a href="https://github.com/ykhirao/ykhirao.github.io" target="_blank" rel="noopener noreferrer">Here</a> is the link to the GitHub repository.</p><p>© 2021 ykhirao</p></div></footer></div></div><script type="text/javascript">window.__routeInfo = JSON.parse("{\"template\":\"__react_static_root__/src/components/QiitaPost\",\"sharedHashesByProp\":{},\"data\":{\"post\":{\"rendered_body\":\"<p>\u3053\u3093\u306B\u3061\u306F\u3002\u5E74\u672B\u5E74\u59CB\u306F\u305A\u3063\u3068Firebase\u3092\u89E6\u3063\u3066\u3044\u307E\u3057\u305F <a href=\\\"/ykhirao\\\" class=\\\"user-mention js-hovercard\\\" title=\\\"ykhirao\\\" data-hovercard-target-type=\\\"user\\\" data-hovercard-target-name=\\\"ykhirao\\\">@ykhirao</a> \u3067\u3059\u3002\u305F\u3076\u30933\u5E74\u304F\u3089\u3044\u9045\u308C\u3066\u6D41\u884C\u306B\u4E57\u308A\u59CB\u3081\u3066\u3044\u307E\u3059\u3002Typescript\u304A\u6B63\u6708\u306B\u306F\u3058\u3081\u307E\u3057\u305F\u3002</p>\\n\\n<p>\u4ECA\u65E5\u306F\u3001\u4ED5\u4E8B\u304C\u304A\u4F11\u307F\u306A\u306E\u3067\u30B9\u30DE\u30DB\u307D\u3061\u307D\u3061\u3057\u3066\u3044\u305F\u3089\u3059\u3054\u304F\u53C2\u8003\u306B\u306A\u308B\u8A18\u4E8B\u3092\u898B\u304B\u3051\u307E\u3057\u305F\u306E\u3067\u3059\u304C\u3001\u3053\u3061\u3089\u306E\u8A18\u4E8B <a href=\\\"https://tech.appbrew.io/entry/2020/01/15/120000\\\" rel=\\\"nofollow noopener\\\" target=\\\"_blank\\\">Firebase\u3067\u4F5C\u308B\uFF01\u30EA\u30A2\u30EB\u30BF\u30A4\u30E0\u753B\u50CF\u5909\u63DBCDN\u3010Firebase Hosting + Cloud Functions\u3011 - AppBrew Tech Blog</a> \u3067\u66F8\u304B\u308C\u3066\u3044\u308B <code>\u30A2\u30C3\u30D7\u30ED\u30FC\u30C9\u3055\u308C\u305F\u753B\u50CF\u3092\u305D\u306E\u307E\u307E\u8868\u793A\u3059\u308B\u6642\u4EE3\u306F\u5E73\u6210\u3068\u3068\u3082\u306B\u7D42\u308F\u308A\u3092\u544A\u3052\u305F\u308F\u3051\u3067\u3059\u304C[\u203B\u8981\u51FA\u5178]</code> \u3068\u3044\u3046\u6587\u8A00\u3092\u898B\u3066\u304F\u3059\u3063\u3068\u7B11\u3063\u3066\u3057\u307E\u3044\u3001\u5C11\u3057\u524D\u306B <a href=\\\"https://qiita.com/hecateball/items/c55b6811835923fb9574\\\">\u541B\u306F\u307E\u3060\u5E73\u6210\u306E\u30A2\u30FC\u30AD\u30C6\u30AF\u30C1\u30E3\u3092\u4F7F\u3063\u3066\u308B\u306E\u304B\uFF1F\u50D5\u306FFirebase\u3068\u4EE4\u548C\u306E\u6642\u4EE3\u306B\u884C\u304F\u305E\u3002</a> \u3068\u3044\u3046\u8A18\u4E8B\u304C\u305F\u304F\u3055\u3093\u306E\u65B9\u306B\u8AAD\u307E\u308C\u3066\u3044\u305F\u3053\u3068\u3068\u304B\u3001Twitter\u306E\u64EC\u4EBA\u5316\u3055\u308C\u305F <a href=\\\"https://twitter.com/search?q=%23%E4%BB%A4%E5%92%8C%E3%81%A1%E3%82%83%E3%82%93\\\" rel=\\\"nofollow noopener\\\" target=\\\"_blank\\\">#\u4EE4\u548C\u3061\u3083\u3093</a> \u3092\u601D\u3044\u51FA\u3057\u305F\u308A\u3057\u3066\u3001\u30A8\u30F3\u30B8\u30CB\u30A2\u306E\u307F\u306A\u3055\u3093\u306F\u4EE4\u548C\u3061\u3083\u3093\u3082Firebase\u3082\u5927\u597D\u304D\u3063\u307D\u3044\u306E\u3067\u79C1\u3082\u8A18\u4E8B\u3092\u66F8\u3053\u3046\u304B\u306A\u30FC\u30FC\u3068\u601D\u3063\u3066\u66F8\u304D\u59CB\u3081\u307E\u3057\u305F\u3002\u30CD\u30BF\u306A\u3093\u3060\u3051\u3069\u8AB0\u304B\u306E\u5F79\u306B\u305F\u3064\u8A18\u4E8B\u3092\u66F8\u304D\u305F\u3044\u6B21\u7B2C\u3067\u3059\u3002</p>\\n\\n<p>\u3055\u3066\u524D\u7F6E\u304D\u304C\u9577\u304F\u306A\u308A\u307E\u3057\u305F\u304C\u3001\u672C\u6587\u306F\u3001\u753B\u50CF\u3092\u30A2\u30C3\u30D7\u30ED\u30FC\u30C9\u3059\u308B\u524D\u306B\u30B4\u30EA\u30C3\u3068\u51E6\u7406\u3059\u308B\u65B9\u6CD5\u3092\u66F8\u3044\u3066\u884C\u304D\u307E\u3059\u3002</p>\\n\\n<h1>\\n<span id=\\\"\u753B\u50CF\u3092\u30A2\u30C3\u30D7\u30ED\u30FC\u30C9\u524D\u306B\u5727\u7E2E\u3059\u308B\u6D41\u884C\u308A\u306E\u65B9\u6CD5\\\" class=\\\"fragment\\\"></span><a href=\\\"#%E7%94%BB%E5%83%8F%E3%82%92%E3%82%A2%E3%83%83%E3%83%97%E3%83%AD%E3%83%BC%E3%83%89%E5%89%8D%E3%81%AB%E5%9C%A7%E7%B8%AE%E3%81%99%E3%82%8B%E6%B5%81%E8%A1%8C%E3%82%8A%E3%81%AE%E6%96%B9%E6%B3%95\\\"><i class=\\\"fa fa-link\\\"></i></a>\u753B\u50CF\u3092\u30A2\u30C3\u30D7\u30ED\u30FC\u30C9\u524D\u306B\u5727\u7E2E\u3059\u308B\u6D41\u884C\u308A\u306E\u65B9\u6CD5</h1>\\n\\n<h2>\\n<span id=\\\"\u4ECA\u56DE\u7D39\u4ECB\u3059\u308B\u3053\u3068\u3057\u306A\u3044\u3053\u3068\\\" class=\\\"fragment\\\"></span><a href=\\\"#%E4%BB%8A%E5%9B%9E%E7%B4%B9%E4%BB%8B%E3%81%99%E3%82%8B%E3%81%93%E3%81%A8%E3%81%97%E3%81%AA%E3%81%84%E3%81%93%E3%81%A8\\\"><i class=\\\"fa fa-link\\\"></i></a>\u4ECA\u56DE\u7D39\u4ECB\u3059\u308B\u3053\u3068\u3001\u3057\u306A\u3044\u3053\u3068</h2>\\n\\n<div class=\\\"code-frame\\\" data-lang=\\\"text\\\"><div class=\\\"highlight\\\"><pre><code># \u753B\u50CF\u30A2\u30C3\u30D7\u30ED\u30FC\u30C9\u306B\u3064\u3044\u3066\u306E\u624B\u6CD5\\n\\n1. \u753B\u50CF\u51E6\u7406\u3092\u3057\u306A\u3044(\u5E73\u6210)\\n\\n2. \u753B\u50CF\u51E6\u7406\u3092\u3059\u308B(\u4EE4\u548C)\\n  - 2.1 \u30B5\u30FC\u30D0\u30FC\u3067\u51E6\u7406\u3059\u308B (https://tech.appbrew.io/entry/2020/01/15/120000 \u3067\u7D39\u4ECB\u3055\u308C\u3066\u3044\u308B)\\n    - Firebase Extension\uFF08\u307E\u3060\u03B2\u3063\u307D\u3044\u3067\u3059\u304C\u516C\u5F0F\u306E\u62E1\u5F35\u304C\u3042\u308B\u3063\u307D\u3044\uFF01\uFF09\\n    - CloudFunctions\u3092\u81EA\u5206\u3067Node.JS\u3054\u308A\u3054\u308A\u66F8\u304F\\n  - 2.2 \u30AF\u30E9\u30A4\u30A2\u30F3\u30C8\u5074\u3067\u51E6\u7406\u3059\u308B( &lt;---- \u4ECA\u65E5\u306E\u8A18\u4E8B\u306F\u3053\u3053\uFF01\uFF01\uFF01)\\n</code></pre></div></div>\\n\\n<h2>\\n<span id=\\\"\u672C\u6587\u3044\u3089\u306A\u3044\u304B\u3089\u30B9\u30AF\u30B7\u30E7\u3068\u304Bgist\u307F\u305F\u3044\u3072\u3068\\\" class=\\\"fragment\\\"></span><a href=\\\"#%E6%9C%AC%E6%96%87%E3%81%84%E3%82%89%E3%81%AA%E3%81%84%E3%81%8B%E3%82%89%E3%82%B9%E3%82%AF%E3%82%B7%E3%83%A7%E3%81%A8%E3%81%8Bgist%E3%81%BF%E3%81%9F%E3%81%84%E3%81%B2%E3%81%A8\\\"><i class=\\\"fa fa-link\\\"></i></a>\u672C\u6587\u3044\u3089\u306A\u3044\u304B\u3089\u30B9\u30AF\u30B7\u30E7\u3068\u304BGist\u307F\u305F\u3044\u3072\u3068</h2>\\n\\n<p>\u4EE5\u4E0B\u306E\u30B9\u30AF\u30B7\u30E7\u306E\u3088\u3046\u306B\u306A\u308BGist\u306F\u3053\u3061\u3089<br>\\n<a href=\\\"https://gist.github.com/ykhirao/1d36aeca9abb02709cc9dd3d676040ef\\\" class=\\\"autolink\\\" rel=\\\"nofollow noopener\\\" target=\\\"_blank\\\">https://gist.github.com/ykhirao/1d36aeca9abb02709cc9dd3d676040ef</a></p>\\n\\n<p><a href=\\\"https://camo.qiitausercontent.com/6b6c597a98d947ee94c260fa4d55bd4436205254/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3131323932392f62313533373531372d656334342d663962302d336632342d3066393962376365613434612e706e67\\\" target=\\\"_blank\\\" rel=\\\"nofollow noopener\\\"><img width=\\\"1672\\\" alt=\\\"\u30B9\u30AF\u30EA\u30FC\u30F3\u30B7\u30E7\u30C3\u30C8 2020-01-16 13.32.29.png\\\" src=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F112929%2Fb1537517-ec44-f9b0-3f24-0f99b7cea44a.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=69b617e8b6520c467cfa27db3dd124bb\\\" data-canonical-src=\\\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/112929/b1537517-ec44-f9b0-3f24-0f99b7cea44a.png\\\" srcset=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F112929%2Fb1537517-ec44-f9b0-3f24-0f99b7cea44a.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=5ccaf52e4a792a625b9688b420bd8c1b 1x\\\" loading=\\\"lazy\\\"></a></p>\\n\\n<p><a href=\\\"https://camo.qiitausercontent.com/affbbab7aafe55e01f7105f920d83748d3a2df4f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3131323932392f64366437663039642d666463362d343739612d336639362d3765396137313236306265322e706e67\\\" target=\\\"_blank\\\" rel=\\\"nofollow noopener\\\"><img width=\\\"1330\\\" alt=\\\"\u30B9\u30AF\u30EA\u30FC\u30F3\u30B7\u30E7\u30C3\u30C8 2020-01-16 14.17.23.png\\\" src=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F112929%2Fd6d7f09d-fdc6-479a-3f96-7e9a71260be2.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=1570a6f782c256deaa732bd20c2fb778\\\" data-canonical-src=\\\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/112929/d6d7f09d-fdc6-479a-3f96-7e9a71260be2.png\\\" srcset=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F112929%2Fd6d7f09d-fdc6-479a-3f96-7e9a71260be2.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=e34da2ce6e6f65476da3ca294eaa1aa1 1x\\\" loading=\\\"lazy\\\"></a></p>\\n\\n<p>(\u6700\u5927 100x100 px \u306B\u3057\u3066\u3044\u308B\u306E\u30672kb\u304F\u3089\u3044)</p>\\n\\n<h2>\\n<span id=\\\"\u51E6\u7406\u3057\u3066\u7C21\u5358\u306B\u89E3\u8AAC\u3059\u308B\\\" class=\\\"fragment\\\"></span><a href=\\\"#%E5%87%A6%E7%90%86%E3%81%97%E3%81%A6%E7%B0%A1%E5%8D%98%E3%81%AB%E8%A7%A3%E8%AA%AC%E3%81%99%E3%82%8B\\\"><i class=\\\"fa fa-link\\\"></i></a>\u51E6\u7406\u3057\u3066\u7C21\u5358\u306B\u89E3\u8AAC\u3059\u308B</h2>\\n\\n<p><a href=\\\"https://qiita.com/komakomako/items/8efd4184f6d7cf1363f2\\\" id=\\\"reference-70c300a4799183af61fb\\\">Canvas\u3067\u3054\u308A\u3063\u3068\u51E6\u7406\u3059\u308B</a>\u3068\u304B\u3001\u30E9\u30A4\u30D6\u30E9\u30EA\u306B\u983C\u308B\u3068\u304B\u65B9\u6CD5\u306F\u3042\u308B\u3068\u601D\u3044\u307E\u3059\u304C\u4ECA\u56DE\u306F <a href=\\\"https://github.com/fengyuanchen/compressorjs\\\" rel=\\\"nofollow noopener\\\" target=\\\"_blank\\\">compressorjs</a> \u3092\u7D39\u4ECB\u3057\u305F\u3044\u3063\u3059\u3002</p>\\n\\n<div class=\\\"code-frame\\\" data-lang=\\\"javascript\\\">\\n<div class=\\\"code-lang\\\"><span class=\\\"bold\\\">component.js</span></div>\\n<div class=\\\"highlight\\\"><pre><code><span class=\\\"k\\\">import</span> <span class=\\\"nx\\\">Compressor</span> <span class=\\\"k\\\">from</span> <span class=\\\"dl\\\">'</span><span class=\\\"s1\\\">compressorjs</span><span class=\\\"dl\\\">'</span>\\n</code></pre></div>\\n</div>\\n\\n<p>OR</p>\\n\\n<div class=\\\"code-frame\\\" data-lang=\\\"html\\\">\\n<div class=\\\"code-lang\\\"><span class=\\\"bold\\\">index.html</span></div>\\n<div class=\\\"highlight\\\"><pre><code><span class=\\\"nt\\\">&lt;script </span><span class=\\\"na\\\">src=</span><span class=\\\"s\\\">\\\"https://cdn.jsdelivr.net/gh/fengyuanchen/compressorjs/dist/compressor.min.js\\\"</span><span class=\\\"nt\\\">&gt;&lt;/script&gt;</span>\\n</code></pre></div>\\n</div>\\n\\n<p>CDN\u306F\u306A\u304B\u306A\u304B\u898B\u3064\u304B\u3089\u306A\u304B\u3063\u305F\u306E\u3067\u3059\u304C\u3050\u3050\u3063\u305F\u3089 <a href=\\\"https://paiza.hatenablog.com/entry/2019/04/03/%E7%94%BB%E5%83%8F%E5%9C%A7%E7%B8%AE%E3%82%84%E3%82%AA%E3%83%BC%E3%83%88%E3%82%B3%E3%83%B3%E3%83%97%E3%83%AA%E3%83%BC%E3%83%88%E3%81%AA%E3%81%A9Web%E9%96%8B%E7%99%BA%E3%82%92%E7%B0%A1%E5%8D%98%E3%81%AB\\\" rel=\\\"nofollow noopener\\\" target=\\\"_blank\\\">\u3053\u306E\u30D6\u30ED\u30B0</a> \u3067\u898B\u3064\u304B\u3063\u305F\u3002\u307E\u3055\u3068\u3089\u3093\u3055\u3093\u3042\u308A\u304C\u3068\u3046\u3067\u3059\u3002</p>\\n\\n<p>\u753B\u50CF\u306F <code>input</code> \u30BF\u30B0\u3067\u9078\u629E\u3057\u3066\u3082\u3089\u3063\u3066</p>\\n\\n<div class=\\\"code-frame\\\" data-lang=\\\"js\\\"><div class=\\\"highlight\\\"><pre><code><span class=\\\"o\\\">&lt;</span><span class=\\\"nx\\\">input</span>\\n  <span class=\\\"nx\\\">type</span><span class=\\\"o\\\">=</span><span class=\\\"dl\\\">\\\"</span><span class=\\\"s2\\\">file</span><span class=\\\"dl\\\">\\\"</span>\\n  <span class=\\\"nx\\\">id</span><span class=\\\"o\\\">=</span><span class=\\\"dl\\\">\\\"</span><span class=\\\"s2\\\">file</span><span class=\\\"dl\\\">\\\"</span>\\n  <span class=\\\"nx\\\">multiple</span>\\n  <span class=\\\"nx\\\">accept</span><span class=\\\"o\\\">=</span><span class=\\\"dl\\\">\\\"</span><span class=\\\"s2\\\">image/*</span><span class=\\\"dl\\\">\\\"</span>\\n  <span class=\\\"p\\\">@</span><span class=\\\"nd\\\">change</span><span class=\\\"o\\\">=</span><span class=\\\"dl\\\">\\\"</span><span class=\\\"s2\\\">handleFiles</span><span class=\\\"dl\\\">\\\"</span>\\n<span class=\\\"o\\\">/&gt;</span>\\n</code></pre></div></div>\\n\\n<p><code>multiple</code> \u3067\u8907\u6570\u9078\u629E\u53EF\u306B\u3057\u3066 <code>accept</code> \u3067\u753B\u50CF\u4EE5\u5916\u3092\u4E00\u5FDC\u5F3E\u3044\u3066\u3044\u307E\u3059\u3002\u305D\u308C\u3067 <code>@change</code> \u30A4\u30D9\u30F3\u30C8\u306E\u30D5\u30C3\u30AF\u3067\u753B\u50CF\u3092\u5727\u7E2E\u3057\u3066\u3044\u307E\u3059\u3002</p>\\n\\n<div class=\\\"code-frame\\\" data-lang=\\\"js\\\"><div class=\\\"highlight\\\"><pre><code><span class=\\\"nx\\\">handleFiles</span><span class=\\\"p\\\">(</span><span class=\\\"nx\\\">e</span><span class=\\\"p\\\">:</span> <span class=\\\"nx\\\">Event</span><span class=\\\"p\\\">)</span> <span class=\\\"p\\\">{</span>\\n  <span class=\\\"kd\\\">const</span> <span class=\\\"nx\\\">images</span> <span class=\\\"o\\\">=</span> <span class=\\\"k\\\">this</span><span class=\\\"p\\\">.</span><span class=\\\"nx\\\">images</span>\\n  <span class=\\\"kd\\\">const</span> <span class=\\\"nx\\\">files</span><span class=\\\"p\\\">:</span> <span class=\\\"nx\\\">FileList</span> <span class=\\\"o\\\">|</span> <span class=\\\"kc\\\">null</span> <span class=\\\"o\\\">=</span> <span class=\\\"p\\\">(</span><span class=\\\"o\\\">&lt;</span><span class=\\\"nx\\\">HTMLInputElement</span><span class=\\\"o\\\">&gt;</span><span class=\\\"nx\\\">e</span><span class=\\\"p\\\">.</span><span class=\\\"nx\\\">target</span><span class=\\\"p\\\">).</span><span class=\\\"nx\\\">files</span>\\n  <span class=\\\"k\\\">if</span> <span class=\\\"p\\\">(</span><span class=\\\"nx\\\">files</span> <span class=\\\"o\\\">===</span> <span class=\\\"kc\\\">null</span><span class=\\\"p\\\">)</span> <span class=\\\"k\\\">return</span>\\n  <span class=\\\"p\\\">;[...</span><span class=\\\"nx\\\">files</span><span class=\\\"p\\\">].</span><span class=\\\"nx\\\">forEach</span><span class=\\\"p\\\">((</span><span class=\\\"nx\\\">file</span><span class=\\\"p\\\">:</span> <span class=\\\"nx\\\">File</span><span class=\\\"p\\\">)</span> <span class=\\\"o\\\">=&gt;</span> <span class=\\\"p\\\">{</span>\\n    <span class=\\\"c1\\\">// \u8907\u6570\u30D5\u30A1\u30A4\u30EB\u3092\u53D7\u3051\u5165\u308C\u3066\u3044\u308B\u306E\u3067\u3001\u3053\u306E\u4E2D\u3067\u51E6\u7406\u3057\u3066\u3044\u308B</span>\\n  <span class=\\\"p\\\">})</span>\\n<span class=\\\"p\\\">}</span>\\n</code></pre></div></div>\\n\\n<p>\u8907\u6570\u51E6\u7406\u3084file\u304C\u53D6\u5F97\u3067\u304D\u306A\u304B\u3063\u305F\u5834\u5408\u306E\u51E6\u7406\u306F\u4E0A\u306E\u3088\u3046\u306A\u611F\u3058\u3067\u3001Typescript\u7684\u306B\u30A8\u30E9\u30FC\u304C\u51FA\u3066\u3044\u306A\u3044\u306E\u3067\u3053\u308C\u3067OK\u304B\u306A\u3068\u601D\u3063\u3066\u307E\u3059\uFF08\u8A8D\u8B58\u3042\u3063\u3066\u307E\u3059\u304B\uFF1F\uFF09</p>\\n\\n<div class=\\\"code-frame\\\" data-lang=\\\"js\\\"><div class=\\\"highlight\\\"><pre><code><span class=\\\"kd\\\">const</span> <span class=\\\"nx\\\">payload</span><span class=\\\"p\\\">:</span> <span class=\\\"nx\\\">Compressor</span><span class=\\\"p\\\">.</span><span class=\\\"nx\\\">Options</span> <span class=\\\"o\\\">=</span> <span class=\\\"p\\\">{</span>\\n  <span class=\\\"na\\\">quality</span><span class=\\\"p\\\">:</span> <span class=\\\"mf\\\">0.8</span><span class=\\\"p\\\">,</span>\\n  <span class=\\\"na\\\">maxWidth</span><span class=\\\"p\\\">:</span> <span class=\\\"mi\\\">100</span><span class=\\\"p\\\">,</span>\\n  <span class=\\\"na\\\">maxHeight</span><span class=\\\"p\\\">:</span> <span class=\\\"mi\\\">100</span><span class=\\\"p\\\">,</span>\\n  <span class=\\\"na\\\">mimeType</span><span class=\\\"p\\\">:</span> <span class=\\\"dl\\\">'</span><span class=\\\"s1\\\">image/jpeg</span><span class=\\\"dl\\\">'</span><span class=\\\"p\\\">,</span>\\n  <span class=\\\"nx\\\">success</span><span class=\\\"p\\\">(</span><span class=\\\"na\\\">blob</span><span class=\\\"p\\\">:</span> <span class=\\\"nx\\\">Blob</span><span class=\\\"p\\\">):</span> <span class=\\\"k\\\">void</span> <span class=\\\"p\\\">{</span>\\n    <span class=\\\"c1\\\">// \u3053\u3053\u306B\u6210\u529F\u6642\u306E\u51E6\u7406\u3092\u66F8\u304F\u3002\u6B21\u3002</span>\\n  <span class=\\\"p\\\">},</span>\\n  <span class=\\\"nx\\\">error</span><span class=\\\"p\\\">(</span><span class=\\\"na\\\">err</span><span class=\\\"p\\\">:</span> <span class=\\\"nb\\\">Error</span><span class=\\\"p\\\">):</span> <span class=\\\"k\\\">void</span> <span class=\\\"p\\\">{</span>\\n    <span class=\\\"nx\\\">console</span><span class=\\\"p\\\">.</span><span class=\\\"nx\\\">log</span><span class=\\\"p\\\">(</span><span class=\\\"nx\\\">err</span><span class=\\\"p\\\">.</span><span class=\\\"nx\\\">message</span><span class=\\\"p\\\">)</span>\\n  <span class=\\\"p\\\">}</span>\\n<span class=\\\"p\\\">}</span>\\n<span class=\\\"k\\\">new</span> <span class=\\\"nx\\\">Compressor</span><span class=\\\"p\\\">(</span><span class=\\\"nx\\\">file</span><span class=\\\"p\\\">,</span> <span class=\\\"nx\\\">payload</span><span class=\\\"p\\\">)</span>\\n</code></pre></div></div>\\n\\n<p>\u5B9F\u969B\u306E\u51E6\u7406\u306F\u3053\u3093\u306A\u611F\u3058\u3067\u6A2A\u5E45\u30FB\u7E26\u5E45\u306E\u6700\u5927\u3068\u304B\u5727\u7E2E\u7387\u3068\u304B\u305F\u304F\u3055\u3093\u306E <a href=\\\"https://github.com/fengyuanchen/compressorjs/blob/master/README.md#options\\\" rel=\\\"nofollow noopener\\\" target=\\\"_blank\\\">\u30AA\u30D7\u30B7\u30E7\u30F3</a> \u304C\u3042\u308A\u307E\u3059\u3002\u307E\u305F\u6210\u529F\u6642\u3068\u5931\u6557\u6642\u306F <code>success</code> \u3068 <code>error</code> \u306E\u30B3\u30FC\u30EB\u30D0\u30C3\u30AF\u306B\u66F8\u304F\u307F\u305F\u3044\u3067\u3059\u3002</p>\\n\\n<div class=\\\"code-frame\\\" data-lang=\\\"js\\\"><div class=\\\"highlight\\\"><pre><code><span class=\\\"nx\\\">success</span><span class=\\\"p\\\">(</span><span class=\\\"nx\\\">blob</span><span class=\\\"p\\\">:</span> <span class=\\\"nx\\\">Blob</span><span class=\\\"p\\\">):</span> <span class=\\\"k\\\">void</span> <span class=\\\"p\\\">{</span>\\n<span class=\\\"p\\\">},</span>\\n\\n</code></pre></div></div>\\n\\n<p>\u30B5\u30AF\u30BB\u30B9\u306E\u30B3\u30FC\u30EB\u30D0\u30C3\u30AF\u306F <code>Blob</code> \u3092\u53D7\u3051\u53D6\u308B\u306E\u3067Firebase\u3067\u306F\u3053\u306E\u6BB5\u968E\u3067\u30D5\u30A1\u30A4\u30EB\u306E\u30A2\u30C3\u30D7\u30ED\u30FC\u30C9\u304C\u3067\u304D\u307E\u3059\uFF01\uFF01\uFF01<a href=\\\"https://firebase.google.com/docs/storage/web/upload-files?hl=ja#upload_from_a_blob_or_file\\\" rel=\\\"nofollow noopener\\\" target=\\\"_blank\\\">\u30C9\u30AD\u30E5\u30E1\u30F3\u30C8\u306F\u3053\u3061\u3089\u3002</a>  Blob\u304B\u3089\u30A2\u30C3\u30D7\u30ED\u30FC\u30C9\u3067\u304D\u308B\u3068\u304B\u3059\u3054\u304F\u3044\u3044\u3067\u3059\u306D\u3002(\u8A66\u3057\u3066\u306A\u3044\u3051\u3069\u305F\u3076\u3093\u305D\u3061\u3089\u3067Upload\u3067\u304D\u308B)</p>\\n\\n<p>\u4ECA\u56DE\u306F\u30A2\u30C3\u30D7\u30ED\u30FC\u30C9\u3059\u308B\u524D\u306B\u8AAD\u307F\u8FBC\u307F\u3092\u78BA\u8A8D\u3057\u305F\u304B\u3063\u305F\u306E\u3067\u3001DataUrl\u3068\u3044\u3046\u5F62\u5F0F\u306B\u5909\u63DB\u3057\u3066\u3044\u307E\u3059\u3002</p>\\n\\n<div class=\\\"code-frame\\\" data-lang=\\\"js\\\"><div class=\\\"highlight\\\"><pre><code><span class=\\\"nx\\\">success</span><span class=\\\"p\\\">(</span><span class=\\\"nx\\\">blob</span><span class=\\\"p\\\">:</span> <span class=\\\"nx\\\">Blob</span><span class=\\\"p\\\">):</span> <span class=\\\"k\\\">void</span> <span class=\\\"p\\\">{</span>\\n  <span class=\\\"kd\\\">var</span> <span class=\\\"nx\\\">reader</span> <span class=\\\"o\\\">=</span> <span class=\\\"k\\\">new</span> <span class=\\\"nx\\\">FileReader</span><span class=\\\"p\\\">()</span>\\n  <span class=\\\"nx\\\">reader</span><span class=\\\"p\\\">.</span><span class=\\\"nx\\\">onloadend</span> <span class=\\\"o\\\">=</span> <span class=\\\"p\\\">()</span> <span class=\\\"o\\\">=&gt;</span> <span class=\\\"p\\\">{</span>\\n    <span class=\\\"kd\\\">const</span> <span class=\\\"nx\\\">result</span> <span class=\\\"o\\\">=</span> <span class=\\\"o\\\">&lt;</span><span class=\\\"nx\\\">string</span> <span class=\\\"o\\\">|</span> <span class=\\\"nb\\\">ArrayBuffer</span> <span class=\\\"o\\\">|</span> <span class=\\\"kc\\\">null</span><span class=\\\"o\\\">&gt;</span><span class=\\\"nx\\\">reader</span><span class=\\\"p\\\">.</span><span class=\\\"nx\\\">result</span>\\n    <span class=\\\"k\\\">if</span> <span class=\\\"p\\\">(</span><span class=\\\"nx\\\">result</span> <span class=\\\"k\\\">instanceof</span> <span class=\\\"nb\\\">ArrayBuffer</span> <span class=\\\"o\\\">||</span> <span class=\\\"nx\\\">result</span> <span class=\\\"o\\\">===</span> <span class=\\\"kc\\\">null</span><span class=\\\"p\\\">)</span> <span class=\\\"k\\\">return</span>\\n    <span class=\\\"nx\\\">images</span><span class=\\\"p\\\">.</span><span class=\\\"nx\\\">push</span><span class=\\\"p\\\">(</span><span class=\\\"nx\\\">result</span><span class=\\\"p\\\">)</span>\\n  <span class=\\\"p\\\">}</span>\\n  <span class=\\\"nx\\\">reader</span><span class=\\\"p\\\">.</span><span class=\\\"nx\\\">readAsDataURL</span><span class=\\\"p\\\">(</span><span class=\\\"nx\\\">blob</span><span class=\\\"p\\\">)</span>\\n<span class=\\\"p\\\">},</span>\\n</code></pre></div></div>\\n\\n<p><code>images.push(result)</code> \u3059\u308B\u6BB5\u968E\u3067DataUrl\u3068\u3044\u3046\u5F62\u5F0F\u306E <code>data:image/jpeg;base64,XXXXXXXX</code>\u307F\u305F\u3044\u306A\u6587\u5B57\u5217\u306B\u306A\u3063\u3066\u3044\u307E\u3059\u3002<a href=\\\"https://firebase.google.com/docs/storage/web/upload-files?hl=ja#upload_from_a_string\\\" rel=\\\"nofollow noopener\\\" target=\\\"_blank\\\">\u30C9\u30AD\u30E5\u30E1\u30F3\u30C8\u306E\u6587\u5B57\u5217\u304B\u3089\u30A2\u30C3\u30D7\u30ED\u30FC\u30C9\u3059\u308B</a>\u3092\u898B\u308B\u3068</p>\\n\\n<div class=\\\"code-frame\\\" data-lang=\\\"js\\\"><div class=\\\"highlight\\\"><pre><code><span class=\\\"kd\\\">var</span> <span class=\\\"nx\\\">message</span> <span class=\\\"o\\\">=</span> <span class=\\\"dl\\\">'</span><span class=\\\"s1\\\">data:text/plain;base64,5b6p5Y+344GX44G+44GX44Gf77yB44GK44KB44Gn44Go44GG77yB</span><span class=\\\"dl\\\">'</span><span class=\\\"p\\\">;</span>\\n<span class=\\\"nx\\\">ref</span><span class=\\\"p\\\">.</span><span class=\\\"nx\\\">putString</span><span class=\\\"p\\\">(</span><span class=\\\"nx\\\">message</span><span class=\\\"p\\\">,</span> <span class=\\\"dl\\\">'</span><span class=\\\"s1\\\">data_url</span><span class=\\\"dl\\\">'</span><span class=\\\"p\\\">).</span><span class=\\\"nx\\\">then</span><span class=\\\"p\\\">(</span><span class=\\\"kd\\\">function</span><span class=\\\"p\\\">(</span><span class=\\\"nx\\\">snapshot</span><span class=\\\"p\\\">)</span> <span class=\\\"p\\\">{</span>\\n  <span class=\\\"nx\\\">console</span><span class=\\\"p\\\">.</span><span class=\\\"nx\\\">log</span><span class=\\\"p\\\">(</span><span class=\\\"dl\\\">'</span><span class=\\\"s1\\\">Uploaded a data_url string!</span><span class=\\\"dl\\\">'</span><span class=\\\"p\\\">);</span>\\n<span class=\\\"p\\\">});</span>\\n</code></pre></div></div>\\n\\n<p>\u3053\u308C\u3067\u30A2\u30C3\u30D7\u30ED\u30FC\u30C9\u3067\u304D\u305D\u3046\u3067\u3059\u306D\u3002</p>\\n\\n<p>\u30C9\u30AD\u30E5\u30E1\u30F3\u30C8\u3092\u8AAD\u3080\u3068 <code>data:text/plain;base64,</code> \u3068\u3044\u3046\u6587\u5B57\u5217\u3092\u524A\u9664\u3057\u305F\u3089 ref.putString(message, 'base64url')\u3067\u30A2\u30C3\u30D7\u30ED\u30FC\u30C9\u3067\u304D\u305D\u3046\u3067\u3059\u3002\u305F\u3076\u3093\u3002</p>\\n\\n<p>\u30B5\u30F3\u30D7\u30EB\u30D5\u30A1\u30A4\u30EB\u306F <code>&lt;script lang=\\\"ts\\\"&gt;</code> \u306B\u3057\u3066\u3044\u308B\u306E\u3067VSCode\u3067\u3072\u3089\u3044\u3066\u3001 <code>CMD + Click</code> \u3068\u304B\u3067\u5B9A\u7FA9\u5143\u3068\u304B\u98DB\u3093\u3067\u884C\u3063\u3066\u81EA\u5206\u3067\u89E6\u3063\u3066\u307F\u3066\u304F\u3060\u3055\u3044\uFF01\uFF01</p>\\n\\n<p><a href=\\\"https://camo.qiitausercontent.com/1727be86da44b5cc85c2dbae435f1b31f2af6e04/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3131323932392f38643038333739662d323139322d626266312d386238342d6437323764373361623237622e706e67\\\" target=\\\"_blank\\\" rel=\\\"nofollow noopener\\\"><img width=\\\"659\\\" alt=\\\"\u30B9\u30AF\u30EA\u30FC\u30F3\u30B7\u30E7\u30C3\u30C8 2020-01-16 14.09.43.png\\\" src=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F112929%2F8d08379f-2192-bbf1-8b84-d727d73ab27b.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=c089a54495a050d153c48ddf100f248e\\\" data-canonical-src=\\\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/112929/8d08379f-2192-bbf1-8b84-d727d73ab27b.png\\\" srcset=\\\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F112929%2F8d08379f-2192-bbf1-8b84-d727d73ab27b.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=14f8e46852d921d15bfacf5512470bfe 1x\\\" loading=\\\"lazy\\\"></a></p>\\n\\n<h2>\\n<span id=\\\"\u7D42\u308F\u308A\u306B\\\" class=\\\"fragment\\\"></span><a href=\\\"#%E7%B5%82%E3%82%8F%E3%82%8A%E3%81%AB\\\"><i class=\\\"fa fa-link\\\"></i></a>\u7D42\u308F\u308A\u306B</h2>\\n\\n<p>\u30D6\u30E9\u30A6\u30B6\u306EAPI\u3092\u53E9\u304F\u3068\u304D\u306BTypeScript\u3059\u3054\u304F\u958B\u767A\u4F53\u9A13\u826F\u304B\u3063\u305F\u3067\u3059\u3002MDN\u3092\u898B\u306B\u884C\u304B\u306A\u304F\u3066\u3082\u4F55\u304C\u8FD4\u3063\u3066\u304F\u308B\u304B\u308F\u304B\u308B\u306E\u3067\u3001null\u5236\u5FA1\u3068\u304B\u305D\u3046\u3044\u3046\u306E\u304C\u3084\u308A\u3084\u3059\u304B\u3063\u305F\u3067\u3059\u3002\u30B3\u30FC\u30C9\u66F8\u3044\u3066\u3066\u697D\u3057\u304B\u3063\u305F\u3002</p>\\n\\n<p>\u306A\u306B\u304B\u9593\u9055\u3044\u898B\u3064\u3051\u305F\u3089\u7DE8\u96C6\u30EA\u30AF\u30A8\u30B9\u30C8\u304F\u3060\u3055\u3044\uFF01\uFF01\uFF01</p>\\n\\n<p>\u6700\u5F8C\u307E\u3067\u8AAD\u3093\u3067\u3044\u305F\u3060\u304D\u3042\u308A\u304C\u3068\u3046\u3054\u3056\u3044\u307E\u3059\u3002\uFF01\uFF01</p>\\n\",\"body\":\"\u3053\u3093\u306B\u3061\u306F\u3002\u5E74\u672B\u5E74\u59CB\u306F\u305A\u3063\u3068Firebase\u3092\u89E6\u3063\u3066\u3044\u307E\u3057\u305F @ykhirao \u3067\u3059\u3002\u305F\u3076\u30933\u5E74\u304F\u3089\u3044\u9045\u308C\u3066\u6D41\u884C\u306B\u4E57\u308A\u59CB\u3081\u3066\u3044\u307E\u3059\u3002Typescript\u304A\u6B63\u6708\u306B\u306F\u3058\u3081\u307E\u3057\u305F\u3002\\n\\n\u4ECA\u65E5\u306F\u3001\u4ED5\u4E8B\u304C\u304A\u4F11\u307F\u306A\u306E\u3067\u30B9\u30DE\u30DB\u307D\u3061\u307D\u3061\u3057\u3066\u3044\u305F\u3089\u3059\u3054\u304F\u53C2\u8003\u306B\u306A\u308B\u8A18\u4E8B\u3092\u898B\u304B\u3051\u307E\u3057\u305F\u306E\u3067\u3059\u304C\u3001\u3053\u3061\u3089\u306E\u8A18\u4E8B [Firebase\u3067\u4F5C\u308B\uFF01\u30EA\u30A2\u30EB\u30BF\u30A4\u30E0\u753B\u50CF\u5909\u63DBCDN\u3010Firebase Hosting + Cloud Functions\u3011 - AppBrew Tech Blog](https://tech.appbrew.io/entry/2020/01/15/120000) \u3067\u66F8\u304B\u308C\u3066\u3044\u308B `\u30A2\u30C3\u30D7\u30ED\u30FC\u30C9\u3055\u308C\u305F\u753B\u50CF\u3092\u305D\u306E\u307E\u307E\u8868\u793A\u3059\u308B\u6642\u4EE3\u306F\u5E73\u6210\u3068\u3068\u3082\u306B\u7D42\u308F\u308A\u3092\u544A\u3052\u305F\u308F\u3051\u3067\u3059\u304C[\u203B\u8981\u51FA\u5178]` \u3068\u3044\u3046\u6587\u8A00\u3092\u898B\u3066\u304F\u3059\u3063\u3068\u7B11\u3063\u3066\u3057\u307E\u3044\u3001\u5C11\u3057\u524D\u306B [\u541B\u306F\u307E\u3060\u5E73\u6210\u306E\u30A2\u30FC\u30AD\u30C6\u30AF\u30C1\u30E3\u3092\u4F7F\u3063\u3066\u308B\u306E\u304B\uFF1F\u50D5\u306FFirebase\u3068\u4EE4\u548C\u306E\u6642\u4EE3\u306B\u884C\u304F\u305E\u3002](https://qiita.com/hecateball/items/c55b6811835923fb9574) \u3068\u3044\u3046\u8A18\u4E8B\u304C\u305F\u304F\u3055\u3093\u306E\u65B9\u306B\u8AAD\u307E\u308C\u3066\u3044\u305F\u3053\u3068\u3068\u304B\u3001Twitter\u306E\u64EC\u4EBA\u5316\u3055\u308C\u305F [#\u4EE4\u548C\u3061\u3083\u3093](https://twitter.com/search?q=%23\u4EE4\u548C\u3061\u3083\u3093) \u3092\u601D\u3044\u51FA\u3057\u305F\u308A\u3057\u3066\u3001\u30A8\u30F3\u30B8\u30CB\u30A2\u306E\u307F\u306A\u3055\u3093\u306F\u4EE4\u548C\u3061\u3083\u3093\u3082Firebase\u3082\u5927\u597D\u304D\u3063\u307D\u3044\u306E\u3067\u79C1\u3082\u8A18\u4E8B\u3092\u66F8\u3053\u3046\u304B\u306A\u30FC\u30FC\u3068\u601D\u3063\u3066\u66F8\u304D\u59CB\u3081\u307E\u3057\u305F\u3002\u30CD\u30BF\u306A\u3093\u3060\u3051\u3069\u8AB0\u304B\u306E\u5F79\u306B\u305F\u3064\u8A18\u4E8B\u3092\u66F8\u304D\u305F\u3044\u6B21\u7B2C\u3067\u3059\u3002\\n\\n\\n\u3055\u3066\u524D\u7F6E\u304D\u304C\u9577\u304F\u306A\u308A\u307E\u3057\u305F\u304C\u3001\u672C\u6587\u306F\u3001\u753B\u50CF\u3092\u30A2\u30C3\u30D7\u30ED\u30FC\u30C9\u3059\u308B\u524D\u306B\u30B4\u30EA\u30C3\u3068\u51E6\u7406\u3059\u308B\u65B9\u6CD5\u3092\u66F8\u3044\u3066\u884C\u304D\u307E\u3059\u3002\\n\\n# \u753B\u50CF\u3092\u30A2\u30C3\u30D7\u30ED\u30FC\u30C9\u524D\u306B\u5727\u7E2E\u3059\u308B\u6D41\u884C\u308A\u306E\u65B9\u6CD5\\n\\n## \u4ECA\u56DE\u7D39\u4ECB\u3059\u308B\u3053\u3068\u3001\u3057\u306A\u3044\u3053\u3068\\n\\n```\\n# \u753B\u50CF\u30A2\u30C3\u30D7\u30ED\u30FC\u30C9\u306B\u3064\u3044\u3066\u306E\u624B\u6CD5\\n\\n1. \u753B\u50CF\u51E6\u7406\u3092\u3057\u306A\u3044(\u5E73\u6210)\\n\\n2. \u753B\u50CF\u51E6\u7406\u3092\u3059\u308B(\u4EE4\u548C)\\n  - 2.1 \u30B5\u30FC\u30D0\u30FC\u3067\u51E6\u7406\u3059\u308B (https://tech.appbrew.io/entry/2020/01/15/120000 \u3067\u7D39\u4ECB\u3055\u308C\u3066\u3044\u308B)\\n    - Firebase Extension\uFF08\u307E\u3060\u03B2\u3063\u307D\u3044\u3067\u3059\u304C\u516C\u5F0F\u306E\u62E1\u5F35\u304C\u3042\u308B\u3063\u307D\u3044\uFF01\uFF09\\n    - CloudFunctions\u3092\u81EA\u5206\u3067Node.JS\u3054\u308A\u3054\u308A\u66F8\u304F\\n  - 2.2 \u30AF\u30E9\u30A4\u30A2\u30F3\u30C8\u5074\u3067\u51E6\u7406\u3059\u308B( <---- \u4ECA\u65E5\u306E\u8A18\u4E8B\u306F\u3053\u3053\uFF01\uFF01\uFF01)\\n```\\n\\n\\n\\n## \u672C\u6587\u3044\u3089\u306A\u3044\u304B\u3089\u30B9\u30AF\u30B7\u30E7\u3068\u304BGist\u307F\u305F\u3044\u3072\u3068\\n\\n\u4EE5\u4E0B\u306E\u30B9\u30AF\u30B7\u30E7\u306E\u3088\u3046\u306B\u306A\u308BGist\u306F\u3053\u3061\u3089\\nhttps://gist.github.com/ykhirao/1d36aeca9abb02709cc9dd3d676040ef\\n\\n<img width=\\\"1672\\\" alt=\\\"\u30B9\u30AF\u30EA\u30FC\u30F3\u30B7\u30E7\u30C3\u30C8 2020-01-16 13.32.29.png\\\" src=\\\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/112929/b1537517-ec44-f9b0-3f24-0f99b7cea44a.png\\\">\\n\\n<img width=\\\"1330\\\" alt=\\\"\u30B9\u30AF\u30EA\u30FC\u30F3\u30B7\u30E7\u30C3\u30C8 2020-01-16 14.17.23.png\\\" src=\\\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/112929/d6d7f09d-fdc6-479a-3f96-7e9a71260be2.png\\\">\\n\\n(\u6700\u5927 100x100 px \u306B\u3057\u3066\u3044\u308B\u306E\u30672kb\u304F\u3089\u3044)\\n\\n\\n## \u51E6\u7406\u3057\u3066\u7C21\u5358\u306B\u89E3\u8AAC\u3059\u308B\\n\\n[Canvas\u3067\u3054\u308A\u3063\u3068\u51E6\u7406\u3059\u308B](https://qiita.com/komakomako/items/8efd4184f6d7cf1363f2)\u3068\u304B\u3001\u30E9\u30A4\u30D6\u30E9\u30EA\u306B\u983C\u308B\u3068\u304B\u65B9\u6CD5\u306F\u3042\u308B\u3068\u601D\u3044\u307E\u3059\u304C\u4ECA\u56DE\u306F [compressorjs](https://github.com/fengyuanchen/compressorjs) \u3092\u7D39\u4ECB\u3057\u305F\u3044\u3063\u3059\u3002\\n\\n```component.js\\nimport Compressor from 'compressorjs'\\n```\\n\\nOR\\n\\n```index.html\\n<script src=\\\"https://cdn.jsdelivr.net/gh/fengyuanchen/compressorjs/dist/compressor.min.js\\\"><\/script>\\n```\\n\\nCDN\u306F\u306A\u304B\u306A\u304B\u898B\u3064\u304B\u3089\u306A\u304B\u3063\u305F\u306E\u3067\u3059\u304C\u3050\u3050\u3063\u305F\u3089 [\u3053\u306E\u30D6\u30ED\u30B0](https://paiza.hatenablog.com/entry/2019/04/03/\u753B\u50CF\u5727\u7E2E\u3084\u30AA\u30FC\u30C8\u30B3\u30F3\u30D7\u30EA\u30FC\u30C8\u306A\u3069Web\u958B\u767A\u3092\u7C21\u5358\u306B) \u3067\u898B\u3064\u304B\u3063\u305F\u3002\u307E\u3055\u3068\u3089\u3093\u3055\u3093\u3042\u308A\u304C\u3068\u3046\u3067\u3059\u3002\\n\\n\u753B\u50CF\u306F `input` \u30BF\u30B0\u3067\u9078\u629E\u3057\u3066\u3082\u3089\u3063\u3066\\n\\n```js\\n<input\\n  type=\\\"file\\\"\\n  id=\\\"file\\\"\\n  multiple\\n  accept=\\\"image/*\\\"\\n  @change=\\\"handleFiles\\\"\\n/>\\n```\\n\\n`multiple` \u3067\u8907\u6570\u9078\u629E\u53EF\u306B\u3057\u3066 `accept` \u3067\u753B\u50CF\u4EE5\u5916\u3092\u4E00\u5FDC\u5F3E\u3044\u3066\u3044\u307E\u3059\u3002\u305D\u308C\u3067 `@change` \u30A4\u30D9\u30F3\u30C8\u306E\u30D5\u30C3\u30AF\u3067\u753B\u50CF\u3092\u5727\u7E2E\u3057\u3066\u3044\u307E\u3059\u3002\\n\\n```js\\nhandleFiles(e: Event) {\\n  const images = this.images\\n  const files: FileList | null = (<HTMLInputElement>e.target).files\\n  if (files === null) return\\n  ;[...files].forEach((file: File) => {\\n    // \u8907\u6570\u30D5\u30A1\u30A4\u30EB\u3092\u53D7\u3051\u5165\u308C\u3066\u3044\u308B\u306E\u3067\u3001\u3053\u306E\u4E2D\u3067\u51E6\u7406\u3057\u3066\u3044\u308B\\n  })\\n}\\n```\\n\\n\u8907\u6570\u51E6\u7406\u3084file\u304C\u53D6\u5F97\u3067\u304D\u306A\u304B\u3063\u305F\u5834\u5408\u306E\u51E6\u7406\u306F\u4E0A\u306E\u3088\u3046\u306A\u611F\u3058\u3067\u3001Typescript\u7684\u306B\u30A8\u30E9\u30FC\u304C\u51FA\u3066\u3044\u306A\u3044\u306E\u3067\u3053\u308C\u3067OK\u304B\u306A\u3068\u601D\u3063\u3066\u307E\u3059\uFF08\u8A8D\u8B58\u3042\u3063\u3066\u307E\u3059\u304B\uFF1F\uFF09\\n\\n```js\\nconst payload: Compressor.Options = {\\n  quality: 0.8,\\n  maxWidth: 100,\\n  maxHeight: 100,\\n  mimeType: 'image/jpeg',\\n  success(blob: Blob): void {\\n    // \u3053\u3053\u306B\u6210\u529F\u6642\u306E\u51E6\u7406\u3092\u66F8\u304F\u3002\u6B21\u3002\\n  },\\n  error(err: Error): void {\\n    console.log(err.message)\\n  }\\n}\\nnew Compressor(file, payload)\\n```\\n\\n\u5B9F\u969B\u306E\u51E6\u7406\u306F\u3053\u3093\u306A\u611F\u3058\u3067\u6A2A\u5E45\u30FB\u7E26\u5E45\u306E\u6700\u5927\u3068\u304B\u5727\u7E2E\u7387\u3068\u304B\u305F\u304F\u3055\u3093\u306E [\u30AA\u30D7\u30B7\u30E7\u30F3](https://github.com/fengyuanchen/compressorjs/blob/master/README.md#options) \u304C\u3042\u308A\u307E\u3059\u3002\u307E\u305F\u6210\u529F\u6642\u3068\u5931\u6557\u6642\u306F `success` \u3068 `error` \u306E\u30B3\u30FC\u30EB\u30D0\u30C3\u30AF\u306B\u66F8\u304F\u307F\u305F\u3044\u3067\u3059\u3002\\n\\n\\n```js\\nsuccess(blob: Blob): void {\\n},\\n\\n```\\n\\n\u30B5\u30AF\u30BB\u30B9\u306E\u30B3\u30FC\u30EB\u30D0\u30C3\u30AF\u306F `Blob` \u3092\u53D7\u3051\u53D6\u308B\u306E\u3067Firebase\u3067\u306F\u3053\u306E\u6BB5\u968E\u3067\u30D5\u30A1\u30A4\u30EB\u306E\u30A2\u30C3\u30D7\u30ED\u30FC\u30C9\u304C\u3067\u304D\u307E\u3059\uFF01\uFF01\uFF01[\u30C9\u30AD\u30E5\u30E1\u30F3\u30C8\u306F\u3053\u3061\u3089\u3002](https://firebase.google.com/docs/storage/web/upload-files?hl=ja#upload_from_a_blob_or_file)  Blob\u304B\u3089\u30A2\u30C3\u30D7\u30ED\u30FC\u30C9\u3067\u304D\u308B\u3068\u304B\u3059\u3054\u304F\u3044\u3044\u3067\u3059\u306D\u3002(\u8A66\u3057\u3066\u306A\u3044\u3051\u3069\u305F\u3076\u3093\u305D\u3061\u3089\u3067Upload\u3067\u304D\u308B)\\n\\n\u4ECA\u56DE\u306F\u30A2\u30C3\u30D7\u30ED\u30FC\u30C9\u3059\u308B\u524D\u306B\u8AAD\u307F\u8FBC\u307F\u3092\u78BA\u8A8D\u3057\u305F\u304B\u3063\u305F\u306E\u3067\u3001DataUrl\u3068\u3044\u3046\u5F62\u5F0F\u306B\u5909\u63DB\u3057\u3066\u3044\u307E\u3059\u3002\\n\\n```js\\nsuccess(blob: Blob): void {\\n  var reader = new FileReader()\\n  reader.onloadend = () => {\\n    const result = <string | ArrayBuffer | null>reader.result\\n    if (result instanceof ArrayBuffer || result === null) return\\n    images.push(result)\\n  }\\n  reader.readAsDataURL(blob)\\n},\\n```\\n\\n`images.push(result)` \u3059\u308B\u6BB5\u968E\u3067DataUrl\u3068\u3044\u3046\u5F62\u5F0F\u306E `data:image/jpeg;base64,XXXXXXXX`\u307F\u305F\u3044\u306A\u6587\u5B57\u5217\u306B\u306A\u3063\u3066\u3044\u307E\u3059\u3002[\u30C9\u30AD\u30E5\u30E1\u30F3\u30C8\u306E\u6587\u5B57\u5217\u304B\u3089\u30A2\u30C3\u30D7\u30ED\u30FC\u30C9\u3059\u308B](https://firebase.google.com/docs/storage/web/upload-files?hl=ja#upload_from_a_string)\u3092\u898B\u308B\u3068\\n\\n```js\\nvar message = 'data:text/plain;base64,5b6p5Y+344GX44G+44GX44Gf77yB44GK44KB44Gn44Go44GG77yB';\\nref.putString(message, 'data_url').then(function(snapshot) {\\n  console.log('Uploaded a data_url string!');\\n});\\n```\\n\\n\u3053\u308C\u3067\u30A2\u30C3\u30D7\u30ED\u30FC\u30C9\u3067\u304D\u305D\u3046\u3067\u3059\u306D\u3002\\n\\n\u30C9\u30AD\u30E5\u30E1\u30F3\u30C8\u3092\u8AAD\u3080\u3068 `data:text/plain;base64,` \u3068\u3044\u3046\u6587\u5B57\u5217\u3092\u524A\u9664\u3057\u305F\u3089 ref.putString(message, 'base64url')\u3067\u30A2\u30C3\u30D7\u30ED\u30FC\u30C9\u3067\u304D\u305D\u3046\u3067\u3059\u3002\u305F\u3076\u3093\u3002\\n\\n\u30B5\u30F3\u30D7\u30EB\u30D5\u30A1\u30A4\u30EB\u306F `<script lang=\\\"ts\\\">` \u306B\u3057\u3066\u3044\u308B\u306E\u3067VSCode\u3067\u3072\u3089\u3044\u3066\u3001 `CMD + Click` \u3068\u304B\u3067\u5B9A\u7FA9\u5143\u3068\u304B\u98DB\u3093\u3067\u884C\u3063\u3066\u81EA\u5206\u3067\u89E6\u3063\u3066\u307F\u3066\u304F\u3060\u3055\u3044\uFF01\uFF01\\n\\n<img width=\\\"659\\\" alt=\\\"\u30B9\u30AF\u30EA\u30FC\u30F3\u30B7\u30E7\u30C3\u30C8 2020-01-16 14.09.43.png\\\" src=\\\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/112929/8d08379f-2192-bbf1-8b84-d727d73ab27b.png\\\">\\n\\n## \u7D42\u308F\u308A\u306B\\n\\n\u30D6\u30E9\u30A6\u30B6\u306EAPI\u3092\u53E9\u304F\u3068\u304D\u306BTypeScript\u3059\u3054\u304F\u958B\u767A\u4F53\u9A13\u826F\u304B\u3063\u305F\u3067\u3059\u3002MDN\u3092\u898B\u306B\u884C\u304B\u306A\u304F\u3066\u3082\u4F55\u304C\u8FD4\u3063\u3066\u304F\u308B\u304B\u308F\u304B\u308B\u306E\u3067\u3001null\u5236\u5FA1\u3068\u304B\u305D\u3046\u3044\u3046\u306E\u304C\u3084\u308A\u3084\u3059\u304B\u3063\u305F\u3067\u3059\u3002\u30B3\u30FC\u30C9\u66F8\u3044\u3066\u3066\u697D\u3057\u304B\u3063\u305F\u3002\\n\\n\u306A\u306B\u304B\u9593\u9055\u3044\u898B\u3064\u3051\u305F\u3089\u7DE8\u96C6\u30EA\u30AF\u30A8\u30B9\u30C8\u304F\u3060\u3055\u3044\uFF01\uFF01\uFF01\\n\\n\u6700\u5F8C\u307E\u3067\u8AAD\u3093\u3067\u3044\u305F\u3060\u304D\u3042\u308A\u304C\u3068\u3046\u3054\u3056\u3044\u307E\u3059\u3002\uFF01\uFF01\\n\\n\\n\\n\\n\",\"coediting\":false,\"comments_count\":3,\"created_at\":\"2020-01-16T14:21:50+09:00\",\"group\":null,\"id\":\"33815dfe198ea332d142\",\"likes_count\":145,\"private\":false,\"reactions_count\":0,\"tags\":[{\"name\":\"JavaScript\",\"versions\":[]},{\"name\":\"Vue.js\",\"versions\":[]},{\"name\":\"Firebase\",\"versions\":[]},{\"name\":\"FirebaseStorage\",\"versions\":[]}],\"title\":\"\u753B\u50CF\u3092\u30A2\u30C3\u30D7\u30ED\u30FC\u30C9\u524D\u306B\u5727\u7E2E\u3059\u308B\u6D41\u884C\u308A\u306E\u65B9\u6CD5\u3010Vue.js x Firebase x \u4EE4\u548C\u3011\",\"updated_at\":\"2021-10-06T21:01:55+09:00\",\"url\":\"https://qiita.com/ykhirao/items/33815dfe198ea332d142\",\"user\":{\"description\":\"Web Developer For 6 years.\\r\\nPHP/Laravel && (React OR Vue.js)\\r\\nTypeScript/node.js\\r\\n\\r\\n\u696D\u52D9\u59D4\u8A17\u306E\u4F9D\u983C\u3068\u304B\u306FWantedly\u3068\u304B\u304B\u3089\u3067\u304A\u9858\u3044\u3057\u307E\u3059\uFF01\",\"facebook_id\":\"\",\"followees_count\":38,\"followers_count\":95,\"github_login_name\":\"ykhirao\",\"id\":\"ykhirao\",\"items_count\":58,\"linkedin_id\":\"\",\"location\":\"Tokyo, Japan\",\"name\":\"yk\",\"organization\":\"\",\"permanent_id\":112929,\"profile_image_url\":\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/112929/profile-images/1639030792\",\"team_only\":false,\"twitter_screen_name\":\"yk_hirao\",\"website_url\":\"https://www.wantedly.com/id/ykhirao\"},\"page_views_count\":null,\"team_membership\":null}},\"path\":\"posts/33815dfe198ea332d142\",\"sharedData\":{},\"siteData\":{}}");</script><script defer="" type="text/javascript" src="/templates/styles.9da399bc.js"></script><script defer="" type="text/javascript" src="/templates/vendors~main.50f3f31b.js"></script><script defer="" type="text/javascript" src="/main.62ec0c15.js"></script></body></html>