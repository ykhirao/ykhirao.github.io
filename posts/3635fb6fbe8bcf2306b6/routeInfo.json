{"template":"__react_static_root__/src/components/QiitaPost","sharedHashesByProp":{},"data":{"post":{"rendered_body":"<h1 data-sourcepos=\"2:1-2:33\">\n<span id=\"ローカル環境で-circleci\" class=\"fragment\"></span><a href=\"#%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E7%92%B0%E5%A2%83%E3%81%A7-circleci\"><i class=\"fa fa-link\"></i></a>ローカル環境で .circleci</h1>\n<p data-sourcepos=\"4:1-5:63\">このホームページみたらインストールできる<br>\n<a href=\"https://circleci.com/docs/ja/how-to-use-the-circleci-local-cli/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\">https://circleci.com/docs/ja/how-to-use-the-circleci-local-cli/</a></p>\n<h2 data-sourcepos=\"7:1-7:12\">\n<span id=\"ビルド\" class=\"fragment\"></span><a href=\"#%E3%83%93%E3%83%AB%E3%83%89\"><i class=\"fa fa-link\"></i></a>ビルド</h2>\n<h2 data-sourcepos=\"8:1-8:30\">\n<span id=\"コンフィグチェック\" class=\"fragment\"></span><a href=\"#%E3%82%B3%E3%83%B3%E3%83%95%E3%82%A3%E3%82%B0%E3%83%81%E3%82%A7%E3%83%83%E3%82%AF\"><i class=\"fa fa-link\"></i></a>コンフィグチェック</h2>\n<div class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"10:1-13:3\"><div class=\"highlight\"><pre><code>$ circleci config validate\nConfig file at .circleci/config.yml is valid.\n</code></pre></div></div>\n<p data-sourcepos=\"15:1-15:73\">pushしてこんなメッセージを何度も見た方は朗報です。</p>\n<p data-sourcepos=\"17:1-17:163\"><a href=\"https://camo.qiitausercontent.com/2117dfc0025e25b02e90783ea3c630588c375b5c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3131323932392f61616334376436392d303362392d656665632d386533312d6662393634616662393765362e706e67\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F112929%2Faac47d69-03b9-efec-8e31-fb964afb97e6.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=5ef325155d7a8444ef779b118a290d72\" alt=\"スクリーンショット 2023-10-13 12.55.55.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/112929/aac47d69-03b9-efec-8e31-fb964afb97e6.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F112929%2Faac47d69-03b9-efec-8e31-fb964afb97e6.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=8e34ddc1bfef1abf2b27e207ba637719 1x\" loading=\"lazy\"></a></p>\n<p data-sourcepos=\"19:1-19:39\">ローカルでエラーが出ます。</p>\n<div class=\"code-frame\" data-lang=\"terminal\" data-sourcepos=\"21:1-25:3\"><div class=\"highlight\"><pre><code><span class=\"gp\">$</span><span class=\"w\"> </span>circleci config validate\n<span class=\"go\">Error: config compilation contains errors: config compilation contains errors:\n        - ERROR IN CONFIG FILE:\n</span></code></pre></div></div>\n<h1 data-sourcepos=\"28:1-28:17\">\n<span id=\"当該の問題\" class=\"fragment\"></span><a href=\"#%E5%BD%93%E8%A9%B2%E3%81%AE%E5%95%8F%E9%A1%8C\"><i class=\"fa fa-link\"></i></a>当該の問題</h1>\n<p data-sourcepos=\"30:1-31:58\">イシュー見る感じだと、ubuntuでもmacでも起こるっぽい？<br>\n<a href=\"https://github.com/CircleCI-Public/circleci-cli/issues/716\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\">https://github.com/CircleCI-Public/circleci-cli/issues/716</a></p>\n<h2 data-sourcepos=\"33:1-33:24\">\n<span id=\"tmp読み込めない\" class=\"fragment\"></span><a href=\"#tmp%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%82%81%E3%81%AA%E3%81%84\"><i class=\"fa fa-link\"></i></a>tmp読み込めない</h2>\n<div class=\"code-frame\" data-lang=\"terminal\" data-sourcepos=\"35:1-42:3\"><div class=\"highlight\"><pre><code><span class=\"gp\">$</span><span class=\"w\"> </span>circleci <span class=\"nb\">local </span>execute <span class=\"o\">{</span>jobの名前<span class=\"o\">}</span>\n<span class=\"go\">(中略)\ndocker: Error response from daemon: Mounts denied: \nThe path /tmp/3945127950_circleci_config.yml is not shared from the host and is not known to Docker.\n</span><span class=\"gp\">You can configure shared paths from Docker -&gt;</span><span class=\"w\"> </span>Preferences... -&gt; Resources -&gt; File Sharing.\n<span class=\"go\">See https://docs.docker.com/desktop/mac for more info.\n</span></code></pre></div></div>\n<p data-sourcepos=\"44:1-44:141\">エラーメッセージ通りに、Dockerデスクトップの設定 Preferences -&gt; Resources -&gt; File Sharing で <code>/tmp/</code> を追加する。</p>\n<p data-sourcepos=\"46:1-46:91\"><code>/tmp/{数値}_circleci_config.yml</code> 数値は毎回変更されるので /tmp/ で設定。</p>\n<h2 data-sourcepos=\"49:1-49:63\">\n<span id=\"ymlファイルがディレクトリとして認識される\" class=\"fragment\"></span><a href=\"#yml%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%8C%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%81%A8%E3%81%97%E3%81%A6%E8%AA%8D%E8%AD%98%E3%81%95%E3%82%8C%E3%82%8B\"><i class=\"fa fa-link\"></i></a>ymlファイルがディレクトリとして認識される</h2>\n<div class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"51:1-55:3\"><div class=\"highlight\"><pre><code>$ circleci local execute {jobの名前}\n(中略)\nError: failed to start event processor: failed to compute task config: failed to read config file: read /tmp/local_build_config.yml: is a directory\n</code></pre></div></div>\n<h2 data-sourcepos=\"57:1-57:21\">\n<span id=\"原因と解決策\" class=\"fragment\"></span><a href=\"#%E5%8E%9F%E5%9B%A0%E3%81%A8%E8%A7%A3%E6%B1%BA%E7%AD%96\"><i class=\"fa fa-link\"></i></a>原因と解決策</h2>\n<p data-sourcepos=\"59:1-59:280\">イシューの最後にもかかれていますが /tmp というパスの競合でゴニョゴニョしてるみたいでした。<a href=\"https://github.com/CircleCI-Public/circleci-cli/pull/967\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\">https://github.com/CircleCI-Public/circleci-cli/pull/967</a> のPRを待つか、このPRをローカルビルドすれば動くかなと思います。</p>\n<blockquote data-sourcepos=\"61:1-67:84\">\n<p data-sourcepos=\"61:3-61:76\">Thanks everyone for reporting this issue and contributing in the comments!</p>\n<p data-sourcepos=\"63:3-63:242\">The underlying problem comes from Lima not accepting /tmp as a mount for its VMs, as it considers it a \"system path\" similar to /etc or /usr.. Any container distribution using Lima will face this issue, including colima and Rancher Desktop.</p>\n<p data-sourcepos=\"65:3-67:84\">We're currently at work on this, and we seem to have found a solution in #967.<br>\nWe're still working on adding some tests and checks to make sure this is reliable and future-proof, and we'll release it as soon as we can.<br>\n<a href=\"https://github.com/CircleCI-Public/circleci-cli/issues/716#issuecomment-1680680789\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\">https://github.com/CircleCI-Public/circleci-cli/issues/716#issuecomment-1680680789</a></p>\n</blockquote>\n<p data-sourcepos=\"70:1-70:171\">自分は一旦ローカルのconfigがバリデーションエラーでないかチェックするだけで充分だと思ったのでそれだけを使う予定です。</p>\n","body":"\n# ローカル環境で .circleci\n\nこのホームページみたらインストールできる\nhttps://circleci.com/docs/ja/how-to-use-the-circleci-local-cli/\n\n## ビルド\n## コンフィグチェック\n\n```\n$ circleci config validate\nConfig file at .circleci/config.yml is valid.\n```\n\npushしてこんなメッセージを何度も見た方は朗報です。\n\n![スクリーンショット 2023-10-13 12.55.55.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/112929/aac47d69-03b9-efec-8e31-fb964afb97e6.png)\n\nローカルでエラーが出ます。\n\n```terminal\n$ circleci config validate\nError: config compilation contains errors: config compilation contains errors:\n        - ERROR IN CONFIG FILE:\n```\n\n\n# 当該の問題\n\nイシュー見る感じだと、ubuntuでもmacでも起こるっぽい？\nhttps://github.com/CircleCI-Public/circleci-cli/issues/716\n\n## tmp読み込めない\n\n```terminal\n$ circleci local execute {jobの名前}\n(中略)\ndocker: Error response from daemon: Mounts denied: \nThe path /tmp/3945127950_circleci_config.yml is not shared from the host and is not known to Docker.\nYou can configure shared paths from Docker -> Preferences... -> Resources -> File Sharing.\nSee https://docs.docker.com/desktop/mac for more info.\n```\n\nエラーメッセージ通りに、Dockerデスクトップの設定 Preferences -> Resources -> File Sharing で `/tmp/` を追加する。\n\n`/tmp/{数値}_circleci_config.yml` 数値は毎回変更されるので /tmp/ で設定。\n\n\n## ymlファイルがディレクトリとして認識される\n\n```\n$ circleci local execute {jobの名前}\n(中略)\nError: failed to start event processor: failed to compute task config: failed to read config file: read /tmp/local_build_config.yml: is a directory\n```\n\n## 原因と解決策\n\nイシューの最後にもかかれていますが /tmp というパスの競合でゴニョゴニョしてるみたいでした。https://github.com/CircleCI-Public/circleci-cli/pull/967 のPRを待つか、このPRをローカルビルドすれば動くかなと思います。\n\n> Thanks everyone for reporting this issue and contributing in the comments!\n> \n> The underlying problem comes from Lima not accepting /tmp as a mount for its VMs, as it considers it a \"system path\" similar to /etc or /usr.. Any container distribution using Lima will face this issue, including colima and Rancher Desktop.\n>\n> We're currently at work on this, and we seem to have found a solution in #967.\nWe're still working on adding some tests and checks to make sure this is reliable and future-proof, and we'll release it as soon as we can.\n> https://github.com/CircleCI-Public/circleci-cli/issues/716#issuecomment-1680680789\n\n\n自分は一旦ローカルのconfigがバリデーションエラーでないかチェックするだけで充分だと思ったのでそれだけを使う予定です。\n","coediting":false,"comments_count":0,"created_at":"2023-10-17T18:30:58+09:00","group":null,"id":"3635fb6fbe8bcf2306b6","likes_count":1,"private":false,"reactions_count":0,"stocks_count":0,"tags":[{"name":"Mac","versions":[]},{"name":"Ubuntu","versions":[]},{"name":"CircleCI","versions":[]}],"title":"M1MacでCircleCIのローカルビルド失敗する","updated_at":"2023-10-17T18:30:58+09:00","url":"https://qiita.com/ykhirao/items/3635fb6fbe8bcf2306b6","user":{"description":"Web Developer From 2016.\r\nPHP/Laravel && React/TypeScript/Node.js\r\n\r\n業務委託の依頼とかはWantedlyとかからでお願いします！","facebook_id":"","followees_count":39,"followers_count":101,"github_login_name":"ykhirao","id":"ykhirao","items_count":83,"linkedin_id":"","location":"Tokyo, Japan","name":"yk","organization":"","permanent_id":112929,"profile_image_url":"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/112929/profile-images/1639030792","team_only":false,"twitter_screen_name":"ykhirao","website_url":"https://www.wantedly.com/id/ykhirao"},"page_views_count":null,"team_membership":null,"organization_url_name":null,"slide":false}},"path":"posts/3635fb6fbe8bcf2306b6"}
