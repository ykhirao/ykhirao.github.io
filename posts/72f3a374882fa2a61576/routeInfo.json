{"template":"__react_static_root__/src/components/QiitaPost","sharedHashesByProp":{},"data":{"post":{"rendered_body":"<p>本記事は<a href=\"https://qiita.com/advent-calendar/2018/openlogi\">OPENLOGI AdventCalendar</a> 15日目の記事です。</p>\n\n<h2>\n<span id=\"問題提起\" class=\"fragment\"></span><a href=\"#%E5%95%8F%E9%A1%8C%E6%8F%90%E8%B5%B7\"><i class=\"fa fa-link\"></i></a>問題提起</h2>\n\n<p>JSDOMの中で <strong>ピンク</strong> という色はどういう扱いを受けているか知っていますか？</p>\n\n<p><details><br>\ncolorのピンクはjsdomの中だとレンダーされなく、存在が消されています！<br>\nと思っていたのですが実装が変わったみたいです。<br>\nピンクはちゃんとレンダーされます。<br>\n<summary>答えだけ知りたいって方はこちらをクリックで <img alt=\":pray:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f64f.png\" title=\":pray:\" width=\"20\" loading=\"lazy\"></summary></details></p>\n\n<p>Vue.jsのコード例ですが触ったことないひともなんとなくわかるかと思う簡単な例にしてます。。<br>\nそれでは実際にコードを追ってみましょう。！！！</p>\n\n<h2>\n<span id=\"実コードみせる\" class=\"fragment\"></span><a href=\"#%E5%AE%9F%E3%82%B3%E3%83%BC%E3%83%89%E3%81%BF%E3%81%9B%E3%82%8B\"><i class=\"fa fa-link\"></i></a>実コードみせる</h2>\n\n<h3>\n<span id=\"ブラウザ編\" class=\"fragment\"></span><a href=\"#%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6%E7%B7%A8\"><i class=\"fa fa-link\"></i></a>ブラウザ編</h3>\n\n<p>こちらのコードを実際にWeb上でレンダーするとどうなるか見ていきたいと思います。</p>\n\n<p>Greeting.vue</p>\n\n<div class=\"code-frame\" data-lang=\"html\"><div class=\"highlight\"><pre><code><span class=\"nt\">&lt;template&gt;</span>\n  <span class=\"nt\">&lt;div&gt;</span>\n    color: <span class=\"nt\">&lt;span</span> <span class=\"na\">:style=</span><span class=\"s\">\"{ color: color }\"</span><span class=\"nt\">&gt;</span>{{ color }}<span class=\"nt\">&lt;/span&gt;</span>\n  <span class=\"nt\">&lt;/div&gt;</span>\n<span class=\"nt\">&lt;/template&gt;</span>\n\n<span class=\"nt\">&lt;script&gt;</span>\n<span class=\"k\">export</span> <span class=\"k\">default</span> <span class=\"p\">{</span>\n  <span class=\"na\">name</span><span class=\"p\">:</span> <span class=\"dl\">\"</span><span class=\"s2\">Greeting</span><span class=\"dl\">\"</span><span class=\"p\">,</span>\n  <span class=\"na\">props</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n    <span class=\"na\">color</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n      <span class=\"na\">type</span><span class=\"p\">:</span> <span class=\"nb\">String</span><span class=\"p\">,</span>\n      <span class=\"na\">default</span><span class=\"p\">:</span> <span class=\"dl\">\"</span><span class=\"s2\">blue</span><span class=\"dl\">\"</span>\n    <span class=\"p\">}</span>\n  <span class=\"p\">}</span>\n<span class=\"p\">};</span>\n<span class=\"nt\">&lt;/script&gt;</span>\n\n</code></pre></div></div>\n\n<p>吐き出されるHTML</p>\n\n<div class=\"code-frame\" data-lang=\"HTML\"><div class=\"highlight\"><pre><code><span class=\"nt\">&lt;div&gt;</span>color: <span class=\"nt\">&lt;span</span> <span class=\"na\">style=</span><span class=\"s\">\"color: blue;\"</span><span class=\"nt\">&gt;</span>blue<span class=\"nt\">&lt;/span&gt;&lt;/div&gt;</span>\n</code></pre></div></div>\n\n<p>画面で見るとこんな感じ</p>\n\n<p><a href=\"https://camo.qiitausercontent.com/d9094635d17d7ff50739e2545040a17dd69ca760/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131323932392f34353966383062622d396238332d346430632d393166322d3265313839633835353335362e706e67\" target=\"_blank\" rel=\"nofollow noopener\"><img width=\"451\" alt=\"スクリーンショット 2018-12-18 23.36.40.png\" src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2F459f80bb-9b83-4d0c-91f2-2e189c855356.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=d8cda6598a1985faa855ed617367ce5c\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/112929/459f80bb-9b83-4d0c-91f2-2e189c855356.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2F459f80bb-9b83-4d0c-91f2-2e189c855356.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=f1eabd2503790223e92b69161acb944d 1x\" loading=\"lazy\"></a></p>\n\n<p>CodeSandboxで実際に触ってみる場合はこちら。 <br>\n<a href=\"https://codesandbox.io/s/7w1kz03o8x\" rel=\"nofollow noopener\" target=\"_blank\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcodesandbox.io%2Fstatic%2Fimg%2Fplay-codesandbox.svg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=526b28505f6e4bb0243c164fb3253c6f\" alt=\"Edit Vue Template\" data-canonical-src=\"https://codesandbox.io/static/img/play-codesandbox.svg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcodesandbox.io%2Fstatic%2Fimg%2Fplay-codesandbox.svg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=b5efbb51ff9effbad6a4700c5e6ca1b9 1x\" loading=\"lazy\"></a></p>\n\n<h3>\n<span id=\"nodejs編\" class=\"fragment\"></span><a href=\"#nodejs%E7%B7%A8\"><i class=\"fa fa-link\"></i></a>node.js編</h3>\n\n<p>（（今年の八月くらいまでは））例えばVue-test-utilsとかブラウザに依存しない環境で</p>\n\n<div class=\"code-frame\" data-lang=\"HTML\"><div class=\"highlight\"><pre><code><span class=\"nt\">&lt;Greeting</span> <span class=\"na\">:color=</span><span class=\"s\">\"pink\"</span><span class=\"nt\">&gt;</span>\nをレンダーすると\n<span class=\"nt\">&lt;div&gt;</span>color: <span class=\"nt\">&lt;span</span> <span class=\"na\">style</span><span class=\"nt\">&gt;</span>pink<span class=\"nt\">&lt;/span&gt;&lt;/div&gt;</span>\nってなりました。\n</code></pre></div></div>\n\n<p>要するにピンクがスタイルとして認識されてなかったです。</p>\n\n<h2>\n<span id=\"仮想domのなかでどういう実装になっているか\" class=\"fragment\"></span><a href=\"#%E4%BB%AE%E6%83%B3dom%E3%81%AE%E3%81%AA%E3%81%8B%E3%81%A7%E3%81%A9%E3%81%86%E3%81%84%E3%81%86%E5%AE%9F%E8%A3%85%E3%81%AB%E3%81%AA%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B%E3%81%8B\"><i class=\"fa fa-link\"></i></a>仮想DOMのなかでどういう実装になっているか</h2>\n\n<p>JSDOMのなかでのカラーレンダリングとかはchad3814/CSSStyleDeclarationというライブラリに依存していました。</p>\n\n<p>そのなかの <a href=\"https://github.com/chad3814/CSSStyleDeclaration/blob/5c51d1657f8b693d46744e05239c24ae03be57e5/lib/parsers.js#L100-L116\" rel=\"nofollow noopener\" target=\"_blank\">ここらへん</a></p>\n\n<div class=\"code-frame\" data-lang=\"js\"><div class=\"highlight\"><pre><code>    <span class=\"k\">case</span> <span class=\"dl\">'</span><span class=\"s1\">maroon</span><span class=\"dl\">'</span><span class=\"p\">:</span>\n    <span class=\"k\">case</span> <span class=\"dl\">'</span><span class=\"s1\">red</span><span class=\"dl\">'</span><span class=\"p\">:</span>\n    <span class=\"k\">case</span> <span class=\"dl\">'</span><span class=\"s1\">orange</span><span class=\"dl\">'</span><span class=\"p\">:</span>\n    <span class=\"k\">case</span> <span class=\"dl\">'</span><span class=\"s1\">yellow</span><span class=\"dl\">'</span><span class=\"p\">:</span>\n    <span class=\"k\">case</span> <span class=\"dl\">'</span><span class=\"s1\">olive</span><span class=\"dl\">'</span><span class=\"p\">:</span>\n    <span class=\"k\">case</span> <span class=\"dl\">'</span><span class=\"s1\">purple</span><span class=\"dl\">'</span><span class=\"p\">:</span>\n    <span class=\"k\">case</span> <span class=\"dl\">'</span><span class=\"s1\">fuchsia</span><span class=\"dl\">'</span><span class=\"p\">:</span>\n    <span class=\"k\">case</span> <span class=\"dl\">'</span><span class=\"s1\">white</span><span class=\"dl\">'</span><span class=\"p\">:</span>\n    <span class=\"k\">case</span> <span class=\"dl\">'</span><span class=\"s1\">lime</span><span class=\"dl\">'</span><span class=\"p\">:</span>\n    <span class=\"k\">case</span> <span class=\"dl\">'</span><span class=\"s1\">green</span><span class=\"dl\">'</span><span class=\"p\">:</span>\n    <span class=\"k\">case</span> <span class=\"dl\">'</span><span class=\"s1\">navy</span><span class=\"dl\">'</span><span class=\"p\">:</span>\n    <span class=\"k\">case</span> <span class=\"dl\">'</span><span class=\"s1\">blue</span><span class=\"dl\">'</span><span class=\"p\">:</span>\n    <span class=\"k\">case</span> <span class=\"dl\">'</span><span class=\"s1\">aqua</span><span class=\"dl\">'</span><span class=\"p\">:</span>\n    <span class=\"k\">case</span> <span class=\"dl\">'</span><span class=\"s1\">teal</span><span class=\"dl\">'</span><span class=\"p\">:</span>\n    <span class=\"k\">case</span> <span class=\"dl\">'</span><span class=\"s1\">black</span><span class=\"dl\">'</span><span class=\"p\">:</span>\n    <span class=\"k\">case</span> <span class=\"dl\">'</span><span class=\"s1\">silver</span><span class=\"dl\">'</span><span class=\"p\">:</span>\n    <span class=\"k\">case</span> <span class=\"dl\">'</span><span class=\"s1\">gray</span><span class=\"dl\">'</span><span class=\"p\">:</span>\n</code></pre></div></div>\n\n<p>この色しか使えなかったのです。ピンクはありませんね。もしピンクをどうしてもVue-test-utilsのテストで使いたいならこのライブラリをフォークして <code>cace pink</code> を追加すると大丈夫な仕様になっていました。</p>\n\n<p><a href=\"https://github.com/jsdom/jsdom/issues/1965\" rel=\"nofollow noopener\" target=\"_blank\">このあたり</a>にとても詳しくかかれていますが、「JSDOMはpinkプロパティをセットできねーぜ」ってイシューが建てられていました。</p>\n\n<ul>\n<li>JSDOM doesn't retrieve the \"*style.backgroundColor = 'pink'\" property set on a table row #1965</li>\n</ul>\n\n<h2>\n<span id=\"書き換えてみる\" class=\"fragment\"></span><a href=\"#%E6%9B%B8%E3%81%8D%E6%8F%9B%E3%81%88%E3%81%A6%E3%81%BF%E3%82%8B\"><i class=\"fa fa-link\"></i></a>書き換えてみる</h2>\n\n<p>node_modules/からCSSStyleDeclarationの部分を書き換えるとレンダリングされました。</p>\n\n<h2>\n<span id=\"jsdomのイシュー読んでみた\" class=\"fragment\"></span><a href=\"#jsdom%E3%81%AE%E3%82%A4%E3%82%B7%E3%83%A5%E3%83%BC%E8%AA%AD%E3%82%93%E3%81%A7%E3%81%BF%E3%81%9F\"><i class=\"fa fa-link\"></i></a>jsdomのイシュー読んでみた</h2>\n\n<p><a href=\"https://github.com/jsdom/jsdom/issues/1965\" rel=\"nofollow noopener\" target=\"_blank\">このあたり</a>のイシューを読んでみた</p>\n\n<blockquote>\n<p>We don't support getting the style property as JS properties on style for now. You would have to use tr.style.getPropertyValue(). I believe @Zirro is working on a rewrite of the entire CSSOM support in jsdom, though, which should bring support for this feature.</p>\n</blockquote>\n\n<p>ZirroさんのJSDOMのCSS部分の書き換えが終わり無事にピンクが使えるようになりました。</p>\n\n<h2>\n<span id=\"終わりに\" class=\"fragment\"></span><a href=\"#%E7%B5%82%E3%82%8F%E3%82%8A%E3%81%AB\"><i class=\"fa fa-link\"></i></a>終わりに</h2>\n\n<p>今回「JSDOMだとピンクが使えないよ！」って話を書こうとしたらまさかのすでに対応済みでかなり焦りました。内容の薄い感じになりましたが、ライブラリの実装とかイシューとか少しおってみたので楽しかったです。</p>\n","body":"本記事は[OPENLOGI AdventCalendar](https://qiita.com/advent-calendar/2018/openlogi) 15日目の記事です。\n\n## 問題提起\n\nJSDOMの中で **ピンク** という色はどういう扱いを受けているか知っていますか？\n\n<details>\ncolorのピンクはjsdomの中だとレンダーされなく、存在が消されています！\nと思っていたのですが実装が変わったみたいです。\nピンクはちゃんとレンダーされます。\n<summary>答えだけ知りたいって方はこちらをクリックで :pray:</summary>\n\nVue.jsのコード例ですが触ったことないひともなんとなくわかるかと思う簡単な例にしてます。。\nそれでは実際にコードを追ってみましょう。！！！\n\n## 実コードみせる\n\n\n### ブラウザ編\n\nこちらのコードを実際にWeb上でレンダーするとどうなるか見ていきたいと思います。\n\nGreeting.vue\n\n```html\n<template>\n  <div>\n    color: <span :style=\"{ color: color }\">{{ color }}</span>\n  </div>\n</template>\n\n<script>\nexport default {\n  name: \"Greeting\",\n  props: {\n    color: {\n      type: String,\n      default: \"blue\"\n    }\n  }\n};\n</script>\n\n```\n\n吐き出されるHTML\n\n```HTML\n<div>color: <span style=\"color: blue;\">blue</span></div>\n```\n\n画面で見るとこんな感じ\n\n<img width=\"451\" alt=\"スクリーンショット 2018-12-18 23.36.40.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/112929/459f80bb-9b83-4d0c-91f2-2e189c855356.png\">\n\nCodeSandboxで実際に触ってみる場合はこちら。 \n[![Edit Vue Template](https://codesandbox.io/static/img/play-codesandbox.svg)](https://codesandbox.io/s/7w1kz03o8x)\n\n### node.js編\n\n（（今年の八月くらいまでは））例えばVue-test-utilsとかブラウザに依存しない環境で\n\n```HTML\n<Greeting :color=\"pink\">\nをレンダーすると\n<div>color: <span style>pink</span></div>\nってなりました。\n```\n\n要するにピンクがスタイルとして認識されてなかったです。\n\n## 仮想DOMのなかでどういう実装になっているか\n\nJSDOMのなかでのカラーレンダリングとかはchad3814/CSSStyleDeclarationというライブラリに依存していました。\n\nそのなかの [ここらへん](https://github.com/chad3814/CSSStyleDeclaration/blob/5c51d1657f8b693d46744e05239c24ae03be57e5/lib/parsers.js#L100-L116)\n\n```js\n    case 'maroon':\n    case 'red':\n    case 'orange':\n    case 'yellow':\n    case 'olive':\n    case 'purple':\n    case 'fuchsia':\n    case 'white':\n    case 'lime':\n    case 'green':\n    case 'navy':\n    case 'blue':\n    case 'aqua':\n    case 'teal':\n    case 'black':\n    case 'silver':\n    case 'gray':\n```\n\nこの色しか使えなかったのです。ピンクはありませんね。もしピンクをどうしてもVue-test-utilsのテストで使いたいならこのライブラリをフォークして `cace pink` を追加すると大丈夫な仕様になっていました。\n\n[このあたり](https://github.com/jsdom/jsdom/issues/1965)にとても詳しくかかれていますが、「JSDOMはpinkプロパティをセットできねーぜ」ってイシューが建てられていました。\n\n- JSDOM doesn't retrieve the \"*style.backgroundColor = 'pink'\" property set on a table row #1965\n\n## 書き換えてみる\n\nnode_modules/からCSSStyleDeclarationの部分を書き換えるとレンダリングされました。\n\n## jsdomのイシュー読んでみた\n\n[このあたり](https://github.com/jsdom/jsdom/issues/1965)のイシューを読んでみた\n\n> We don't support getting the style property as JS properties on style for now. You would have to use tr.style.getPropertyValue(). I believe @Zirro is working on a rewrite of the entire CSSOM support in jsdom, though, which should bring support for this feature.\n\nZirroさんのJSDOMのCSS部分の書き換えが終わり無事にピンクが使えるようになりました。\n\n## 終わりに\n\n今回「JSDOMだとピンクが使えないよ！」って話を書こうとしたらまさかのすでに対応済みでかなり焦りました。内容の薄い感じになりましたが、ライブラリの実装とかイシューとか少しおってみたので楽しかったです。\n\n","coediting":false,"comments_count":0,"created_at":"2018-12-20T00:32:33+09:00","group":null,"id":"72f3a374882fa2a61576","likes_count":9,"private":false,"reactions_count":0,"tags":[{"name":"JavaScript","versions":[]},{"name":"jsdom","versions":[]},{"name":"Vue.js","versions":[]},{"name":"仮想DOM","versions":[]}],"title":"JSDOMからピンクを探せ！！","updated_at":"2018-12-20T00:32:33+09:00","url":"https://qiita.com/ykhirao/items/72f3a374882fa2a61576","user":{"description":"Web Developer For 6 years.\r\nPHP/Laravel && (React OR Vue.js)\r\nTypeScript/node.js\r\n\r\n業務委託の依頼とかはWantedlyとかからでお願いします！","facebook_id":"","followees_count":39,"followers_count":94,"github_login_name":"ykhirao","id":"ykhirao","items_count":58,"linkedin_id":"","location":"Tokyo, Japan","name":"yk","organization":"","permanent_id":112929,"profile_image_url":"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/112929/profile-images/1639030792","team_only":false,"twitter_screen_name":"yk_hirao","website_url":"https://www.wantedly.com/id/ykhirao"},"page_views_count":null,"team_membership":null}},"path":"posts/72f3a374882fa2a61576"}
