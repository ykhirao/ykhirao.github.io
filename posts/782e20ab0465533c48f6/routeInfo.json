{"template":"__react_static_root__/src/components/QiitaPost","sharedHashesByProp":{},"data":{"post":{"rendered_body":"\n<h1>\n<span id=\"月末って忙しいよね\" class=\"fragment\"></span><a href=\"#%E6%9C%88%E6%9C%AB%E3%81%A3%E3%81%A6%E5%BF%99%E3%81%97%E3%81%84%E3%82%88%E3%81%AD\"><i class=\"fa fa-link\"></i></a>月末って忙しいよね…</h1>\n\n<p>月末って報告書とか、領収証とか…なんかたくさん出さなきゃいけないものあるよね。センパイが「誰か作って」って言ってたのをGoogle apps scriptで作成しました。<br>\nGoogle apps script[GAS]触りだして4日目くらいですが、かなり便利なのでエンジニア以外のもっとたくさんの人に触れて欲しいなと思い、連日ですがGASの実用例をあげたいと思います。</p>\n\n<h1>\n<span id=\"完成品\" class=\"fragment\"></span><a href=\"#%E5%AE%8C%E6%88%90%E5%93%81\"><i class=\"fa fa-link\"></i></a>完成品</h1>\n\n<p>月末の営業日にSlack投げるだけのシンプルな実装です。<br>\nコピペすれば10分で実装いけるんじゃないかと！</p>\n\n<p><a href=\"https://camo.qiitausercontent.com/b149deb75bd6943500f82a6c5d8d688217114df0/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131323932392f65366537633034382d336463642d303934382d306430642d3539376266313438616534642e6a706567\" target=\"_blank\" rel=\"nofollow noopener\"><img width=\"555\" alt=\"スクリーンショット 2017-03-06 21.29.19.jpg\" src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2Fe6e7c048-3dcd-0948-0d0d-597bf148ae4d.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=db2b6d3bde4acf38d998fc70597a61ff\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/112929/e6e7c048-3dcd-0948-0d0d-597bf148ae4d.jpeg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2Fe6e7c048-3dcd-0948-0d0d-597bf148ae4d.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=b80bcb2bc2bc1b56c1da86ddedf85763 1x\" loading=\"lazy\"></a></p>\n\n<h2>\n<span id=\"完成までに使用するもの\" class=\"fragment\"></span><a href=\"#%E5%AE%8C%E6%88%90%E3%81%BE%E3%81%A7%E3%81%AB%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B%E3%82%82%E3%81%AE\"><i class=\"fa fa-link\"></i></a>完成までに使用するもの</h2>\n\n<p>Googleアカウント[Google Apps Script]<br>\nSlack</p>\n\n<h2>\n<span id=\"完成したら\" class=\"fragment\"></span><a href=\"#%E5%AE%8C%E6%88%90%E3%81%97%E3%81%9F%E3%82%89\"><i class=\"fa fa-link\"></i></a>完成したら</h2>\n\n<p>以下の2つもコード公開します<br>\n* 月初めの営業日になにかをする<br>\n* 月始めの第一金曜日になにかをする</p>\n\n<p>つまりこれを応用すれば、いつ何時でもSlackで自動チャットを飛ばせるようになる。</p>\n\n<h1>\n<span id=\"月末締め\" class=\"fragment\"></span><a href=\"#%E6%9C%88%E6%9C%AB%E7%B7%A0%E3%82%81\"><i class=\"fa fa-link\"></i></a>月末締め…！！</h1>\n\n<p>画像ありでどんどんいくよ〜〜</p>\n\n<h2>\n<span id=\"slack-tokenの取得\" class=\"fragment\"></span><a href=\"#slack-token%E3%81%AE%E5%8F%96%E5%BE%97\"><i class=\"fa fa-link\"></i></a>Slack Tokenの取得</h2>\n\n<p>ここを参考にしてみて！<br>\n<a href=\"http://qiita.com/ykhirao/items/0d6b9f4a0cc626884dbb\" class=\"autolink\" id=\"reference-a3696fbcff57fc2bef93\">http://qiita.com/ykhirao/items/0d6b9f4a0cc626884dbb</a></p>\n\n<p>xoxp-18127　こんな感じの長い数字。</p>\n\n<p>Slack持ってない人は<a href=\"http://qiita.com/saitotak/items/ac0eb7ddc0d8d83cbe91\" id=\"reference-c27f8c53fed184064594\">個人Slackのススメ</a>にしたがって導入をすすめます。</p>\n\n<h2>\n<span id=\"gasの導入\" class=\"fragment\"></span><a href=\"#gas%E3%81%AE%E5%B0%8E%E5%85%A5\"><i class=\"fa fa-link\"></i></a>GASの導入</h2>\n\n<p>Googleドライブにアクセス<br>\n<a href=\"https://drive.google.com/drive/my-drive\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\">https://drive.google.com/drive/my-drive</a></p>\n\n<p><a href=\"https://camo.qiitausercontent.com/1bb999134bf657ebc975ba39db895e0f36c15e55/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131323932392f66303630333130352d656232332d613763612d353362652d3865353933643130343531362e6a706567\" target=\"_blank\" rel=\"nofollow noopener\"><img width=\"1192\" alt=\"スクリーンショット 2017-03-06 21.59.16.jpg\" src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2Ff0603105-eb23-a7ca-53be-8e593d104516.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=3d95220c7d0ec307b0b324bb8d73aaab\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/112929/f0603105-eb23-a7ca-53be-8e593d104516.jpeg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2Ff0603105-eb23-a7ca-53be-8e593d104516.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=68314d0b8ed179a3da5a49d9d6b4f9b6 1x\" loading=\"lazy\"></a></p>\n\n<p><code>新規 &gt;&gt; その他 &gt;&gt; アプリを追加</code><br>\nから Google apps script を検索・追加</p>\n\n<p><a href=\"https://camo.qiitausercontent.com/596401421f94304589195d90bbb93d19d32c5092/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131323932392f35663537396630642d326432342d333462362d383633342d6137663066343836393533372e6a706567\" target=\"_blank\" rel=\"nofollow noopener\"><img width=\"1196\" alt=\"スクリーンショット 2017-03-06 22.00.23.jpg\" src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2F5f579f0d-2d24-34b6-8634-a7f0f4869537.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=0027e01d18fcdad909aeda9c3be9d951\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/112929/5f579f0d-2d24-34b6-8634-a7f0f4869537.jpeg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2F5f579f0d-2d24-34b6-8634-a7f0f4869537.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=3aa8708c5121478d83d7e4c59f2526c4 1x\" loading=\"lazy\"></a></p>\n\n<p>そうすると<code>新規 &gt;&gt; その他 &gt;&gt; Google apps script</code>を押してみてください。<br>\nGAS画面になると思います。</p>\n\n<h2>\n<span id=\"gasの編集\" class=\"fragment\"></span><a href=\"#gas%E3%81%AE%E7%B7%A8%E9%9B%86\"><i class=\"fa fa-link\"></i></a>GASの編集</h2>\n\n<p><a href=\"https://camo.qiitausercontent.com/ca5e3c94c0855ef18d78bc41926692f9d7dc8f04/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131323932392f66636661393739642d323635322d663739352d633562612d6362376465343063616230322e6a706567\" target=\"_blank\" rel=\"nofollow noopener\"><img width=\"816\" alt=\"スクリーンショット 2017-03-06 22.23.56.jpg\" src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2Ffcfa979d-2652-f795-c5ba-cb7de40cab02.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=f194163c0f34c56245cc49838e67f960\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/112929/fcfa979d-2652-f795-c5ba-cb7de40cab02.jpeg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2Ffcfa979d-2652-f795-c5ba-cb7de40cab02.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=6f030ab2a9355861517cfef200d34f54 1x\" loading=\"lazy\"></a></p>\n\n<p>メインの部分にこれを貼り付けてみよう！</p>\n\n<div class=\"code-frame\" data-lang=\"js\"><div class=\"highlight\"><pre><code>\n<span class=\"cm\">/*\n  メインの処理\n  setTriggerDay() : 最終営業日(0時)に次の処理をする命令を出す。\n  setTriggerHoursLast() : 最終営業日の18時に次の命令を出す。\n  sendSlack() : slackにデータを投げる。\n\n  サブ的な処理\n  deleteTrigger() : 蓄積されている命令を削除する\n  lastBusinessDay() : 今月の最終営業日を求める\n  isHoliday() : 本日が[日本の祝日]かどうかチェック。土日は曜日で判定してるチェック\n  .getDay()　: Dateオブジェクトから曜日を求めるメソッド(0:日, 6:土曜日)\n*/</span>\n\n<span class=\"kd\">function</span> <span class=\"nx\">setTriggerDay</span><span class=\"p\">()</span>\n<span class=\"p\">{</span>  \n  <span class=\"kd\">var</span> <span class=\"nx\">last</span> <span class=\"o\">=</span> <span class=\"nx\">lastBusinessDay</span><span class=\"p\">();</span>\n  <span class=\"nx\">ScriptApp</span><span class=\"p\">.</span><span class=\"nx\">newTrigger</span><span class=\"p\">(</span><span class=\"dl\">\"</span><span class=\"s2\">setTriggerHoursLast</span><span class=\"dl\">\"</span><span class=\"p\">)</span>\n    <span class=\"p\">.</span><span class=\"nx\">timeBased</span><span class=\"p\">()</span>\n    <span class=\"p\">.</span><span class=\"nx\">atDate</span><span class=\"p\">(</span><span class=\"nx\">last</span><span class=\"p\">.</span><span class=\"nx\">getFullYear</span><span class=\"p\">(),</span> <span class=\"nx\">last</span><span class=\"p\">.</span><span class=\"nx\">getMonth</span><span class=\"p\">()</span><span class=\"o\">+</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"nx\">last</span><span class=\"p\">.</span><span class=\"nx\">getDate</span><span class=\"p\">())</span>\n    <span class=\"p\">.</span><span class=\"nx\">create</span><span class=\"p\">();</span>\n<span class=\"p\">}</span>\n\n<span class=\"kd\">function</span> <span class=\"nx\">setTriggerHoursLast</span><span class=\"p\">()</span>\n<span class=\"p\">{</span>\n  <span class=\"nx\">deleteTrigger</span><span class=\"p\">(</span><span class=\"dl\">\"</span><span class=\"s2\">setTriggerHoursLast</span><span class=\"dl\">\"</span><span class=\"p\">);</span>\n  <span class=\"nx\">ScriptApp</span><span class=\"p\">.</span><span class=\"nx\">newTrigger</span><span class=\"p\">(</span><span class=\"dl\">\"</span><span class=\"s2\">sendSlack</span><span class=\"dl\">\"</span><span class=\"p\">)</span>\n    <span class=\"p\">.</span><span class=\"nx\">timeBased</span><span class=\"p\">()</span>\n    <span class=\"p\">.</span><span class=\"nx\">after</span><span class=\"p\">(</span> <span class=\"mi\">18</span> <span class=\"o\">*</span> <span class=\"mi\">60</span> <span class=\"o\">*</span> <span class=\"mi\">60</span> <span class=\"o\">*</span> <span class=\"mi\">1000</span> <span class=\"p\">)</span>\n    <span class=\"p\">.</span><span class=\"nx\">create</span><span class=\"p\">();</span>\n<span class=\"p\">}</span>\n\n<span class=\"kd\">function</span> <span class=\"nx\">sendSlack</span><span class=\"p\">()</span> \n<span class=\"p\">{</span>\n  <span class=\"nx\">deleteTrigger</span><span class=\"p\">(</span><span class=\"dl\">\"</span><span class=\"s2\">sendSlack</span><span class=\"dl\">\"</span><span class=\"p\">);</span>\n  <span class=\"kd\">var</span> <span class=\"nx\">options</span> <span class=\"o\">=</span> \n  <span class=\"p\">{</span>\n    <span class=\"dl\">\"</span><span class=\"s2\">method</span><span class=\"dl\">\"</span> <span class=\"p\">:</span> <span class=\"dl\">\"</span><span class=\"s2\">POST</span><span class=\"dl\">\"</span><span class=\"p\">,</span>\n    <span class=\"dl\">\"</span><span class=\"s2\">payload</span><span class=\"dl\">\"</span> <span class=\"p\">:</span> \n    <span class=\"p\">{</span>\n      <span class=\"dl\">\"</span><span class=\"s2\">token</span><span class=\"dl\">\"</span><span class=\"p\">:</span> <span class=\"dl\">\"</span><span class=\"s2\">********************</span><span class=\"dl\">\"</span><span class=\"p\">,</span>\n      <span class=\"dl\">\"</span><span class=\"s2\">channel</span><span class=\"dl\">\"</span><span class=\"p\">:</span> <span class=\"dl\">\"</span><span class=\"s2\">bot-test</span><span class=\"dl\">\"</span><span class=\"p\">,</span>\n      <span class=\"dl\">\"</span><span class=\"s2\">text</span><span class=\"dl\">\"</span><span class=\"p\">:</span> <span class=\"dl\">\"</span><span class=\"s2\">領収書出しましたか？忘れてないよね。</span><span class=\"se\">\\</span><span class=\"s2\">ｎhttp://.../</span><span class=\"dl\">\"</span>\n    <span class=\"p\">}</span>\n  <span class=\"p\">}</span>\n  <span class=\"kd\">var</span> <span class=\"nx\">url</span> <span class=\"o\">=</span> <span class=\"dl\">\"</span><span class=\"s2\">https://slack.com/api/chat.postMessage</span><span class=\"dl\">\"</span>\n  <span class=\"nx\">UrlFetchApp</span><span class=\"p\">.</span><span class=\"nx\">fetch</span><span class=\"p\">(</span><span class=\"nx\">url</span><span class=\"p\">,</span> <span class=\"nx\">options</span><span class=\"p\">);</span>\n<span class=\"p\">}</span>\n\n<span class=\"kd\">function</span> <span class=\"nx\">lastBusinessDay</span><span class=\"p\">()</span> \n<span class=\"p\">{</span>\n  <span class=\"kd\">var</span> <span class=\"nx\">today</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nb\">Date</span><span class=\"p\">();</span>\n\n  <span class=\"kd\">var</span> <span class=\"nx\">lastDayOfThisMonth</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nb\">Date</span><span class=\"p\">(</span><span class=\"nx\">today</span><span class=\"p\">.</span><span class=\"nx\">getFullYear</span><span class=\"p\">(),</span> <span class=\"nx\">today</span><span class=\"p\">.</span><span class=\"nx\">getMonth</span><span class=\"p\">()</span><span class=\"o\">+</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">);</span>\n  <span class=\"kd\">var</span> <span class=\"nx\">day</span><span class=\"p\">;</span> <span class=\"c1\">// 0-&gt;日曜日</span>\n\n  <span class=\"k\">for</span> <span class=\"p\">(</span><span class=\"kd\">var</span> <span class=\"nx\">i</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"p\">;</span> <span class=\"nx\">i</span> <span class=\"o\">&lt;</span> <span class=\"mi\">30</span><span class=\"p\">;</span> <span class=\"nx\">i</span><span class=\"o\">++</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"nx\">day</span> <span class=\"o\">=</span> <span class=\"nx\">lastDayOfThisMonth</span><span class=\"p\">.</span><span class=\"nx\">getDay</span><span class=\"p\">();</span>\n    <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"nx\">day</span> <span class=\"o\">==</span> <span class=\"mi\">0</span> <span class=\"o\">||</span> <span class=\"nx\">day</span> <span class=\"o\">==</span> <span class=\"mi\">6</span> <span class=\"o\">||</span> <span class=\"nx\">isHoliday</span><span class=\"p\">(</span><span class=\"nx\">lastDayOfThisMonth</span><span class=\"p\">))</span> <span class=\"p\">{</span>\n      <span class=\"nx\">lastDayOfThisMonth</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nb\">Date</span><span class=\"p\">(</span><span class=\"nx\">today</span><span class=\"p\">.</span><span class=\"nx\">getFullYear</span><span class=\"p\">(),</span> <span class=\"nx\">today</span><span class=\"p\">.</span><span class=\"nx\">getMonth</span><span class=\"p\">()</span><span class=\"o\">+</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mi\">1</span> <span class=\"o\">*</span> <span class=\"nx\">i</span><span class=\"p\">);</span>\n      <span class=\"k\">continue</span><span class=\"p\">;</span>\n    <span class=\"p\">}</span>\n  <span class=\"p\">}</span>\n  <span class=\"k\">return</span> <span class=\"nx\">lastDayOfThisMonth</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"kd\">function</span> <span class=\"nx\">deleteTrigger</span><span class=\"p\">(</span><span class=\"nx\">name</span><span class=\"p\">)</span> \n<span class=\"p\">{</span>\n  <span class=\"kd\">var</span> <span class=\"nx\">triggers</span> <span class=\"o\">=</span> <span class=\"nx\">ScriptApp</span><span class=\"p\">.</span><span class=\"nx\">getProjectTriggers</span><span class=\"p\">();</span>\n  <span class=\"k\">for</span><span class=\"p\">(</span><span class=\"kd\">var</span> <span class=\"nx\">i</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">;</span> <span class=\"nx\">i</span> <span class=\"o\">&lt;</span> <span class=\"nx\">triggers</span><span class=\"p\">.</span><span class=\"nx\">length</span><span class=\"p\">;</span> <span class=\"nx\">i</span><span class=\"o\">++</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"nx\">triggers</span><span class=\"p\">[</span><span class=\"nx\">i</span><span class=\"p\">].</span><span class=\"nx\">getHandlerFunction</span><span class=\"p\">()</span> <span class=\"o\">==</span> <span class=\"nx\">name</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n      <span class=\"nx\">ScriptApp</span><span class=\"p\">.</span><span class=\"nx\">deleteTrigger</span><span class=\"p\">(</span><span class=\"nx\">triggers</span><span class=\"p\">[</span><span class=\"nx\">i</span><span class=\"p\">]);</span>\n    <span class=\"p\">}</span>\n  <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n\n<span class=\"kd\">function</span> <span class=\"nx\">isHoliday</span><span class=\"p\">(</span><span class=\"nx\">day</span><span class=\"p\">)</span> \n<span class=\"p\">{</span>\n  <span class=\"kd\">var</span> <span class=\"nx\">startDate</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nb\">Date</span><span class=\"p\">(</span><span class=\"nx\">day</span><span class=\"p\">.</span><span class=\"nx\">setHours</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">));</span>\n  <span class=\"kd\">var</span> <span class=\"nx\">endDate</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nb\">Date</span><span class=\"p\">(</span><span class=\"nx\">day</span><span class=\"p\">.</span><span class=\"nx\">setHours</span><span class=\"p\">(</span><span class=\"mi\">23</span><span class=\"p\">,</span> <span class=\"mi\">59</span><span class=\"p\">,</span> <span class=\"mi\">59</span><span class=\"p\">));</span>\n  <span class=\"kd\">var</span> <span class=\"nx\">cal</span> <span class=\"o\">=</span> <span class=\"nx\">CalendarApp</span><span class=\"p\">.</span><span class=\"nx\">getCalendarById</span><span class=\"p\">(</span><span class=\"dl\">\"</span><span class=\"s2\">ja.japanese#holiday@group.v.calendar.google.com</span><span class=\"dl\">\"</span><span class=\"p\">);</span>\n  <span class=\"kd\">var</span> <span class=\"nx\">holidays</span> <span class=\"o\">=</span>  <span class=\"nx\">cal</span><span class=\"p\">.</span><span class=\"nx\">getEvents</span><span class=\"p\">(</span><span class=\"nx\">startDate</span><span class=\"p\">,</span> <span class=\"nx\">endDate</span><span class=\"p\">);</span>\n  <span class=\"k\">return</span> <span class=\"nx\">holidays</span><span class=\"p\">.</span><span class=\"nx\">length</span> <span class=\"o\">!=</span> <span class=\"mi\">0</span><span class=\"p\">;</span> <span class=\"c1\">// 祝日ならtrue</span>\n<span class=\"p\">}</span>\n\n</code></pre></div></div>\n\n<p>sendSlackのここは個人設定に変えてください！</p>\n\n<ul>\n<li>\"token\": \"********************\",</li>\n<li>\"channel\": \"bot-test\",</li>\n<li>\"text\": \"領収書出しましたか？忘れてないよね。\\ｎhttp://.../\"</li>\n</ul>\n\n<h2>\n<span id=\"settriggerdayの実行と取り消しと毎月実行\" class=\"fragment\"></span><a href=\"#settriggerday%E3%81%AE%E5%AE%9F%E8%A1%8C%E3%81%A8%E5%8F%96%E3%82%8A%E6%B6%88%E3%81%97%E3%81%A8%E6%AF%8E%E6%9C%88%E5%AE%9F%E8%A1%8C\"><i class=\"fa fa-link\"></i></a>setTriggerDay()の実行と取り消しと毎月実行</h2>\n\n<p>実行 &gt;&gt; setTriggerDay<br>\nをおしてみよう。</p>\n\n<p><a href=\"https://camo.qiitausercontent.com/2943d9ffc3472a260a7b8b49cf1dd129d6215eaa/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131323932392f36656238366532392d613466392d346664302d653632642d3736613861663233336137322e6a706567\" target=\"_blank\" rel=\"nofollow noopener\"><img width=\"527\" alt=\"スクリーンショット 2017-03-06 22.26.52.jpg\" src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2F6eb86e29-a4f9-4fd0-e62d-76a8af233a72.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=41f721b304f5cec115d59b983c938b0b\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/112929/6eb86e29-a4f9-4fd0-e62d-76a8af233a72.jpeg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2F6eb86e29-a4f9-4fd0-e62d-76a8af233a72.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=e1491c09dfdf657c2ef3aff033538ed5 1x\" loading=\"lazy\"></a></p>\n\n<p>リソース &gt;&gt; 現在のプロジェクトのトリガー<br>\nここからトリガー（何時にあれを実行しなさい）を確認できます。</p>\n\n<p><a href=\"https://camo.qiitausercontent.com/3b08a873f77b7d6e66e6950e4b4d91c82fd6c443/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131323932392f64616566616139312d353166632d306662662d343035372d6233313663386265343562312e6a706567\" target=\"_blank\" rel=\"nofollow noopener\"><img width=\"648\" alt=\"スクリーンショット 2017-03-06 22.27.40.jpg\" src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2Fdaefaa91-51fc-0fbf-4057-b316c8be45b1.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=962a2c45562cefc53b007fdfc8ff1fc8\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/112929/daefaa91-51fc-0fbf-4057-b316c8be45b1.jpeg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2Fdaefaa91-51fc-0fbf-4057-b316c8be45b1.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=2b7a193799802c5662a3b3b0c37d5e9e 1x\" loading=\"lazy\"></a></p>\n\n<p>ここで 2017/03/21 夜中丁度に setTriggerHoursLast が実行されるようになっていたら大丈夫。setTriggerHoursLastは18時間後にSlack送りなさいという命令です。</p>\n\n<p><a href=\"https://camo.qiitausercontent.com/7e6b6f79bffa7dac4f99d0ed7c62440e61ac39e6/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131323932392f62623663663961322d616566372d373639632d633639622d6261346561613962336539382e6a706567\" target=\"_blank\" rel=\"nofollow noopener\"><img width=\"838\" alt=\"スクリーンショット 2017-03-06 22.27.47.jpg\" src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2Fbb6cf9a2-aef7-769c-c69b-ba4eaa9b3e98.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=19baf0caf865485764a2109df380591b\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/112929/bb6cf9a2-aef7-769c-c69b-ba4eaa9b3e98.jpeg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2Fbb6cf9a2-aef7-769c-c69b-ba4eaa9b3e98.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=230c496677d16423f56ac98744f89e3d 1x\" loading=\"lazy\"></a></p>\n\n<p>またついでにこの画面でsetTriggerDayを毎月1日6時くらいにセットします。</p>\n\n<p><a href=\"https://camo.qiitausercontent.com/03a0f1662ae9b4984279eca9bed6bfc52894518b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131323932392f33323838633963382d646561372d356264642d656566612d3433666337373335666366622e6a706567\" target=\"_blank\" rel=\"nofollow noopener\"><img width=\"836\" alt=\"スクリーンショット 2017-03-06 22.37.18.jpg\" src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2F3288c9c8-dea7-5bdd-eefa-43fc7735fcfb.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=617a1a8877077bb4ae243b8b31e33d37\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/112929/3288c9c8-dea7-5bdd-eefa-43fc7735fcfb.jpeg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2F3288c9c8-dea7-5bdd-eefa-43fc7735fcfb.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=f2dd1d807c95f0919a362633f312b55c 1x\" loading=\"lazy\"></a></p>\n\n<p>そうすると毎月1日にsetTriggerDayが実行されて<br>\n-&gt; setTriggerDay :最終日に次を実行<br>\n-&gt; setTriggerHoursLast :18時に次を実行<br>\n-&gt; sendSlack :Slackを実行</p>\n\n<p>って感じで毎月、最終日トリガーを作成してくれます。</p>\n\n<h2>\n<span id=\"functionごとに見ていく\" class=\"fragment\"></span><a href=\"#function%E3%81%94%E3%81%A8%E3%81%AB%E8%A6%8B%E3%81%A6%E3%81%84%E3%81%8F\"><i class=\"fa fa-link\"></i></a>functionごとに見ていく</h2>\n\n<p>簡単にみていきます。</p>\n\n<h3>\n<span id=\"settriggerday\" class=\"fragment\"></span><a href=\"#settriggerday\"><i class=\"fa fa-link\"></i></a>setTriggerDay</h3>\n\n<div class=\"code-frame\" data-lang=\"js\"><div class=\"highlight\"><pre><code><span class=\"kd\">function</span> <span class=\"nx\">setTriggerDay</span><span class=\"p\">()</span>\n<span class=\"p\">{</span>  \n  <span class=\"kd\">var</span> <span class=\"nx\">last</span> <span class=\"o\">=</span> <span class=\"nx\">lastBusinessDay</span><span class=\"p\">();</span>\n  <span class=\"nx\">ScriptApp</span><span class=\"p\">.</span><span class=\"nx\">newTrigger</span><span class=\"p\">(</span><span class=\"dl\">\"</span><span class=\"s2\">setTriggerHoursLast</span><span class=\"dl\">\"</span><span class=\"p\">)</span>\n    <span class=\"p\">.</span><span class=\"nx\">timeBased</span><span class=\"p\">()</span>\n    <span class=\"p\">.</span><span class=\"nx\">atDate</span><span class=\"p\">(</span><span class=\"nx\">last</span><span class=\"p\">.</span><span class=\"nx\">getFullYear</span><span class=\"p\">(),</span> <span class=\"nx\">last</span><span class=\"p\">.</span><span class=\"nx\">getMonth</span><span class=\"p\">()</span><span class=\"o\">+</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"nx\">last</span><span class=\"p\">.</span><span class=\"nx\">getDate</span><span class=\"p\">())</span>\n    <span class=\"p\">.</span><span class=\"nx\">create</span><span class=\"p\">();</span>\n<span class=\"p\">}</span>\n</code></pre></div></div>\n\n<p>lastBusinessDay()で営業日最終日のDateオブジェクトを取ってきて<br>\n.atDate(last.getMonth()+1)としているところは、月は0月始まりとなっているからです。</p>\n\n<h3>\n<span id=\"settriggerhourslast\" class=\"fragment\"></span><a href=\"#settriggerhourslast\"><i class=\"fa fa-link\"></i></a>setTriggerHoursLast</h3>\n\n<div class=\"code-frame\" data-lang=\"js\"><div class=\"highlight\"><pre><code><span class=\"kd\">function</span> <span class=\"nx\">setTriggerHoursLast</span><span class=\"p\">()</span>\n<span class=\"p\">{</span>\n  <span class=\"nx\">deleteTrigger</span><span class=\"p\">(</span><span class=\"dl\">\"</span><span class=\"s2\">setTriggerHoursLast</span><span class=\"dl\">\"</span><span class=\"p\">);</span>\n  <span class=\"nx\">ScriptApp</span><span class=\"p\">.</span><span class=\"nx\">newTrigger</span><span class=\"p\">(</span><span class=\"dl\">\"</span><span class=\"s2\">sendSlack</span><span class=\"dl\">\"</span><span class=\"p\">)</span>\n    <span class=\"p\">.</span><span class=\"nx\">timeBased</span><span class=\"p\">()</span>\n    <span class=\"p\">.</span><span class=\"nx\">after</span><span class=\"p\">(</span> <span class=\"mi\">18</span> <span class=\"o\">*</span> <span class=\"mi\">60</span> <span class=\"o\">*</span> <span class=\"mi\">60</span> <span class=\"o\">*</span> <span class=\"mi\">1000</span> <span class=\"p\">)</span>\n    <span class=\"p\">.</span><span class=\"nx\">create</span><span class=\"p\">();</span>\n<span class=\"p\">}</span>\n</code></pre></div></div>\n\n<p>.after( 18 * 60 * 60 * 1000 )でミリ秒後にトリガーをセットしてます。</p>\n\n<h3>\n<span id=\"sendslack\" class=\"fragment\"></span><a href=\"#sendslack\"><i class=\"fa fa-link\"></i></a>sendSlack</h3>\n\n<div class=\"code-frame\" data-lang=\"js\"><div class=\"highlight\"><pre><code><span class=\"kd\">function</span> <span class=\"nx\">sendSlack</span><span class=\"p\">()</span> \n<span class=\"p\">{</span>\n  <span class=\"nx\">deleteTrigger</span><span class=\"p\">(</span><span class=\"dl\">\"</span><span class=\"s2\">sendSlack</span><span class=\"dl\">\"</span><span class=\"p\">);</span>\n  <span class=\"kd\">var</span> <span class=\"nx\">options</span> <span class=\"o\">=</span> \n  <span class=\"p\">{</span>\n    <span class=\"dl\">\"</span><span class=\"s2\">method</span><span class=\"dl\">\"</span> <span class=\"p\">:</span> <span class=\"dl\">\"</span><span class=\"s2\">POST</span><span class=\"dl\">\"</span><span class=\"p\">,</span>\n    <span class=\"dl\">\"</span><span class=\"s2\">payload</span><span class=\"dl\">\"</span> <span class=\"p\">:</span> \n    <span class=\"p\">{</span>\n      <span class=\"dl\">\"</span><span class=\"s2\">token</span><span class=\"dl\">\"</span><span class=\"p\">:</span> <span class=\"dl\">\"</span><span class=\"s2\">********************</span><span class=\"dl\">\"</span><span class=\"p\">,</span>\n      <span class=\"dl\">\"</span><span class=\"s2\">channel</span><span class=\"dl\">\"</span><span class=\"p\">:</span> <span class=\"dl\">\"</span><span class=\"s2\">bot-test</span><span class=\"dl\">\"</span><span class=\"p\">,</span>\n      <span class=\"dl\">\"</span><span class=\"s2\">text</span><span class=\"dl\">\"</span><span class=\"p\">:</span> <span class=\"dl\">\"</span><span class=\"s2\">領収書出しましたか？忘れてないよね。</span><span class=\"se\">\\</span><span class=\"s2\">ｎhttp://.../</span><span class=\"dl\">\"</span>\n    <span class=\"p\">}</span>\n  <span class=\"p\">}</span>\n  <span class=\"kd\">var</span> <span class=\"nx\">url</span> <span class=\"o\">=</span> <span class=\"dl\">\"</span><span class=\"s2\">https://slack.com/api/chat.postMessage</span><span class=\"dl\">\"</span>\n  <span class=\"nx\">UrlFetchApp</span><span class=\"p\">.</span><span class=\"nx\">fetch</span><span class=\"p\">(</span><span class=\"nx\">url</span><span class=\"p\">,</span> <span class=\"nx\">options</span><span class=\"p\">);</span>\n<span class=\"p\">}</span>\n</code></pre></div></div>\n\n<p>こういう書き方だと思っていただければ…<br>\n詳しくは公式ドキュメントで　<a href=\"https://api.slack.com/methods/chat.postMessage\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\">https://api.slack.com/methods/chat.postMessage</a></p>\n\n<h3>\n<span id=\"lastbusinessday\" class=\"fragment\"></span><a href=\"#lastbusinessday\"><i class=\"fa fa-link\"></i></a>lastBusinessDay</h3>\n\n<div class=\"code-frame\" data-lang=\"js\"><div class=\"highlight\"><pre><code><span class=\"kd\">function</span> <span class=\"nx\">lastBusinessDay</span><span class=\"p\">()</span> \n<span class=\"p\">{</span>\n  <span class=\"kd\">var</span> <span class=\"nx\">today</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nb\">Date</span><span class=\"p\">();</span>\n  <span class=\"kd\">var</span> <span class=\"nx\">lastDayOfThisMonth</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nb\">Date</span><span class=\"p\">(</span><span class=\"nx\">today</span><span class=\"p\">.</span><span class=\"nx\">getFullYear</span><span class=\"p\">(),</span> <span class=\"nx\">today</span><span class=\"p\">.</span><span class=\"nx\">getMonth</span><span class=\"p\">()</span><span class=\"o\">+</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">);</span>\n  <span class=\"kd\">var</span> <span class=\"nx\">day</span><span class=\"p\">;</span> <span class=\"c1\">// 0-&gt;日曜日</span>\n\n  <span class=\"k\">for</span> <span class=\"p\">(</span><span class=\"kd\">var</span> <span class=\"nx\">i</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"p\">;</span> <span class=\"nx\">i</span> <span class=\"o\">&lt;</span> <span class=\"mi\">30</span><span class=\"p\">;</span> <span class=\"nx\">i</span><span class=\"o\">++</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"nx\">day</span> <span class=\"o\">=</span> <span class=\"nx\">lastDayOfThisMonth</span><span class=\"p\">.</span><span class=\"nx\">getDay</span><span class=\"p\">();</span>\n    <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"nx\">day</span> <span class=\"o\">==</span> <span class=\"mi\">0</span> <span class=\"o\">||</span> <span class=\"nx\">day</span> <span class=\"o\">==</span> <span class=\"mi\">6</span> <span class=\"o\">||</span> <span class=\"nx\">isHoliday</span><span class=\"p\">(</span><span class=\"nx\">lastDayOfThisMonth</span><span class=\"p\">))</span> <span class=\"p\">{</span>\n      <span class=\"nx\">lastDayOfThisMonth</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nb\">Date</span><span class=\"p\">(</span><span class=\"nx\">today</span><span class=\"p\">.</span><span class=\"nx\">getFullYear</span><span class=\"p\">(),</span> <span class=\"nx\">today</span><span class=\"p\">.</span><span class=\"nx\">getMonth</span><span class=\"p\">()</span><span class=\"o\">+</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mi\">1</span> <span class=\"o\">*</span> <span class=\"nx\">i</span><span class=\"p\">);</span>\n      <span class=\"k\">continue</span><span class=\"p\">;</span>\n    <span class=\"p\">}</span>\n    <span class=\"k\">break</span><span class=\"p\">;</span>\n  <span class=\"p\">}</span>\n  <span class=\"k\">return</span> <span class=\"nx\">lastDayOfThisMonth</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</code></pre></div></div>\n\n<p>day == 0 || day == 6 || isHoliday(lastDayOfThisMonth)<br>\nここで土日もしくは祝日判定をしています。</p>\n\n<h3>\n<span id=\"deletetrigger\" class=\"fragment\"></span><a href=\"#deletetrigger\"><i class=\"fa fa-link\"></i></a>deleteTrigger</h3>\n\n<div class=\"code-frame\" data-lang=\"js\"><div class=\"highlight\"><pre><code>\n<span class=\"kd\">function</span> <span class=\"nx\">deleteTrigger</span><span class=\"p\">(</span><span class=\"nx\">name</span><span class=\"p\">)</span> \n<span class=\"p\">{</span>\n  <span class=\"kd\">var</span> <span class=\"nx\">triggers</span> <span class=\"o\">=</span> <span class=\"nx\">ScriptApp</span><span class=\"p\">.</span><span class=\"nx\">getProjectTriggers</span><span class=\"p\">();</span>\n  <span class=\"k\">for</span><span class=\"p\">(</span><span class=\"kd\">var</span> <span class=\"nx\">i</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">;</span> <span class=\"nx\">i</span> <span class=\"o\">&lt;</span> <span class=\"nx\">triggers</span><span class=\"p\">.</span><span class=\"nx\">length</span><span class=\"p\">;</span> <span class=\"nx\">i</span><span class=\"o\">++</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"nx\">triggers</span><span class=\"p\">[</span><span class=\"nx\">i</span><span class=\"p\">].</span><span class=\"nx\">getHandlerFunction</span><span class=\"p\">()</span> <span class=\"o\">==</span> <span class=\"nx\">name</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n      <span class=\"nx\">ScriptApp</span><span class=\"p\">.</span><span class=\"nx\">deleteTrigger</span><span class=\"p\">(</span><span class=\"nx\">triggers</span><span class=\"p\">[</span><span class=\"nx\">i</span><span class=\"p\">]);</span>\n    <span class=\"p\">}</span>\n  <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n\n</code></pre></div></div>\n\n<p>実は自分でセットしたtriggerってこんな感じで1分ごとにたまっていきます。<br>\n今回だと\"MAIAMAIN\"って名前のトリガーを全削除する機能になってます。<br>\n<a href=\"https://camo.qiitausercontent.com/18f33b9bf701e7e2189b93dcbdab932fc9b61457/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131323932392f61633666346337632d663134322d663463612d663764632d6639353038386263373131382e6a706567\" target=\"_blank\" rel=\"nofollow noopener\"><img width=\"735\" alt=\"スクリーンショット 2017-03-06 23.14.29.jpg\" src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2Fac6f4c7c-f142-f4ca-f7dc-f95088bc7118.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=36fd1a6a74b29b8998d068ac6e5dbb5d\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/112929/ac6f4c7c-f142-f4ca-f7dc-f95088bc7118.jpeg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F112929%2Fac6f4c7c-f142-f4ca-f7dc-f95088bc7118.jpeg?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=bcde38fa01a6d1b60bb0a3bef5ea1a2a 1x\" loading=\"lazy\"></a></p>\n\n<p>参考：　<a href=\"http://qiita.com/sumi-engraphia/items/465dd027e17f44da4d6a\" class=\"autolink\" id=\"reference-6cdb302138342d02b062\">http://qiita.com/sumi-engraphia/items/465dd027e17f44da4d6a</a></p>\n\n<h3>\n<span id=\"isholiday\" class=\"fragment\"></span><a href=\"#isholiday\"><i class=\"fa fa-link\"></i></a>isHoliday</h3>\n\n<div class=\"code-frame\" data-lang=\"js\"><div class=\"highlight\"><pre><code>\n<span class=\"kd\">function</span> <span class=\"nx\">isHoliday</span><span class=\"p\">(</span><span class=\"nx\">day</span><span class=\"p\">)</span> \n<span class=\"p\">{</span>\n  <span class=\"kd\">var</span> <span class=\"nx\">startDate</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nb\">Date</span><span class=\"p\">(</span><span class=\"nx\">day</span><span class=\"p\">.</span><span class=\"nx\">setHours</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">));</span>\n  <span class=\"kd\">var</span> <span class=\"nx\">endDate</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nb\">Date</span><span class=\"p\">(</span><span class=\"nx\">day</span><span class=\"p\">.</span><span class=\"nx\">setHours</span><span class=\"p\">(</span><span class=\"mi\">23</span><span class=\"p\">,</span> <span class=\"mi\">59</span><span class=\"p\">,</span> <span class=\"mi\">59</span><span class=\"p\">));</span>\n  <span class=\"kd\">var</span> <span class=\"nx\">cal</span> <span class=\"o\">=</span> <span class=\"nx\">CalendarApp</span><span class=\"p\">.</span><span class=\"nx\">getCalendarById</span><span class=\"p\">(</span><span class=\"dl\">\"</span><span class=\"s2\">ja.japanese#holiday@group.v.calendar.google.com</span><span class=\"dl\">\"</span><span class=\"p\">);</span>\n  <span class=\"kd\">var</span> <span class=\"nx\">holidays</span> <span class=\"o\">=</span>  <span class=\"nx\">cal</span><span class=\"p\">.</span><span class=\"nx\">getEvents</span><span class=\"p\">(</span><span class=\"nx\">startDate</span><span class=\"p\">,</span> <span class=\"nx\">endDate</span><span class=\"p\">);</span>\n  <span class=\"k\">return</span> <span class=\"nx\">holidays</span><span class=\"p\">.</span><span class=\"nx\">length</span> <span class=\"o\">!=</span> <span class=\"mi\">0</span><span class=\"p\">;</span> <span class=\"c1\">// 祝日ならtrue</span>\n<span class=\"p\">}</span>\n\n</code></pre></div></div>\n\n<p>getCalendarByIdでGoogleの[日本の祝日]を取得してきてます。</p>\n\n<p>参考：　<a href=\"http://qiita.com/kamatama_41/items/be40e05524530920a9d9\" class=\"autolink\" id=\"reference-5a809bb3572c78f54395\">http://qiita.com/kamatama_41/items/be40e05524530920a9d9</a></p>\n\n<p>終わりました〜〜<br>\n次は月初めの営業日を取っていきます〜〜</p>\n\n<h1>\n<span id=\"月初めの営業日\" class=\"fragment\"></span><a href=\"#%E6%9C%88%E5%88%9D%E3%82%81%E3%81%AE%E5%96%B6%E6%A5%AD%E6%97%A5\"><i class=\"fa fa-link\"></i></a>月初めの営業日</h1>\n\n<div class=\"code-frame\" data-lang=\"js\"><div class=\"highlight\"><pre><code>\n<span class=\"cm\">/*\n  メインの処理\n  setTriggerDay() : はじめの営業日(0時)に次の処理をする命令を出す。\n  setTriggerHoursFirst() : はじめの営業日の11時に次の命令を出す。\n  sendSlack() : slackにデータを投げる。\n\n  サブ的な処理\n  deleteTrigger() : 蓄積されている命令を削除する\n  firstNextBusinessDay() : 来月のはじめの営業日を求める\n  isHoliday() : 本日が[日本の祝日]かどうかチェック。土日は曜日で判定してるチェック\n  .getDay()　: Dateオブジェクトから曜日を求めるメソッド(0:日, 6:土曜日)\n*/</span>\n\n<span class=\"kd\">function</span> <span class=\"nx\">setTriggerDay2</span><span class=\"p\">()</span>\n<span class=\"p\">{</span>  \n  <span class=\"kd\">var</span> <span class=\"nx\">first</span> <span class=\"o\">=</span> <span class=\"nx\">firstNextBusinessDay</span><span class=\"p\">();</span>\n  <span class=\"nx\">ScriptApp</span><span class=\"p\">.</span><span class=\"nx\">newTrigger</span><span class=\"p\">(</span><span class=\"dl\">\"</span><span class=\"s2\">setTriggerHoursFirst</span><span class=\"dl\">\"</span><span class=\"p\">)</span>\n    <span class=\"p\">.</span><span class=\"nx\">timeBased</span><span class=\"p\">()</span>\n    <span class=\"p\">.</span><span class=\"nx\">atDate</span><span class=\"p\">(</span><span class=\"nx\">first</span><span class=\"p\">.</span><span class=\"nx\">getFullYear</span><span class=\"p\">(),</span> <span class=\"nx\">first</span><span class=\"p\">.</span><span class=\"nx\">getMonth</span><span class=\"p\">()</span><span class=\"o\">+</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"nx\">first</span><span class=\"p\">.</span><span class=\"nx\">getDate</span><span class=\"p\">())</span>\n    <span class=\"p\">.</span><span class=\"nx\">create</span><span class=\"p\">();</span>\n<span class=\"p\">}</span>\n\n<span class=\"kd\">function</span> <span class=\"nx\">setTriggerHoursFirst</span><span class=\"p\">()</span>\n<span class=\"p\">{</span>\n <span class=\"nx\">ScriptApp</span><span class=\"p\">.</span><span class=\"nx\">newTrigger</span><span class=\"p\">(</span><span class=\"dl\">\"</span><span class=\"s2\">sendSlack</span><span class=\"dl\">\"</span><span class=\"p\">)</span>\n   <span class=\"p\">.</span><span class=\"nx\">timeBased</span><span class=\"p\">()</span>\n   <span class=\"p\">.</span><span class=\"nx\">after</span><span class=\"p\">(</span><span class=\"mi\">11</span> <span class=\"o\">*</span> <span class=\"mi\">60</span> <span class=\"o\">*</span> <span class=\"mi\">60</span> <span class=\"o\">*</span> <span class=\"mi\">1000</span><span class=\"p\">)</span>\n   <span class=\"p\">.</span><span class=\"nx\">create</span><span class=\"p\">();</span>\n<span class=\"p\">}</span>\n\n<span class=\"kd\">function</span> <span class=\"nx\">sendSlack</span><span class=\"p\">()</span> \n<span class=\"p\">{</span>\n  <span class=\"kd\">var</span> <span class=\"nx\">options</span> <span class=\"o\">=</span> \n  <span class=\"p\">{</span>\n    <span class=\"dl\">\"</span><span class=\"s2\">method</span><span class=\"dl\">\"</span> <span class=\"p\">:</span> <span class=\"dl\">\"</span><span class=\"s2\">POST</span><span class=\"dl\">\"</span><span class=\"p\">,</span>\n    <span class=\"dl\">\"</span><span class=\"s2\">payload</span><span class=\"dl\">\"</span> <span class=\"p\">:</span> \n    <span class=\"p\">{</span>\n      <span class=\"dl\">\"</span><span class=\"s2\">token</span><span class=\"dl\">\"</span><span class=\"p\">:</span> <span class=\"dl\">\"</span><span class=\"s2\">********************</span><span class=\"dl\">\"</span><span class=\"p\">,</span>\n      <span class=\"dl\">\"</span><span class=\"s2\">channel</span><span class=\"dl\">\"</span><span class=\"p\">:</span> <span class=\"dl\">\"</span><span class=\"s2\">bot-test</span><span class=\"dl\">\"</span><span class=\"p\">,</span>\n      <span class=\"dl\">\"</span><span class=\"s2\">text</span><span class=\"dl\">\"</span><span class=\"p\">:</span> <span class=\"dl\">\"</span><span class=\"s2\">月が始まりました。</span><span class=\"dl\">\"</span>\n    <span class=\"p\">}</span>\n  <span class=\"p\">}</span>\n  <span class=\"kd\">var</span> <span class=\"nx\">url</span> <span class=\"o\">=</span> <span class=\"dl\">\"</span><span class=\"s2\">https://slack.com/api/chat.postMessage</span><span class=\"dl\">\"</span>\n  <span class=\"nx\">UrlFetchApp</span><span class=\"p\">.</span><span class=\"nx\">fetch</span><span class=\"p\">(</span><span class=\"nx\">url</span><span class=\"p\">,</span> <span class=\"nx\">options</span><span class=\"p\">);</span>\n<span class=\"p\">}</span>\n\n<span class=\"kd\">function</span> <span class=\"nx\">firstNextBusinessDay</span><span class=\"p\">()</span> \n<span class=\"p\">{</span>\n  <span class=\"kd\">var</span> <span class=\"nx\">today</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nb\">Date</span><span class=\"p\">();</span>  \n  <span class=\"kd\">var</span> <span class=\"nx\">firstDayOfNextMonth</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nb\">Date</span><span class=\"p\">(</span><span class=\"nx\">today</span><span class=\"p\">.</span><span class=\"nx\">getFullYear</span><span class=\"p\">(),</span> <span class=\"nx\">today</span><span class=\"p\">.</span><span class=\"nx\">getMonth</span><span class=\"p\">()</span><span class=\"o\">+</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">);</span>\n  <span class=\"kd\">var</span> <span class=\"nx\">day</span><span class=\"p\">;</span> <span class=\"c1\">// 0-&gt;日曜日</span>\n\n  <span class=\"k\">for</span> <span class=\"p\">(</span><span class=\"kd\">var</span> <span class=\"nx\">i</span> <span class=\"o\">=</span> <span class=\"mi\">2</span><span class=\"p\">;</span> <span class=\"nx\">i</span> <span class=\"o\">&lt;</span> <span class=\"mi\">32</span><span class=\"p\">;</span> <span class=\"nx\">i</span><span class=\"o\">++</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"nx\">day</span> <span class=\"o\">=</span> <span class=\"nx\">firstDayOfNextMonth</span><span class=\"p\">.</span><span class=\"nx\">getDay</span><span class=\"p\">();</span>\n    <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"nx\">day</span> <span class=\"o\">==</span> <span class=\"mi\">0</span> <span class=\"o\">||</span> <span class=\"nx\">day</span> <span class=\"o\">==</span> <span class=\"mi\">6</span> <span class=\"o\">||</span> <span class=\"nx\">isHoliday</span><span class=\"p\">(</span><span class=\"nx\">firstDayOfNextMonth</span><span class=\"p\">))</span> <span class=\"p\">{</span>\n      <span class=\"nx\">firstDayOfThisMonth</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nb\">Date</span><span class=\"p\">(</span><span class=\"nx\">today</span><span class=\"p\">.</span><span class=\"nx\">getFullYear</span><span class=\"p\">(),</span> <span class=\"nx\">today</span><span class=\"p\">.</span><span class=\"nx\">getMonth</span><span class=\"p\">(),</span> <span class=\"nx\">i</span><span class=\"p\">);</span>\n      <span class=\"k\">continue</span><span class=\"p\">;</span>\n    <span class=\"p\">}</span>\n  <span class=\"p\">}</span>\n  <span class=\"k\">return</span> <span class=\"nx\">firstDayOfNextMonth</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"kd\">function</span> <span class=\"nx\">deleteTrigger</span><span class=\"p\">()</span> \n<span class=\"p\">{</span>\n  <span class=\"kd\">var</span> <span class=\"nx\">triggers</span> <span class=\"o\">=</span> <span class=\"nx\">ScriptApp</span><span class=\"p\">.</span><span class=\"nx\">getProjectTriggers</span><span class=\"p\">();</span>\n  <span class=\"k\">for</span><span class=\"p\">(</span><span class=\"kd\">var</span> <span class=\"nx\">i</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">;</span> <span class=\"nx\">i</span> <span class=\"o\">&lt;</span> <span class=\"nx\">triggers</span><span class=\"p\">.</span><span class=\"nx\">length</span><span class=\"p\">;</span> <span class=\"nx\">i</span><span class=\"o\">++</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"nx\">triggers</span><span class=\"p\">[</span><span class=\"nx\">i</span><span class=\"p\">].</span><span class=\"nx\">getHandlerFunction</span><span class=\"p\">()</span> <span class=\"o\">==</span> <span class=\"dl\">\"</span><span class=\"s2\">main</span><span class=\"dl\">\"</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n      <span class=\"nx\">ScriptApp</span><span class=\"p\">.</span><span class=\"nx\">deleteTrigger</span><span class=\"p\">(</span><span class=\"nx\">triggers</span><span class=\"p\">[</span><span class=\"nx\">i</span><span class=\"p\">]);</span>\n    <span class=\"p\">}</span>\n  <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n\n<span class=\"kd\">function</span> <span class=\"nx\">isHoliday</span><span class=\"p\">(</span><span class=\"nx\">day</span><span class=\"p\">)</span> \n<span class=\"p\">{</span>\n  <span class=\"kd\">var</span> <span class=\"nx\">startDate</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nb\">Date</span><span class=\"p\">(</span><span class=\"nx\">day</span><span class=\"p\">.</span><span class=\"nx\">setHours</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">));</span>\n  <span class=\"kd\">var</span> <span class=\"nx\">endDate</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nb\">Date</span><span class=\"p\">(</span><span class=\"nx\">day</span><span class=\"p\">.</span><span class=\"nx\">setHours</span><span class=\"p\">(</span><span class=\"mi\">23</span><span class=\"p\">,</span> <span class=\"mi\">59</span><span class=\"p\">,</span> <span class=\"mi\">59</span><span class=\"p\">));</span>\n  <span class=\"kd\">var</span> <span class=\"nx\">cal</span> <span class=\"o\">=</span> <span class=\"nx\">CalendarApp</span><span class=\"p\">.</span><span class=\"nx\">getCalendarById</span><span class=\"p\">(</span><span class=\"dl\">\"</span><span class=\"s2\">ja.japanese#holiday@group.v.calendar.google.com</span><span class=\"dl\">\"</span><span class=\"p\">);</span>\n  <span class=\"kd\">var</span> <span class=\"nx\">holidays</span> <span class=\"o\">=</span>  <span class=\"nx\">cal</span><span class=\"p\">.</span><span class=\"nx\">getEvents</span><span class=\"p\">(</span><span class=\"nx\">startDate</span><span class=\"p\">,</span> <span class=\"nx\">endDate</span><span class=\"p\">);</span>\n  <span class=\"k\">return</span> <span class=\"nx\">holidays</span><span class=\"p\">.</span><span class=\"nx\">length</span> <span class=\"o\">!=</span> <span class=\"mi\">0</span><span class=\"p\">;</span> <span class=\"c1\">// 祝日ならtrue</span>\n<span class=\"p\">}</span>\n\n</code></pre></div></div>\n\n<h1>\n<span id=\"第一月曜日営業日\" class=\"fragment\"></span><a href=\"#%E7%AC%AC%E4%B8%80%E6%9C%88%E6%9B%9C%E6%97%A5%E5%96%B6%E6%A5%AD%E6%97%A5\"><i class=\"fa fa-link\"></i></a>第一月曜日営業日</h1>\n\n<div class=\"code-frame\" data-lang=\"js\"><div class=\"highlight\"><pre><code>\n<span class=\"kd\">function</span> <span class=\"nx\">firstNextBusinessMonDay</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n  <span class=\"kd\">var</span> <span class=\"nx\">today</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nb\">Date</span><span class=\"p\">();</span>\n\n  <span class=\"kd\">var</span> <span class=\"nx\">firstDayOfNextMonth</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nb\">Date</span><span class=\"p\">(</span><span class=\"nx\">today</span><span class=\"p\">.</span><span class=\"nx\">getFullYear</span><span class=\"p\">(),</span> <span class=\"nx\">today</span><span class=\"p\">.</span><span class=\"nx\">getMonth</span><span class=\"p\">()</span><span class=\"o\">+</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">);</span>\n  <span class=\"kd\">var</span> <span class=\"nx\">day</span><span class=\"p\">;</span> <span class=\"c1\">// 0-&gt;日曜日</span>\n\n  <span class=\"k\">for</span> <span class=\"p\">(</span><span class=\"kd\">var</span> <span class=\"nx\">i</span> <span class=\"o\">=</span> <span class=\"mi\">2</span><span class=\"p\">;</span> <span class=\"nx\">i</span> <span class=\"o\">&lt;</span> <span class=\"mi\">32</span><span class=\"p\">;</span> <span class=\"nx\">i</span><span class=\"o\">++</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"nx\">day</span> <span class=\"o\">=</span> <span class=\"nx\">firstDayOfNextMonth</span><span class=\"p\">.</span><span class=\"nx\">getDay</span><span class=\"p\">();</span>\n    <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"nx\">day</span> <span class=\"o\">!=</span> <span class=\"mi\">1</span> <span class=\"o\">||</span> <span class=\"nx\">isHoliday</span><span class=\"p\">(</span><span class=\"nx\">firstDayOfNextMonth</span><span class=\"p\">))</span> <span class=\"p\">{</span>\n      <span class=\"nx\">firstDayOfThisMonth</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nb\">Date</span><span class=\"p\">(</span><span class=\"nx\">today</span><span class=\"p\">.</span><span class=\"nx\">getFullYear</span><span class=\"p\">(),</span> <span class=\"nx\">today</span><span class=\"p\">.</span><span class=\"nx\">getMonth</span><span class=\"p\">(),</span> <span class=\"nx\">i</span><span class=\"p\">);</span>\n      <span class=\"k\">continue</span><span class=\"p\">;</span>\n    <span class=\"p\">}</span>\n    <span class=\"k\">break</span><span class=\"p\">;</span>\n  <span class=\"p\">}</span>\n  <span class=\"k\">return</span> <span class=\"nx\">firstDayOfNextMonth</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n</code></pre></div></div>\n\n<p>ここだけ変えればいいかな、こんな感じ？<br>\n1日から探索して、月曜日以外もしくは祝日なら次の日にいく。</p>\n\n<p>以上です。</p>\n\n<h1>\n<span id=\"終わりに\" class=\"fragment\"></span><a href=\"#%E7%B5%82%E3%82%8F%E3%82%8A%E3%81%AB\"><i class=\"fa fa-link\"></i></a>終わりに</h1>\n\n<p>重要なことはそのままおコピペしてなんかやらかしちゃったとか責任とれないんで(ミスあっても、Slackがあれるとか、もしくは通知されないとか？)自身の環境でデバックしてからお使いください！</p>\n\n<p>Google Apps Script楽しい！</p>\n\n<p>.</p>\n","body":"# 月末って忙しいよね…\n\n月末って報告書とか、領収証とか…なんかたくさん出さなきゃいけないものあるよね。センパイが「誰か作って」って言ってたのをGoogle apps scriptで作成しました。\nGoogle apps script[GAS]触りだして4日目くらいですが、かなり便利なのでエンジニア以外のもっとたくさんの人に触れて欲しいなと思い、連日ですがGASの実用例をあげたいと思います。\n\n# 完成品\n\n月末の営業日にSlack投げるだけのシンプルな実装です。\nコピペすれば10分で実装いけるんじゃないかと！\n\n<img width=\"555\" alt=\"スクリーンショット 2017-03-06 21.29.19.jpg\" src=\"https://qiita-image-store.s3.amazonaws.com/0/112929/e6e7c048-3dcd-0948-0d0d-597bf148ae4d.jpeg\">\n\n## 完成までに使用するもの\n\nGoogleアカウント[Google Apps Script]\nSlack\n\n## 完成したら\n\n以下の2つもコード公開します\n* 月初めの営業日になにかをする\n* 月始めの第一金曜日になにかをする\n\nつまりこれを応用すれば、いつ何時でもSlackで自動チャットを飛ばせるようになる。\n\n# 月末締め…！！\n\n画像ありでどんどんいくよ〜〜\n\n## Slack Tokenの取得\n\nここを参考にしてみて！\nhttp://qiita.com/ykhirao/items/0d6b9f4a0cc626884dbb\n\nxoxp-18127　こんな感じの長い数字。\n\nSlack持ってない人は[個人Slackのススメ](http://qiita.com/saitotak/items/ac0eb7ddc0d8d83cbe91)にしたがって導入をすすめます。\n\n## GASの導入\n\nGoogleドライブにアクセス\nhttps://drive.google.com/drive/my-drive\n\n<img width=\"1192\" alt=\"スクリーンショット 2017-03-06 21.59.16.jpg\" src=\"https://qiita-image-store.s3.amazonaws.com/0/112929/f0603105-eb23-a7ca-53be-8e593d104516.jpeg\">\n\n`新規 >> その他 >> アプリを追加`\nから Google apps script を検索・追加\n\n<img width=\"1196\" alt=\"スクリーンショット 2017-03-06 22.00.23.jpg\" src=\"https://qiita-image-store.s3.amazonaws.com/0/112929/5f579f0d-2d24-34b6-8634-a7f0f4869537.jpeg\">\n\nそうすると`新規 >> その他 >> Google apps script`を押してみてください。\nGAS画面になると思います。\n\n## GASの編集\n\n<img width=\"816\" alt=\"スクリーンショット 2017-03-06 22.23.56.jpg\" src=\"https://qiita-image-store.s3.amazonaws.com/0/112929/fcfa979d-2652-f795-c5ba-cb7de40cab02.jpeg\">\n\nメインの部分にこれを貼り付けてみよう！\n\n```js\n\n/*\n  メインの処理\n  setTriggerDay() : 最終営業日(0時)に次の処理をする命令を出す。\n  setTriggerHoursLast() : 最終営業日の18時に次の命令を出す。\n  sendSlack() : slackにデータを投げる。\n\n  サブ的な処理\n  deleteTrigger() : 蓄積されている命令を削除する\n  lastBusinessDay() : 今月の最終営業日を求める\n  isHoliday() : 本日が[日本の祝日]かどうかチェック。土日は曜日で判定してるチェック\n  .getDay()　: Dateオブジェクトから曜日を求めるメソッド(0:日, 6:土曜日)\n*/\n\nfunction setTriggerDay()\n{  \n  var last = lastBusinessDay();\n  ScriptApp.newTrigger(\"setTriggerHoursLast\")\n    .timeBased()\n    .atDate(last.getFullYear(), last.getMonth()+1, last.getDate())\n    .create();\n}\n\nfunction setTriggerHoursLast()\n{\n  deleteTrigger(\"setTriggerHoursLast\");\n  ScriptApp.newTrigger(\"sendSlack\")\n    .timeBased()\n    .after( 18 * 60 * 60 * 1000 )\n    .create();\n}\n\nfunction sendSlack() \n{\n  deleteTrigger(\"sendSlack\");\n  var options = \n  {\n    \"method\" : \"POST\",\n    \"payload\" : \n    {\n      \"token\": \"********************\",\n      \"channel\": \"bot-test\",\n      \"text\": \"領収書出しましたか？忘れてないよね。\\ｎhttp://.../\"\n    }\n  }\n  var url = \"https://slack.com/api/chat.postMessage\"\n  UrlFetchApp.fetch(url, options);\n}\n\nfunction lastBusinessDay() \n{\n  var today = new Date();\n  \n  var lastDayOfThisMonth = new Date(today.getFullYear(), today.getMonth()+1, 0);\n  var day; // 0->日曜日\n  \n  for (var i = 0; i < 30; i++) {\n    day = lastDayOfThisMonth.getDay();\n    if (day == 0 || day == 6 || isHoliday(lastDayOfThisMonth)) {\n      lastDayOfThisMonth = new Date(today.getFullYear(), today.getMonth()+1, -1 * i);\n      continue;\n    }\n  }\n  return lastDayOfThisMonth;\n}\n\nfunction deleteTrigger(name) \n{\n  var triggers = ScriptApp.getProjectTriggers();\n  for(var i=0; i < triggers.length; i++) {\n    if (triggers[i].getHandlerFunction() == name) {\n      ScriptApp.deleteTrigger(triggers[i]);\n    }\n  }\n}\n\nfunction isHoliday(day) \n{\n  var startDate = new Date(day.setHours(0, 0, 0, 0));\n  var endDate = new Date(day.setHours(23, 59, 59));\n  var cal = CalendarApp.getCalendarById(\"ja.japanese#holiday@group.v.calendar.google.com\");\n  var holidays =  cal.getEvents(startDate, endDate);\n  return holidays.length != 0; // 祝日ならtrue\n}\n\n```\nsendSlackのここは個人設定に変えてください！\n\n- \"token\": \"********************\",\n- \"channel\": \"bot-test\",\n- \"text\": \"領収書出しましたか？忘れてないよね。\\ｎhttp://.../\"\n\n\n## setTriggerDay()の実行と取り消しと毎月実行\n実行 >> setTriggerDay\nをおしてみよう。\n\n<img width=\"527\" alt=\"スクリーンショット 2017-03-06 22.26.52.jpg\" src=\"https://qiita-image-store.s3.amazonaws.com/0/112929/6eb86e29-a4f9-4fd0-e62d-76a8af233a72.jpeg\">\n\nリソース >> 現在のプロジェクトのトリガー\nここからトリガー（何時にあれを実行しなさい）を確認できます。\n\n<img width=\"648\" alt=\"スクリーンショット 2017-03-06 22.27.40.jpg\" src=\"https://qiita-image-store.s3.amazonaws.com/0/112929/daefaa91-51fc-0fbf-4057-b316c8be45b1.jpeg\">\n\nここで 2017/03/21 夜中丁度に setTriggerHoursLast が実行されるようになっていたら大丈夫。setTriggerHoursLastは18時間後にSlack送りなさいという命令です。\n\n<img width=\"838\" alt=\"スクリーンショット 2017-03-06 22.27.47.jpg\" src=\"https://qiita-image-store.s3.amazonaws.com/0/112929/bb6cf9a2-aef7-769c-c69b-ba4eaa9b3e98.jpeg\">\n\nまたついでにこの画面でsetTriggerDayを毎月1日6時くらいにセットします。\n\n<img width=\"836\" alt=\"スクリーンショット 2017-03-06 22.37.18.jpg\" src=\"https://qiita-image-store.s3.amazonaws.com/0/112929/3288c9c8-dea7-5bdd-eefa-43fc7735fcfb.jpeg\">\n\n\nそうすると毎月1日にsetTriggerDayが実行されて\n-> setTriggerDay :最終日に次を実行\n-> setTriggerHoursLast :18時に次を実行\n-> sendSlack :Slackを実行\n\nって感じで毎月、最終日トリガーを作成してくれます。\n\n## functionごとに見ていく\n\n簡単にみていきます。\n\n### setTriggerDay\n\n```js\nfunction setTriggerDay()\n{  \n  var last = lastBusinessDay();\n  ScriptApp.newTrigger(\"setTriggerHoursLast\")\n    .timeBased()\n    .atDate(last.getFullYear(), last.getMonth()+1, last.getDate())\n    .create();\n}\n```\n\nlastBusinessDay()で営業日最終日のDateオブジェクトを取ってきて\n.atDate(last.getMonth()+1)としているところは、月は0月始まりとなっているからです。\n\n### setTriggerHoursLast\n\n```js\nfunction setTriggerHoursLast()\n{\n  deleteTrigger(\"setTriggerHoursLast\");\n  ScriptApp.newTrigger(\"sendSlack\")\n    .timeBased()\n    .after( 18 * 60 * 60 * 1000 )\n    .create();\n}\n```\n.after( 18 * 60 * 60 * 1000 )でミリ秒後にトリガーをセットしてます。\n\n### sendSlack\n\n```js\nfunction sendSlack() \n{\n  deleteTrigger(\"sendSlack\");\n  var options = \n  {\n    \"method\" : \"POST\",\n    \"payload\" : \n    {\n      \"token\": \"********************\",\n      \"channel\": \"bot-test\",\n      \"text\": \"領収書出しましたか？忘れてないよね。\\ｎhttp://.../\"\n    }\n  }\n  var url = \"https://slack.com/api/chat.postMessage\"\n  UrlFetchApp.fetch(url, options);\n}\n```\n\nこういう書き方だと思っていただければ…\n詳しくは公式ドキュメントで　https://api.slack.com/methods/chat.postMessage\n\n### lastBusinessDay\n\n```js\nfunction lastBusinessDay() \n{\n  var today = new Date();\n  var lastDayOfThisMonth = new Date(today.getFullYear(), today.getMonth()+1, 0);\n  var day; // 0->日曜日\n\n  for (var i = 0; i < 30; i++) {\n    day = lastDayOfThisMonth.getDay();\n    if (day == 0 || day == 6 || isHoliday(lastDayOfThisMonth)) {\n      lastDayOfThisMonth = new Date(today.getFullYear(), today.getMonth()+1, -1 * i);\n      continue;\n    }\n    break;\n  }\n  return lastDayOfThisMonth;\n}\n```\n\nday == 0 || day == 6 || isHoliday(lastDayOfThisMonth)\nここで土日もしくは祝日判定をしています。\n\n### deleteTrigger\n\n```js\n\nfunction deleteTrigger(name) \n{\n  var triggers = ScriptApp.getProjectTriggers();\n  for(var i=0; i < triggers.length; i++) {\n    if (triggers[i].getHandlerFunction() == name) {\n      ScriptApp.deleteTrigger(triggers[i]);\n    }\n  }\n}\n\n```\n\n実は自分でセットしたtriggerってこんな感じで1分ごとにたまっていきます。\n今回だと\"MAIAMAIN\"って名前のトリガーを全削除する機能になってます。\n<img width=\"735\" alt=\"スクリーンショット 2017-03-06 23.14.29.jpg\" src=\"https://qiita-image-store.s3.amazonaws.com/0/112929/ac6f4c7c-f142-f4ca-f7dc-f95088bc7118.jpeg\">\n\n参考：　http://qiita.com/sumi-engraphia/items/465dd027e17f44da4d6a\n\n### isHoliday\n\n```js\n\nfunction isHoliday(day) \n{\n  var startDate = new Date(day.setHours(0, 0, 0, 0));\n  var endDate = new Date(day.setHours(23, 59, 59));\n  var cal = CalendarApp.getCalendarById(\"ja.japanese#holiday@group.v.calendar.google.com\");\n  var holidays =  cal.getEvents(startDate, endDate);\n  return holidays.length != 0; // 祝日ならtrue\n}\n\n```\n\ngetCalendarByIdでGoogleの[日本の祝日]を取得してきてます。\n\n参考：　http://qiita.com/kamatama_41/items/be40e05524530920a9d9\n\n終わりました〜〜\n次は月初めの営業日を取っていきます〜〜\n\n# 月初めの営業日\n\n```js\n\n/*\n  メインの処理\n  setTriggerDay() : はじめの営業日(0時)に次の処理をする命令を出す。\n  setTriggerHoursFirst() : はじめの営業日の11時に次の命令を出す。\n  sendSlack() : slackにデータを投げる。\n\n  サブ的な処理\n  deleteTrigger() : 蓄積されている命令を削除する\n  firstNextBusinessDay() : 来月のはじめの営業日を求める\n  isHoliday() : 本日が[日本の祝日]かどうかチェック。土日は曜日で判定してるチェック\n  .getDay()　: Dateオブジェクトから曜日を求めるメソッド(0:日, 6:土曜日)\n*/\n\nfunction setTriggerDay2()\n{  \n  var first = firstNextBusinessDay();\n  ScriptApp.newTrigger(\"setTriggerHoursFirst\")\n    .timeBased()\n    .atDate(first.getFullYear(), first.getMonth()+1, first.getDate())\n    .create();\n}\n\nfunction setTriggerHoursFirst()\n{\n ScriptApp.newTrigger(\"sendSlack\")\n   .timeBased()\n   .after(11 * 60 * 60 * 1000)\n   .create();\n}\n\nfunction sendSlack() \n{\n  var options = \n  {\n    \"method\" : \"POST\",\n    \"payload\" : \n    {\n      \"token\": \"********************\",\n      \"channel\": \"bot-test\",\n      \"text\": \"月が始まりました。\"\n    }\n  }\n  var url = \"https://slack.com/api/chat.postMessage\"\n  UrlFetchApp.fetch(url, options);\n}\n\nfunction firstNextBusinessDay() \n{\n  var today = new Date();  \n  var firstDayOfNextMonth = new Date(today.getFullYear(), today.getMonth()+1, 1);\n  var day; // 0->日曜日\n  \n  for (var i = 2; i < 32; i++) {\n    day = firstDayOfNextMonth.getDay();\n    if (day == 0 || day == 6 || isHoliday(firstDayOfNextMonth)) {\n      firstDayOfThisMonth = new Date(today.getFullYear(), today.getMonth(), i);\n      continue;\n    }\n  }\n  return firstDayOfNextMonth;\n}\n\nfunction deleteTrigger() \n{\n  var triggers = ScriptApp.getProjectTriggers();\n  for(var i=0; i < triggers.length; i++) {\n    if (triggers[i].getHandlerFunction() == \"main\") {\n      ScriptApp.deleteTrigger(triggers[i]);\n    }\n  }\n}\n\nfunction isHoliday(day) \n{\n  var startDate = new Date(day.setHours(0, 0, 0, 0));\n  var endDate = new Date(day.setHours(23, 59, 59));\n  var cal = CalendarApp.getCalendarById(\"ja.japanese#holiday@group.v.calendar.google.com\");\n  var holidays =  cal.getEvents(startDate, endDate);\n  return holidays.length != 0; // 祝日ならtrue\n}\n\n```\n\n# 第一月曜日営業日\n\n```js\n\nfunction firstNextBusinessMonDay() {\n  var today = new Date();\n  \n  var firstDayOfNextMonth = new Date(today.getFullYear(), today.getMonth()+1, 1);\n  var day; // 0->日曜日\n  \n  for (var i = 2; i < 32; i++) {\n    day = firstDayOfNextMonth.getDay();\n    if (day != 1 || isHoliday(firstDayOfNextMonth)) {\n      firstDayOfThisMonth = new Date(today.getFullYear(), today.getMonth(), i);\n      continue;\n    }\n    break;\n  }\n  return firstDayOfNextMonth;\n}\n\n```\nここだけ変えればいいかな、こんな感じ？\n1日から探索して、月曜日以外もしくは祝日なら次の日にいく。\n\n\n以上です。\n\n\n# 終わりに\n\n重要なことはそのままおコピペしてなんかやらかしちゃったとか責任とれないんで(ミスあっても、Slackがあれるとか、もしくは通知されないとか？)自身の環境でデバックしてからお使いください！\n\nGoogle Apps Script楽しい！\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.\n","coediting":false,"comments_count":0,"created_at":"2017-03-06T23:34:54+09:00","group":null,"id":"782e20ab0465533c48f6","likes_count":43,"private":false,"reactions_count":0,"stocks_count":50,"tags":[{"name":"JavaScript","versions":[]},{"name":"Google","versions":[]},{"name":"GoogleAppsScript","versions":[]},{"name":"Slack","versions":[]}],"title":"月末営業日にタスクをリマインドする ~ 使うのはSlackとGoogleアカウントだけで10分くらいで実装できるよ ~","updated_at":"2017-03-06T23:39:17+09:00","url":"https://qiita.com/ykhirao/items/782e20ab0465533c48f6","user":{"description":"Web Developer From 2016.\r\nPHP/Laravel && React/TypeScript/Node.js\r\n\r\n業務委託の依頼とかはWantedlyとかからでお願いします！","facebook_id":"","followees_count":38,"followers_count":99,"github_login_name":"ykhirao","id":"ykhirao","items_count":69,"linkedin_id":"","location":"Tokyo, Japan","name":"yk","organization":"","permanent_id":112929,"profile_image_url":"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/112929/profile-images/1639030792","team_only":false,"twitter_screen_name":"ykhirao","website_url":"https://www.wantedly.com/id/ykhirao"},"page_views_count":null,"team_membership":null,"organization_url_name":null,"slide":false}},"path":"posts/782e20ab0465533c48f6"}
