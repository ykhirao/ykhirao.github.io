{"template":"__react_static_root__/src/components/QiitaPost","sharedHashesByProp":{},"data":{"post":{"rendered_body":"\n<h1>\n<span id=\"google-driveで共有設定が適切に設定されているかドライブのファイルフォルダを一覧で調べる方法\" class=\"fragment\"></span><a href=\"#google-drive%E3%81%A7%E5%85%B1%E6%9C%89%E8%A8%AD%E5%AE%9A%E3%81%8C%E9%81%A9%E5%88%87%E3%81%AB%E8%A8%AD%E5%AE%9A%E3%81%95%E3%82%8C%E3%81%A6%E3%81%84%E3%82%8B%E3%81%8B%E3%83%89%E3%83%A9%E3%82%A4%E3%83%96%E3%81%AE%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%83%95%E3%82%A9%E3%83%AB%E3%83%80%E3%82%92%E4%B8%80%E8%A6%A7%E3%81%A7%E8%AA%BF%E3%81%B9%E3%82%8B%E6%96%B9%E6%B3%95\"><i class=\"fa fa-link\"></i></a>Google Driveで共有設定が適切に設定されているかドライブのファイル・フォルダを一覧で調べる方法</h1>\n\n<p>30分くらいで作ったやつを貼っておく。<br>\nかんたんなスクリプトなのでもっと良さそうな改良版あればコメント欄なり、自分で記事お願いします！</p>\n\n<p>「2021年１月６日、福岡県の新型コロナウイルス感染症陽性者に関する個人情報の漏えい」がありましたが、この漏洩事案がGoogle Driveによるものだとは存じ上げないのですが、SaaSのドライブを利用するユーザーが増えてくると（絶対数が増える）と、共有設定を間違えるニュースが増えてくると思います。</p>\n\n<p>なのでDriveのファイルとフォルダが適切に共有設定されているか確認しましょう、ってお話。</p>\n\n<h2>\n<span id=\"データ\" class=\"fragment\"></span><a href=\"#%E3%83%87%E3%83%BC%E3%82%BF\"><i class=\"fa fa-link\"></i></a>データ</h2>\n\n<div class=\"code-frame\" data-lang=\"js\"><div class=\"highlight\"><pre><code><span class=\"kd\">const</span> <span class=\"nx\">results</span> <span class=\"o\">=</span> <span class=\"p\">[];</span>\n\n<span class=\"kd\">function</span> <span class=\"nx\">doGet</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n  <span class=\"nx\">writeInforInFolder</span><span class=\"p\">(</span><span class=\"nx\">DriveApp</span><span class=\"p\">.</span><span class=\"nx\">getRootFolder</span><span class=\"p\">());</span>\n  <span class=\"kd\">const</span> <span class=\"nx\">text</span> <span class=\"o\">=</span> <span class=\"nx\">results</span><span class=\"p\">.</span><span class=\"nx\">join</span><span class=\"p\">(</span><span class=\"dl\">\"</span><span class=\"se\">\\n</span><span class=\"dl\">\"</span><span class=\"p\">);</span>\n  <span class=\"nx\">Logger</span><span class=\"p\">.</span><span class=\"nx\">log</span><span class=\"p\">(</span><span class=\"nx\">text</span><span class=\"p\">);</span>\n\n  <span class=\"c1\">// Webアプリとして導入するならこんな感じ？</span>\n  <span class=\"c1\">// return HtmlService.createHtmlOutput(text);</span>\n<span class=\"p\">}</span>\n\n<span class=\"kd\">function</span> <span class=\"nx\">writeInforInFolder</span><span class=\"p\">(</span><span class=\"nx\">folder</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n  <span class=\"k\">if</span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"nx\">folder</span><span class=\"p\">)</span> <span class=\"k\">return</span><span class=\"p\">;</span>\n\n  <span class=\"c1\">// フォルダ以下ファイルをすべて取得</span>\n  <span class=\"kd\">const</span> <span class=\"nx\">files</span> <span class=\"o\">=</span> <span class=\"nx\">folder</span><span class=\"p\">.</span><span class=\"nx\">getFiles</span><span class=\"p\">();</span>\n  <span class=\"k\">while</span><span class=\"p\">(</span><span class=\"nx\">files</span><span class=\"p\">.</span><span class=\"nx\">hasNext</span><span class=\"p\">())</span> <span class=\"p\">{</span>\n    <span class=\"kd\">const</span> <span class=\"nx\">file</span> <span class=\"o\">=</span> <span class=\"nx\">files</span><span class=\"p\">.</span><span class=\"nx\">next</span><span class=\"p\">();</span>\n    <span class=\"nx\">results</span><span class=\"p\">.</span><span class=\"nx\">push</span><span class=\"p\">(</span><span class=\"s2\">`FILE,</span><span class=\"p\">${</span><span class=\"nx\">file</span><span class=\"p\">.</span><span class=\"nx\">getName</span><span class=\"p\">()}</span><span class=\"s2\">,</span><span class=\"p\">${</span><span class=\"nx\">file</span><span class=\"p\">.</span><span class=\"nx\">getSharingAccess</span><span class=\"p\">()}</span><span class=\"s2\">,</span><span class=\"p\">${</span><span class=\"nx\">file</span><span class=\"p\">.</span><span class=\"nx\">getUrl</span><span class=\"p\">()}</span><span class=\"s2\">`</span><span class=\"p\">)</span>\n  <span class=\"p\">}</span>\n\n  <span class=\"c1\">// フォルダ配下のフォルダを取得</span>\n  <span class=\"kd\">const</span> <span class=\"nx\">folders</span> <span class=\"o\">=</span> <span class=\"nx\">folder</span><span class=\"p\">.</span><span class=\"nx\">getFolders</span><span class=\"p\">();</span>\n  <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"o\">!</span><span class=\"nx\">folders</span><span class=\"p\">)</span> <span class=\"k\">return</span><span class=\"p\">;</span>\n  <span class=\"k\">while</span><span class=\"p\">(</span><span class=\"nx\">folders</span><span class=\"p\">.</span><span class=\"nx\">hasNext</span><span class=\"p\">())</span> <span class=\"p\">{</span>\n    <span class=\"kd\">const</span> <span class=\"nx\">folder</span> <span class=\"o\">=</span> <span class=\"nx\">folders</span><span class=\"p\">.</span><span class=\"nx\">next</span><span class=\"p\">();</span>\n    <span class=\"nx\">results</span><span class=\"p\">.</span><span class=\"nx\">push</span><span class=\"p\">(</span><span class=\"s2\">`FOLDER,</span><span class=\"p\">${</span><span class=\"nx\">folder</span><span class=\"p\">.</span><span class=\"nx\">getName</span><span class=\"p\">()}</span><span class=\"s2\">,</span><span class=\"p\">${</span><span class=\"nx\">folder</span><span class=\"p\">.</span><span class=\"nx\">getSharingAccess</span><span class=\"p\">()}</span><span class=\"s2\">,</span><span class=\"p\">${</span><span class=\"nx\">folder</span><span class=\"p\">.</span><span class=\"nx\">getUrl</span><span class=\"p\">()}</span><span class=\"s2\">`</span><span class=\"p\">)</span>\n    <span class=\"c1\">// 更に下のフォルダを検索するため再帰処理</span>\n    <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">writeInforInFolder</span><span class=\"p\">(</span><span class=\"nx\">folder</span><span class=\"p\">)</span>\n  <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n</code></pre></div></div>\n\n<ul>\n<li>権限を取得とかもろもろの許可が必要</li>\n</ul>\n\n<p>CSV形式のテキストで出力されるので、3列目がANYONEとかANYONE_WITH_LINKになっているのは確認したほうがいいと思います。</p>\n\n<div class=\"code-frame\" data-lang=\"csvs\"><div class=\"highlight\"><pre><code><span class=\"c1\">// 出力例</span>\n<span class=\"c1\">// 長すぎるとエラーでるので、</span>\n<span class=\"c1\">// return HtmlService.createHtmlOutput(text);のとこコメントアウト外してWebで見たほうがいいかも</span>\n<span class=\"k\">Logging</span> <span class=\"k\">output</span> <span class=\"k\">too</span> <span class=\"k\">large</span><span class=\"err\">.</span> <span class=\"k\">Truncating</span> <span class=\"k\">output</span><span class=\"err\">.</span> \n\n<span class=\"c1\">// folderとfile,名前,url</span>\n<span class=\"k\">FOLDER</span><span class=\"p\">,</span><span class=\"k\">test</span><span class=\"p\">,</span><span class=\"k\">PRIVATE</span><span class=\"p\">,</span><span class=\"nv\">https:</span><span class=\"c1\">//script.google.com/d/sample</span>\n<span class=\"k\">FILE</span><span class=\"p\">,</span><span class=\"err\">無題のプロジェクト</span><span class=\"p\">,</span><span class=\"k\">PRIVATE</span><span class=\"p\">,</span><span class=\"nv\">https:</span><span class=\"c1\">//script.google.com/d/1i</span>\n</code></pre></div></div>\n\n<p>権限は以下を確認してください。<br>\n<a href=\"https://developers.google.com/apps-script/reference/drive/access\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\">https://developers.google.com/apps-script/reference/drive/access</a></p>\n\n<ul>\n<li>ANYONE (誰でも見れる)</li>\n<li>ANYONE_WITH_LINK(リンク知っている人全員)</li>\n<li>DOMAIN (自社のGsuiteワークスペースの人のみ)</li>\n<li>DOMAIN_WITH_LINK(自社のワークスペースの人でリンク知っている人のみ)</li>\n<li>PRIVATE (自分のみ)</li>\n</ul>\n\n<p>基本的に機密情報は、ANYONE,ANYONE_WITH_LINKだと合うと、特に気密性高い情報はDOMAINもDOMAIN_WITH_LINKもだめかも。<br>\n気密性の高いファイルは、PRIVATEにして、必要な人だけ個別で追加していくスタイルがよいかと。</p>\n","body":"# Google Driveで共有設定が適切に設定されているかドライブのファイル・フォルダを一覧で調べる方法\n\n30分くらいで作ったやつを貼っておく。\nかんたんなスクリプトなのでもっと良さそうな改良版あればコメント欄なり、自分で記事お願いします！\n\n「2021年１月６日、福岡県の新型コロナウイルス感染症陽性者に関する個人情報の漏えい」がありましたが、この漏洩事案がGoogle Driveによるものだとは存じ上げないのですが、SaaSのドライブを利用するユーザーが増えてくると（絶対数が増える）と、共有設定を間違えるニュースが増えてくると思います。\n\nなのでDriveのファイルとフォルダが適切に共有設定されているか確認しましょう、ってお話。\n\n## データ\n\n\n\n```js\nconst results = [];\n\nfunction doGet() {\n  writeInforInFolder(DriveApp.getRootFolder());\n  const text = results.join(\"\\n\");\n  Logger.log(text);\n\n  // Webアプリとして導入するならこんな感じ？\n  // return HtmlService.createHtmlOutput(text);\n}\n\nfunction writeInforInFolder(folder) {\n  if(!folder) return;\n  \n  // フォルダ以下ファイルをすべて取得\n  const files = folder.getFiles();\n  while(files.hasNext()) {\n    const file = files.next();\n    results.push(`FILE,${file.getName()},${file.getSharingAccess()},${file.getUrl()}`)\n  }\n\n  // フォルダ配下のフォルダを取得\n  const folders = folder.getFolders();\n  if (!folders) return;\n  while(folders.hasNext()) {\n    const folder = folders.next();\n    results.push(`FOLDER,${folder.getName()},${folder.getSharingAccess()},${folder.getUrl()}`)\n    // 更に下のフォルダを検索するため再帰処理\n    this.writeInforInFolder(folder)\n  }\n}\n```\n\n- 権限を取得とかもろもろの許可が必要\n\n\nCSV形式のテキストで出力されるので、3列目がANYONEとかANYONE_WITH_LINKになっているのは確認したほうがいいと思います。\n\n```csvs\n// 出力例\n// 長すぎるとエラーでるので、\n// return HtmlService.createHtmlOutput(text);のとこコメントアウト外してWebで見たほうがいいかも\nLogging output too large. Truncating output. \n\n// folderとfile,名前,url\nFOLDER,test,PRIVATE,https://script.google.com/d/sample\nFILE,無題のプロジェクト,PRIVATE,https://script.google.com/d/1i\n```\n\n権限は以下を確認してください。\nhttps://developers.google.com/apps-script/reference/drive/access\n\n- ANYONE (誰でも見れる)\n- ANYONE_WITH_LINK(リンク知っている人全員)\n- DOMAIN (自社のGsuiteワークスペースの人のみ)\n- DOMAIN_WITH_LINK(自社のワークスペースの人でリンク知っている人のみ)\n- PRIVATE (自分のみ)\n\n\n基本的に機密情報は、ANYONE,ANYONE_WITH_LINKだと合うと、特に気密性高い情報はDOMAINもDOMAIN_WITH_LINKもだめかも。\n気密性の高いファイルは、PRIVATEにして、必要な人だけ個別で追加していくスタイルがよいかと。\n\n","coediting":false,"comments_count":0,"created_at":"2021-03-08T11:09:30+09:00","group":null,"id":"e068314d14879221f5a8","likes_count":4,"private":false,"reactions_count":0,"stocks_count":3,"tags":[{"name":"GAS","versions":[]},{"name":"GoogleDrive","versions":[]},{"name":"共有","versions":[]},{"name":"権限管理","versions":[]}],"title":"Google Driveで共有設定が適切に設定されているかドライブのファイル・フォルダを一覧で調べる方法","updated_at":"2021-03-08T11:09:30+09:00","url":"https://qiita.com/ykhirao/items/e068314d14879221f5a8","user":{"description":"Web Developer From 2016.\r\nPHP/Laravel && React/TypeScript/Node.js\r\n\r\n業務委託の依頼とかはWantedlyとかからでお願いします！","facebook_id":"","followees_count":38,"followers_count":99,"github_login_name":"ykhirao","id":"ykhirao","items_count":71,"linkedin_id":"","location":"Tokyo, Japan","name":"yk","organization":"","permanent_id":112929,"profile_image_url":"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/112929/profile-images/1639030792","team_only":false,"twitter_screen_name":"ykhirao","website_url":"https://www.wantedly.com/id/ykhirao"},"page_views_count":null,"team_membership":null,"organization_url_name":null,"slide":false}},"path":"posts/e068314d14879221f5a8"}
